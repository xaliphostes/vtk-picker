(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();var Z=1e-6,Ee=typeof Float32Array<"u"?Float32Array:Array,il=Math.PI/180;function ol(t){return t*il}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function nc(){var t=new Ee(9);return Ee!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ds(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function cl(t){var e=new Ee(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function fl(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ul(t,e,n,r,a,s,i,o,c){var u=new Ee(9);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,u[4]=a,u[5]=s,u[6]=i,u[7]=o,u[8]=c,u}function gl(t,e,n,r,a,s,i,o,c,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=s,t[5]=i,t[6]=o,t[7]=c,t[8]=u,t}function Nt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function rc(t,e){if(t===e){var n=e[1],r=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function xs(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8],f=g*i-o*u,l=-g*s+o*c,h=u*s-i*c,v=n*f+r*l+a*h;return v?(v=1/v,t[0]=f*v,t[1]=(-g*r+a*u)*v,t[2]=(o*r-a*i)*v,t[3]=l*v,t[4]=(g*n-a*c)*v,t[5]=(-o*n+a*s)*v,t[6]=h*v,t[7]=(-u*n+r*c)*v,t[8]=(i*n-r*s)*v,t):null}function ll(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8];return t[0]=i*g-o*u,t[1]=a*u-r*g,t[2]=r*o-a*i,t[3]=o*c-s*g,t[4]=n*g-a*c,t[5]=a*s-n*o,t[6]=s*u-i*c,t[7]=r*c-n*u,t[8]=n*i-r*s,t}function pl(t){var e=t[0],n=t[1],r=t[2],a=t[3],s=t[4],i=t[5],o=t[6],c=t[7],u=t[8];return e*(u*s-i*c)+n*(-u*a+i*o)+r*(c*a-s*o)}function ac(t,e,n){var r=e[0],a=e[1],s=e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=n[0],h=n[1],v=n[2],p=n[3],y=n[4],T=n[5],S=n[6],d=n[7],x=n[8];return t[0]=l*r+h*i+v*u,t[1]=l*a+h*o+v*g,t[2]=l*s+h*c+v*f,t[3]=p*r+y*i+T*u,t[4]=p*a+y*o+T*g,t[5]=p*s+y*c+T*f,t[6]=S*r+d*i+x*u,t[7]=S*a+d*o+x*g,t[8]=S*s+d*c+x*f,t}function hl(t,e,n){var r=e[0],a=e[1],s=e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=n[0],h=n[1];return t[0]=r,t[1]=a,t[2]=s,t[3]=i,t[4]=o,t[5]=c,t[6]=l*r+h*i+u,t[7]=l*a+h*o+g,t[8]=l*s+h*c+f,t}function yl(t,e,n){var r=e[0],a=e[1],s=e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=Math.sin(n),h=Math.cos(n);return t[0]=h*r+l*i,t[1]=h*a+l*o,t[2]=h*s+l*c,t[3]=h*i-l*r,t[4]=h*o-l*a,t[5]=h*c-l*s,t[6]=u,t[7]=g,t[8]=f,t}function vl(t,e,n){var r=n[0],a=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Tl(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function dl(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function xl(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Sl(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Cl(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=n+n,o=r+r,c=a+a,u=n*i,g=r*i,f=r*o,l=a*i,h=a*o,v=a*c,p=s*i,y=s*o,T=s*c;return t[0]=1-f-v,t[3]=g-T,t[6]=l+y,t[1]=g+T,t[4]=1-u-v,t[7]=h-p,t[2]=l-y,t[5]=h+p,t[8]=1-u-f,t}function wl(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8],f=e[9],l=e[10],h=e[11],v=e[12],p=e[13],y=e[14],T=e[15],S=n*o-r*i,d=n*c-a*i,x=n*u-s*i,w=r*c-a*o,C=r*u-s*o,M=a*u-s*c,R=g*p-f*v,V=g*y-l*v,O=g*T-h*v,D=f*y-l*p,B=f*T-h*p,L=l*T-h*y,F=S*L-d*B+x*D+w*O-C*V+M*R;return F?(F=1/F,t[0]=(o*L-c*B+u*D)*F,t[1]=(c*O-i*L-u*V)*F,t[2]=(i*B-o*O+u*R)*F,t[3]=(a*B-r*L-s*D)*F,t[4]=(n*L-a*O+s*V)*F,t[5]=(r*O-n*B-s*R)*F,t[6]=(p*M-y*C+T*w)*F,t[7]=(y*x-v*M-T*d)*F,t[8]=(v*C-p*x+T*S)*F,t):null}function El(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Ml(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Rl(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Ol(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function sc(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function Dl(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function Ll(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function Vl(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Bl(t,e){var n=t[0],r=t[1],a=t[2],s=t[3],i=t[4],o=t[5],c=t[6],u=t[7],g=t[8],f=e[0],l=e[1],h=e[2],v=e[3],p=e[4],y=e[5],T=e[6],S=e[7],d=e[8];return Math.abs(n-f)<=Z*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-l)<=Z*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-h)<=Z*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(s-v)<=Z*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(i-p)<=Z*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-y)<=Z*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(c-T)<=Z*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-S)<=Z*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(g-d)<=Z*Math.max(1,Math.abs(g),Math.abs(d))}var Fl=ac,ml=sc;const kl=Object.freeze(Object.defineProperty({__proto__:null,add:Ol,adjoint:ll,clone:cl,copy:fl,create:nc,determinant:pl,equals:Bl,exactEquals:Vl,frob:Rl,fromMat2d:Sl,fromMat4:ds,fromQuat:Cl,fromRotation:dl,fromScaling:xl,fromTranslation:Tl,fromValues:ul,identity:Nt,invert:xs,mul:Fl,multiply:ac,multiplyScalar:Dl,multiplyScalarAndAdd:Ll,normalFromMat4:wl,projection:El,rotate:yl,scale:vl,set:gl,str:Ml,sub:ml,subtract:sc,translate:hl,transpose:rc},Symbol.toStringTag,{value:"Module"}));function oa(){var t=new Ee(16);return Ee!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Ul(t){var e=new Ee(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Oe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Nl(t,e,n,r,a,s,i,o,c,u,g,f,l,h,v,p){var y=new Ee(16);return y[0]=t,y[1]=e,y[2]=n,y[3]=r,y[4]=a,y[5]=s,y[6]=i,y[7]=o,y[8]=c,y[9]=u,y[10]=g,y[11]=f,y[12]=l,y[13]=h,y[14]=v,y[15]=p,y}function _l(t,e,n,r,a,s,i,o,c,u,g,f,l,h,v,p,y){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=s,t[5]=i,t[6]=o,t[7]=c,t[8]=u,t[9]=g,t[10]=f,t[11]=l,t[12]=h,t[13]=v,t[14]=p,t[15]=y,t}function Y(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ne(t,e){if(t===e){var n=e[1],r=e[2],a=e[3],s=e[6],i=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=a,t[13]=i,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Ve(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8],f=e[9],l=e[10],h=e[11],v=e[12],p=e[13],y=e[14],T=e[15],S=n*o-r*i,d=n*c-a*i,x=n*u-s*i,w=r*c-a*o,C=r*u-s*o,M=a*u-s*c,R=g*p-f*v,V=g*y-l*v,O=g*T-h*v,D=f*y-l*p,B=f*T-h*p,L=l*T-h*y,F=S*L-d*B+x*D+w*O-C*V+M*R;return F?(F=1/F,t[0]=(o*L-c*B+u*D)*F,t[1]=(a*B-r*L-s*D)*F,t[2]=(p*M-y*C+T*w)*F,t[3]=(l*C-f*M-h*w)*F,t[4]=(c*O-i*L-u*V)*F,t[5]=(n*L-a*O+s*V)*F,t[6]=(y*x-v*M-T*d)*F,t[7]=(g*M-l*x+h*d)*F,t[8]=(i*B-o*O+u*R)*F,t[9]=(r*O-n*B-s*R)*F,t[10]=(v*C-p*x+T*S)*F,t[11]=(f*x-g*C-h*S)*F,t[12]=(o*V-i*D-c*R)*F,t[13]=(n*D-r*V+a*R)*F,t[14]=(p*d-v*w-y*S)*F,t[15]=(g*w-f*d+l*S)*F,t):null}function Gl(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8],f=e[9],l=e[10],h=e[11],v=e[12],p=e[13],y=e[14],T=e[15];return t[0]=o*(l*T-h*y)-f*(c*T-u*y)+p*(c*h-u*l),t[1]=-(r*(l*T-h*y)-f*(a*T-s*y)+p*(a*h-s*l)),t[2]=r*(c*T-u*y)-o*(a*T-s*y)+p*(a*u-s*c),t[3]=-(r*(c*h-u*l)-o*(a*h-s*l)+f*(a*u-s*c)),t[4]=-(i*(l*T-h*y)-g*(c*T-u*y)+v*(c*h-u*l)),t[5]=n*(l*T-h*y)-g*(a*T-s*y)+v*(a*h-s*l),t[6]=-(n*(c*T-u*y)-i*(a*T-s*y)+v*(a*u-s*c)),t[7]=n*(c*h-u*l)-i*(a*h-s*l)+g*(a*u-s*c),t[8]=i*(f*T-h*p)-g*(o*T-u*p)+v*(o*h-u*f),t[9]=-(n*(f*T-h*p)-g*(r*T-s*p)+v*(r*h-s*f)),t[10]=n*(o*T-u*p)-i*(r*T-s*p)+v*(r*u-s*o),t[11]=-(n*(o*h-u*f)-i*(r*h-s*f)+g*(r*u-s*o)),t[12]=-(i*(f*y-l*p)-g*(o*y-c*p)+v*(o*l-c*f)),t[13]=n*(f*y-l*p)-g*(r*y-a*p)+v*(r*l-a*f),t[14]=-(n*(o*y-c*p)-i*(r*y-a*p)+v*(r*c-a*o)),t[15]=n*(o*l-c*f)-i*(r*l-a*f)+g*(r*c-a*o),t}function bl(t){var e=t[0],n=t[1],r=t[2],a=t[3],s=t[4],i=t[5],o=t[6],c=t[7],u=t[8],g=t[9],f=t[10],l=t[11],h=t[12],v=t[13],p=t[14],y=t[15],T=e*i-n*s,S=e*o-r*s,d=e*c-a*s,x=n*o-r*i,w=n*c-a*i,C=r*c-a*o,M=u*v-g*h,R=u*p-f*h,V=u*y-l*h,O=g*p-f*v,D=g*y-l*v,B=f*y-l*p;return T*B-S*D+d*O+x*V-w*R+C*M}function pe(t,e,n){var r=e[0],a=e[1],s=e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=e[9],h=e[10],v=e[11],p=e[12],y=e[13],T=e[14],S=e[15],d=n[0],x=n[1],w=n[2],C=n[3];return t[0]=d*r+x*o+w*f+C*p,t[1]=d*a+x*c+w*l+C*y,t[2]=d*s+x*u+w*h+C*T,t[3]=d*i+x*g+w*v+C*S,d=n[4],x=n[5],w=n[6],C=n[7],t[4]=d*r+x*o+w*f+C*p,t[5]=d*a+x*c+w*l+C*y,t[6]=d*s+x*u+w*h+C*T,t[7]=d*i+x*g+w*v+C*S,d=n[8],x=n[9],w=n[10],C=n[11],t[8]=d*r+x*o+w*f+C*p,t[9]=d*a+x*c+w*l+C*y,t[10]=d*s+x*u+w*h+C*T,t[11]=d*i+x*g+w*v+C*S,d=n[12],x=n[13],w=n[14],C=n[15],t[12]=d*r+x*o+w*f+C*p,t[13]=d*a+x*c+w*l+C*y,t[14]=d*s+x*u+w*h+C*T,t[15]=d*i+x*g+w*v+C*S,t}function le(t,e,n){var r=n[0],a=n[1],s=n[2],i,o,c,u,g,f,l,h,v,p,y,T;return e===t?(t[12]=e[0]*r+e[4]*a+e[8]*s+e[12],t[13]=e[1]*r+e[5]*a+e[9]*s+e[13],t[14]=e[2]*r+e[6]*a+e[10]*s+e[14],t[15]=e[3]*r+e[7]*a+e[11]*s+e[15]):(i=e[0],o=e[1],c=e[2],u=e[3],g=e[4],f=e[5],l=e[6],h=e[7],v=e[8],p=e[9],y=e[10],T=e[11],t[0]=i,t[1]=o,t[2]=c,t[3]=u,t[4]=g,t[5]=f,t[6]=l,t[7]=h,t[8]=v,t[9]=p,t[10]=y,t[11]=T,t[12]=i*r+g*a+v*s+e[12],t[13]=o*r+f*a+p*s+e[13],t[14]=c*r+l*a+y*s+e[14],t[15]=u*r+h*a+T*s+e[15]),t}function en(t,e,n){var r=n[0],a=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ye(t,e,n,r){var a=r[0],s=r[1],i=r[2],o=Math.hypot(a,s,i),c,u,g,f,l,h,v,p,y,T,S,d,x,w,C,M,R,V,O,D,B,L,F,U;return o<Z?null:(o=1/o,a*=o,s*=o,i*=o,c=Math.sin(n),u=Math.cos(n),g=1-u,f=e[0],l=e[1],h=e[2],v=e[3],p=e[4],y=e[5],T=e[6],S=e[7],d=e[8],x=e[9],w=e[10],C=e[11],M=a*a*g+u,R=s*a*g+i*c,V=i*a*g-s*c,O=a*s*g-i*c,D=s*s*g+u,B=i*s*g+a*c,L=a*i*g+s*c,F=s*i*g-a*c,U=i*i*g+u,t[0]=f*M+p*R+d*V,t[1]=l*M+y*R+x*V,t[2]=h*M+T*R+w*V,t[3]=v*M+S*R+C*V,t[4]=f*O+p*D+d*B,t[5]=l*O+y*D+x*B,t[6]=h*O+T*D+w*B,t[7]=v*O+S*D+C*B,t[8]=f*L+p*F+d*U,t[9]=l*L+y*F+x*U,t[10]=h*L+T*F+w*U,t[11]=v*L+S*F+C*U,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Ss(t,e,n){var r=Math.sin(n),a=Math.cos(n),s=e[4],i=e[5],o=e[6],c=e[7],u=e[8],g=e[9],f=e[10],l=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*a+u*r,t[5]=i*a+g*r,t[6]=o*a+f*r,t[7]=c*a+l*r,t[8]=u*a-s*r,t[9]=g*a-i*r,t[10]=f*a-o*r,t[11]=l*a-c*r,t}function Cs(t,e,n){var r=Math.sin(n),a=Math.cos(n),s=e[0],i=e[1],o=e[2],c=e[3],u=e[8],g=e[9],f=e[10],l=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*a-u*r,t[1]=i*a-g*r,t[2]=o*a-f*r,t[3]=c*a-l*r,t[8]=s*r+u*a,t[9]=i*r+g*a,t[10]=o*r+f*a,t[11]=c*r+l*a,t}function ws(t,e,n){var r=Math.sin(n),a=Math.cos(n),s=e[0],i=e[1],o=e[2],c=e[3],u=e[4],g=e[5],f=e[6],l=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*a+u*r,t[1]=i*a+g*r,t[2]=o*a+f*r,t[3]=c*a+l*r,t[4]=u*a-s*r,t[5]=g*a-i*r,t[6]=f*a-o*r,t[7]=l*a-c*r,t}function ic(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function oc(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cc(t,e,n){var r=n[0],a=n[1],s=n[2],i=Math.hypot(r,a,s),o,c,u;return i<Z?null:(i=1/i,r*=i,a*=i,s*=i,o=Math.sin(e),c=Math.cos(e),u=1-c,t[0]=r*r*u+c,t[1]=a*r*u+s*o,t[2]=s*r*u-a*o,t[3]=0,t[4]=r*a*u-s*o,t[5]=a*a*u+c,t[6]=s*a*u+r*o,t[7]=0,t[8]=r*s*u+a*o,t[9]=a*s*u-r*o,t[10]=s*s*u+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function $l(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function zl(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Wl(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fc(t,e,n){var r=e[0],a=e[1],s=e[2],i=e[3],o=r+r,c=a+a,u=s+s,g=r*o,f=r*c,l=r*u,h=a*c,v=a*u,p=s*u,y=i*o,T=i*c,S=i*u;return t[0]=1-(h+p),t[1]=f+S,t[2]=l-T,t[3]=0,t[4]=f-S,t[5]=1-(g+p),t[6]=v+y,t[7]=0,t[8]=l+T,t[9]=v-y,t[10]=1-(g+h),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Hl(t,e){var n=new Ee(3),r=-e[0],a=-e[1],s=-e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=r*r+a*a+s*s+i*i;return f>0?(n[0]=(o*i+g*r+c*s-u*a)*2/f,n[1]=(c*i+g*a+u*r-o*s)*2/f,n[2]=(u*i+g*s+o*a-c*r)*2/f):(n[0]=(o*i+g*r+c*s-u*a)*2,n[1]=(c*i+g*a+u*r-o*s)*2,n[2]=(u*i+g*s+o*a-c*r)*2),fc(t,e,n),t}function Al(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Es(t,e){var n=e[0],r=e[1],a=e[2],s=e[4],i=e[5],o=e[6],c=e[8],u=e[9],g=e[10];return t[0]=Math.hypot(n,r,a),t[1]=Math.hypot(s,i,o),t[2]=Math.hypot(c,u,g),t}function Ha(t,e){var n=new Ee(3);Es(n,e);var r=1/n[0],a=1/n[1],s=1/n[2],i=e[0]*r,o=e[1]*a,c=e[2]*s,u=e[4]*r,g=e[5]*a,f=e[6]*s,l=e[8]*r,h=e[9]*a,v=e[10]*s,p=i+g+v,y=0;return p>0?(y=Math.sqrt(p+1)*2,t[3]=.25*y,t[0]=(f-h)/y,t[1]=(l-c)/y,t[2]=(o-u)/y):i>g&&i>v?(y=Math.sqrt(1+i-g-v)*2,t[3]=(f-h)/y,t[0]=.25*y,t[1]=(o+u)/y,t[2]=(l+c)/y):g>v?(y=Math.sqrt(1+g-i-v)*2,t[3]=(l-c)/y,t[0]=(o+u)/y,t[1]=.25*y,t[2]=(f+h)/y):(y=Math.sqrt(1+v-i-g)*2,t[3]=(o-u)/y,t[0]=(l+c)/y,t[1]=(f+h)/y,t[2]=.25*y),t}function uc(t,e,n,r){var a=e[0],s=e[1],i=e[2],o=e[3],c=a+a,u=s+s,g=i+i,f=a*c,l=a*u,h=a*g,v=s*u,p=s*g,y=i*g,T=o*c,S=o*u,d=o*g,x=r[0],w=r[1],C=r[2];return t[0]=(1-(v+y))*x,t[1]=(l+d)*x,t[2]=(h-S)*x,t[3]=0,t[4]=(l-d)*w,t[5]=(1-(f+y))*w,t[6]=(p+T)*w,t[7]=0,t[8]=(h+S)*C,t[9]=(p-T)*C,t[10]=(1-(f+v))*C,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function jl(t,e,n,r,a){var s=e[0],i=e[1],o=e[2],c=e[3],u=s+s,g=i+i,f=o+o,l=s*u,h=s*g,v=s*f,p=i*g,y=i*f,T=o*f,S=c*u,d=c*g,x=c*f,w=r[0],C=r[1],M=r[2],R=a[0],V=a[1],O=a[2],D=(1-(p+T))*w,B=(h+x)*w,L=(v-d)*w,F=(h-x)*C,U=(1-(l+T))*C,N=(y+S)*C,G=(v+d)*M,H=(y-S)*M,k=(1-(l+p))*M;return t[0]=D,t[1]=B,t[2]=L,t[3]=0,t[4]=F,t[5]=U,t[6]=N,t[7]=0,t[8]=G,t[9]=H,t[10]=k,t[11]=0,t[12]=n[0]+R-(D*R+F*V+G*O),t[13]=n[1]+V-(B*R+U*V+H*O),t[14]=n[2]+O-(L*R+N*V+k*O),t[15]=1,t}function Kn(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=n+n,o=r+r,c=a+a,u=n*i,g=r*i,f=r*o,l=a*i,h=a*o,v=a*c,p=s*i,y=s*o,T=s*c;return t[0]=1-f-v,t[1]=g+T,t[2]=l-y,t[3]=0,t[4]=g-T,t[5]=1-u-v,t[6]=h+p,t[7]=0,t[8]=l+y,t[9]=h-p,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Kl(t,e,n,r,a,s,i){var o=1/(n-e),c=1/(a-r),u=1/(s-i);return t[0]=s*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*c,t[6]=0,t[7]=0,t[8]=(n+e)*o,t[9]=(a+r)*c,t[10]=(i+s)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*s*2*u,t[15]=0,t}function gc(t,e,n,r,a){var s=1/Math.tan(e/2),i;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(i=1/(r-a),t[10]=(a+r)*i,t[14]=2*a*r*i):(t[10]=-1,t[14]=-2*r),t}var Pl=gc;function Xl(t,e,n,r,a){var s=1/Math.tan(e/2),i;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(i=1/(r-a),t[10]=a*i,t[14]=a*r*i):(t[10]=-1,t[14]=-r),t}function Il(t,e,n,r){var a=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),i=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(i+o),u=2/(a+s);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((i-o)*c*.5),t[9]=(a-s)*u*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function lc(t,e,n,r,a,s,i){var o=1/(e-n),c=1/(r-a),u=1/(s-i);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*o,t[13]=(a+r)*c,t[14]=(i+s)*u,t[15]=1,t}var pc=lc;function Yl(t,e,n,r,a,s,i){var o=1/(e-n),c=1/(r-a),u=1/(s-i);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(e+n)*o,t[13]=(a+r)*c,t[14]=s*u,t[15]=1,t}function hc(t,e,n,r){var a,s,i,o,c,u,g,f,l,h,v=e[0],p=e[1],y=e[2],T=r[0],S=r[1],d=r[2],x=n[0],w=n[1],C=n[2];return Math.abs(v-x)<Z&&Math.abs(p-w)<Z&&Math.abs(y-C)<Z?Y(t):(g=v-x,f=p-w,l=y-C,h=1/Math.hypot(g,f,l),g*=h,f*=h,l*=h,a=S*l-d*f,s=d*g-T*l,i=T*f-S*g,h=Math.hypot(a,s,i),h?(h=1/h,a*=h,s*=h,i*=h):(a=0,s=0,i=0),o=f*i-l*s,c=l*a-g*i,u=g*s-f*a,h=Math.hypot(o,c,u),h?(h=1/h,o*=h,c*=h,u*=h):(o=0,c=0,u=0),t[0]=a,t[1]=o,t[2]=g,t[3]=0,t[4]=s,t[5]=c,t[6]=f,t[7]=0,t[8]=i,t[9]=u,t[10]=l,t[11]=0,t[12]=-(a*v+s*p+i*y),t[13]=-(o*v+c*p+u*y),t[14]=-(g*v+f*p+l*y),t[15]=1,t)}function Ql(t,e,n,r){var a=e[0],s=e[1],i=e[2],o=r[0],c=r[1],u=r[2],g=a-n[0],f=s-n[1],l=i-n[2],h=g*g+f*f+l*l;h>0&&(h=1/Math.sqrt(h),g*=h,f*=h,l*=h);var v=c*l-u*f,p=u*g-o*l,y=o*f-c*g;return h=v*v+p*p+y*y,h>0&&(h=1/Math.sqrt(h),v*=h,p*=h,y*=h),t[0]=v,t[1]=p,t[2]=y,t[3]=0,t[4]=f*y-l*p,t[5]=l*v-g*y,t[6]=g*p-f*v,t[7]=0,t[8]=g,t[9]=f,t[10]=l,t[11]=0,t[12]=a,t[13]=s,t[14]=i,t[15]=1,t}function Zl(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function ql(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Jl(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function yc(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function ep(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function tp(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function np(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function rp(t,e){var n=t[0],r=t[1],a=t[2],s=t[3],i=t[4],o=t[5],c=t[6],u=t[7],g=t[8],f=t[9],l=t[10],h=t[11],v=t[12],p=t[13],y=t[14],T=t[15],S=e[0],d=e[1],x=e[2],w=e[3],C=e[4],M=e[5],R=e[6],V=e[7],O=e[8],D=e[9],B=e[10],L=e[11],F=e[12],U=e[13],N=e[14],G=e[15];return Math.abs(n-S)<=Z*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(r-d)<=Z*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-x)<=Z*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(s-w)<=Z*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(i-C)<=Z*Math.max(1,Math.abs(i),Math.abs(C))&&Math.abs(o-M)<=Z*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(c-R)<=Z*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(u-V)<=Z*Math.max(1,Math.abs(u),Math.abs(V))&&Math.abs(g-O)<=Z*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(f-D)<=Z*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(l-B)<=Z*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(h-L)<=Z*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(v-F)<=Z*Math.max(1,Math.abs(v),Math.abs(F))&&Math.abs(p-U)<=Z*Math.max(1,Math.abs(p),Math.abs(U))&&Math.abs(y-N)<=Z*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(T-G)<=Z*Math.max(1,Math.abs(T),Math.abs(G))}var Aa=pe,ap=yc;const ja=Object.freeze(Object.defineProperty({__proto__:null,add:Jl,adjoint:Gl,clone:Ul,copy:Oe,create:oa,determinant:bl,equals:rp,exactEquals:np,frob:ql,fromQuat:Kn,fromQuat2:Hl,fromRotation:cc,fromRotationTranslation:fc,fromRotationTranslationScale:uc,fromRotationTranslationScaleOrigin:jl,fromScaling:oc,fromTranslation:ic,fromValues:Nl,fromXRotation:$l,fromYRotation:zl,fromZRotation:Wl,frustum:Kl,getRotation:Ha,getScaling:Es,getTranslation:Al,identity:Y,invert:Ve,lookAt:hc,mul:Aa,multiply:pe,multiplyScalar:ep,multiplyScalarAndAdd:tp,ortho:pc,orthoNO:lc,orthoZO:Yl,perspective:Pl,perspectiveFromFieldOfView:Il,perspectiveNO:gc,perspectiveZO:Xl,rotate:Ye,rotateX:Ss,rotateY:Cs,rotateZ:ws,scale:en,set:_l,str:Zl,sub:ap,subtract:yc,targetTo:Ql,translate:le,transpose:ne},Symbol.toStringTag,{value:"Module"}));function vc(){var t=new Ee(3);return Ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ka(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function di(t,e,n){var r=new Ee(3);return r[0]=t,r[1]=e,r[2]=n,r}function Tc(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function it(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function Gn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function vt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function at(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function sp(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return Math.hypot(n,r,a)}function ip(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function mt(t,e){var n=e[0],r=e[1],a=e[2],s=n*n+r*r+a*a;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Ms(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function dn(t,e,n){var r=e[0],a=e[1],s=e[2],i=n[0],o=n[1],c=n[2];return t[0]=a*c-s*o,t[1]=s*i-r*c,t[2]=r*o-a*i,t}function q(t,e,n){var r=e[0],a=e[1],s=e[2],i=n[3]*r+n[7]*a+n[11]*s+n[15];return i=i||1,t[0]=(n[0]*r+n[4]*a+n[8]*s+n[12])/i,t[1]=(n[1]*r+n[5]*a+n[9]*s+n[13])/i,t[2]=(n[2]*r+n[6]*a+n[10]*s+n[14])/i,t}function xi(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Si(t,e){var n=t[0],r=t[1],a=t[2],s=e[0],i=e[1],o=e[2];return Math.abs(n-s)<=Z*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-i)<=Z*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(a-o)<=Z*Math.max(1,Math.abs(a),Math.abs(o))}var Pa=vt,op=sp,dc=Ka;(function(){var t=vc();return function(e,n,r,a,s,i){var o,c;for(n||(n=3),r||(r=0),a?c=Math.min(a*n+r,e.length):c=e.length,o=r;o<c;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],s(t,t,i),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();function cp(){var t=new Ee(4);return Ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function fp(t,e,n,r){var a=new Ee(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a}function up(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=n*n+r*r+a*a+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=n*i,t[1]=r*i,t[2]=a*i,t[3]=s*i,t}function ht(t,e,n){var r=e[0],a=e[1],s=e[2],i=e[3];return t[0]=n[0]*r+n[4]*a+n[8]*s+n[12]*i,t[1]=n[1]*r+n[5]*a+n[9]*s+n[13]*i,t[2]=n[2]*r+n[6]*a+n[10]*s+n[14]*i,t[3]=n[3]*r+n[7]*a+n[11]*s+n[15]*i,t}(function(){var t=cp();return function(e,n,r,a,s,i){var o,c;for(n||(n=4),r||(r=0),a?c=Math.min(a*n+r,e.length):c=e.length,o=r;o<c;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],s(t,t,i),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})();function tn(){var t=new Ee(4);return Ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Rs(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function gp(t,e){var n=Math.acos(e[3])*2,r=Math.sin(n/2);return r>Z?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Ci(t,e,n){var r=e[0],a=e[1],s=e[2],i=e[3],o=n[0],c=n[1],u=n[2],g=n[3];return t[0]=r*g+i*o+a*u-s*c,t[1]=a*g+i*c+s*o-r*u,t[2]=s*g+i*u+r*c-a*o,t[3]=i*g-r*o-a*c-s*u,t}function Ur(t,e,n,r){var a=e[0],s=e[1],i=e[2],o=e[3],c=n[0],u=n[1],g=n[2],f=n[3],l,h,v,p,y;return h=a*c+s*u+i*g+o*f,h<0&&(h=-h,c=-c,u=-u,g=-g,f=-f),1-h>Z?(l=Math.acos(h),v=Math.sin(l),p=Math.sin((1-r)*l)/v,y=Math.sin(r*l)/v):(p=1-r,y=r),t[0]=p*a+y*c,t[1]=p*s+y*u,t[2]=p*i+y*g,t[3]=p*o+y*f,t}function lp(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function pp(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[a*3+a]&&(a=2);var s=(a+1)%3,i=(a+2)%3;r=Math.sqrt(e[a*3+a]-e[s*3+s]-e[i*3+i]+1),t[a]=.5*r,r=.5/r,t[3]=(e[s*3+i]-e[i*3+s])*r,t[s]=(e[s*3+a]+e[a*3+s])*r,t[i]=(e[i*3+a]+e[a*3+i])*r}return t}var wi=fp,xc=up;(function(){var t=vc(),e=di(1,0,0),n=di(0,1,0);return function(r,a,s){var i=Ms(a,s);return i<-.999999?(dn(t,e,a),dc(t)<1e-6&&dn(t,n,a),mt(t,t),Rs(r,t,Math.PI),r):i>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(dn(t,a,s),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+i,xc(r,r))}})();(function(){var t=tn(),e=tn();return function(n,r,a,s,i,o){return Ur(t,r,i,o),Ur(e,a,s,o),Ur(n,t,e,2*o*(1-o)),n}})();(function(){var t=nc();return function(e,n,r,a){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],xc(e,pp(e,t))}})();var Pe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ca(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function hp(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}),n}var yp=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,a,s;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(a=r;a--!==0;)if(!t(e[a],n[a]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(s=Object.keys(e),r=s.length,r!==Object.keys(n).length)return!1;for(a=r;a--!==0;)if(!Object.prototype.hasOwnProperty.call(n,s[a]))return!1;for(a=r;a--!==0;){var i=s[a];if(!t(e[i],n[i]))return!1}return!0}return e!==e&&n!==n};const Sc=ca(yp);var Ei=Object.prototype.toString,Cc=function(e){var n=Ei.call(e),r=n==="[object Arguments]";return r||(r=n!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Ei.call(e.callee)==="[object Function]"),r},wa,Mi;function vp(){if(Mi)return wa;Mi=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=Cc,a=Object.prototype.propertyIsEnumerable,s=!a.call({toString:null},"toString"),i=a.call(function(){},"prototype"),o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(l){var h=l.constructor;return h&&h.prototype===l},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},g=function(){if(typeof window>"u")return!1;for(var l in window)try{if(!u["$"+l]&&e.call(window,l)&&window[l]!==null&&typeof window[l]=="object")try{c(window[l])}catch{return!0}}catch{return!0}return!1}(),f=function(l){if(typeof window>"u"||!g)return c(l);try{return c(l)}catch{return!1}};t=function(h){var v=h!==null&&typeof h=="object",p=n.call(h)==="[object Function]",y=r(h),T=v&&n.call(h)==="[object String]",S=[];if(!v&&!p&&!y)throw new TypeError("Object.keys called on a non-object");var d=i&&p;if(T&&h.length>0&&!e.call(h,0))for(var x=0;x<h.length;++x)S.push(String(x));if(y&&h.length>0)for(var w=0;w<h.length;++w)S.push(String(w));else for(var C in h)!(d&&C==="prototype")&&e.call(h,C)&&S.push(String(C));if(s)for(var M=f(h),R=0;R<o.length;++R)!(M&&o[R]==="constructor")&&e.call(h,o[R])&&S.push(o[R]);return S}}return wa=t,wa}var Tp=Array.prototype.slice,dp=Cc,Ri=Object.keys,Nr=Ri?function(e){return Ri(e)}:vp(),Oi=Object.keys;Nr.shim=function(){if(Object.keys){var e=function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2);e||(Object.keys=function(r){return dp(r)?Oi(Tp.call(r)):Oi(r)})}else Object.keys=Nr;return Object.keys||Nr};var xp=Nr,_r=Object.defineProperty||!1;if(_r)try{_r({},"a",{value:1})}catch{_r=!1}var wc=_r,Sp=SyntaxError,Cp=TypeError,wp=Object.getOwnPropertyDescriptor,Gr=wp;if(Gr)try{Gr([],"length")}catch{Gr=null}var Ep=Gr,Di=wc,Mp=Sp,un=Cp,Li=Ep,Rp=function(e,n,r){if(!e||typeof e!="object"&&typeof e!="function")throw new un("`obj` must be an object or a function`");if(typeof n!="string"&&typeof n!="symbol")throw new un("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new un("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new un("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new un("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new un("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,i=arguments.length>5?arguments[5]:null,o=arguments.length>6?arguments[6]:!1,c=!!Li&&Li(e,n);if(Di)Di(e,n,{configurable:i===null&&c?c.configurable:!i,enumerable:a===null&&c?c.enumerable:!a,value:r,writable:s===null&&c?c.writable:!s});else if(o||!a&&!s&&!i)e[n]=r;else throw new Mp("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Xa=wc,Ec=function(){return!!Xa};Ec.hasArrayLengthDefineBug=function(){if(!Xa)return null;try{return Xa([],"length",{value:1}).length!==1}catch{return!0}};var Op=Ec,Dp=xp,Lp=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",Vp=Object.prototype.toString,Bp=Array.prototype.concat,Vi=Rp,Fp=function(t){return typeof t=="function"&&Vp.call(t)==="[object Function]"},Mc=Op(),mp=function(t,e,n,r){if(e in t){if(r===!0){if(t[e]===n)return}else if(!Fp(r)||!r())return}Mc?Vi(t,e,n,!0):Vi(t,e,n)},Rc=function(t,e){var n=arguments.length>2?arguments[2]:{},r=Dp(e);Lp&&(r=Bp.call(r,Object.getOwnPropertySymbols(e)));for(var a=0;a<r.length;a+=1)mp(t,r[a],e[r[a]],n[r[a]])};Rc.supportsDescriptors=!!Mc;var Oc=Rc,br={exports:{}};typeof self<"u"?br.exports=self:typeof window<"u"?br.exports=window:br.exports=Function("return this")();var Dc=br.exports,kp=Dc,Lc=function(){return typeof Pe!="object"||!Pe||Pe.Math!==Math||Pe.Array!==Array?kp:Pe},Up=Oc,Np=Lc,_p=function(){var e=Np();if(Up.supportsDescriptors){var n=Object.getOwnPropertyDescriptor(e,"globalThis");(!n||n.configurable&&(n.enumerable||!n.writable||globalThis!==e))&&Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!0})}else(typeof globalThis!="object"||globalThis!==e)&&(e.globalThis=e);return e},Gp=Oc,bp=Dc,Vc=Lc,$p=_p,zp=Vc(),Bc=function(){return zp};Gp(Bc,{getPolyfill:Vc,implementation:bp,shim:$p});var Wp=Bc;const Hp=ca(Wp),Ze=Hp(),Fc={vtkObject:()=>null};function et(t){if(t==null||t.isA)return t;if(!t.vtkClass)return Ze.console&&Ze.console.error&&Ze.console.error("Invalid VTK object"),null;const e=Fc[t.vtkClass];if(!e)return Ze.console&&Ze.console.error&&Ze.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;const n={...t};Object.keys(n).forEach(a=>{n[a]&&typeof n[a]=="object"&&n[a].vtkClass&&(n[a]=et(n[a]))});const r=e(n);return r&&r.modified&&r.modified(),r}function Ap(t,e){Fc[t]=e}et.register=Ap;class Ea extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let Ia=0;const mc=t=>{throw new Error(`Named parameter '${t}' is missing`)},kc=Symbol("void");function jp(){return Ia}const Uc={};function It(){}const Kp=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];Kp.forEach(t=>{Uc[t]=It});Ze.console=console.hasOwnProperty("log")?console:Uc;const kt={debug:It,error:Ze.console.error||It,info:Ze.console.info||It,log:Ze.console.log||It,warn:Ze.console.warn||It};function Nc(t,e){kt[t]&&(kt[t]=e||It)}function _c(){kt.log(...arguments)}function Gc(){kt.info(...arguments)}function Pr(){kt.debug(...arguments)}function X(){kt.error(...arguments)}function fa(){kt.warn(...arguments)}const Bi={};function bc(t){Bi[t]||(kt.error(t),Bi[t]=!0)}const De=Object.create(null);De.Float32Array=Float32Array;De.Float64Array=Float64Array;De.Uint8Array=Uint8Array;De.Int8Array=Int8Array;De.Uint16Array=Uint16Array;De.Int16Array=Int16Array;De.Uint32Array=Uint32Array;De.Int32Array=Int32Array;De.Uint8ClampedArray=Uint8ClampedArray;try{De.BigInt64Array=BigInt64Array,De.BigUint64Array=BigUint64Array}catch{}function Dn(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return new(De[t]||Float64Array)(...n)}function Os(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return(De[t]||Float64Array).from(...n)}function ua(t){return t.charAt(0).toUpperCase()+t.slice(1)}function ce(t){return ua(t[0]==="_"?t.slice(1):t)}function $c(t){return t.charAt(0).toLowerCase()+t.slice(1)}function zc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const r=["TB","GB","MB","KB"];let a=Number(t),s="B";for(;a>n;)a/=n,s=r.pop();return`${a.toFixed(e)} ${s}`}function Wc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const n=[];let r=t;for(;r>1e3;)n.push(`000${r%1e3}`.slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(e)}function Hc(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function Pp(t){return Object.values(De).some(e=>t instanceof e)}function Xp(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return!1}function Ip(t,e){return Object.keys(t).find(n=>t[n]===e)}function Ac(t){return t&&t.isA?t.getState():t}function Ds(t){setTimeout(t,0)}function jc(t,e){const n=performance.now();t.finally(()=>{const r=performance.now()-n;e(r)})}function Me(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Hc(e);const n=[];if(Number.isInteger(e.mtime)||(e.mtime=++Ia),!("classHierarchy"in e))e.classHierarchy=new Ea("vtkObject");else if(!(e.classHierarchy instanceof Ea)){const s=new Ea;for(let i=0;i<e.classHierarchy.length;i++)s.push(e.classHierarchy[i]);e.classHierarchy=s}function r(s){n[s]=null}function a(s){function i(){r(s)}return Object.freeze({unsubscribe:i})}return t.isDeleted=()=>!!e.deleted,t.modified=s=>{if(e.deleted){X("instance deleted - cannot call any method");return}s&&s<t.getMTime()||(e.mtime=++Ia,n.forEach(i=>i&&i(t)))},t.onModified=s=>{if(e.deleted)return X("instance deleted - cannot call any method"),null;const i=n.length;return n.push(s),a(i)},t.getMTime=()=>e.mtime,t.isA=s=>{let i=e.classHierarchy.length;for(;i--;)if(e.classHierarchy[i]===s)return!0;return!1},t.getClassName=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-s]},t.set=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(s).forEach(u=>{const g=o?null:t[`set${ua(u)}`];g&&Array.isArray(s[u])&&g.length>1?c=g(...s[u])||c:g?c=g(s[u])||c:(["mtime"].indexOf(u)===-1&&!i&&fa(`Warning: Set value to model directly ${u}, ${s[u]}`),c=e[u]!==s[u]||c,e[u]=s[u])}),c},t.get=function(){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];if(!i.length)return e;const c={};return i.forEach(u=>{c[u]=e[u]}),c},t.getReferenceByName=s=>e[s],t.delete=()=>{Object.keys(e).forEach(s=>delete e[s]),n.forEach((s,i)=>r(i)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;const s={...e,vtkClass:t.getClassName()};Object.keys(s).forEach(o=>{s[o]===null||s[o]===void 0||o[0]==="_"?delete s[o]:s[o].isA?s[o]=s[o].getState():Array.isArray(s[o])?s[o]=s[o].map(Ac):Pp(s[o])&&(s[o]=Array.from(s[o]))});const i={};return Object.keys(s).sort().forEach(o=>{i[o]=s[o]}),i.mtime&&delete i.mtime,i},t.shallowCopy=function(s){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(s.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${s.getClassName()} into ${t.getClassName()}`);const o=s.get(),c=Object.keys(e).sort();Object.keys(o).sort().forEach(g=>{const f=c.indexOf(g);f===-1?i&&Pr(`add ${g} in shallowCopy`):c.splice(f,1),e[g]=o[g]}),c.length&&i&&Pr(`Untouched keys: ${c.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}const Yp={object(t,e,n){return function(){return{...e[n.name]}}}};function Ne(t,e,n){n.forEach(r=>{if(typeof r=="object"){const a=Yp[r.type];a?t[`get${ce(r.name)}`]=a(t,e,r):t[`get${ce(r.name)}`]=()=>e[r.name]}else t[`get${ce(r)}`]=()=>e[r]})}const Kc={enum(t,e,n){const r=`_on${ce(n.name)}Changed`;return a=>{var s;if(typeof a=="string"){if(n.enum[a]!==void 0)return e[n.name]!==n.enum[a]?(e[n.name]=n.enum[a],t.modified(),!0):!1;throw X(`Set Enum with invalid argument ${n}, ${a}`),new RangeError("Set Enum with invalid string argument")}if(typeof a=="number"){if(e[n.name]!==a){if(Object.keys(n.enum).map(i=>n.enum[i]).indexOf(a)!==-1){const i=e[n.name];return e[n.name]=a,(s=e[r])==null||s.call(e,t,e,a,i),t.modified(),!0}throw X(`Set Enum outside numeric range ${n}, ${a}`),new RangeError("Set Enum outside numeric range")}return!1}throw X(`Set Enum with invalid argument (String/Number) ${n}, ${a}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,n){var a;((a=n.params)==null?void 0:a.length)===1&&fa('Setter of type "object" with a single "param" field is not supported');const r=`_on${ce(n.name)}Changed`;return function(){var u,g;for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];let c;if(i.length>1&&((u=n.params)!=null&&u.length)?c=n.params.reduce((f,l,h)=>Object.assign(f,{[l]:i[h]}),{}):c=i[0],!Sc(e[n.name],c)){const f=e[n.name];return e[n.name]=c,(g=e[r])==null||g.call(e,t,e,c,f),t.modified(),!0}return!1}}};function Fi(t){if(typeof t=="object"){const e=Kc[t.type];if(e)return(n,r)=>e(n,r,t);throw X(`No setter for field ${t}`),new TypeError("No setter for field")}return function(n,r){const a=`_on${ce(t)}Changed`;return function(i){var o;if(r.deleted)return X("instance deleted - cannot call any method"),!1;if(r[t]!==i){const c=r[t.name];return r[t]=i,(o=r[a])==null||o.call(r,n,r,i,c),n.modified(),!0}return!1}}}function nr(t,e,n){n.forEach(r=>{typeof r=="object"?t[`set${ce(r.name)}`]=Fi(r)(t,e):t[`set${ce(r)}`]=Fi(r)(t,e)})}function Te(t,e,n){Ne(t,e,n),nr(t,e,n)}function Ln(t,e,n){n.forEach(r=>{t[`get${ce(r)}`]=()=>e[r]?Array.from(e[r]):e[r],t[`get${ce(r)}ByReference`]=()=>e[r]})}function Ls(t,e,n,r){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;n.forEach(s=>{if(e[s]&&r&&e[s].length!==r)throw new RangeError(`Invalid initial number of values for array (${s})`);const i=`_on${ce(s)}Changed`;t[`set${ce(s)}`]=function(){var h;if(e.deleted)return X("instance deleted - cannot call any method"),!1;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];let g=c,f,l=!1;if(g.length===1&&(g[0]==null||g[0].length>=0)&&(g=g[0],l=!0),g==null)f=e[s]!==g;else{if(r&&g.length!==r)if(g.length<r&&a!==void 0)for(g=Array.from(g),l=!1;g.length<r;)g.push(a);else throw new RangeError(`Invalid number of values for array setter (${s})`);f=e[s]==null||e[s].length!==g.length;for(let v=0;!f&&v<g.length;++v)f=e[s][v]!==g[v];f&&l&&(g=Array.from(g))}if(f){const v=e[s.name];e[s]=g,(h=e[i])==null||h.call(e,t,e,g,v),t.modified()}return f},t[`set${ce(s)}From`]=o=>{const c=e[s];o.forEach((u,g)=>{c[g]=u})}})}function Vs(t,e,n,r){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;Ln(t,e,n),Ls(t,e,n,r,a)}function rr(t,e,n){for(let r=0;r<n.length;r++){const a=n[r];e[a]!==void 0&&(e[`_${a}`]=e[a],delete e[a])}}function Pc(t,e,n,r){e.inputData?e.inputData=e.inputData.map(et):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(et):e.inputConnection=[],e.output?e.output=e.output.map(et):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(et):e.inputArrayToProcess=[],e.numberOfInputs=n;function a(h){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){X("instance deleted - cannot call any method");return}if(v>=e.numberOfInputs){X(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[v]!==h||e.inputConnection[v])&&(e.inputData[v]=h,e.inputConnection[v]=null,t.modified&&t.modified())}function s(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[h]&&(e.inputData[h]=e.inputConnection[h]()),e.inputData[h]}function i(h){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){X("instance deleted - cannot call any method");return}if(v>=e.numberOfInputs){let p=`algorithm ${t.getClassName()} only has `;p+=`${e.numberOfInputs}`,p+=" input ports. To add more input ports, use addInputConnection()",X(p);return}e.inputData[v]=null,e.inputConnection[v]=h}function o(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[h]}function c(){let h=e.numberOfInputs;for(;h&&!e.inputData[h-1]&&!e.inputConnection[h-1];)h--;return h===e.numberOfInputs&&e.numberOfInputs++,h}function u(h){if(e.deleted){X("instance deleted - cannot call any method");return}i(h,c())}function g(h){if(e.deleted){X("instance deleted - cannot call any method");return}a(h,c())}function f(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(X("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[h])}t.shouldUpdate=()=>{var y,T;const h=t.getMTime();let v=1/0,p=r;for(;p--;){if(!e.output[p]||e.output[p].isDeleted())return!0;const S=e.output[p].getMTime();if(S<h)return!0;S<v&&(v=S)}for(p=e.numberOfInputs;p--;)if((y=e.inputConnection[p])!=null&&y.filter.shouldUpdate()||((T=t.getInputData(p))==null?void 0:T.getMTime())>v)return!0;return!1};function l(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const v=()=>f(h);return v.filter=t,v}if(e.numberOfInputs){let h=e.numberOfInputs;for(;h--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=a,t.setInputConnection=i,t.addInputData=g,t.addInputConnection=u,t.getInputData=s,t.getInputConnection=o}r&&(t.getOutputData=f,t.getOutputPort=l),t.update=()=>{const h=[];if(e.numberOfInputs){let v=0;for(;v<e.numberOfInputs;)h[v]=t.getInputData(v),v++}t.requestData&&!t.isDeleted()&&t.shouldUpdate()&&t.requestData(h,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>r||e.output.length,t.getInputArrayToProcess=h=>{const v=e.inputArrayToProcess[h],p=e.inputData[h];return v&&p?p[`get${v.fieldAssociation}`]().getArray(v.arrayName):null},t.setInputArrayToProcess=function(h,v,p){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<h;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[h]={arrayName:v,fieldAssociation:p,attributeType:y}}}const Bs=Symbol("Event abort");function Xc(t,e,n){const r=[],a=t.delete;let s=1;function i(u){for(let g=0;g<r.length;++g){const[f]=r[g];if(f===u){r.splice(g,1);return}}}function o(u){function g(){i(u)}return Object.freeze({unsubscribe:g})}function c(){if(e.deleted){X("instance deleted - cannot call any method");return}const u=r.slice();for(let g=0;g<u.length;++g){const[,f,l]=u[g];if(f){if(l<0)setTimeout(()=>f.apply(t,arguments),1-l);else if(f.apply(t,arguments)===Bs)break}}}t[`invoke${ce(n)}`]=c,t[`on${ce(n)}`]=function(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!u.apply)return console.error(`Invalid callback for event ${n}`),null;if(e.deleted)return X("instance deleted - cannot call any method"),null;const f=s++;return r.push([f,u,g]),r.sort((l,h)=>h[2]-l[2]),o(f)},t.delete=()=>{a(),r.forEach(u=>{let[g]=u;return i(g)})}}function re(t,e){const n=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a={},s={};return t(s,a,r),Object.freeze(s)};return e&&et.register(e,n),n}function Ic(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return e.filter(i=>!!i).map(i=>i(...a))}}function Fs(t){return t&&t.isA&&t.isA("vtkObject")}function Xr(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(Fs(t)){if(r.indexOf(t)>=0)return n;r.push(t);const a=e(t);a!==void 0&&n.push(a);const s=t.get();Object.keys(s).forEach(i=>{const o=s[i];Array.isArray(o)?o.forEach(c=>{Xr(c,e,n,r)}):Xr(o,e,n,r)})}return n}function Yc(t,e,n){var r=this;let a;const s=function(){for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];const u=r,g=()=>{a=null,n||t.apply(u,o)},f=n&&!a;clearTimeout(a),a=setTimeout(g,e),f&&t.apply(u,o)};return s.cancel=()=>clearTimeout(a),s}function Qc(t,e){let n=!1,r=null;function a(){n=!1,r!==null&&(s(...r),r=null)}function s(){for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];if(n){r=o;return}n=!0,t(...o),setTimeout(a,e)}return s}function ms(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},n),t.setKey=(r,a)=>{e.keystore[r]=a},t.getKey=r=>e.keystore[r],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=r=>delete e.keystore[r],t.clearKeystore=()=>t.getAllKeys().forEach(r=>delete e.keystore[r])}let Qp=1;const ur="__root__";function Zc(t,e){ms(t,e);const n=t.delete;e.proxyId=`${Qp++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),Ne(t,e,["proxyId","proxyGroup","proxyName"]),Te(t,e,["proxyManager"]);const r={},a={};function s(u,g){a[g]||(a[g]=[]);const f=a[g];for(let l=0;l<u.length;l++)f.push(u[l].name),r[u[l].name]=u[l],u[l].children&&u[l].children.length&&s(u[l].children,u[l].name)}s(e.ui,ur),t.updateUI=u=>{e.ui=JSON.parse(JSON.stringify(u||[])),Object.keys(r).forEach(g=>delete r[g]),Object.keys(a).forEach(g=>delete a[g]),s(e.ui,ur),t.modified()};function i(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ur;return a[u]}t.updateProxyProperty=(u,g)=>{const f=r[u];f?Object.assign(f,g):r[u]={...g}},t.activate=()=>{if(e.proxyManager){const u=`setActive${ce(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[u]&&e.proxyManager[u](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(u,g)=>{g in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[g]=[]),e.propertyLinkSubscribers[g].push(u)},t.gcPropertyLinks=u=>{const g=e.propertyLinkSubscribers[u]||[];for(;g.length;)g.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[u])return e.propertyLinkMap[u];let f=null;const l=[];let h=0,v=!1;function p(x){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(v)return null;const C=[];let M=null;for(h=l.length;h--;){const V=l[h];V.instance===x?M=V:C.push(V)}if(!M)return null;const R=M.instance[`get${ce(M.propertyName)}`]();if(!Xp(R,f)||w){for(f=R,v=!0;C.length;){const V=C.pop();V.instance.set({[V.propertyName]:f})}v=!1}return e.propertyLinkMap[u].persistent&&(e.propertyLinkMap[u].value=R),R}function y(x,w){const C=[];for(h=l.length;h--;){const M=l[h];M.instance===x&&(M.propertyName===w||w===void 0)&&(M.subscription.unsubscribe(),C.push(h))}for(;C.length;)l.splice(C.pop(),1)}function T(x,w){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const M=x.onModified(p),R=l[0];return l.push({instance:x,propertyName:w,subscription:M}),C&&(e.propertyLinkMap[u].persistent&&e.propertyLinkMap[u].value!==void 0?x.set({[w]:e.propertyLinkMap[u].value}):R&&p(R.instance,!0)),{unsubscribe:()=>y(x,w)}}function S(){for(;l.length;)l.pop().subscription.unsubscribe()}const d={bind:T,unbind:y,unsubscribe:S,persistent:g};return e.propertyLinkMap[u]=d,d};function o(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ur;const g=[],f=e.proxyId,l=i(u)||[];for(let h=0;h<l.length;h++){const v=l[h],p=t[`get${ce(v)}`],y=p?p():void 0,T={id:f,name:v,value:y},S=o(v);S.length&&(T.children=S),g.push(T)}return g}t.listPropertyNames=()=>o().map(u=>u.name),t.getPropertyByName=u=>o().find(g=>g.name===u),t.getPropertyDomainByName=u=>(r[u]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:o()}),t.delete=()=>{const u=Object.keys(e.propertyLinkMap);let g=u.length;for(;g--;)e.propertyLinkMap[u[g]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),n()},t.getState=()=>null;function c(){if(e.links)for(let u=0;u<e.links.length;u++){const{link:g,property:f,persistent:l,updateOnBind:h,type:v}=e.links[u];if(v==="application"){const p=e.proxyManager.getPropertyLink(g,l);t.registerPropertyLinkForGC(p,"application"),p.bind(t,f,h)}}}Ds(c)}function qc(t,e,n){const r=t.delete,a=[],s=Object.keys(n);let i=s.length;for(;i--;){const o=s[i],{modelKey:c,property:u,modified:g=!0}=n[o],f=ce(u),l=ce(o);t[`get${l}`]=e[c][`get${f}`],t[`set${l}`]=e[c][`set${f}`],g&&a.push(e[c].onModified(t.modified))}t.delete=()=>{for(;a.length;)a.pop().unsubscribe();r()}}function Jc(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function a(o){const c=Object.keys(o);let u=c.length;for(;u--;){const g=c[u];e[g].set(o[g])}}const s=Object.keys(r);let i=s.length;for(;i--;){const o=s[i];e[o]=r[o];const c=n[o];t[`set${ce(o)}`]=u=>{if(u!==e[o]){e[o]=u;const g=c[u];a(g),t.modified()}}}s.length&&Ne(t,e,s)}const mi=10,ki=40,Ui=800;function ef(t){let e=0,n=0,r=0,a=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*mi,a=n*mi,"deltaY"in t&&(a=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||a)&&t.deltaMode&&(t.deltaMode===1?(r*=ki,a*=ki):(r*=Ui,a*=Ui)),r&&!e&&(e=r<1?-1:1),a&&!n&&(n=a<1?-1:1),{spinX:e,spinY:n||e,pixelX:r,pixelY:a||r}}var E={algo:Pc,capitalize:ua,chain:Ic,debounce:Yc,enumToString:Ip,event:Xc,EVENT_ABORT:Bs,formatBytesToProperUnit:zc,formatNumbersWithThousandSeparator:Wc,get:Ne,getArray:Ln,getCurrentGlobalMTime:jp,getStateArrayMapFunc:Ac,isVtkObject:Fs,keystore:ms,measurePromiseExecution:jc,moveToProtected:rr,newInstance:re,newTypedArray:Dn,newTypedArrayFrom:Os,normalizeWheel:ef,obj:Me,proxy:Zc,proxyPropertyMapping:qc,proxyPropertyState:Jc,safeArrays:Hc,set:nr,setArray:Ls,setGet:Te,setGetArray:Vs,setImmediate:Ds,setLoggerFunction:Nc,throttle:Qc,traverseInstanceTree:Xr,TYPED_ARRAYS:De,uncapitalize:$c,VOID:kc,vtkDebugMacro:Pr,vtkErrorMacro:X,vtkInfoMacro:Gc,vtkLogMacro:_c,vtkOnceErrorMacro:bc,vtkWarningMacro:fa,objectSetterMap:Kc,requiredParam:mc},ft=Object.freeze({__proto__:null,requiredParam:mc,VOID:kc,setLoggerFunction:Nc,vtkLogMacro:_c,vtkInfoMacro:Gc,vtkDebugMacro:Pr,vtkErrorMacro:X,vtkWarningMacro:fa,vtkOnceErrorMacro:bc,TYPED_ARRAYS:De,newTypedArray:Dn,newTypedArrayFrom:Os,capitalize:ua,_capitalize:ce,uncapitalize:$c,formatBytesToProperUnit:zc,formatNumbersWithThousandSeparator:Wc,setImmediateVTK:Ds,measurePromiseExecution:jc,obj:Me,get:Ne,set:nr,setGet:Te,getArray:Ln,setArray:Ls,setGetArray:Vs,moveToProtected:rr,algo:Pc,EVENT_ABORT:Bs,event:Xc,newInstance:re,chain:Ic,isVtkObject:Fs,traverseInstanceTree:Xr,debounce:Yc,throttle:Qc,keystore:ms,proxy:Zc,proxyPropertyMapping:qc,proxyPropertyState:Jc,normalizeWheel:ef,default:E});const{vtkErrorMacro:Zp}=E,qp=["Build","Render"];function Jp(t,e){e.classHierarchy.push("vtkViewNode"),t.build=r=>{},t.render=r=>{},t.traverse=r=>{const a=r.getTraverseOperation(),s=t[a];if(s){s(r);return}t.apply(r,!0);for(let i=0;i<e.children.length;i++)e.children[i].traverse(r);t.apply(r,!1)},t.apply=(r,a)=>{const s=t[r.getOperation()];s&&s(a,r)},t.getViewNodeFor=r=>{if(e.renderable===r)return t;for(let a=0;a<e.children.length;++a){const i=e.children[a].getViewNodeFor(r);if(i)return i}},t.getFirstAncestorOfType=r=>e._parent?e._parent.isA(r)?e._parent:e._parent.getFirstAncestorOfType(r):null,t.getLastAncestorOfType=r=>{if(!e._parent)return null;const a=e._parent.getLastAncestorOfType(r);return a||(e._parent.isA(r)?e._parent:null)},t.addMissingNode=r=>{if(!r)return;const a=e._renderableChildMap.get(r);if(a!==void 0)return a.setVisited(!0),a;const s=t.createViewNode(r);if(s)return s.setParent(t),s.setVisited(!0),e._renderableChildMap.set(r,s),e.children.push(s),s},t.addMissingNodes=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!(!r||!r.length))for(let s=0;s<r.length;++s){const i=r[s],o=t.addMissingNode(i);if(a&&o!==void 0&&e.children[s]!==o){for(let c=s+1;c<e.children.length;++c)if(e.children[c]===o){e.children.splice(c,1),e.children.splice(s,0,o);break}}}},t.addMissingChildren=r=>{if(!(!r||!r.length))for(let a=0;a<r.length;++a){const s=r[a];if(e.children.indexOf(s)===-1){s.setParent(t),e.children.push(s);const o=s.getRenderable();o&&e._renderableChildMap.set(o,s)}s.setVisited(!0)}},t.removeNode=r=>{const a=e.children.findIndex(i=>i===r);if(a<0)return!1;const s=r.getRenderable();return s&&e._renderableChildMap.delete(s),r.delete(),e.children.splice(a,1),!0},t.prepareNodes=()=>{for(let r=0;r<e.children.length;++r)e.children[r].setVisited(!1)},t.setVisited=r=>{e.visited=r},t.removeUnusedNodes=()=>{let r=0;for(let a=0;a<e.children.length;++a){const s=e.children[a];if(s.getVisited())e.children[r++]=s,s.setVisited(!1);else{const o=s.getRenderable();o&&e._renderableChildMap.delete(o),s.delete()}}e.children.length=r},t.createViewNode=r=>{if(!e.myFactory)return Zp("Cannot create view nodes without my own factory"),null;const a=e.myFactory.createNode(r);return a&&a.setRenderable(r),a};const n=t.delete;t.delete=()=>{for(let r=0;r<e.children.length;r++)e.children[r].delete();n()}}const eh={renderable:null,myFactory:null,children:[],visited:!1};function tf(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eh,n),E.obj(t,e),E.event(t,e,"event"),e._renderableChildMap=new Map,E.get(t,e,["visited"]),E.setGet(t,e,["_parent","renderable","myFactory"]),E.getArray(t,e,["children"]),E.moveToProtected(t,e,["parent"]),Jp(t,e)}const th=E.newInstance(tf,"vtkViewNode");var fe={newInstance:th,extend:tf,PASS_TYPES:qp};function nh(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,a=n.getClassName(r++),s=!1;const i=Object.keys(e.overrides);for(;a&&!s;)i.indexOf(a)!==-1?s=!0:a=n.getClassName(r++);if(!s)return null;const o=e.overrides[a]();return o.setMyFactory(t),o}}const rh={};function nf(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rh,n),E.obj(t,e),nh(t,e)}const ah=E.newInstance(nf,"vtkViewNodeFactory");var rf={newInstance:ah,extend:nf};const af=Object.create(null);function Ie(t,e){af[t]=e}function sh(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}const ih={};function sf(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ih,n),e.overrides=af,rf.extend(t,e,n),sh(t,e)}const oh=E.newInstance(sf,"vtkOpenGLViewNodeFactory");var ch={newInstance:oh,extend:sf};function fh(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=n=>{if(n){const r=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize),e.context.scissor(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=n=>{if(n!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||n.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){Oe(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),ds(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),xs(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),ne(e.keyMatrices.wcvc,e.keyMatrices.wcvc);const r=e._openGLRenderer.getAspectRatio();Oe(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(r,-1,1)),ne(e.keyMatrices.vcpc,e.keyMatrices.vcpc),pe(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=n}return e.keyMatrices}}const uh={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function gh(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uh,n),fe.extend(t,e,n),e.keyMatrixTime={},Me(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},Te(t,e,["context","keyMatrixTime"]),fh(t,e)}const lh=re(gh);Ie("vtkCamera",lh);const{vtkDebugMacro:ph}=ft;function hh(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps(),!0),t.removeUnusedNodes()}},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let a=0;a<r.length;++a)r[a].getSwitch()>0&&n++;return n||(ph("No lights are on, creating one."),e.renderable.createLight()),n},t.zBufferPass=n=>{if(n){let r=0;const a=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),r|=a.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(a.clearDepth(1),r|=a.DEPTH_BUFFER_BIT,e.context.depthMask(!0));const s=t.getTiledSizeAndOrigin();a.enable(a.SCISSOR_TEST),a.scissor(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),a.viewport(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),a.colorMask(!0,!0,!0,!0),r&&a.clear(r),a.enable(a.DEPTH_TEST)}},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.cameraPass=n=>{n&&t.clear()},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],a=n[0]-r[0],s=n[1]-r[1],i=e._parent.normalizedDisplayToDisplay(a,s),o=Math.round(i[0]),c=Math.round(i[1]),u=n[2]-r[0],g=n[3]-r[1],f=e._parent.normalizedDisplayToDisplay(u,g);let l=Math.round(f[0])-o,h=Math.round(f[1])-c;return l<0&&(l=0),h<0&&(h=0),{usize:l,vsize:h,lowerLeftU:o,lowerLeftV:c}},t.clear=()=>{let n=0;const r=e.context;if(!e.renderable.getTransparent()){const s=e.renderable.getBackgroundByReference();r.clearColor(s[0],s[1],s[2],s[3]),n|=r.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(r.clearDepth(1),n|=r.DEPTH_BUFFER_BIT,r.depthMask(!0)),r.colorMask(!0,!0,!0,!0);const a=t.getTiledSizeAndOrigin();r.enable(r.SCISSOR_TEST),r.scissor(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),r.viewport(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),n&&r.clear(n),r.enable(r.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(n=>{n.modified()})},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const yh={context:null,_openGLRenderWindow:null,selector:null};function vh(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yh,n),fe.extend(t,e,n),Ne(t,e,["shaderCache"]),Te(t,e,["selector"]),rr(t,e,["openGLRenderWindow"]),hh(t,e)}const Th=re(vh,"vtkOpenGLRenderer");Ie("vtkRenderer",Th);function dh(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=n=>{if(n){e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const a=e.children[r];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(e._openGLRenderer.getSelector()&&e.renderable.getNestedPickable()),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),Oe(e.keyMatrices.mcwc,e.renderable.getMatrix()),ne(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?Nt(e.keyMatrices.normalMatrix):(ds(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),xs(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),rc(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}const xh={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function Sh(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xh,n),fe.extend(t,e,n),e.keyMatrixTime={},Me(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:Nt(new Float64Array(9)),mcwc:Y(new Float64Array(16))},Te(t,e,["context"]),Ne(t,e,["activeTextures"]),dh(t,e)}const Ch=re(Sh);Ie("vtkActor",Ch);function wh(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=n=>{if(n){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const a=e.children[r];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOverlayActorCount()}},t.traverseOpaquePass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOverlayPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.overlayPass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()}}const Eh={context:null,activeTextures:null};function Mh(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Eh,n),fe.extend(t,e,n),Te(t,e,["context"]),Ne(t,e,["activeTextures"]),wh(t,e)}const Rh=re(Mh);Ie("vtkActor2D",Rh);function $r(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Oh(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function of(t){let e,n,r;t.length!==2?(e=$r,n=(o,c)=>$r(t(o),c),r=(o,c)=>t(o)-c):(e=t===$r||t===Oh?t:Dh,n=t,r=t);function a(o,c,u=0,g=o.length){if(u<g){if(e(c,c)!==0)return g;do{const f=u+g>>>1;n(o[f],c)<0?u=f+1:g=f}while(u<g)}return u}function s(o,c,u=0,g=o.length){if(u<g){if(e(c,c)!==0)return g;do{const f=u+g>>>1;n(o[f],c)<=0?u=f+1:g=f}while(u<g)}return u}function i(o,c,u=0,g=o.length){const f=a(o,c,u,g-1);return f>u&&r(o[f-1],c)>-r(o[f],c)?f-1:f}return{left:a,center:i,right:s}}function Dh(){return 0}function Lh(t){return t===null?NaN:+t}const Vh=of($r),Bh=Vh.right;of(Lh).center;const Fh=Math.sqrt(50),mh=Math.sqrt(10),kh=Math.sqrt(2);function Ir(t,e,n){const r=(e-t)/Math.max(0,n),a=Math.floor(Math.log10(r)),s=r/Math.pow(10,a),i=s>=Fh?10:s>=mh?5:s>=kh?2:1;let o,c,u;return a<0?(u=Math.pow(10,-a)/i,o=Math.round(t*u),c=Math.round(e*u),o/u<t&&++o,c/u>e&&--c,u=-u):(u=Math.pow(10,a)*i,o=Math.round(t/u),c=Math.round(e/u),o*u<t&&++o,c*u>e&&--c),c<o&&.5<=n&&n<2?Ir(t,e,n*2):[o,c,u]}function Uh(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[a,s,i]=r?Ir(e,t,n):Ir(t,e,n);if(!(s>=a))return[];const o=s-a+1,c=new Array(o);if(r)if(i<0)for(let u=0;u<o;++u)c[u]=(s-u)/-i;else for(let u=0;u<o;++u)c[u]=(s-u)*i;else if(i<0)for(let u=0;u<o;++u)c[u]=(a+u)/-i;else for(let u=0;u<o;++u)c[u]=(a+u)*i;return c}function Ya(t,e,n){return e=+e,t=+t,n=+n,Ir(t,e,n)[2]}function Nh(t,e,n){e=+e,t=+t,n=+n;const r=e<t,a=r?Ya(e,t,n):Ya(t,e,n);return(r?-1:1)*(a<0?1/-a:a)}function _h(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function ks(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function cf(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function ar(){}var Qn=.7,Yr=1/Qn,xn="\\s*([+-]?\\d+)\\s*",Zn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ot="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Gh=/^#([0-9a-f]{3,8})$/,bh=new RegExp(`^rgb\\(${xn},${xn},${xn}\\)$`),$h=new RegExp(`^rgb\\(${ot},${ot},${ot}\\)$`),zh=new RegExp(`^rgba\\(${xn},${xn},${xn},${Zn}\\)$`),Wh=new RegExp(`^rgba\\(${ot},${ot},${ot},${Zn}\\)$`),Hh=new RegExp(`^hsl\\(${Zn},${ot},${ot}\\)$`),Ah=new RegExp(`^hsla\\(${Zn},${ot},${ot},${Zn}\\)$`),Ni={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ks(ar,qn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:_i,formatHex:_i,formatHex8:jh,formatHsl:Kh,formatRgb:Gi,toString:Gi});function _i(){return this.rgb().formatHex()}function jh(){return this.rgb().formatHex8()}function Kh(){return ff(this).formatHsl()}function Gi(){return this.rgb().formatRgb()}function qn(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Gh.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?bi(e):n===3?new Ge(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?gr(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?gr(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=bh.exec(t))?new Ge(e[1],e[2],e[3],1):(e=$h.exec(t))?new Ge(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=zh.exec(t))?gr(e[1],e[2],e[3],e[4]):(e=Wh.exec(t))?gr(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Hh.exec(t))?Wi(e[1],e[2]/100,e[3]/100,1):(e=Ah.exec(t))?Wi(e[1],e[2]/100,e[3]/100,e[4]):Ni.hasOwnProperty(t)?bi(Ni[t]):t==="transparent"?new Ge(NaN,NaN,NaN,0):null}function bi(t){return new Ge(t>>16&255,t>>8&255,t&255,1)}function gr(t,e,n,r){return r<=0&&(t=e=n=NaN),new Ge(t,e,n,r)}function Ph(t){return t instanceof ar||(t=qn(t)),t?(t=t.rgb(),new Ge(t.r,t.g,t.b,t.opacity)):new Ge}function Qa(t,e,n,r){return arguments.length===1?Ph(t):new Ge(t,e,n,r??1)}function Ge(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}ks(Ge,Qa,cf(ar,{brighter(t){return t=t==null?Yr:Math.pow(Yr,t),new Ge(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Qn:Math.pow(Qn,t),new Ge(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Ge(qt(this.r),qt(this.g),qt(this.b),Qr(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:$i,formatHex:$i,formatHex8:Xh,formatRgb:zi,toString:zi}));function $i(){return`#${Zt(this.r)}${Zt(this.g)}${Zt(this.b)}`}function Xh(){return`#${Zt(this.r)}${Zt(this.g)}${Zt(this.b)}${Zt((isNaN(this.opacity)?1:this.opacity)*255)}`}function zi(){const t=Qr(this.opacity);return`${t===1?"rgb(":"rgba("}${qt(this.r)}, ${qt(this.g)}, ${qt(this.b)}${t===1?")":`, ${t})`}`}function Qr(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function qt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Zt(t){return t=qt(t),(t<16?"0":"")+t.toString(16)}function Wi(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new qe(t,e,n,r)}function ff(t){if(t instanceof qe)return new qe(t.h,t.s,t.l,t.opacity);if(t instanceof ar||(t=qn(t)),!t)return new qe;if(t instanceof qe)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,a=Math.min(e,n,r),s=Math.max(e,n,r),i=NaN,o=s-a,c=(s+a)/2;return o?(e===s?i=(n-r)/o+(n<r)*6:n===s?i=(r-e)/o+2:i=(e-n)/o+4,o/=c<.5?s+a:2-s-a,i*=60):o=c>0&&c<1?0:i,new qe(i,o,c,t.opacity)}function Ih(t,e,n,r){return arguments.length===1?ff(t):new qe(t,e,n,r??1)}function qe(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}ks(qe,Ih,cf(ar,{brighter(t){return t=t==null?Yr:Math.pow(Yr,t),new qe(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Qn:Math.pow(Qn,t),new qe(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,a=2*n-r;return new Ge(Ma(t>=240?t-240:t+120,a,r),Ma(t,a,r),Ma(t<120?t+240:t-120,a,r),this.opacity)},clamp(){return new qe(Hi(this.h),lr(this.s),lr(this.l),Qr(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Qr(this.opacity);return`${t===1?"hsl(":"hsla("}${Hi(this.h)}, ${lr(this.s)*100}%, ${lr(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Hi(t){return t=(t||0)%360,t<0?t+360:t}function lr(t){return Math.max(0,Math.min(1,t||0))}function Ma(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Us=t=>()=>t;function Yh(t,e){return function(n){return t+n*e}}function Qh(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Zh(t){return(t=+t)==1?uf:function(e,n){return n-e?Qh(e,n,t):Us(isNaN(e)?n:e)}}function uf(t,e){var n=e-t;return n?Yh(t,n):Us(isNaN(t)?e:t)}const Ai=function t(e){var n=Zh(e);function r(a,s){var i=n((a=Qa(a)).r,(s=Qa(s)).r),o=n(a.g,s.g),c=n(a.b,s.b),u=uf(a.opacity,s.opacity);return function(g){return a.r=i(g),a.g=o(g),a.b=c(g),a.opacity=u(g),a+""}}return r.gamma=t,r}(1);function qh(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),a;return function(s){for(a=0;a<n;++a)r[a]=t[a]*(1-s)+e[a]*s;return r}}function Jh(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function e1(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,a=new Array(r),s=new Array(n),i;for(i=0;i<r;++i)a[i]=Ns(t[i],e[i]);for(;i<n;++i)s[i]=e[i];return function(o){for(i=0;i<r;++i)s[i]=a[i](o);return s}}function t1(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Zr(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function n1(t,e){var n={},r={},a;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(a in e)a in t?n[a]=Ns(t[a],e[a]):r[a]=e[a];return function(s){for(a in n)r[a]=n[a](s);return r}}var Za=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ra=new RegExp(Za.source,"g");function r1(t){return function(){return t}}function a1(t){return function(e){return t(e)+""}}function s1(t,e){var n=Za.lastIndex=Ra.lastIndex=0,r,a,s,i=-1,o=[],c=[];for(t=t+"",e=e+"";(r=Za.exec(t))&&(a=Ra.exec(e));)(s=a.index)>n&&(s=e.slice(n,s),o[i]?o[i]+=s:o[++i]=s),(r=r[0])===(a=a[0])?o[i]?o[i]+=a:o[++i]=a:(o[++i]=null,c.push({i,x:Zr(r,a)})),n=Ra.lastIndex;return n<e.length&&(s=e.slice(n),o[i]?o[i]+=s:o[++i]=s),o.length<2?c[0]?a1(c[0].x):r1(e):(e=c.length,function(u){for(var g=0,f;g<e;++g)o[(f=c[g]).i]=f.x(u);return o.join("")})}function Ns(t,e){var n=typeof e,r;return e==null||n==="boolean"?Us(e):(n==="number"?Zr:n==="string"?(r=qn(e))?(e=r,Ai):s1:e instanceof qn?Ai:e instanceof Date?t1:Jh(e)?qh:Array.isArray(e)?e1:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?n1:Zr)(t,e)}function i1(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function o1(t){return function(){return t}}function c1(t){return+t}var ji=[0,1];function vn(t){return t}function qa(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:o1(isNaN(e)?NaN:.5)}function f1(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function u1(t,e,n){var r=t[0],a=t[1],s=e[0],i=e[1];return a<r?(r=qa(a,r),s=n(i,s)):(r=qa(r,a),s=n(s,i)),function(o){return s(r(o))}}function g1(t,e,n){var r=Math.min(t.length,e.length)-1,a=new Array(r),s=new Array(r),i=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++i<r;)a[i]=qa(t[i],t[i+1]),s[i]=n(e[i],e[i+1]);return function(o){var c=Bh(t,o,1,r)-1;return s[c](a[c](o))}}function l1(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function p1(){var t=ji,e=ji,n=Ns,r,a,s,i=vn,o,c,u;function g(){var l=Math.min(t.length,e.length);return i!==vn&&(i=f1(t[0],t[l-1])),o=l>2?g1:u1,c=u=null,f}function f(l){return l==null||isNaN(l=+l)?s:(c||(c=o(t.map(r),e,n)))(r(i(l)))}return f.invert=function(l){return i(a((u||(u=o(e,t.map(r),Zr)))(l)))},f.domain=function(l){return arguments.length?(t=Array.from(l,c1),g()):t.slice()},f.range=function(l){return arguments.length?(e=Array.from(l),g()):e.slice()},f.rangeRound=function(l){return e=Array.from(l),n=i1,g()},f.clamp=function(l){return arguments.length?(i=l?!0:vn,g()):i!==vn},f.interpolate=function(l){return arguments.length?(n=l,g()):n},f.unknown=function(l){return arguments.length?(s=l,f):s},function(l,h){return r=l,a=h,g()}}function h1(){return p1()(vn,vn)}function y1(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function qr(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Cn(t){return t=qr(Math.abs(t)),t?t[1]:NaN}function v1(t,e){return function(n,r){for(var a=n.length,s=[],i=0,o=t[0],c=0;a>0&&o>0&&(c+o+1>r&&(o=Math.max(1,r-c)),s.push(n.substring(a-=o,a+o)),!((c+=o+1)>r));)o=t[i=(i+1)%t.length];return s.reverse().join(e)}}function T1(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var d1=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Jr(t){if(!(e=d1.exec(t)))throw new Error("invalid format: "+t);var e;return new _s({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Jr.prototype=_s.prototype;function _s(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}_s.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function x1(t){e:for(var e=t.length,n=1,r=-1,a;n<e;++n)switch(t[n]){case".":r=a=n;break;case"0":r===0&&(r=n),a=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(a+1):t}var gf;function S1(t,e){var n=qr(t,e);if(!n)return t+"";var r=n[0],a=n[1],s=a-(gf=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,i=r.length;return s===i?r:s>i?r+new Array(s-i+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+qr(t,Math.max(0,e+s-1))[0]}function Ki(t,e){var n=qr(t,e);if(!n)return t+"";var r=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+r:r.length>a+1?r.slice(0,a+1)+"."+r.slice(a+1):r+new Array(a-r.length+2).join("0")}const Pi={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:y1,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Ki(t*100,e),r:Ki,s:S1,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Xi(t){return t}var Ii=Array.prototype.map,Yi=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function C1(t){var e=t.grouping===void 0||t.thousands===void 0?Xi:v1(Ii.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",a=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?Xi:T1(Ii.call(t.numerals,String)),i=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"−":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function u(f){f=Jr(f);var l=f.fill,h=f.align,v=f.sign,p=f.symbol,y=f.zero,T=f.width,S=f.comma,d=f.precision,x=f.trim,w=f.type;w==="n"?(S=!0,w="g"):Pi[w]||(d===void 0&&(d=12),x=!0,w="g"),(y||l==="0"&&h==="=")&&(y=!0,l="0",h="=");var C=p==="$"?n:p==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",M=p==="$"?r:/[%p]/.test(w)?i:"",R=Pi[w],V=/[defgprs%]/.test(w);d=d===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,d)):Math.max(0,Math.min(20,d));function O(D){var B=C,L=M,F,U,N;if(w==="c")L=R(D)+L,D="";else{D=+D;var G=D<0||1/D<0;if(D=isNaN(D)?c:R(Math.abs(D),d),x&&(D=x1(D)),G&&+D==0&&v!=="+"&&(G=!1),B=(G?v==="("?v:o:v==="-"||v==="("?"":v)+B,L=(w==="s"?Yi[8+gf/3]:"")+L+(G&&v==="("?")":""),V){for(F=-1,U=D.length;++F<U;)if(N=D.charCodeAt(F),48>N||N>57){L=(N===46?a+D.slice(F+1):D.slice(F))+L,D=D.slice(0,F);break}}}S&&!y&&(D=e(D,1/0));var H=B.length+D.length+L.length,k=H<T?new Array(T-H+1).join(l):"";switch(S&&y&&(D=e(k+D,k.length?T-L.length:1/0),k=""),h){case"<":D=B+D+L+k;break;case"=":D=B+k+D+L;break;case"^":D=k.slice(0,H=k.length>>1)+B+D+L+k.slice(H);break;default:D=k+B+D+L;break}return s(D)}return O.toString=function(){return f+""},O}function g(f,l){var h=u((f=Jr(f),f.type="f",f)),v=Math.max(-8,Math.min(8,Math.floor(Cn(l)/3)))*3,p=Math.pow(10,-v),y=Yi[8+v/3];return function(T){return h(p*T)+y}}return{format:u,formatPrefix:g}}var pr,lf,pf;w1({thousands:",",grouping:[3],currency:["$",""]});function w1(t){return pr=C1(t),lf=pr.format,pf=pr.formatPrefix,pr}function E1(t){return Math.max(0,-Cn(Math.abs(t)))}function M1(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Cn(e)/3)))*3-Cn(Math.abs(t)))}function R1(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Cn(e)-Cn(t))+1}function O1(t,e,n,r){var a=Nh(t,e,n),s;switch(r=Jr(r??",f"),r.type){case"s":{var i=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(s=M1(a,i))&&(r.precision=s),pf(r,i)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=R1(a,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=E1(a))&&(r.precision=s-(r.type==="%")*2);break}}return lf(r)}function D1(t){var e=t.domain;return t.ticks=function(n){var r=e();return Uh(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var a=e();return O1(a[0],a[a.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),a=0,s=r.length-1,i=r[a],o=r[s],c,u,g=10;for(o<i&&(u=i,i=o,o=u,u=a,a=s,s=u);g-- >0;){if(u=Ya(i,o,n),u===c)return r[a]=i,r[s]=o,e(r);if(u>0)i=Math.floor(i/u)*u,o=Math.ceil(o/u)*u;else if(u<0)i=Math.ceil(i*u)/u,o=Math.floor(o*u)/u;else break;c=u}return t},t}function Gs(){var t=h1();return t.copy=function(){return l1(t,Gs())},_h.apply(t,arguments),D1(t)}var bs={exports:{}};bs.exports;(function(t){(function(e,n,r){function a(c){var u=this,g=o();u.next=function(){var f=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=f-(u.c=f|0)},u.c=1,u.s0=g(" "),u.s1=g(" "),u.s2=g(" "),u.s0-=g(c),u.s0<0&&(u.s0+=1),u.s1-=g(c),u.s1<0&&(u.s1+=1),u.s2-=g(c),u.s2<0&&(u.s2+=1),g=null}function s(c,u){return u.c=c.c,u.s0=c.s0,u.s1=c.s1,u.s2=c.s2,u}function i(c,u){var g=new a(c),f=u&&u.state,l=g.next;return l.int32=function(){return g.next()*4294967296|0},l.double=function(){return l()+(l()*2097152|0)*11102230246251565e-32},l.quick=l,f&&(typeof f=="object"&&s(f,g),l.state=function(){return s(g,{})}),l}function o(){var c=4022871197,u=function(g){g=String(g);for(var f=0;f<g.length;f++){c+=g.charCodeAt(f);var l=.02519603282416938*c;c=l>>>0,l-=c,l*=c,c=l>>>0,l-=c,c+=l*4294967296}return(c>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=i:this.alea=i})(Pe,t)})(bs);var L1=bs.exports,$s={exports:{}};$s.exports;(function(t){(function(e,n,r){function a(o){var c=this,u="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var f=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^f^f>>>8},o===(o|0)?c.x=o:u+=o;for(var g=0;g<u.length+64;g++)c.x^=u.charCodeAt(g)|0,c.next()}function s(o,c){return c.x=o.x,c.y=o.y,c.z=o.z,c.w=o.w,c}function i(o,c){var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,h=(u.next()>>>0)/4294967296,v=(l+h)/(1<<21);while(v===0);return v},f.int32=u.next,f.quick=f,g&&(typeof g=="object"&&s(g,u),f.state=function(){return s(u,{})}),f}n&&n.exports?n.exports=i:this.xor128=i})(Pe,t)})($s);var V1=$s.exports,zs={exports:{}};zs.exports;(function(t){(function(e,n,r){function a(o){var c=this,u="";c.next=function(){var f=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(f^f<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,o===(o|0)?c.x=o:u+=o;for(var g=0;g<u.length+64;g++)c.x^=u.charCodeAt(g)|0,g==u.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function s(o,c){return c.x=o.x,c.y=o.y,c.z=o.z,c.w=o.w,c.v=o.v,c.d=o.d,c}function i(o,c){var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,h=(u.next()>>>0)/4294967296,v=(l+h)/(1<<21);while(v===0);return v},f.int32=u.next,f.quick=f,g&&(typeof g=="object"&&s(g,u),f.state=function(){return s(u,{})}),f}n&&n.exports?n.exports=i:this.xorwow=i})(Pe,t)})(zs);var B1=zs.exports,Ws={exports:{}};Ws.exports;(function(t){(function(e,n,r){function a(o){var c=this;c.next=function(){var g=c.x,f=c.i,l,h;return l=g[f],l^=l>>>7,h=l^l<<24,l=g[f+1&7],h^=l^l>>>10,l=g[f+3&7],h^=l^l>>>3,l=g[f+4&7],h^=l^l<<7,l=g[f+7&7],l=l^l<<13,h^=l^l<<9,g[f]=h,c.i=f+1&7,h};function u(g,f){var l,h=[];if(f===(f|0))h[0]=f;else for(f=""+f,l=0;l<f.length;++l)h[l&7]=h[l&7]<<15^f.charCodeAt(l)+h[l+1&7]<<13;for(;h.length<8;)h.push(0);for(l=0;l<8&&h[l]===0;++l);for(l==8?h[7]=-1:h[l],g.x=h,g.i=0,l=256;l>0;--l)g.next()}u(c,o)}function s(o,c){return c.x=o.x.slice(),c.i=o.i,c}function i(o,c){o==null&&(o=+new Date);var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,h=(u.next()>>>0)/4294967296,v=(l+h)/(1<<21);while(v===0);return v},f.int32=u.next,f.quick=f,g&&(g.x&&s(g,u),f.state=function(){return s(u,{})}),f}n&&n.exports?n.exports=i:this.xorshift7=i})(Pe,t)})(Ws);var F1=Ws.exports,Hs={exports:{}};Hs.exports;(function(t){(function(e,n,r){function a(o){var c=this;c.next=function(){var g=c.w,f=c.X,l=c.i,h,v;return c.w=g=g+1640531527|0,v=f[l+34&127],h=f[l=l+1&127],v^=v<<13,h^=h<<17,v^=v>>>15,h^=h>>>12,v=f[l]=v^h,c.i=l,v+(g^g>>>16)|0};function u(g,f){var l,h,v,p,y,T=[],S=128;for(f===(f|0)?(h=f,f=null):(f=f+"\0",h=0,S=Math.max(S,f.length)),v=0,p=-32;p<S;++p)f&&(h^=f.charCodeAt((p+32)%f.length)),p===0&&(y=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,p>=0&&(y=y+1640531527|0,l=T[p&127]^=h+y,v=l==0?v+1:0);for(v>=128&&(T[(f&&f.length||0)&127]=-1),v=127,p=4*128;p>0;--p)h=T[v+34&127],l=T[v=v+1&127],h^=h<<13,l^=l<<17,h^=h>>>15,l^=l>>>12,T[v]=h^l;g.w=y,g.X=T,g.i=v}u(c,o)}function s(o,c){return c.i=o.i,c.w=o.w,c.X=o.X.slice(),c}function i(o,c){o==null&&(o=+new Date);var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,h=(u.next()>>>0)/4294967296,v=(l+h)/(1<<21);while(v===0);return v},f.int32=u.next,f.quick=f,g&&(g.X&&s(g,u),f.state=function(){return s(u,{})}),f}n&&n.exports?n.exports=i:this.xor4096=i})(Pe,t)})(Hs);var m1=Hs.exports,As={exports:{}};As.exports;(function(t){(function(e,n,r){function a(o){var c=this,u="";c.next=function(){var f=c.b,l=c.c,h=c.d,v=c.a;return f=f<<25^f>>>7^l,l=l-h|0,h=h<<24^h>>>8^v,v=v-f|0,c.b=f=f<<20^f>>>12^l,c.c=l=l-h|0,c.d=h<<16^l>>>16^v,c.a=v-f|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,o===Math.floor(o)?(c.a=o/4294967296|0,c.b=o|0):u+=o;for(var g=0;g<u.length+20;g++)c.b^=u.charCodeAt(g)|0,c.next()}function s(o,c){return c.a=o.a,c.b=o.b,c.c=o.c,c.d=o.d,c}function i(o,c){var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,h=(u.next()>>>0)/4294967296,v=(l+h)/(1<<21);while(v===0);return v},f.int32=u.next,f.quick=f,g&&(typeof g=="object"&&s(g,u),f.state=function(){return s(u,{})}),f}n&&n.exports?n.exports=i:this.tychei=i})(Pe,t)})(As);var k1=As.exports,hf={exports:{}};const U1={},N1=Object.freeze(Object.defineProperty({__proto__:null,default:U1},Symbol.toStringTag,{value:"Module"})),_1=hp(N1);(function(t){(function(e,n,r){var a=256,s=6,i=52,o="random",c=r.pow(a,s),u=r.pow(2,i),g=u*2,f=a-1,l;function h(x,w,C){var M=[];w=w==!0?{entropy:!0}:w||{};var R=T(y(w.entropy?[x,d(n)]:x??S(),3),M),V=new v(M),O=function(){for(var D=V.g(s),B=c,L=0;D<u;)D=(D+L)*a,B*=a,L=V.g(1);for(;D>=g;)D/=2,B/=2,L>>>=1;return(D+L)/B};return O.int32=function(){return V.g(4)|0},O.quick=function(){return V.g(4)/4294967296},O.double=O,T(d(V.S),n),(w.pass||C||function(D,B,L,F){return F&&(F.S&&p(F,V),D.state=function(){return p(V,{})}),L?(r[o]=D,B):D})(O,R,"global"in w?w.global:this==r,w.state)}function v(x){var w,C=x.length,M=this,R=0,V=M.i=M.j=0,O=M.S=[];for(C||(x=[C++]);R<a;)O[R]=R++;for(R=0;R<a;R++)O[R]=O[V=f&V+x[R%C]+(w=O[R])],O[V]=w;(M.g=function(D){for(var B,L=0,F=M.i,U=M.j,N=M.S;D--;)B=N[F=f&F+1],L=L*a+N[f&(N[F]=N[U=f&U+B])+(N[U]=B)];return M.i=F,M.j=U,L})(a)}function p(x,w){return w.i=x.i,w.j=x.j,w.S=x.S.slice(),w}function y(x,w){var C=[],M=typeof x,R;if(w&&M=="object")for(R in x)try{C.push(y(x[R],w-1))}catch{}return C.length?C:M=="string"?x:x+"\0"}function T(x,w){for(var C=x+"",M,R=0;R<C.length;)w[f&R]=f&(M^=w[f&R]*19)+C.charCodeAt(R++);return d(w)}function S(){try{var x;return l&&(x=l.randomBytes)?x=x(a):(x=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(x)),d(x)}catch{var w=e.navigator,C=w&&w.plugins;return[+new Date,e,C,e.screen,d(n)]}}function d(x){return String.fromCharCode.apply(0,x)}if(T(r.random(),n),t.exports){t.exports=h;try{l=_1}catch{}}else r["seed"+o]=h})(typeof self<"u"?self:Pe,[],Math)})(hf);var G1=hf.exports,b1=L1,$1=V1,z1=B1,W1=F1,H1=m1,A1=k1,on=G1;on.alea=b1;on.xor128=$1;on.xorwow=z1;on.xorshift7=W1;on.xor4096=H1;on.tychei=A1;var j1=on;const K1=ca(j1),yf=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],P1=[1,0,0,0,1,0,0,0,1],js=1e-6,Ks=1e-12,{vtkErrorMacro:vf,vtkWarningMacro:nn}=E;let Tf=0;const Qi=20;function sr(t){return()=>vf(`vtkMath::${t} - NOT IMPLEMENTED`)}function Pn(t,e,n,r){let a;for(let s=0;s<e;s++)a=t[n*e+s],t[n*e+s]=t[r*e+s],t[r*e+s]=a}function bn(t,e,n,r){let a;for(let s=0;s<e;s++)a=t[s*e+n],t[s*e+n]=t[s*e+r],t[s*e+r]=a}function ae(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const e=Array(t);for(let n=0;n<t;++n)e[n]=0;return e}const X1=()=>Math.PI;function I1(t,e){return e>1023?t*2**1023*2**(e-1023):e<-1074?t*2**-1074*2**(e+1074):t*2**e}function oe(t){return t/180*Math.PI}function wn(t){return t*180/Math.PI}const{round:$n,floor:Y1,ceil:Q1,min:Z1,max:q1}=Math;function J1(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0;for(let a=e,s=t.length;a<s;a+=n)t[a]<r&&(r=t[a]);return r}function ey(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=-1/0;for(let a=e,s=t.length;a<s;a+=n)r<t[a]&&(r=t[a]);return r}function ty(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=1/0,a=-1/0;for(let s=e,i=t.length;s<i;s+=n)t[s]<r&&(r=t[s]),a<t[s]&&(a=t[s]);return[r,a]}const ny=sr("ceilLog2"),ry=sr("factorial");function Ke(t){let e=1;for(;e<t;)e*=2;return e}function zn(t){return t===Ke(t)}function ay(t,e){let n=1;for(let r=1;r<=e;++r)n*=(t-r+1)/r;return Math.floor(n)}function sy(t,e){if(t<e)return 0;const n=ae(e);for(let r=0;r<e;++r)n[r]=r;return n}function iy(t,e,n){let r=0;for(let a=e-1;a>=0;--a)if(n[a]<t-e+a){let s=n[a]+1;for(;a<e;)n[a++]=s++;r=1;break}return r}function oy(t){K1(`${t}`,{global:!0}),Tf=t}function cy(){return Tf}function fy(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const n=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:1)-t;return t+n*Math.random()}const uy=sr("gaussian");function En(t,e,n){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function ye(t,e,n){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function df(t,e){return t[0]*=e,t[1]*=e,t[2]*=e,t}function xf(t,e){return t[0]*=e,t[1]*=e,t}function Ja(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function gy(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r}function W(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ly(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[0]*e[2],n[3]=t[1]*e[0],n[4]=t[1]*e[1],n[5]=t[1]*e[2],n[6]=t[2]*e[0],n[7]=t[2]*e[1],n[8]=t[2]*e[2]}function Ue(t,e,n){const r=t[1]*e[2]-t[2]*e[1],a=t[2]*e[0]-t[0]*e[2],s=t[0]*e[1]-t[1]*e[0];return n[0]=r,n[1]=a,n[2]=s,n}function $e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let n=0;for(let r=0;r<e;r++)n+=t[r]*t[r];return Math.sqrt(n)}}}function we(t){const e=$e(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function py(t){const e=$e(t,3);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e,t[3]/=e),e}function hy(t,e,n,r){const a=t[0]*t[0],s=t[1]*t[1],i=t[2]*t[2],o=Math.sqrt(a+s+i);let c,u,g;a>s&&a>i?(c=0,u=1,g=2):s>i?(c=1,u=2,g=0):(c=2,u=0,g=1);const f=t[c]/o,l=t[u]/o,h=t[g]/o,v=Math.sqrt(f*f+h*h);if(r!==0){const p=Math.sin(r),y=Math.cos(r);e&&(e[c]=(h*y-f*l*p)/v,e[u]=p*v,e[g]=(-(f*y)-l*h*p)/v),n&&(n[c]=(-(h*p)-f*l*y)/v,n[u]=y*v,n[g]=(f*p-l*h*y)/v)}else e&&(e[c]=h/v,e[u]=0,e[g]=-f/v),n&&(n[c]=-f*l/v,n[u]=v,n[g]=-l*h/v)}function yy(t,e,n){const r=W(e,e);if(r===0)return n[0]=0,n[1]=0,n[2]=0,!1;const a=W(t,e)/r;for(let s=0;s<3;s++)n[s]=e[s];return df(n,a),!0}function es(t,e){return t[0]*e[0]+t[1]*e[1]}function vy(t,e,n){const r=es(e,e);if(r===0)return n[0]=0,n[1]=0,!1;const a=es(t,e)/r;for(let s=0;s<2;s++)n[s]=e[s];return xf(n,a),!0}function Se(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function Ty(t,e){const n=[0,0,0];return Ue(t,e,n),Math.atan2($e(n),W(t,e))}function dy(t,e,n){const r=Math.abs(t-n);return 1/Math.sqrt(2*Math.PI*e)*Math.exp(-(r**2)/(2*e))}function xy(t,e,n){const r=Math.abs(t-n);return Math.exp(-(r**2)/(2*e))}function Sy(t,e,n){n[0]=t[0]*e[0],n[1]=t[0]*e[1],n[2]=t[1]*e[0],n[3]=t[1]*e[1]}function Sf(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Cf(t){const e=Sf(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function ie(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function Cy(t,e){let n,r,a;const s=[0,0,0];for(let i=0;i<3;i++)a=Math.abs(t[i*3]),(r=Math.abs(t[i*3+1]))>a&&(a=r),(r=Math.abs(t[i*3+2]))>a&&(a=r),s[i]=1/a;a=s[0]*Math.abs(t[0]),n=0,(r=s[1]*Math.abs(t[3]))>=a&&(a=r,n=1),(r=s[2]*Math.abs(t[6]))>=a&&(n=2),n!==0&&(Pn(t,3,n,0),s[n]=s[0]),e[0]=n,t[3]/=t[0],t[6]/=t[0],t[4]-=t[3]*t[1],t[7]-=t[6]*t[1],a=s[1]*Math.abs(t[4]),n=1,(r=s[2]*Math.abs(t[7]))>=a&&(n=2,Pn(t,3,1,2),s[2]=s[1]),e[1]=n,t[7]/=t[4],t[5]-=t[3]*t[2],t[8]-=t[6]*t[2]+t[7]*t[5],e[2]=2}function wy(t,e,n){let r=n[e[0]];n[e[0]]=n[0],n[0]=r,r=n[e[1]],n[e[1]]=n[1],n[1]=r-t[3]*n[0],r=n[e[2]],n[e[2]]=n[2],n[2]=r-t[6]*n[0]-t[7]*n[1],n[2]/=t[8],n[1]=(n[1]-t[5]*n[2])/t[4],n[0]=(n[0]-t[1]*n[1]-t[2]*n[2])/t[0]}function Ey(t,e,n){const r=t[0],a=t[1],s=t[2],i=t[3],o=t[4],c=t[5],u=t[6],g=t[7],f=t[8],l=+ie(o,g,c,f),h=-ie(i,u,c,f),v=+ie(i,u,o,g),p=-ie(a,g,s,f),y=+ie(r,u,s,f),T=-ie(r,u,a,g),S=+ie(a,o,s,c),d=-ie(r,i,s,c),x=+ie(r,i,a,o),w=r*l+a*h+s*v,C=l*e[0]+p*e[1]+S*e[2],M=h*e[0]+y*e[1]+d*e[2],R=v*e[0]+T*e[1]+x*e[2];n[0]=C/w,n[1]=M/w,n[2]=R/w}function My(t,e,n){const r=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],a=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],s=t[6]*e[0]+t[7]*e[1]+t[8]*e[2];n[0]=r,n[1]=a,n[2]=s}function ts(t,e,n){const r=[...t],a=[...e];for(let s=0;s<3;s++)n[s]=r[0]*a[s]+r[1]*a[s+3]+r[2]*a[s+6],n[s+3]=r[3]*a[s]+r[4]*a[s+3]+r[5]*a[s+6],n[s+6]=r[6]*a[s]+r[7]*a[s+3]+r[8]*a[s+6]}function Ry(t,e,n,r,a,s,i){r!==a&&vf("Number of columns of A must match number of rows of B.");const o=[...t],c=[...e];for(let u=0;u<n;u++)for(let g=0;g<s;g++){i[u*s+g]=0;for(let f=0;f<r;f++)i[u*s+g]+=o[u*r+f]*c[g+s*f]}}function Sn(t,e){let n;n=t[3],e[3]=t[1],e[1]=n,n=t[6],e[6]=t[2],e[2]=n,n=t[7],e[7]=t[5],e[5]=n,e[0]=t[0],e[4]=t[4],e[8]=t[8]}function Oy(t,e){const n=t[0],r=t[1],a=t[2],s=t[3],i=t[4],o=t[5],c=t[6],u=t[7],g=t[8],f=+ie(i,u,o,g),l=-ie(s,c,o,g),h=+ie(s,c,i,u),v=-ie(r,u,a,g),p=+ie(n,c,a,g),y=-ie(n,c,r,u),T=+ie(r,i,a,o),S=-ie(n,s,a,o),d=+ie(n,s,r,i),x=n*f+r*l+a*h;x===0&&nn("Matrix has 0 determinant"),e[0]=f/x,e[3]=l/x,e[6]=h/x,e[1]=v/x,e[4]=p/x,e[7]=y/x,e[2]=T/x,e[5]=S/x,e[8]=d/x}function ga(t){return t[0]*t[4]*t[8]+t[3]*t[7]*t[2]+t[6]*t[1]*t[5]-t[0]*t[7]*t[5]-t[3]*t[1]*t[8]-t[6]*t[4]*t[2]}function wf(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:js;if(t.length!==e.length)return!1;function r(a,s){return Math.abs(a-e[s])<=n}return t.every(r)}const Mn=wf;function Ef(t){for(let e=0;e<3;e++)t[e*3]=t[e*3+1]=t[e*3+2]=0,t[e*3+e]=1}function Mf(t,e){for(let n=0;n<t;n++){for(let r=0;r<t;r++)e[n*t+r]=0;e[n*t+n]=1}return e}function Dy(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:js;return Mn(t,yf,e)}function Ly(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:js;return Mn(t,P1,e)}function Rf(t,e){const n=t[0]*t[0],r=t[0]*t[1],a=t[0]*t[2],s=t[0]*t[3],i=t[1]*t[1],o=t[2]*t[2],c=t[3]*t[3],u=t[1]*t[2],g=t[1]*t[3],f=t[2]*t[3],l=i+o+c;let h=1/(n+l);const v=(n-l)*h;h*=2,e[0]=i*h+v,e[3]=(u+s)*h,e[6]=(g-a)*h,e[1]=(u-s)*h,e[4]=o*h+v,e[7]=(f+r)*h,e[2]=(g+a)*h,e[5]=(f-r)*h,e[8]=c*h+v}function zr(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;const n=`${t}`.split("e");let r="";return+n[1]+e>0&&(r="+"),+`${Math.round(`${+n[0]}e${r}${+n[1]+e}`)}e-${e}`}function ns(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=zr(t[0],n),e[1]=zr(t[1],n),e[2]=zr(t[2],n),e}function ir(t,e,n,r){let a,s,i,o,c,u,g,f,l,h,v,p,y,T,S,d;const x=ae(e),w=ae(e),C=(R,V,O)=>{T=R[V],y=R[O],R[V]=T-p*(y+T*h),R[O]=y+p*(T-y*h)};for(Mf(e,r),c=0;c<e;c++)x[c]=n[c]=t[c+c*e],w[c]=0;for(a=0;a<Qi;a++){for(v=0,c=0;c<e-1;c++)for(o=c+1;o<e;o++)v+=Math.abs(t[c*e+o]);if(v===0)break;for(a<3?g=.2*v/(e*e):g=0,c=0;c<e-1;c++)for(o=c+1;o<e;o++)if(T=100*Math.abs(t[c*e+o]),a>3&&Math.abs(n[c])+T===Math.abs(n[c])&&Math.abs(n[o])+T===Math.abs(n[o]))t[c*e+o]=0;else if(Math.abs(t[c*e+o])>g){for(y=n[o]-n[c],Math.abs(y)+T===Math.abs(y)?l=t[c*e+o]/y:(f=.5*y/t[c*e+o],l=1/(Math.abs(f)+Math.sqrt(1+f*f)),f<0&&(l=-l)),S=1/Math.sqrt(1+l*l),p=l*S,h=p/(1+S),y=l*t[c*e+o],w[c]-=y,w[o]+=y,n[c]-=y,n[o]+=y,t[c*e+o]=0,s=0;s<=c-1;s++)C(t,s*e+c,s*e+o);for(s=c+1;s<=o-1;s++)C(t,c*e+s,s*e+o);for(s=o+1;s<e;s++)C(t,c*e+s,o*e+s);for(s=0;s<e;s++)C(r,s*e+c,s*e+o)}for(c=0;c<e;c++)x[c]+=w[c],n[c]=x[c],w[c]=0}if(a>=Qi)return nn("vtkMath::Jacobi: Error extracting eigenfunctions"),0;for(s=0;s<e-1;s++){for(i=s,d=n[i],a=s+1;a<e;a++)(n[a]>=d||Math.abs(n[a]-d)<Ks)&&(i=a,d=n[i]);i!==s&&(n[i]=n[s],n[s]=d,bn(r,e,s,i))}const M=(e>>1)+(e&1);for(u=0,a=0;a<e*e;a++)r[a]>=0&&u++;if(u<M)for(a=0;a<e;a++)r[a*e+s]*=-1;return 1}function Of(t,e){const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];n[0]=t[0]+t[4]+t[8],n[5]=t[0]-t[4]-t[8],n[10]=-t[0]+t[4]-t[8],n[15]=-t[0]-t[4]+t[8],n[1]=n[4]=t[7]-t[5],n[2]=n[8]=t[2]-t[6],n[3]=n[12]=t[3]-t[1],n[6]=n[9]=t[3]+t[1],n[7]=n[13]=t[2]+t[6],n[11]=n[14]=t[7]+t[5];const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=[0,0,0,0],s=[...n];ir(s,4,a,r),e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12]}function Vy(t,e,n){const r=t[0]*e[0],a=t[0]*e[1],s=t[0]*e[2],i=t[0]*e[3],o=t[1]*e[0],c=t[1]*e[1],u=t[1]*e[2],g=t[1]*e[3],f=t[2]*e[0],l=t[2]*e[1],h=t[2]*e[2],v=t[2]*e[3],p=t[3]*e[0],y=t[3]*e[1],T=t[3]*e[2],S=t[3]*e[3];n[0]=r-c-h-S,n[1]=a+o+v-T,n[2]=s-g+f+y,n[3]=i+u-l+p}function Df(t,e){for(let l=0;l<9;l++)e[l]=t[l];const n=ae(3),r=ae(3);let a;for(let l=0;l<3;l++){const h=Math.abs(e[l*3]),v=Math.abs(e[l*3+1]),p=Math.abs(e[l*3+2]);a=v>h?v:h,a=p>a?p:a,n[l]=1,a!==0&&(n[l]/=a)}const s=Math.abs(e[0])*n[0],i=Math.abs(e[3])*n[1],o=Math.abs(e[6])*n[2];r[0]=0,a=s,i>=a&&(a=i,r[0]=1),o>=a&&(r[0]=2),r[0]!==0&&(bn(e,3,r[0],0),n[r[0]]=n[0]);const c=Math.abs(e[4])*n[1],u=Math.abs(e[7])*n[2];r[1]=1,a=c,u>=a&&(r[1]=2,bn(e,3,1,2)),r[2]=2;let g=0;if(ga(e)<0){g=1;for(let l=0;l<9;l++)e[l]=-e[l]}const f=ae(4);if(Of(e,f),Rf(f,e),g)for(let l=0;l<9;l++)e[l]=-e[l];r[1]!==1&&bn(e,3,r[1],1),r[0]!==0&&bn(e,3,r[0],0)}function Lf(t,e,n){let r,a,s,i,o,c;const u=[...t];if(ir(u,3,e,n),e[0]===e[1]&&e[0]===e[2]){Ef(n);return}for(Sn(n,n),r=0;r<3;r++)if(e[(r+1)%3]===e[(r+2)%3]){for(c=Math.abs(n[r*3]),i=0,a=1;a<3;a++)c<(o=Math.abs(n[r*3+a]))&&(c=o,i=a);i!==r&&(o=e[i],e[i]=e[r],e[r]=o,Pn(n,3,r,i)),n[i*3+i]<0&&(n[i*3]=-n[i*3],n[i*3+1]=-n[i*3+1],n[i*3+2]=-n[i*3+2]),a=(i+1)%3,s=(i+2)%3,n[a*3]=0,n[a*3+1]=0,n[a*3+2]=0,n[a*3+a]=1;const g=Ue([n[i*3],n[i*3+1],n[i*3+2]],[n[a*3],n[a*3+1],n[a*3+2]],[]);we(g);const f=Ue(g,[n[i*3],n[i*3+1],n[i*3+2]],[]);for(let l=0;l<3;l++)n[s*3+l]=g[l],n[a*3+l]=f[l];Sn(n,n);return}for(c=Math.abs(n[0]),i=0,r=1;r<3;r++)c<(o=Math.abs(n[r*3]))&&(c=o,i=r);if(i!==0){const g=e[i];e[i]=e[0],e[0]=g,Pn(n,3,i,0)}if(Math.abs(n[4])<Math.abs(n[7])){const g=e[2];e[2]=e[1],e[1]=g,Pn(n,3,1,2)}for(r=0;r<2;r++)n[r*3+r]<0&&(n[r*3]=-n[r*3],n[r*3+1]=-n[r*3+1],n[r*3+2]=-n[r*3+2]);ga(n)<0&&(n[6]=-n[6],n[7]=-n[7],n[8]=-n[8]),Sn(n,n)}function By(t,e,n,r){let a;const s=[...t],i=ga(s);if(i<0)for(a=0;a<9;a++)s[a]=-s[a];Df(s,e),Sn(s,s),ts(s,e,r),Lf(r,n,r),ts(e,r,e),Sn(r,r),i<0&&(n[0]=-n[0],n[1]=-n[1],n[2]=-n[2])}function Ps(t,e,n){let r,a,s,i,o=0,c,u,g;const f=ae(n);for(r=0;r<n;r++){for(i=0,a=0;a<n;a++)(g=Math.abs(t[r*n+a]))>i&&(i=g);if(i===0)return nn("Unable to factor linear system"),0;f[r]=1/i}for(a=0;a<n;a++){for(r=0;r<a;r++){for(c=t[r*n+a],s=0;s<r;s++)c-=t[r*n+s]*t[s*n+a];t[r*n+a]=c}for(i=0,r=a;r<n;r++){for(c=t[r*n+a],s=0;s<a;s++)c-=t[r*n+s]*t[s*n+a];t[r*n+a]=c,(u=f[r]*Math.abs(c))>=i&&(i=u,o=r)}if(a!==o){for(s=0;s<n;s++)u=t[o*n+s],t[o*n+s]=t[a*n+s],t[a*n+s]=u;f[o]=f[a]}if(e[a]=o,Math.abs(t[a*n+a])<=Ks)return nn("Unable to factor linear system"),0;if(a!==n-1)for(u=1/t[a*n+a],r=a+1;r<n;r++)t[r*n+a]*=u}return 1}function Xs(t,e,n,r){let a,s,i,o,c;for(i=-1,a=0;a<r;a++){if(o=e[a],c=n[o],n[o]=n[a],i>=0)for(s=i;s<=a-1;s++)c-=t[a*r+s]*n[s];else c!==0&&(i=a);n[a]=c}for(a=r-1;a>=0;a--){for(c=n[a],s=a+1;s<r;s++)c-=t[a*r+s]*n[s];n[a]=c/t[a*r+a]}}function Vf(t,e,n){if(n===2){const a=ae(2),s=ie(t[0],t[1],t[2],t[3]);return s===0?0:(a[0]=(t[3]*e[0]-t[1]*e[1])/s,a[1]=(-(t[2]*e[0])+t[0]*e[1])/s,e[0]=a[0],e[1]=a[1],1)}if(n===1)return t[0]===0?0:(e[0]/=t[0],1);const r=ae(n);return Ps(t,r,n)===0?0:(Xs(t,r,e,n),1)}function Is(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;const s=r||ae(n),i=a||ae(n);if(Ps(t,s,n)===0)return null;for(let o=0;o<n;o++){for(let c=0;c<n;c++)i[c]=0;i[o]=1,Xs(t,s,i,n);for(let c=0;c<n;c++)e[c*n+o]=i[c]}return e}function Fy(t,e){let n=+Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let a=0;a<e;a++)for(let s=a;s<e;s++)Math.abs(t[a*e+s])>r&&(r=Math.abs(t[a*e+s]));for(let a=0;a<e;a++)Math.abs(t[a*e+a])<n&&(n=Math.abs(t[a*e+a]));return n===0?Number.MAX_VALUE:r/n}function my(t,e,n){return ir(t,3,e,n)}function rs(t,e,n,r){if(t<n)return nn("Insufficient number of samples. Underdetermined."),0;let a,s,i;const o=ae(n*n),c=ae(n),u=ae(n*n);for(i=0;i<t;i++)for(a=0;a<n;a++)for(s=a;s<n;s++)o[a*n+s]+=e[i*n+a]*e[i*n+s];for(a=0;a<n;a++)for(s=0;s<a;s++)o[a*n+s]=o[s*n+a];for(ir(o,n,c,u),a=0;a<n;a++)r[a]=u[a*n+n-1];return 1}function ky(t,e,n,r,a,s){let i=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!0;if(t<n||t<a)return nn("Insufficient number of samples. Underdetermined."),0;const o=ae(a);let c=1,u,g=0,f,l,h,v=0;if(i){for(l=0;l<a;l++)o[l]=1;for(f=0;f<t;f++)for(l=0;l<a;l++)Math.abs(r[f*a+l])>Ks&&(c=0,o[l]=0);if(c&&a===1)return nn("Detected homogeneous system (Y=0), calling SolveHomogeneousLeastSquares()"),rs(t,e,n,s);if(c)v=1;else for(l=0;l<a;l++)o[l]&&(v=1)}v&&(u=ae(n),g=rs(t,e,n,u));const p=ae(n*n),y=ae(n*n),T=ae(n*a);for(h=0;h<t;h++)for(f=0;f<n;f++){for(l=f;l<n;l++)p[f*n+l]+=e[h*n+f]*e[h*n+l];for(l=0;l<a;l++)T[f*a+l]+=e[h*n+f]*r[h*a+l]}for(f=0;f<n;f++)for(l=0;l<f;l++)p[f*n+l]=p[l*n+f];const S=Is(p,y,n);if(S)for(f=0;f<n;f++)for(l=0;l<a;l++)for(s[f*a+l]=0,h=0;h<n;h++)s[f*a+l]+=y[f*n+h]*T[h*a+l];if(v){for(l=0;l<a;l++)if(o[l])for(f=0;f<n;f++)s[f*a+l]=u[f*a]}return v?g&&S:S}function Uy(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,.5,1];switch(t.length){case 3:return e[0]=parseInt(t[0],16)*17/255,e[1]=parseInt(t[1],16)*17/255,e[2]=parseInt(t[2],16)*17/255,e;case 4:return e[0]=parseInt(t[1],16)*17/255,e[1]=parseInt(t[2],16)*17/255,e[2]=parseInt(t[3],16)*17/255,e;case 6:return e[0]=parseInt(t.substr(0,2),16)/255,e[1]=parseInt(t.substr(2,2),16)/255,e[2]=parseInt(t.substr(4,2),16)/255,e;case 7:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e;case 9:return e[0]=parseInt(t.substr(1,2),16)/255,e[1]=parseInt(t.substr(3,2),16)/255,e[2]=parseInt(t.substr(5,2),16)/255,e[3]=parseInt(t.substr(7,2),16)/255,e;default:return e}}function Ny(t,e){let n,r;const[a,s,i]=t,o=1/3,c=1/6,u=2/3;let g=a,f=a;s>g?g=s:s<f&&(f=s),i>g?g=i:i<f&&(f=i);const l=g;l>0?r=(g-f)/g:r=0,r>0?(a===g?n=c*(s-i)/(g-f):s===g?n=o+c*(i-a)/(g-f):n=u+c*(a-s)/(g-f),n<0&&(n+=1)):n=0,e[0]=n,e[1]=r,e[2]=l}function Bf(t,e){const[n,r,a]=t,s=1/3,i=1/6,o=2/3,c=5/6;let u,g,f;n>i&&n<=s?(g=1,u=(s-n)/i,f=0):n>s&&n<=.5?(g=1,f=(n-s)/i,u=0):n>.5&&n<=o?(f=1,g=(o-n)/i,u=0):n>o&&n<=c?(f=1,u=(n-o)/i,g=0):n>c&&n<=1?(u=1,f=(1-n)/i,g=0):(u=1,g=n/i,f=0),u=r*u+(1-r),g=r*g+(1-r),f=r*f+(1-r),u*=a,g*=a,f*=a,e[0]=u,e[1]=g,e[2]=f}function Ff(t,e){const[n,r,a]=t;let s=(n+16)/116,i=r/500+s,o=s-a/200;s**3>.008856?s**=3:s=(s-16/116)/7.787,i**3>.008856?i**=3:i=(i-16/116)/7.787,o**3>.008856?o**=3:o=(o-16/116)/7.787;const c=.9505,u=1,g=1.089;e[0]=c*i,e[1]=u*s,e[2]=g*o}function mf(t,e){const[n,r,a]=t,s=.9505,i=1,o=1.089;let c=n/s,u=r/i,g=a/o;c>.008856?c**=1/3:c=7.787*c+16/116,u>.008856?u**=1/3:u=7.787*u+16/116,g>.008856?g**=1/3:g=7.787*g+16/116,e[0]=116*u-16,e[1]=500*(c-u),e[2]=200*(u-g)}function kf(t,e){const[n,r,a]=t;let s=n*3.2406+r*-1.5372+a*-.4986,i=n*-.9689+r*1.8758+a*.0415,o=n*.0557+r*-.204+a*1.057;s>.0031308?s=1.055*s**(1/2.4)-.055:s*=12.92,i>.0031308?i=1.055*i**(1/2.4)-.055:i*=12.92,o>.0031308?o=1.055*o**(1/2.4)-.055:o*=12.92;let c=s;c<i&&(c=i),c<o&&(c=o),c>1&&(s/=c,i/=c,o/=c),s<0&&(s=0),i<0&&(i=0),o<0&&(o=0),e[0]=s,e[1]=i,e[2]=o}function Uf(t,e){let[n,r,a]=t;n>.04045?n=((n+.055)/1.055)**2.4:n/=12.92,r>.04045?r=((r+.055)/1.055)**2.4:r/=12.92,a>.04045?a=((a+.055)/1.055)**2.4:a/=12.92,e[0]=n*.4124+r*.3576+a*.1805,e[1]=n*.2126+r*.7152+a*.0722,e[2]=n*.0193+r*.1192+a*.9505}function _y(t,e){const n=[0,0,0];Uf(t,n),mf(n,e)}function Gy(t,e){const n=[0,0,0];Ff(t,n),kf(n,e)}function Ys(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function Wr(t){return!(t[1]-t[0]<0)}function by(t,e,n){return n[0]=Math.min(t[0],e[0]),n[1]=Math.max(t[0],e[0]),n[2]=Math.min(t[1],e[1]),n[3]=Math.max(t[1],e[1]),n[4]=Math.min(t[2],e[2]),n[5]=Math.max(t[2],e[2]),n}function Hr(t,e,n){return t<e?e:t>n?n:t}function as(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return r[0]=Hr(t[0],e[0],n[0]),r[1]=Hr(t[1],e[1],n[1]),r[2]=Hr(t[2],e[2],n[2]),r}function $y(t,e){let n=0;return e[0]!==e[1]&&(t<e[0]?n=e[0]:t>e[1]?n=e[1]:n=t,n=(n-e[0])/(e[1]-e[0])),n}const zy=sr("GetScalarTypeFittingRange"),Wy=sr("GetAdjustedScalarRange");function Hy(t,e){if(!t||!e)return 0;for(let n=0;n<6;n+=2)if(t[n]<e[n]||t[n]>e[n+1]||t[n+1]<e[n]||t[n+1]>e[n+1])return 0;return 1}function Ay(t,e,n){if(!t||!e)return 0;for(let r=0;r<6;r+=2)if(t[r]+n[r/2]<e[r]||t[r]-n[r/2]>e[r+1]||t[r+1]+n[r/2]<e[r]||t[r+1]-n[r/2]>e[r+1])return 0;return 1}function jy(t,e,n){if(!t||!e||!n)return 0;for(let r=0;r<3;r++)if(t[r]+n[r]<e[2*r]||t[r]-n[r]>e[2*r+1])return 0;return 1}function Ky(t,e,n,r){const a=ae(3),s=ae(3),i=ae(3),o=ae(3),c=ae(3),u=ae(3);for(let x=0;x<3;++x)a[x]=t[x]-e[x],s[x]=e[x]-n[x],i[x]=n[x]-t[x],o[x]=-a[x],c[x]=-s[x],u[x]=-i[x];const g=$e(o),f=$e(c),l=$e(i),h=ae(3);Ue(a,s,h);const v=$e(h),p=g*f*l/(2*v),y=2*v*v,T=f*f*W(a,u)/y,S=l*l*W(o,s)/y,d=g*g*W(i,c)/y;for(let x=0;x<3;++x)r[x]=T*t[x]+S*e[x]+d*n[x];return p}const Py=1/0,Xy=-1/0,Iy=t=>!Number.isFinite(t),{isFinite:Yy,isNaN:ss}=Number,Nf=ss;function la(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function Qy(t){let e=-1,n=-1;for(let r=0;r<t.length;r++){const a=Math.abs(t[r]);a>e&&(n=r,e=a)}return n}function Zy(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;const n=new Array(e),r=new Array(e);for(let s=0;s<e;++s)n[s]=s,r[s]=s;for(let s=e-1;s>0;s--){let i=-1/0,o=0,c=0;for(let u=0;u<=s;++u){const g=n[u];for(let f=0;f<=s;++f){const l=r[f],h=Math.abs(t[g+e*l]);h>i&&(i=h,o=u,c=f)}}[n[s],n[o]]=[n[o],n[s]],[r[s],r[c]]=[r[c],r[s]]}const a=new Array(e*e).fill(0);for(let s=0;s<e;++s){const i=n[s]+e*r[s];a[i]=t[i]<0?-1:1}return a}function _f(t){const e=Math.floor(t*255);return e>15?e.toString(16):`0${e.toString(16)}`}function qy(t){return`${arguments.length>1&&arguments[1]!==void 0?arguments[1]:"#"}${t.map(_f).join("")}`}function hr(t){return Math.round(t*255)}function Jy(t){return t.length===3?`rgb(${t.map(hr).join(", ")})`:`rgba(${hr(t[0]||0)}, ${hr(t[1]||0)}, ${hr(t[2]||0)}, ${t[3]||0})`}var Zi={Pi:X1,ldexp:I1,radiansFromDegrees:oe,degreesFromRadians:wn,round:$n,floor:Y1,ceil:Q1,ceilLog2:ny,min:Z1,max:q1,arrayMin:J1,arrayMax:ey,arrayRange:ty,isPowerOfTwo:zn,nearestPowerOfTwo:Ke,factorial:ry,binomial:ay,beginCombination:sy,nextCombination:iy,randomSeed:oy,getSeed:cy,random:fy,gaussian:uy,add:En,subtract:ye,multiplyScalar:df,multiplyScalar2D:xf,multiplyAccumulate:Ja,multiplyAccumulate2D:gy,dot:W,outer:ly,cross:Ue,norm:$e,normalize:we,perpendiculars:hy,projectVector:yy,projectVector2D:vy,distance2BetweenPoints:Se,angleBetweenVectors:Ty,gaussianAmplitude:dy,gaussianWeight:xy,dot2D:es,outer2D:Sy,norm2D:Sf,normalize2D:Cf,determinant2x2:ie,LUFactor3x3:Cy,LUSolve3x3:wy,linearSolve3x3:Ey,multiply3x3_vect3:My,multiply3x3_mat3:ts,multiplyMatrix:Ry,transpose3x3:Sn,invert3x3:Oy,identity3x3:Ef,identity:Mf,isIdentity:Dy,isIdentity3x3:Ly,determinant3x3:ga,quaternionToMatrix3x3:Rf,areEquals:wf,areMatricesEqual:Mn,roundNumber:zr,roundVector:ns,matrix3x3ToQuaternion:Of,multiplyQuaternion:Vy,orthogonalize3x3:Df,diagonalize3x3:Lf,singularValueDecomposition3x3:By,solveLinearSystem:Vf,invertMatrix:Is,luFactorLinearSystem:Ps,luSolveLinearSystem:Xs,estimateMatrixCondition:Fy,jacobi:my,jacobiN:ir,solveHomogeneousLeastSquares:rs,solveLeastSquares:ky,hex2float:Uy,rgb2hsv:Ny,hsv2rgb:Bf,lab2xyz:Ff,xyz2lab:mf,xyz2rgb:kf,rgb2xyz:Uf,rgb2lab:_y,lab2rgb:Gy,uninitializeBounds:Ys,areBoundsInitialized:Wr,computeBoundsFromPoints:by,clampValue:Hr,clampVector:as,clampAndNormalizeValue:$y,getScalarTypeFittingRange:zy,getAdjustedScalarRange:Wy,extentIsWithinOtherExtent:Hy,boundsIsWithinOtherBounds:Ay,pointIsWithinBounds:jy,solve3PointCircle:Ky,inf:Py,negInf:Xy,isInf:Iy,isNan:ss,isNaN:ss,isFinite:Yy,createUninitializedBounds:la,getMajorAxisIndex:Qy,getSparseOrthogonalMatrix:Zy,floatToHex2:_f,floatRGB2HexCode:qy,float2CssRGBA:Jy};function ev(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=n=>{if(!e.transform)return t.evaluateFunction(n);const r=[];return e.transform.transformPoint(n,r),t.evaluateFunction(r)},t.evaluateFunction=n=>{E.vtkErrorMacro("not implemented")}}const tv={};function Gf(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tv,n),E.obj(t,e),E.setGet(t,e,["transform"]),ev(t,e)}const nv=E.newInstance(Gf,"vtkImplicitFunction");var bf={newInstance:nv,extend:Gf};const is=1e-6,$f="coincide",zf="disjoint";function rv(t,e,n){return t[0]*(n[0]-e[0])+t[1]*(n[1]-e[1])+t[2]*(n[2]-e[2])}function Wf(t,e,n){const r=n[0]*(t[0]-e[0])+n[1]*(t[1]-e[1])+n[2]*(t[2]-e[2]);return Math.abs(r)}function Hf(t,e,n,r){const a=[];ye(t,e,a);const s=W(n,a);r[0]=t[0]-s*n[0],r[1]=t[1]-s*n[1],r[2]=t[2]-s*n[2]}function Af(t,e,n){const r=W(t,e);let a=W(e,e);return a===0&&(a=1),n[0]=t[0]-r*e[0]/a,n[1]=t[1]-r*e[1]/a,n[2]=t[2]-r*e[2]/a,n}function jf(t,e,n,r){const a=[];ye(t,e,a);const s=W(n,a),i=W(n,n);i!==0?(r[0]=t[0]-s*n[0]/i,r[1]=t[1]-s*n[1]/i,r[2]=t[2]-s*n[2]/i):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}function Kf(t,e,n,r){const a={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},s=[],i=[];ye(e,t,s),ye(n,t,i);const o=W(r,i),c=W(r,s);let u,g;return c<0?u=-c:u=c,o<0?g=-o*is:g=o*is,u<=g||(a.t=o/c,a.x[0]=t[0]+a.t*s[0],a.x[1]=t[1]+a.t*s[1],a.x[2]=t[2]+a.t*s[2],a.intersection=!0,a.betweenPoints=a.t>=0&&a.t<=1),a}function Pf(t,e,n,r){const a={intersection:!1,l0:[],l1:[],error:null},s=[];Ue(e,r,s);const i=s.map(f=>Math.abs(f));if(i[0]+i[1]+i[2]<is){const f=[];return ye(t,n,f),W(e,f)===0?a.error=$f:a.error=zf,a}let o;i[0]>i[1]&&i[0]>i[2]?o="x":i[1]>i[2]?o="y":o="z";const c=[],u=-W(e,t),g=-W(r,n);switch(o){case"x":c[0]=0,c[1]=(g*e[2]-u*r[2])/s[0],c[2]=(u*r[1]-g*e[1])/s[0];break;case"y":c[0]=(u*r[2]-g*e[2])/s[1],c[1]=0,c[2]=(g*e[0]-u*r[0])/s[1];break;case"z":c[0]=(g*e[1]-u*r[1])/s[2],c[1]=(u*r[0]-g*e[0])/s[2],c[2]=0;break}return a.l0=c,En(c,s,a.l1),a.intersection=!0,a}const av={evaluate:rv,distanceToPlane:Wf,projectPoint:Hf,projectVector:Af,generalizedProjectPoint:jf,intersectWithLine:Kf,intersectWithPlane:Pf,DISJOINT:zf,COINCIDE:$f};function sv(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=n=>Wf(n,e.origin,e.normal),t.projectPoint=(n,r)=>{Hf(n,e.origin,e.normal,r)},t.projectVector=(n,r)=>Af(n,e.normal,r),t.push=n=>{if(n!==0)for(let r=0;r<3;r++)e.origin[r]+=n*e.normal[r]},t.generalizedProjectPoint=(n,r)=>{jf(n,e.origin,e.normal,r)},t.evaluateFunction=(n,r,a)=>Array.isArray(n)?e.normal[0]*(n[0]-e.origin[0])+e.normal[1]*(n[1]-e.origin[1])+e.normal[2]*(n[2]-e.origin[2]):e.normal[0]*(n-e.origin[0])+e.normal[1]*(r-e.origin[1])+e.normal[2]*(a-e.origin[2]),t.evaluateGradient=n=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(n,r)=>Kf(n,r,e.origin,e.normal),t.intersectWithPlane=(n,r)=>Pf(n,r,e.origin,e.normal)}const iv={normal:[0,0,1],origin:[0,0,0]};function Xf(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iv,n),bf.extend(t,e,n),E.setGetArray(t,e,["normal","origin"],3),sv(t,e)}const ov=E.newInstance(Xf,"vtkPlane");var Ut={newInstance:ov,extend:Xf,...av};const pa=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function If(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function xt(t){return(t==null?void 0:t.length)>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function Qs(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Zs(t){return Qs(t,pa)}function ea(t,e,n,r){const[a,s,i,o,c,u]=t;return t[0]=a<e?a:e,t[1]=s>e?s:e,t[2]=i<n?i:n,t[3]=o>n?o:n,t[4]=c<r?c:r,t[5]=u>r?u:r,t}function qs(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let n=0;n<e.length;++n)ea(t,...e[n]);else for(let n=0;n<e.length;n+=3)ea(t,...e.slice(n,n+3));return t}function Yf(t,e,n,r,a,s,i){const[o,c,u,g,f,l]=t;return i===void 0?(t[0]=Math.min(e[0],o),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],u),t[3]=Math.max(e[3],g),t[4]=Math.min(e[4],f),t[5]=Math.max(e[5],l)):(t[0]=Math.min(e,o),t[1]=Math.max(n,c),t[2]=Math.min(r,u),t[3]=Math.max(a,g),t[4]=Math.min(s,f),t[5]=Math.max(i,l)),t}function Qf(t,e,n,r){const[a,s,i,o,c,u]=t;return t[0]=e,t[1]=e>s?e:s,t[2]=n,t[3]=n>o?n:o,t[4]=r,t[5]=r>u?r:u,a!==e||i!==n||c!==r}function Zf(t,e,n,r){const[a,s,i,o,c,u]=t;return t[0]=e<a?e:a,t[1]=e,t[2]=n<i?n:i,t[3]=n,t[4]=r<c?r:c,t[5]=r,s!==e||o!==n||u!==r}function Js(t,e){return e==null?cv(t):(t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t)}function cv(t){const e=[0,0,0];let n=-1,r=0,a=0;for(let s=0;s<3;++s)a=t[s*2+1]-t[s*2],a>r&&(r=a,n=s),e[s]=a>0?1:0;if(n<0)return Js(t,.5);for(let s=0;s<3;++s)if(!e[s]){const i=.005*r;t[s*2]-=i,t[s*2+1]+=i}return t}function ei(t,e,n,r){return xt(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),n>=0?(t[2]*=n,t[3]*=n):(t[2]=n*t[3],t[3]=n*t[2]),r>=0?(t[4]*=r,t[5]*=r):(t[4]=r*t[5],t[5]=r*t[4]),!0):!1}function ti(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function fv(t,e,n,r){if(!xt(t))return!1;const a=ti(t);return t[0]-=a[0],t[1]-=a[0],t[2]-=a[1],t[3]-=a[1],t[4]-=a[2],t[5]-=a[2],ei(t,e,n,r),t[0]+=a[0],t[1]+=a[0],t[2]+=a[1],t[3]+=a[1],t[4]+=a[2],t[5]+=a[2],!0}function Xn(t,e){return t[e*2+1]-t[e*2]}function or(t){return[Xn(t,0),Xn(t,1),Xn(t,2)]}function qf(t){return t.slice(0,2)}function Jf(t){return t.slice(2,4)}function eu(t){return t.slice(4,6)}function tu(t){const e=or(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function ni(t){if(xt(t)){const e=or(t);return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}return null}function nu(t){const e=ni(t);return e!==null?Math.sqrt(e):null}function ha(t){return[t[0],t[2],t[4]]}function ya(t){return[t[1],t[3],t[5]]}function yr(t,e){return t<=0&&e>=0||t>=0&&e<=0}function ri(t,e){return e[0]=[t[0],t[2],t[4]],e[1]=[t[0],t[2],t[5]],e[2]=[t[0],t[3],t[4]],e[3]=[t[0],t[3],t[5]],e[4]=[t[1],t[2],t[4]],e[5]=[t[1],t[2],t[5]],e[6]=[t[1],t[3],t[4]],e[7]=[t[1],t[3],t[5]],e}function ru(t,e,n){return e[0]=t[0],e[1]=t[2],e[2]=t[4],n[0]=t[1],n[1]=t[3],n[2]=t[5],e}function au(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const r=ri(t,[]);for(let a=0;a<r.length;++a)q(r[a],r[a],e);return Zs(n),qs(n,r)}function su(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function iu(t,e,n,r){const a=[].concat(pa),s=t.getData();for(let i=0;i<s.length;i+=3){const o=[s[i],s[i+1],s[i+2]],c=W(o,e);a[0]=Math.min(c,a[0]),a[1]=Math.max(c,a[1]);const u=W(o,n);a[2]=Math.min(u,a[2]),a[3]=Math.max(u,a[3]);const g=W(o,r);a[4]=Math.min(g,a[4]),a[5]=Math.max(g,a[5])}return a}function ou(t,e,n,r,a){let s=!0;const i=[];let o=0;const c=[],u=[0,0,0],g=0,f=1,l=2;for(let h=0;h<3;h++)e[h]<t[2*h]?(i[h]=f,u[h]=t[2*h],s=!1):e[h]>t[2*h+1]?(i[h]=g,u[h]=t[2*h+1],s=!1):i[h]=l;if(s)return r[0]=e[0],r[1]=e[1],r[2]=e[2],a[0]=0,1;for(let h=0;h<3;h++)i[h]!==l&&n[h]!==0?c[h]=(u[h]-e[h])/n[h]:c[h]=-1;for(let h=0;h<3;h++)c[o]<c[h]&&(o=h);if(c[o]>1||c[o]<0)return 0;a[0]=c[o];for(let h=0;h<3;h++)if(o!==h){if(r[h]=e[h]+c[o]*n[h],r[h]<t[2*h]||r[h]>t[2*h+1])return 0}else r[h]=u[h];return 1}function cu(t,e,n){const r=[];let a=0,s=1,i=1;for(let o=4;o<=5;++o){r[2]=t[o];for(let c=2;c<=3;++c){r[1]=t[c];for(let u=0;u<=1;++u)if(r[0]=t[u],a=Ut.evaluate(n,e,r),i&&(s=a>=0?1:-1,i=0),a===0||s>0&&a<0||s<0&&a>0)return 1}}return 0}function fu(t,e){if(!(xt(t)&&xt(e)))return!1;const n=[0,0,0,0,0,0];let r;for(let a=0;a<3;a++)if(r=!1,e[a*2]>=t[a*2]&&e[a*2]<=t[a*2+1]?(r=!0,n[a*2]=e[a*2]):t[a*2]>=e[a*2]&&t[a*2]<=e[a*2+1]&&(r=!0,n[a*2]=t[a*2]),e[a*2+1]>=t[a*2]&&e[a*2+1]<=t[a*2+1]?(r=!0,n[a*2+1]=e[2*a+1]):t[a*2+1]>=e[a*2]&&t[a*2+1]<=e[a*2+1]&&(r=!0,n[a*2+1]=t[a*2+1]),!r)return!1;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],!0}function ta(t,e){if(!(xt(t)&&xt(e)))return!1;for(let n=0;n<3;n++)if(!(e[n*2]>=t[n*2]&&e[n*2]<=t[n*2+1])&&!(t[n*2]>=e[n*2]&&t[n*2]<=e[n*2+1])&&!(e[n*2+1]>=t[n*2]&&e[n*2+1]<=t[n*2+1])&&!(t[n*2+1]>=e[n*2]&&t[n*2+1]<=e[n*2+1]))return!1;return!0}function na(t,e,n,r){return!(e<t[0]||e>t[1]||n<t[2]||n>t[3]||r<t[4]||r>t[5])}function uv(t,e){return!(!ta(t,e)||!na(t,...ha(e))||!na(t,...ya(e)))}function uu(t,e,n){const r=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],a=[0,0,0,0,0,0,0,0];let s=0;for(let f=0;f<2;f++)for(let l=2;l<4;l++)for(let h=4;h<6;h++){const v=[t[f],t[l],t[h]];a[s++]=Ut.evaluate(n,e,v)}let i=2;for(;i--&&!(yr(a[r[i][0]],a[r[i][4]])&&yr(a[r[i][1]],a[r[i][5]])&&yr(a[r[i][2]],a[r[i][6]])&&yr(a[r[i][3]],a[r[i][7]])););if(i<0)return!1;const o=Math.sign(n[i]),c=Math.abs((t[i*2+1]-t[i*2])*n[i]);let u=o>0?1:0;for(let f=0;f<4;f++){if(c===0)continue;const l=Math.abs(a[r[i][f]])/c;o>0&&l<u&&(u=l),o<0&&l>u&&(u=l)}const g=(1-u)*t[i*2]+u*t[i*2+1];return o>0?t[i*2]=g:t[i*2+1]=g,!0}function gu(t,e){for(let r=0;r<3;++r)e[r]=e[r]<1?1:e[r];let n=e[0]*e[1]*e[2];for(;n>t;){for(let r=0;r<3;++r)e[r]=e[r]>1?e[r]-1:1;n=e[0]*e[1]*e[2]}}function lu(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];e=e<=0?1:e;let a=0;const s=[0,0,0];let i=-1,o=0;const c=or(t),u=c[0]+c[1]+c[2],g=u*(.001/3);for(let p=0;p<3;++p)c[p]>o&&(i=p,o=c[p]),c[p]>g?(s[p]=1,a++):s[p]=0;const f=ha(t),l=ya(t);if(a<1)return n[0]=1,n[1]=1,n[2]=1,r[0]=f[0]-.5,r[1]=l[0]+.5,r[2]=f[1]-.5,r[3]=l[1]+.5,r[4]=f[2]-.5,r[5]=l[2]+.5,1;let h=e;h/=s[0]?c[0]/u:1,h/=s[1]?c[1]/u:1,h/=s[2]?c[2]/u:1,h**=1/a;for(let p=0;p<3;++p)n[p]=s[p]?Math.floor(h*c[p]/u):1,n[p]=n[p]<1?1:n[p];gu(e,n);const v=.5*c[i]/n[i];for(let p=0;p<3;++p)s[p]?(r[2*p]=f[p],r[2*p+1]=l[p]):(r[2*p]=f[p]-v,r[2*p+1]=l[p]+v);return n[0]*n[1]*n[2]}function pu(t,e){if(t[0]>=e[0]&&t[0]<=e[1]&&t[1]>=e[2]&&t[1]<=e[3]&&t[2]>=e[4]&&t[2]<=e[5])return 0;const n=[0,0,0];return t[0]<e[0]?n[0]=e[0]-t[0]:t[0]>e[1]&&(n[0]=t[0]-e[1]),t[1]<e[2]?n[1]=e[2]-t[1]:t[1]>e[3]&&(n[1]=t[1]-e[3]),t[2]<e[4]?n[2]=e[4]-t[2]:t[2]>e[5]&&(n[2]=t[2]-e[5]),W(n,n)}class gv{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(pa))}getBounds(){return this.bounds}equals(e){return If(this.bounds,e)}isValid(){return xt(this.bounds)}setBounds(e){return Qs(this.bounds,e)}reset(){return Zs(this.bounds)}addPoint(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return ea(this.bounds,...n)}addPoints(e){return qs(this.bounds,e)}addBounds(e,n,r,a,s,i){return Yf(this.bounds,e,n,r,a,s,i)}setMinPoint(e,n,r){return Qf(this.bounds,e,n,r)}setMaxPoint(e,n,r){return Zf(this.bounds,e,n,r)}inflate(e){return Js(this.bounds,e)}scale(e,n,r){return ei(this.bounds,e,n,r)}getCenter(){return ti(this.bounds)}getLength(e){return Xn(this.bounds,e)}getLengths(){return or(this.bounds)}getMaxLength(){return tu(this.bounds)}getDiagonalLength(){return nu(this.bounds)}getDiagonalLength2(){return ni(this.bounds)}getMinPoint(){return ha(this.bounds)}getMaxPoint(){return ya(this.bounds)}getXRange(){return qf(this.bounds)}getYRange(){return Jf(this.bounds)}getZRange(){return eu(this.bounds)}getCorners(e){return ri(this.bounds,e)}computeCornerPoints(e,n){return ru(this.bounds,e,n)}computeLocalBounds(e,n,r){return iu(this.bounds,e,n,r)}transformBounds(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return au(this.bounds,e,n)}computeScale3(e){return su(this.bounds,e)}cutWithPlane(e,n){return uu(this.bounds,e,n)}intersectBox(e,n,r,a){return ou(this.bounds,e,n,r,a)}intersectPlane(e,n){return cu(this.bounds,e,n)}intersect(e){return fu(this.bounds,e)}intersects(e){return ta(this.bounds,e)}containsPoint(e,n,r){return na(this.bounds,e,n,r)}contains(e){return ta(this.bounds,e)}computeDivisions(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return lu(this.bounds,e,n,r)}distance2ToBounds(e){return pu(e,this.bounds)}}function lv(t){const e=t&&t.bounds;return new gv(e)}const pv={equals:If,isValid:xt,setBounds:Qs,reset:Zs,addPoint:ea,addPoints:qs,addBounds:Yf,setMinPoint:Qf,setMaxPoint:Zf,inflate:Js,scale:ei,scaleAboutCenter:fv,getCenter:ti,getLength:Xn,getLengths:or,getMaxLength:tu,getDiagonalLength:nu,getDiagonalLength2:ni,getMinPoint:ha,getMaxPoint:ya,getXRange:qf,getYRange:Jf,getZRange:eu,getCorners:ri,computeCornerPoints:ru,computeLocalBounds:iu,transformBounds:au,computeScale3:su,cutWithPlane:uu,intersectBox:ou,intersectPlane:cu,intersect:fu,intersects:ta,containsPoint:na,contains:uv,computeDivisions:lu,clampDivisions:gu,distance2ToBounds:pu,INIT_BOUNDS:pa};var j={newInstance:lv,...pv};const hv={DISPLAY:0,WORLD:1};var hu={CoordinateSystem:hv};const{CoordinateSystem:os}=hu;function qi(t){return()=>E.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function yv(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let n=e.mtime;for(let r=0;r<e.textures.length;++r){const a=e.textures[r].getMTime();a>n&&(n=a)}return n},t.processSelectorPixelBuffers=(n,r)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=qi("pick"),t.hasKey=qi("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=n=>{e.estimatedRenderTime=n,e.savedEstimatedRenderTime=n},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=n=>{e.estimatedRenderTime+=n},t.setAllocatedRenderTime=n=>{e.allocatedRenderTime=n,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=n=>e.textures.indexOf(n)!==-1,t.addTexture=n=>{n&&!t.hasTexture(n)&&(e.textures=e.textures.concat(n),t.modified())},t.removeTexture=n=>{const r=e.textures.filter(a=>a!==n);e.textures.length!==r.length&&(e.textures=r,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(os.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(os.DISPLAY)}const vv={allocatedRenderTime:10,coordinateSystem:os.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function yu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vv,n),E.obj(t,e),E.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),E.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),E.moveToProtected(t,e,["parentProp"]),yv(t,e)}const Tv=E.newInstance(yu,"vtkProp");var cr={newInstance:Tv,extend:yu,...hu};const dv=1e-6;function xv(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=r=>{e.position=e.position.map((a,s)=>a+r[s]),t.modified()},t.getOrientationWXYZ=()=>{const r=tn();Ha(r,e.rotation);const a=new Float64Array(3),s=gp(a,r);return[wn(s),a[0],a[1],a[2]]},t.getOrientationQuaternion=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Ha(r,e.rotation)},t.rotateX=r=>{r!==0&&(Ss(e.rotation,e.rotation,oe(r)),t.modified())},t.rotateY=r=>{r!==0&&(Cs(e.rotation,e.rotation,oe(r)),t.modified())},t.rotateZ=r=>{r!==0&&(ws(e.rotation,e.rotation,oe(r)),t.modified())},t.rotateWXYZ=(r,a,s,i)=>{if(r===0||a===0&&s===0&&i===0)return;const o=oe(r),c=tn();Rs(c,[a,s,i],o);const u=new Float64Array(16);Kn(u,c),pe(e.rotation,e.rotation,u),t.modified()},t.rotateQuaternion=r=>{if(Math.abs(r[3])>=1-dv)return;const a=Kn(new Float64Array(16),r);pe(e.rotation,e.rotation,a),t.modified()},t.setOrientation=(r,a,s)=>r===e.orientation[0]&&a===e.orientation[1]&&s===e.orientation[2]?!1:(e.orientation=[r,a,s],Y(e.rotation),t.rotateZ(s),t.rotateX(r),t.rotateY(a),t.modified(),!0),t.setOrientationFromQuaternion=r=>{const a=oa();return Kn(a,r),Mn(a,e.rotation)?!1:(e.rotation=a,t.modified(),!0)},t.setUserMatrix=r=>Mn(e.userMatrix,r)?!1:(Oe(e.userMatrix,r),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){Y(e.matrix),e.userMatrix&&pe(e.matrix,e.matrix,e.userMatrix),le(e.matrix,e.matrix,e.origin),le(e.matrix,e.matrix,e.position),pe(e.matrix,e.matrix,e.rotation),en(e.matrix,e.matrix,e.scale),le(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),ne(e.matrix,e.matrix),e.isIdentity=!0;for(let r=0;r<4;++r)for(let a=0;a<4;++a)(r===a?1:0)!==e.matrix[r+a*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getBoundsByReference=()=>{if(e.mapper===null)return e.bounds;const r=e.mapper.getBounds();if(!r||r.length!==6)return r;if(r[0]>r[1])return e.mapperBounds=r,e.bounds=[...j.INIT_BOUNDS],e.boundsMTime.modified(),r;if(!e.mapperBounds||!r.every((a,s)=>r[s]===e.mapperBounds[s])||t.getMTime()>e.boundsMTime.getMTime()){E.vtkDebugMacro("Recomputing bounds..."),e.mapperBounds=r,t.computeMatrix();const a=new Float64Array(16);ne(a,e.matrix),j.transformBounds(r,a,e.bounds),e.boundsMTime.modified()}return e.bounds},t.getBounds=()=>{const r=t.getBoundsByReference();try{return[...r]}catch{return r}},t.getCenter=()=>j.getCenter(e.bounds),t.getLength=()=>j.getLength(e.bounds),t.getXRange=()=>j.getXRange(e.bounds),t.getYRange=()=>j.getYRange(e.bounds),t.getZRange=()=>j.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function n(){t.computeMatrix()}t.onModified(n),t.getProperty=function(){var a;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.properties[r]==null&&(e.properties[r]=(a=t.makeProperty)==null?void 0:a.call(t)),e.properties[r]},t.getProperties=()=>{var r;return e.properties.length===0&&(e.properties[0]=(r=t.makeProperty)==null?void 0:r.call(t)),e.properties},t.setProperty=(r,a)=>{const s=Number.isInteger(r),[i,o]=s?[r,a]:[0,r];return e.properties[i]===o?!1:(e.properties[i]=o,!0)},t.getMTime=()=>{let r=e.mtime;return e.properties.forEach(a=>{if(a!==null){const s=a.getMTime();r=s>r?s:r}}),r}}const Sv={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[...j.INIT_BOUNDS],properties:[],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function vu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Sv,n),cr.extend(t,e,n),e.matrixMTime={},E.obj(e.matrixMTime),E.get(t,e,["isIdentity"]),E.getArray(t,e,["orientation"]),E.setGetArray(t,e,["origin","position","scale"],3),E.setGet(t,e,["properties"]),e.matrix=Y(new Float64Array(16)),e.rotation=Y(new Float64Array(16)),e.userMatrix=Y(new Float64Array(16)),e.transform=null,xv(t,e)}const Cv=E.newInstance(vu,"vtkProp3D");var wv={newInstance:Cv,extend:vu};const Tu={FLAT:0,GOURAUD:1,PHONG:2},Xe={POINTS:0,WIREFRAME:1,SURFACE:2},Ev=Tu;var du={Shading:Tu,Representation:Xe,Interpolation:Ev};const{Representation:Wn,Interpolation:Hn}=du;function Ji(t){return()=>E.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function Mv(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(n,r,a)=>{Array.isArray(n)?(e.color[0]!==n[0]||e.color[1]!==n[1]||e.color[2]!==n[2])&&(e.color[0]=n[0],e.color[1]=n[1],e.color[2]=n[2],t.modified()):(e.color[0]!==n||e.color[1]!==r||e.color[2]!==a)&&(e.color[0]=n,e.color[1]=r,e.color[2]=a,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=Ji("ComputeCompositeColor"),t.getColor=()=>{let n=0;e.ambient+e.diffuse+e.specular>0&&(n=1/(e.ambient+e.diffuse+e.specular));for(let r=0;r<3;r++)e.color[r]=n*(e.ambient*e.ambientColor[r]+e.diffuse*e.diffuseColor[r]+e.specular*e.specularColor[r]);return[].concat(e.color)},t.setSpecularPower=n=>{const r=1/Math.max(1,n);(e.roughness!==r||e.specularPower!==n)&&(e.specularPower=n,e.roughness=r,t.modified())},t.addShaderVariable=Ji("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(Hn.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(Hn.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(Hn.PHONG),t.getInterpolationAsString=()=>E.enumToString(Hn,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(Wn.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(Wn.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(Wn.POINTS),t.getRepresentationAsString=()=>E.enumToString(Wn,e.representation)}const Rv={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:Hn.GOURAUD,representation:Wn.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null,ORMTexture:null,RMTexture:null};function Ov(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Rv,n),E.obj(t,e),E.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture","ORMTexture","RMTexture"]),E.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),Mv(t,e)}const Dv=E.newInstance(Ov,"vtkProperty");var Vn={newInstance:Dv,...du};function Lv(t,e){e.classHierarchy.push("vtkActor");const n={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.properties[0]||t.getProperty();let r=e.properties[0].getOpacity()>=1;return r=r&&(!e.texture||!e.texture.isTranslucent()),r=r&&(!e.mapper||e.mapper.getIsOpaque()),r},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.properties[0]||t.getProperty(),!t.getIsOpaque()),t.makeProperty=Vn.newInstance,t.getMTime=()=>{let r=n.getMTime();if(e.backfaceProperty!==null){const a=e.backfaceProperty.getMTime();r=a>r?a:r}return r},t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let a=e.mapper.getMTime();r=a>r?a:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),a=e.mapper.getInput().getMTime(),r=a>r?a:r)}return r},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(r,a)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(r,a)}}const Vv={mapper:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1};function xu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Vv,n),wv.extend(t,e,n),e.boundsMTime={},E.obj(e.boundsMTime),E.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),Lv(t,e)}const Bv=E.newInstance(xu,"vtkActor");var rn={newInstance:Bv,extend:xu};const Fv={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},xe={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},mv=xe.FLOAT;var Su={DefaultDataType:mv,DataTypeByteSize:Fv,VtkDataTypes:xe};const{vtkErrorMacro:kv}=ft,{DefaultDataType:Uv}=Su,Nv=1e-6;function cs(t,e,n){const r=t.length;let a=Number.MAX_VALUE,s=-Number.MAX_VALUE,i,o;for(o=e;o<r;o+=n)if(!Number.isNaN(t[o])){a=t[o],s=a;break}for(;o<r;o+=n)i=t[o],i<a?a=i:i>s&&(s=i);return{min:a,max:s}}function _v(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,n=0,r=0;return{add(a){t>a&&(t=a),e<a&&(e=a),n++,r+=a},get(){return{min:t,max:e,count:n,sum:r,mean:r/n}},getRange(){return{min:t,max:e}}}}function Cu(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&n>1){const a=t.length/n,s=new Float64Array(a);for(let i=0,o=0;i<a;++i){for(let c=o+n;o<c;++o)s[i]+=t[o]*t[o];s[i]**=.5}return cs(s,0,1)}return cs(t,e<0?0:e,n)}function eo(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=t||[];for(;n.length<=e;)n.push(null);return n}function ai(t){return Object.prototype.toString.call(t).slice(8,-1)}function Gv(t){const e=t.getNumberOfComponents();let n=0;const r=new Array(e);for(let a=0;a<t.getNumberOfTuples();++a){t.getTuple(a,r);const s=$e(r,e);s>n&&(n=s)}return n}const bv={computeRange:Cu,createRangeHelper:_v,fastComputeRange:cs,getDataType:ai,getMaxNorm:Gv};function $v(t,e){e.classHierarchy.push("vtkDataArray");function n(r){if(r<0)return!1;const a=t.getNumberOfComponents(),s=e.values.length/(a>0?a:1);if(r===s)return!0;if(r>s){const i=e.values;return e.values=Dn(e.dataType,(r+s)*a),e.values.set(i),!0}return e.size>r*a&&(e.size=r*a,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.allocate=r=>{n(t.getNumberOfTuples()+r)},t.resize=r=>{n(r);const a=r*t.getNumberOfComponents();return e.size!==a?(e.size=a,t.dataChange(),!0):!1},t.initialize=()=>(t.resize(0),t),t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[r*e.numberOfComponents+a]},t.setComponent=(r,a,s)=>{s!==e.values[r*e.numberOfComponents+a]&&(e.values[r*e.numberOfComponents+a]=s,t.dataChange())},t.getValue=r=>{const a=r/e.numberOfComponents,s=r%e.numberOfComponents;return t.getComponent(a,s)},t.setValue=(r,a)=>{const s=r/e.numberOfComponents,i=r%e.numberOfComponents;t.setComponent(s,i,a)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,a=r;a<0&&(a=e.numberOfComponents===1?0:e.numberOfComponents);let s=null;return e.ranges||(e.ranges=eo(e.ranges,e.numberOfComponents)),s=e.ranges[a],s?(e.rangeTuple[0]=s.min,e.rangeTuple[1]=s.max,e.rangeTuple):(s=Cu(t.getData(),r,e.numberOfComponents),e.ranges[a]=s,e.rangeTuple[0]=s.min,e.rangeTuple[1]=s.max,e.rangeTuple)},t.setRange=(r,a)=>{e.ranges||(e.ranges=eo(e.ranges,e.numberOfComponents));const s={min:r.min,max:r.max};return e.ranges[a]=s,e.rangeTuple[0]=s.min,e.rangeTuple[1]=s.max,e.rangeTuple},t.getRanges=function(){if(!(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0))return structuredClone(e.ranges);const a=[];for(let s=0;s<e.numberOfComponents;s++){const[i,o]=t.getRange(s),c={min:i,max:o};a.push(c)}if(e.numberOfComponents>1){const[s,i]=t.getRange(-1),o={min:s,max:i};a.push(o)}return a},t.setTuple=(r,a)=>{const s=r*e.numberOfComponents;for(let i=0;i<e.numberOfComponents;i++)e.values[s+i]=a[i]},t.setTuples=(r,a)=>{let s=r*e.numberOfComponents;const i=Math.min(a.length,e.size-s);for(let o=0;o<i;)e.values[s++]=a[o++]},t.insertTuple=(r,a)=>(e.size<=r*e.numberOfComponents&&(e.size=(r+1)*e.numberOfComponents,n(r+1)),t.setTuple(r,a),r),t.insertTuples=(r,a)=>{const s=r+a.length/e.numberOfComponents;return e.size<s*e.numberOfComponents&&(e.size=s*e.numberOfComponents,n(s)),t.setTuples(r,a),s},t.insertNextTuple=r=>{const a=e.size/e.numberOfComponents;return t.insertTuple(a,r)},t.insertNextTuples=r=>{const a=e.size/e.numberOfComponents;return t.insertTuples(a,r)},t.findTuple=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Nv;for(let s=0;s<e.size;s+=e.numberOfComponents)if(Math.abs(r[0]-e.values[s])<=a){let i=!0;for(let o=1;o<e.numberOfComponents;++o)if(Math.abs(r[o]-e.values[s+o])>a){i=!1;break}if(i)return s/e.numberOfComponents}return-1},t.getTuple=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const s=e.numberOfComponents||1,i=r*s;switch(s){case 4:a[3]=e.values[i+3];case 3:a[2]=e.values[i+2];case 2:a[1]=e.values[i+1];case 1:a[0]=e.values[i];break;default:for(let o=s-1;o>=0;--o)a[o]=e.values[i+o]}return a},t.getTuples=(r,a)=>{const s=(r??0)*e.numberOfComponents,i=(a??t.getNumberOfTuples())*e.numberOfComponents,o=t.getData().subarray(s,i);return o.length>0?o:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>Eu({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(r,a)=>{e.values=r,e.size=r.length,e.dataType=ai(r),a&&(e.numberOfComponents=a),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;const r={...e,vtkClass:t.getClassName()};r.values=Array.from(r.values),delete r.buffer,Object.keys(r).forEach(s=>{r[s]||delete r[s]});const a={};return Object.keys(r).sort().forEach(s=>{a[s]=r[s]}),a.mtime&&delete a.mtime,a},t.deepCopy=r=>{const a=t.getDataType(),s=e.values;t.shallowCopy(r),e.ranges=structuredClone(r.getRanges()),(s==null?void 0:s.length)>=r.getNumberOfValues()&&a===r.getDataType()?(s.set(r.getData()),e.values=s,t.dataChange()):t.setData(r.getData().slice())},t.interpolateTuple=(r,a,s,i,o,c)=>{const u=e.numberOfComponents||1;(u!==a.getNumberOfComponents()||u!==i.getNumberOfComponents())&&kv("numberOfComponents must match");const g=a.getTuple(s),f=i.getTuple(o),l=[];switch(l.length=u,u){case 4:l[3]=g[3]+(f[3]-g[3])*c;case 3:l[2]=g[2]+(f[2]-g[2])*c;case 2:l[1]=g[1]+(f[1]-g[1])*c;case 1:l[0]=g[0]+(f[0]-g[0])*c;break;default:for(let h=0;h<u;h++)l[h]=g[h]+(f[h]-g[h])*c}return t.insertTuple(r,l)}}const zv={name:"",numberOfComponents:1,dataType:Uv,rangeTuple:[0,0]};function wu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,zv,n),Array.isArray(n.values)&&n.dataType===void 0&&console.warn("vtkDataArray.newInstance: no dataType provided, converting to Float32Array"),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=Os(e.dataType,e.values)):e.values=Dn(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=ai(e.values)),Me(t,e),nr(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");$v(t,e)}const Eu=re(wu,"vtkDataArray");var ee={newInstance:Eu,extend:wu,...bv,...Su};function Wv(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=n=>n.isA("vtkPlane")?e.clippingPlanes.includes(n)?!1:(e.clippingPlanes.push(n),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=n=>{const r=e.clippingPlanes.indexOf(n);return r===-1?!1:(e.clippingPlanes.splice(r,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=n=>{if(n)if(!Array.isArray(n))t.addClippingPlane(n);else{const r=n.length;for(let a=0;a<r&&a<6;a++)t.addClippingPlane(n[a])}},t.getClippingPlaneInDataCoords=(n,r,a)=>{const s=e.clippingPlanes,i=n;if(s){const o=s.length;if(r>=0&&r<o){const c=s[r],u=c.getNormal(),g=c.getOrigin(),f=u[0],l=u[1],h=u[2],v=-(f*g[0]+l*g[1]+h*g[2]);a[0]=f*i[0]+l*i[4]+h*i[8]+v*i[12],a[1]=f*i[1]+l*i[5]+h*i[9]+v*i[13],a[2]=f*i[2]+l*i[6]+h*i[10]+v*i[14],a[3]=f*i[3]+l*i[7]+h*i[11]+v*i[15];return}}E.vtkErrorMacro(`Clipping plane index ${r} is out of range.`)}}const Hv={clippingPlanes:[]};function Av(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Hv,n),E.obj(t,e),E.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),Wv(t,e)}var jv={extend:Av};function Kv(t,e){t.getBounds=()=>(E.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),la()),t.getCenter=()=>{var r;const n=t.getBounds();return e.center=j.isValid(n)?j.getCenter(n):null,(r=e.center)==null?void 0:r.slice()},t.getLength=()=>{const n=t.getBounds();return j.getDiagonalLength(n)}}const Pv=t=>({bounds:[...j.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function Xv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Pv(n)),jv.extend(t,e,n),E.setGet(t,e,["viewSpecificProperties"]),Kv(t,e)}var Iv={extend:Xv};const{vtkErrorMacro:to,vtkWarningMacro:Yv}=E;function Qv(t,e){e.classHierarchy.push("vtkFieldData");const n=t.getState;e.arrays&&(e.arrays=e.arrays.map(r=>({data:et(r.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=r=>{t.initializeFields(),e.copyFieldFlags=r.getCopyFieldFlags().map(a=>a),e.arrays=r.getArrays().map(a=>({data:a}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=r=>{const a=r.getName(),{array:s,index:i}=t.getArrayWithIndex(a);return s!=null?(e.arrays[i]={data:r},i):(e.arrays=[].concat(e.arrays,{data:r}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=r=>{const a=e.arrays.findIndex(s=>s.data.getName()===r);return t.removeArrayByIndex(a)},t.removeArrayByIndex=r=>r!==-1&&r<e.arrays.length?(e.arrays.splice(r,1),!0):!1,t.getArrays=()=>e.arrays.map(r=>r.data),t.getArray=r=>typeof r=="number"?t.getArrayByIndex(r):t.getArrayByName(r),t.getArrayByName=r=>e.arrays.reduce((a,s,i)=>s.data.getName()===r?s.data:a,null),t.getArrayWithIndex=r=>{const a=e.arrays.findIndex(s=>s.data.getName()===r);return{array:a!==-1?e.arrays[a].data:null,index:a}},t.getArrayByIndex=r=>r>=0&&r<e.arrays.length?e.arrays[r].data:null,t.hasArray=r=>t.getArrayWithIndex(r).index>=0,t.getArrayName=r=>{const a=e.arrays[r];return a?a.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=r=>e.copyFieldFlags[r],t.passData=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;r.getArrays().forEach(i=>{const o=t.getFlag(i.getName());if(o!==!1&&!(e.doCopyAllOff&&o!==!0)&&i){let c=t.getArrayByName(i.getName());if(c)if(i.getNumberOfComponents()===c.getNumberOfComponents())if(a>-1&&a<i.getNumberOfTuples()){const u=s>-1?s:a;c.insertTuple(u,i.getTuple(a))}else c.insertTuples(0,i.getTuples());else to("Unhandled case in passData");else if(a<0||a>i.getNumberOfTuples())t.addArray(i),r.getAttributes(i).forEach(u=>{t.setAttribute(i,u)});else{const u=i.getNumberOfComponents();let g=i.getNumberOfValues();const f=s>-1?s:a;g<=f*u&&(g=(f+1)*u),c=ee.newInstance({name:i.getName(),dataType:i.getDataType(),numberOfComponents:u,values:E.newTypedArray(i.getDataType(),g),size:0}),c.insertTuple(f,i.getTuple(a)),t.addArray(c),r.getAttributes(i).forEach(l=>{t.setAttribute(c,l)})}}})},t.interpolateData=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;r.getArrays().forEach(c=>{const u=t.getFlag(c.getName());if(u!==!1&&!(e.doCopyAllOff&&u!==!0)&&c){let g=t.getArrayByName(c.getName());if(g)if(c.getNumberOfComponents()===g.getNumberOfComponents())if(a>-1&&a<c.getNumberOfTuples()){const f=i>-1?i:a;g.interpolateTuple(f,c,a,c,s,o),Yv("Unexpected case in interpolateData")}else g.insertTuples(c.getTuples());else to("Unhandled case in interpolateData");else if(a<0||s<0||a>c.getNumberOfTuples())t.addArray(c),r.getAttributes(c).forEach(f=>{t.setAttribute(c,f)});else{const f=c.getNumberOfComponents();let l=c.getNumberOfValues();const h=i>-1?i:a;l<=h*f&&(l=(h+1)*f),g=ee.newInstance({name:c.getName(),dataType:c.getDataType(),numberOfComponents:f,values:E.newTypedArray(c.getDataType(),l),size:0}),g.interpolateTuple(h,c,a,c,s,o),t.addArray(g),r.getAttributes(c).forEach(v=>{t.setAttribute(g,v)})}}})},t.copyFieldOn=r=>{e.copyFieldFlags[r]=!0},t.copyFieldOff=r=>{e.copyFieldFlags[r]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=r=>{e.arrays=r.getArrays().map(a=>{const s=a.newClone();return s.deepCopy(a),{data:s}})},t.copyFlags=r=>r.getCopyFieldFlags().map(a=>a),t.reset=()=>e.arrays.forEach(r=>r.data.reset()),t.getMTime=()=>e.arrays.reduce((r,a)=>a.data.getMTime()>r?a.data.getMTime():r,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((r,a)=>r+a.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{const r=n();return r&&(r.arrays=e.arrays.map(a=>({data:a.data.getState()}))),r}}const Zv={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function Mu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Zv,n),E.obj(t,e),Qv(t,e)}const qv=E.newInstance(Mu,"vtkFieldData");var Jv={newInstance:qv,extend:Mu};const eT={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},tT={MAX:0,EXACT:1,NOLIMIT:2},nT={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},rT={DUPLICATEPOINT:1,HIDDENPOINT:2},aT={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},sT="vtkGhostType",iT={DEFAULT:0,SINGLE:1,DOUBLE:2};var Ru={AttributeCopyOperations:aT,AttributeLimitTypes:tT,AttributeTypes:eT,CellGhostTypes:nT,DesiredOutputPrecision:iT,PointGhostTypes:rT,ghostArrayName:sT};const{AttributeTypes:Et,AttributeCopyOperations:bt}=Ru,{vtkWarningMacro:vr}=E;function oT(t,e){const n=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function r(i){let o=n.find(c=>Et[c.toUpperCase()]===i||typeof i!="number"&&c.toLowerCase()===i.toLowerCase());return typeof o>"u"&&(o=null),o}e.classHierarchy.push("vtkDataSetAttributes");const a={...t};t.checkNumberOfComponents=i=>!0,t.setAttribute=(i,o)=>{const c=r(o);if(i&&c.toUpperCase()==="PEDIGREEIDS"&&!i.isA("vtkDataArray"))return vr(`Cannot set attribute ${c}. The attribute must be a vtkDataArray.`),-1;if(i&&!t.checkNumberOfComponents(i,c))return vr(`Cannot set attribute ${c}. Incorrect number of components.`),-1;let u=e[`active${c}`];if(u>=0&&u<e.arrays.length){if(e.arrays[u]===i)return u;t.removeArrayByIndex(u)}return i?(u=t.addArray(i),e[`active${c}`]=u):e[`active${c}`]=-1,t.modified(),e[`active${c}`]},t.getAttributes=i=>n.filter(o=>t[`get${o}`]()===i),t.setActiveAttributeByName=(i,o)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(i).index,o),t.setActiveAttributeByIndex=(i,o)=>{const c=r(o);if(i>=0&&i<e.arrays.length){if(c.toUpperCase()!=="PEDIGREEIDS"){const u=t.getArrayByIndex(i);if(!u.isA("vtkDataArray"))return vr(`Cannot set attribute ${c}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(u,c))return vr(`Cannot set attribute ${c}. Incorrect number of components.`),-1}return e[`active${c}`]=i,t.modified(),i}return i===-1&&(e[`active${c}`]=i,t.modified()),-1},t.getActiveAttribute=i=>{const o=r(i);return t[`get${o}`]()},t.removeAllArrays=()=>{n.forEach(i=>{e[`active${i}`]=-1}),a.removeAllArrays()},t.removeArrayByIndex=i=>(i!==-1&&n.forEach(o=>{i===e[`active${o}`]?e[`active${o}`]=-1:i<e[`active${o}`]&&(e[`active${o}`]-=1)}),a.removeArrayByIndex(i)),n.forEach(i=>{const o=`active${i}`;t[`get${i}`]=()=>t.getArrayByIndex(e[o]),t[`set${i}`]=c=>t.setAttribute(c,i),t[`setActive${i}`]=c=>t.setActiveAttributeByIndex(t.getArrayWithIndex(c).index,i),t[`copy${i}Off`]=()=>{const c=i.toUpperCase();e.copyAttributeFlags[bt.PASSDATA][Et[c]]=!1},t[`copy${i}On`]=()=>{const c=i.toUpperCase();e.copyAttributeFlags[bt.PASSDATA][Et[c]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys(bt).filter(i=>i!=="ALLCOPY").forEach(i=>{e.copyAttributeFlags[bt[i]]=Object.keys(Et).filter(o=>o!=="NUM_ATTRIBUTES").reduce((o,c)=>(o[Et[c]]=!0,o),[])}),e.copyAttributeFlags[bt.COPYTUPLE][Et.GLOBALIDS]=!1,e.copyAttributeFlags[bt.INTERPOLATE][Et.GLOBALIDS]=!1,e.copyAttributeFlags[bt.COPYTUPLE][Et.PEDIGREEIDS]=!1},t.initialize=E.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(i=>{!e.dataArrays[i].ref&&e.dataArrays[i].type==="vtkDataArray"&&t.addArray(ee.newInstance(e.dataArrays[i]))});const s=t.shallowCopy;t.shallowCopy=(i,o)=>{s(i,o),e.arrays=i.getArrays().map(c=>{const u=c.newClone();return u.shallowCopy(c,o),{data:u}})},t.initializeAttributeCopyFlags()}const cT={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function Ou(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cT,n),Jv.extend(t,e,n),E.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),oT(t,e)}const fT=E.newInstance(Ou,"vtkDataSetAttributes");var no={newInstance:fT,extend:Ou,...Ru};const uT={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},gT={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var lT={FieldDataTypes:uT,FieldAssociations:gT};const An=["pointData","cellData","fieldData"];function pT(t,e){e.classHierarchy.push("vtkDataSet"),An.forEach(a=>{e[a]?e[a]=et(e[a]):e[a]=no.newInstance()}),t.computeBounds=()=>{if(e.modifiedTime&&e.computeTime&&e.modifiedTime>e.computeTime||!e.computeTime){const a=t.getPoints();a!=null&&a.getNumberOfPoints()?j.setBounds(e.bounds,a.getBoundsByReference()):e.bounds=Zi.createUninitializedBounds(),e.computeTime=E.getCurrentGlobalMTime()}},t.getLength2=()=>{const a=t.getBoundsByReference();return!a||a.length!==6?0:j.getDiagonalLength2(a)},t.getLength=()=>Math.sqrt(t.getLength2()),t.getCenter=()=>{const a=t.getBoundsByReference();return!a||a.length!==6?[0,0,0]:j.getCenter(a)},t.getCellBounds=a=>{const s=t.getCell(a);return s?s.getBounds():Zi.createUninitializedBounds()},t.getBounds=E.chain(()=>t.computeBounds,t.getBounds),t.getBoundsByReference=E.chain(()=>t.computeBounds,t.getBoundsByReference);const n=t.shallowCopy;t.shallowCopy=function(a){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(a,s),An.forEach(i=>{e[i]=no.newInstance(),e[i].shallowCopy(a.getReferenceByName(i))})};const r=t.getMTime;t.getMTime=()=>An.reduce((a,s)=>{var i;return Math.max(a,((i=e[s])==null?void 0:i.getMTime())??a)},r()),t.initialize=()=>(An.forEach(a=>{var s;return(s=e[a])==null?void 0:s.initialize()}),t)}const hT={};function Du(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hT,n),E.obj(t,e),E.setGet(t,e,An),E.getArray(t,e,["bounds"],6),pT(t,e)}const yT=E.newInstance(Du,"vtkDataSet");var cn={newInstance:yT,extend:Du,...lT};const je={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var Lu={StructuredType:je};const{StructuredType:gt}=Lu;function vT(t){let e=0;for(let n=0;n<3;++n)t[n*2]<t[n*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?gt.EMPTY:e===3?gt.XYZ_GRID:e===2?t[0]===t[1]?gt.YZ_PLANE:t[2]===t[3]?gt.XZ_PLANE:gt.XY_PLANE:e===1?t[0]<t[1]?gt.X_LINE:t[2]<t[3]?gt.Y_LINE:gt.Z_LINE:gt.SINGLE_POINT}var TT={getDataDescriptionFromExtent:vT,...Lu};const{vtkErrorMacro:$t}=E;function dT(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return $t("instance deleted - cannot call any method"),!1;for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];const i=a.length===1?a[0]:a;if(i.length!==6)return!1;const o=e.extent.some((c,u)=>c!==i[u]);return o&&(e.extent=i.slice(),e.dataDescription=TT.getDataDescriptionFromExtent(e.extent),t.modified()),o},t.setDimensions=function(){let r,a,s;if(e.deleted){$t("instance deleted - cannot call any method");return}if(arguments.length===1){const i=arguments.length<=0?void 0:arguments[0];r=i[0],a=i[1],s=i[2]}else if(arguments.length===3)r=arguments.length<=0?void 0:arguments[0],a=arguments.length<=1?void 0:arguments[1],s=arguments.length<=2?void 0:arguments[2];else{$t("Bad dimension specification");return}t.setExtent(0,r-1,0,a-1,0,s-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{const r=t.getDimensions();let a=1;for(let s=0;s<3;s++){if(r[s]===0)return 0;r[s]>1&&(a*=r[s]-1)}return a},t.getNumberOfPoints=()=>{const r=t.getDimensions();return r[0]*r[1]*r[2]},t.getPoint=r=>{const a=t.getDimensions();if(a[0]===0||a[1]===0||a[2]===0)return $t("Requesting a point from an empty image."),null;const s=new Float64Array(3);switch(e.dataDescription){case je.EMPTY:return null;case je.SINGLE_POINT:break;case je.X_LINE:s[0]=r;break;case je.Y_LINE:s[1]=r;break;case je.Z_LINE:s[2]=r;break;case je.XY_PLANE:s[0]=r%a[0],s[1]=r/a[0];break;case je.YZ_PLANE:s[1]=r%a[1],s[2]=r/a[1];break;case je.XZ_PLANE:s[0]=r%a[0],s[2]=r/a[0];break;case je.XYZ_GRID:s[0]=r%a[0],s[1]=r/a[0]%a[1],s[2]=r/(a[0]*a[1]);break;default:$t("Invalid dataDescription");break}const i=[0,0,0];return t.indexToWorld(s,i),i},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=r=>j.transformBounds(r,e.indexToWorld),t.getSpatialExtent=()=>j.inflate([...e.extent],.5),t.computeTransforms=()=>{ic(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],en(e.indexToWorld,e.indexToWorld,e.spacing),Ve(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return q(a,r,e.indexToWorld),a},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return q(a,r,e.worldToIndex),a},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return j.transformBounds(r,e.indexToWorld,a)},t.worldToIndexBounds=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return j.transformBounds(r,e.worldToIndex,a)},e._onOriginChanged=t.computeTransforms,e._onDirectionChanged=t.computeTransforms,e._onSpacingChanged=t.computeTransforms,t.computeTransforms(),t.getCenter=()=>j.getCenter(t.getBounds()),t.computeHistogram=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const s=[0,0,0,0,0,0];t.worldToIndexBounds(r,s);const i=[0,0,0],o=[0,0,0];j.computeCornerPoints(s,i,o),ns(i,i),ns(o,o);const c=t.getDimensions();as(i,[0,0,0],[c[0]-1,c[1]-1,c[2]-1],i),as(o,[0,0,0],[c[0]-1,c[1]-1,c[2]-1],o);const u=c[0],g=c[0]*c[1],f=t.getPointData().getScalars().getData();let l=-1/0,h=1/0,v=0,p=0,y=0;for(let x=i[2];x<=o[2];x++)for(let w=i[1];w<=o[1];w++){let C=i[0]+w*u+x*g;for(let M=i[0];M<=o[0];M++){if(!a||a([M,w,x],s)){const R=f[C];R>l&&(l=R),R<h&&(h=R),v+=R*R,p+=R,y+=1}++C}}const T=y>0?p/y:0,S=y?Math.abs(v/y-T*T):0,d=Math.sqrt(S);return{minimum:h,maximum:l,average:T,variance:S,sigma:d,count:y}},t.computeIncrements=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const s=[];let i=a;for(let o=0;o<3;++o)s[o]=i,i*=r[o*2+1]-r[o*2]+1;return s},t.computeOffsetIndex=r=>{let[a,s,i]=r;const o=t.getExtent(),c=t.getPointData().getScalars().getNumberOfComponents(),u=t.computeIncrements(o,c);return Math.floor((Math.round(a)-o[0])*u[0]+(Math.round(s)-o[2])*u[1]+(Math.round(i)-o[4])*u[2])},t.getOffsetIndexFromWorld=r=>{const a=t.getExtent(),s=t.worldToIndex(r);for(let i=0;i<3;++i)if(s[i]<a[i*2]||s[i]>a[i*2+1])return $t(`GetScalarPointer: Pixel ${s} is not in memory. Current extent = ${a}`),NaN;return t.computeOffsetIndex(s)},t.getScalarValueFromWorld=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const s=t.getPointData().getScalars().getNumberOfComponents();if(a<0||a>=s)return $t(`GetScalarPointer: Scalar Component ${a} is not within bounds. Current Scalar numberOfComponents: ${s}`),NaN;const i=t.getOffsetIndexFromWorld(r);return Number.isNaN(i)?i:t.getPointData().getScalars().getComponent(i,a)};const n=t.initialize;t.initialize=()=>(t.set({direction:Nt(e.direction),spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:je.EMPTY}),n())}const xT={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:je.EMPTY};function Vu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xT,n),cn.extend(t,e,n),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=Nt(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),E.get(t,e,["indexToWorld","worldToIndex"]),E.setGetArray(t,e,["origin","spacing"],3),E.setGetArray(t,e,["direction"],9),E.getArray(t,e,["extent"],6),dT(t,e)}const ST=E.newInstance(Vu,"vtkImageData");var CT={newInstance:ST,extend:Vu};const wT={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},fs={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4},ET={LINEAR:0,LOG10:1};var si={VectorMode:wT,ScalarMappingTarget:fs,Scale:ET};const MT={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},RT={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},OT={BY_ID:0,BY_NAME:1};var ii={ColorMode:MT,GetArray:OT,ScalarMode:RT};const{ScalarMappingTarget:ro,Scale:DT,VectorMode:rt}=si,{VtkDataTypes:Mt}=ee,{ColorMode:Tr}=ii,{vtkErrorMacro:ao}=E;function LT(t){return t}function so(t){return Math.floor(t*255+.5)}function VT(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(rt.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(rt.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(rt.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(n,r)=>{if(!(n&&!r||!n&&r)){if(n&&r&&n.length!==r.length){ao("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],r&&n){const a=r.length;for(let s=0;s<a;s++)e.annotationArray.push({value:n[s],annotation:String(r[s])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(n,r)=>{let a=t.checkForAnnotatedValue(n),s=!1;return a>=0?e.annotationArray[a].annotation!==r&&(e.annotationArray[a].annotation=r,s=!0):(e.annotationArray.push({value:n,annotation:r}),a=e.annotationArray.length-1,s=!0),s&&(t.updateAnnotatedValueMap(),t.modified()),a},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=n=>n<0||n>=e.annotationArray.length?null:e.annotationArray[n].value,t.getAnnotation=n=>e.annotationArray[n]===void 0?null:e.annotationArray[n].annotation,t.getAnnotatedValueIndex=n=>e.annotationArray.length?t.checkForAnnotatedValue(n):-1,t.removeAnnotation=n=>{const r=t.checkForAnnotatedValue(n),a=r>=0;return a&&(e.annotationArray.splice(r,1),t.updateAnnotatedValueMap(),t.modified()),a},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(n,r)=>{if(e.indexedLookup){const a=t.getAnnotatedValueIndex(n);t.getIndexedColor(a,r)}else t.getColor(parseFloat(n),r),r[3]=1},t.checkForAnnotatedValue=n=>t.getAnnotatedValueIndexInternal(n),t.getAnnotatedValueIndexInternal=n=>{if(e.annotatedValueMap[n]!==void 0){const r=e.annotationArray.length;return e.annotatedValueMap[n]%r}return-1},t.getIndexedColor=(n,r)=>{r[0]=0,r[1]=0,r[2]=0,r[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];const n=e.annotationArray.length;for(let r=0;r<n;r++)e.annotatedValueMap[e.annotationArray[r].value]=r},t.mapScalars=(n,r,a)=>{const s=n.getNumberOfComponents();let i=null;if(r===Tr.DEFAULT&&(n.getDataType()===Mt.UNSIGNED_CHAR||n.getDataType()===Mt.UNSIGNED_CHAR_CLAMPED)||r===Tr.DIRECT_SCALARS&&n)i=t.convertToRGBA(n,s,n.getNumberOfTuples());else{const o={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:Mt.UNSIGNED_CHAR},c=E.newTypedArray(o.dataType,4*n.getNumberOfTuples());o.values=c,o.size=c.length,i=ee.newInstance(o);let u=a;u<0&&s>1?t.mapVectorsThroughTable(n,i,ro.RGBA,-1,-1):(u<0&&(u=0),u>=s&&(u=s-1),t.mapScalarsThroughTable(n,i,ro.RGBA,u))}return i},t.mapVectorsToMagnitude=(n,r,a)=>{const s=n.getNumberOfTuples(),i=n.getNumberOfComponents(),o=r.getData(),c=n.getData();for(let u=0;u<s;u++){let g=0;for(let f=0;f<a;f++)g+=c[u*i+f]*c[u*i+f];o[u]=Math.sqrt(g)}},t.mapVectorsThroughTable=(n,r,a,s,i)=>{let o=t.getVectorMode(),c=i,u=s;const g=n.getNumberOfComponents();o===rt.COMPONENT?(u===-1&&(u=t.getVectorComponent()),u<0&&(u=0),u>=g&&(u=g-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(u=0,c=g):(u<0&&(u=0),u>=g&&(u=g-1),u+c>g&&(c=g-u)),o===rt.MAGNITUDE&&(g===1||c===1)&&(o=rt.COMPONENT));let f=0;switch(u>0&&(f=u),o){case rt.COMPONENT:{t.mapScalarsThroughTable(n,r,a,f);break}case rt.RGBCOLORS:break;case rt.MAGNITUDE:default:{const l=ee.newInstance({numberOfComponents:1,values:new Float32Array(n.getNumberOfTuples())});t.mapVectorsToMagnitude(n,l,c),t.mapScalarsThroughTable(l,r,a,0);break}}},t.luminanceToRGBA=(n,r,a,s)=>{const i=s(a),o=r.getData(),c=n.getData(),u=o.length,g=0,f=1;let l=0;for(let h=g;h<u;h+=f){const v=s(o[h]);c[l*4]=v,c[l*4+1]=v,c[l*4+2]=v,c[l*4+3]=i,l++}},t.luminanceAlphaToRGBA=(n,r,a,s)=>{const i=r.getData(),o=n.getData(),c=i.length,u=0,g=2;let f=0;for(let l=u;l<c;l+=g){const h=s(i[l]);o[f]=h,o[f+1]=h,o[f+2]=h,o[f+3]=s(i[l+1])*a,f+=4}},t.rGBToRGBA=(n,r,a,s)=>{const i=so(a),o=r.getData(),c=n.getData(),u=o.length,g=0,f=3;let l=0;for(let h=g;h<u;h+=f)c[l*4]=s(o[h]),c[l*4+1]=s(o[h+1]),c[l*4+2]=s(o[h+2]),c[l*4+3]=i,l++},t.rGBAToRGBA=(n,r,a,s)=>{const i=r.getData(),o=n.getData(),c=i.length,u=0,g=4;let f=0;for(let l=u;l<c;l+=g)o[f*4]=s(i[l]),o[f*4+1]=s(i[l+1]),o[f*4+2]=s(i[l+2]),o[f*4+3]=s(i[l+3])*a,f++},t.convertToRGBA=(n,r,a)=>{let{alpha:s}=e;if(r===4&&s>=1&&n.getDataType()===Mt.UNSIGNED_CHAR)return n;const i=ee.newInstance({numberOfComponents:4,empty:!0,size:4*a,dataType:Mt.UNSIGNED_CHAR});if(a<=0)return i;s=s>0?s:0,s=s<1?s:1;let o=LT;switch((n.getDataType()===Mt.FLOAT||n.getDataType()===Mt.DOUBLE)&&(o=so),r){case 1:t.luminanceToRGBA(i,n,s,o);break;case 2:t.luminanceAlphaToRGBA(i,n,o);break;case 3:t.rGBToRGBA(i,n,s,o);break;case 4:t.rGBAToRGBA(i,n,s,o);break;default:return ao("Cannot convert colors"),null}return i},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(n,r)=>t.setMappingRange(n,r),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(n,r,a)=>{if(!n)return t.isOpaque();const s=n.getNumberOfComponents();return r===Tr.DEFAULT&&n.getDataType()===Mt.UNSIGNED_CHAR||r===Tr.DIRECT_SCALARS?s===3||s===1?e.alpha>=1:n.getRange(s-1)[0]===255:!0}}const BT={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:rt.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1,scale:DT.LINEAR};function Bu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BT,n),E.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],E.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),E.setArray(t,e,["mappingRange"],2),E.getArray(t,e,["mappingRange"]),VT(t,e)}const FT=E.newInstance(Bu,"vtkScalarsToColors");var Fu={newInstance:FT,extend:Bu,...si};const{vtkErrorMacro:io}=E,oo=0,co=1,Oa=2;function mT(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let n=!0;e.nanColor[3]<1&&(n=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(n=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(n=0);for(let r=3;r<e.table.length&&n;r+=4)e.table[r]<255&&(n=!1);e.opaqueFlag=n,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4-3,t.linearIndexLookup=(n,r)=>{let a=0;const s=Number(n);return s<r.range[0]?a=r.maxIndex+oo+1.5:s>r.range[1]?a=r.maxIndex+co+1.5:(a=(s+r.shift)*r.scale,a=a<r.maxIndex?a:r.maxIndex),Math.floor(a)},t.linearLookup=(n,r,a)=>{let s=0;Nf(n)?s=Math.floor(a.maxIndex+1.5+Oa):s=t.linearIndexLookup(n,a);const i=4*s;return r.slice(i,i+4)},t.indexedLookupFunction=(n,r,a)=>{let s=t.getAnnotatedValueIndexInternal(n);s===-1&&(s=e.numberOfColors+Oa);const i=4*s;return[r[i],r[i+1],r[i+2],r[i+3]]},t.lookupShiftAndScale=(n,r)=>{r.shift=-n[0],r.scale=Number.MAX_VALUE,n[1]>n[0]&&(r.scale=(r.maxIndex+1)/(n[1]-n[0]))},t.mapScalarsThroughTable=(n,r,a,s)=>{let i=t.linearLookup;e.indexedLookup&&(i=t.indexedLookupFunction);const o=t.getMappingRange(),c={maxIndex:t.getNumberOfColors()-1,range:o,shift:0,scale:0};t.lookupShiftAndScale(o,c);const u=t.getAlpha(),g=n.getNumberOfTuples(),f=n.getNumberOfComponents(),l=r.getData(),h=n.getData();if(u>=1){if(a===fs.RGBA)for(let v=0;v<g;v++){const p=i(h[v*f+s],e.table,c);l[v*4]=p[0],l[v*4+1]=p[1],l[v*4+2]=p[2],l[v*4+3]=p[3]}}else if(a===fs.RGBA)for(let v=0;v<g;v++){const p=i(h[v*f+s],e.table,c);l[v*4]=p[0],l[v*4+1]=p[1],l[v*4+2]=p[2],l[v*4+3]=Math.floor(p[3]*u+.5)}},t.forceBuild=()=>{let n=0,r=0,a=0,s=0;const i=e.numberOfColors-1;i&&(n=(e.hueRange[1]-e.hueRange[0])/i,r=(e.saturationRange[1]-e.saturationRange[0])/i,a=(e.valueRange[1]-e.valueRange[0])/i,s=(e.alphaRange[1]-e.alphaRange[0])/i),e.table.length=4*i+16;const o=[],c=[];for(let u=0;u<=i;u++)o[0]=e.hueRange[0]+u*n,o[1]=e.saturationRange[0]+u*r,o[2]=e.valueRange[0]+u*a,Bf(o,c),c[3]=e.alphaRange[0]+u*s,e.table[u*4]=c[0]*255+.5,e.table[u*4+1]=c[1]*255+.5,e.table[u*4+2]=c[2]*255+.5,e.table[u*4+3]=c[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=n=>{if(Array.isArray(n)){const a=n[0].length;e.numberOfColors=n.length;const s=4-a;let i=0;for(let o=0;o<e.numberOfColors;o++)e.table[o*4]=255,e.table[o*4+1]=255,e.table[o*4+2]=255,e.table[o*4+3]=255;for(let o=0;o<n.length;o++){const c=n[o];for(let u=0;u<a;u++)e.table[i++]=c[u];i+=s}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(n.getNumberOfComponents()!==4)return io("Expected 4 components for RGBA colors"),!1;if(n.getDataType()!==xe.UNSIGNED_CHAR)return io("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=n.getNumberOfTuples();const r=n.getData();e.table.length=r.length;for(let a=0;a<r.length;a++)e.table[a]=r[a];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{const{numberOfColors:n}=e,r=e.table;let a=(n+oo)*4;e.useBelowRangeColor||n===0?(r[a]=e.belowRangeColor[0]*255+.5,r[a+1]=e.belowRangeColor[1]*255+.5,r[a+2]=e.belowRangeColor[2]*255+.5,r[a+3]=e.belowRangeColor[3]*255+.5):(r[a]=r[0],r[a+1]=r[1],r[a+2]=r[2],r[a+3]=r[3]),a=(n+co)*4,e.useAboveRangeColor||n===0?(r[a]=e.aboveRangeColor[0]*255+.5,r[a+1]=e.aboveRangeColor[1]*255+.5,r[a+2]=e.aboveRangeColor[2]*255+.5,r[a+3]=e.aboveRangeColor[3]*255+.5):(r[a]=r[4*(n-1)+0],r[a+1]=r[4*(n-1)+1],r[a+2]=r[4*(n-1)+2],r[a+3]=r[4*(n-1)+3]),a=(n+Oa)*4,r[a]=e.nanColor[0]*255+.5,r[a+1]=e.nanColor[1]*255+.5,r[a+2]=e.nanColor[2]*255+.5,r[a+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}const kT={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function mu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kT,n),Fu.extend(t,e,n),e.table||(e.table=[]),e.buildTime={},E.obj(e.buildTime),e.opaqueFlagBuildTime={},E.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},E.obj(e.insertTime,{mtime:0}),E.get(t,e,["buildTime"]),E.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),E.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),E.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),E.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),mT(t,e)}const UT=E.newInstance(mu,"vtkLookupTable");var NT={newInstance:UT,extend:mu};const _t={Off:0,PolygonOffset:1};let us=_t.PolygonOffset,ra=_t.Off;const _T=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function GT(){return us}function bT(t){const e=us===t;return us=t,e}function $T(){return ra}function va(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const e=ra===t;return ra=t,e}function zT(){return va(_t.Off)}function WT(){return va(_t.Off)}function HT(){return va(_t.PolygonOffset)}function AT(){return _T[ra]}var gs={Resolve:_t,getResolveCoincidentTopologyAsString:AT,getResolveCoincidentTopologyPolygonOffsetFaces:GT,getResolveCoincidentTopology:$T,setResolveCoincidentTopology:va,setResolveCoincidentTopologyPolygonOffsetFaces:bT,setResolveCoincidentTopologyToDefault:zT,setResolveCoincidentTopologyToOff:WT,setResolveCoincidentTopologyToPolygonOffset:HT};function ku(t,e,n){n.forEach(r=>{t[`get${r.method}`]=()=>e[r.key],t[`set${r.method}`]=E.objectSetterMap.object(t,e,{name:r.key,params:["factor","offset"]})})}const oi=["Polygon","Line","Point"],jT={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},KT=()=>{},Yt={modified:KT};ku(Yt,jT,oi.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function PT(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),E.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(gs).forEach(n=>{t[n]=gs[n]}),Object.keys(Yt).filter(n=>n!=="modified").forEach(n=>{t[n]=Yt[n]}),ku(t,e.topologyOffset,oi.map(n=>({key:n,method:`RelativeCoincidentTopology${n}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{const n=Yt.getResolveCoincidentTopologyPolygonOffsetParameters(),r=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{const n=Yt.getResolveCoincidentTopologyLineOffsetParameters(),r=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{const n=Yt.getResolveCoincidentTopologyPointOffsetParameters(),r=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}}}var Uu={implementCoincidentTopologyMethods:PT,staticOffsetAPI:Yt,otherStaticMethods:gs,CATEGORIES:oi,Resolve:_t};const ke={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3};var Nu={PassTypes:ke};const{FieldAssociations:fo}=cn,{staticOffsetAPI:XT,otherStaticMethods:IT}=Uu,{ColorMode:dr,ScalarMode:zt,GetArray:Da}=ii,{VectorMode:YT}=si,{VtkDataTypes:QT}=ee;function mn(t){return()=>E.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function ZT(t,e){const n=t[1]%2===0?1:-1;if(t[0]+=n,t[0]>=e[0]||t[0]<0){const r=t[2]%2===0?1:-1;t[0]-=n,t[1]+=r,(t[1]>=e[1]||t[1]<0)&&(t[1]-=r,t[2]++)}}function qT(t,e){return t[0]+e[0]*(t[1]+e[1]*t[2])}function uo(t,e,n){const r=Math.floor(e),a=r%(2*n[0]);let s,i;a<n[0]?(t[0]=a,s=1,i=t[0]===n[0]-1):(t[0]=2*n[0]-1-a,s=-1,i=t[0]===0);const o=Math.floor(r/n[0]),c=o%(2*n[1]);let u,g;c<n[1]?(t[1]=c,u=1,g=t[1]===n[1]-1):(t[1]=2*n[1]-1-c,u=-1,g=t[1]===0),t[2]=Math.floor(o/n[1]);const f=e-r;i?g?t[2]+=f:t[1]+=u*f:t[0]+=s*f,t[0]=(t[0]+.5)/n[0],t[1]=(t[1]+.5)/n[1],t[2]=(t[2]+.5)/n[2]}const go=new WeakMap;function JT(t,e,n,r,a,s,i){var B;const o=new Array(arguments.length);for(let L=0;L<arguments.length;++L){const F=arguments[L];o[L]=((B=F.getMTime)==null?void 0:B.call(F))??F}const c=o.join("/"),u=go.get(t);if(u&&u.stringHash===c)return u.textureCoordinates;const g=(n[1]-n[0])/(a-1),[f,l]=[n[0]-g,n[1]+g],h=f-.5*g,v=1/(l-f+g),p=f,y=(a+1)/(l-f),T=t.getData(),S=t.getNumberOfTuples(),d=t.getNumberOfComponents(),x=e<0||e>=d,w=s[2]<=1?2:3,C=ee.newInstance({numberOfComponents:w,values:new Float32Array(S*w)}),M=C.getData(),R=[0,0,0];uo(R,a+2,s);let V=0,O=0;const D=[.5,.5,.5];for(let L=0;L<S;++L){let F;if(x){let U=0;for(let N=0;N<d;++N){const G=Number(T[V+N]);U+=G*G}F=Math.sqrt(U)}else F=Number(T[V+e]);if(r&&(F=Math.log10(F)),V+=d,Nf(F))D[0]=R[0],D[1]=R[1],D[2]=R[2];else if(i){let U=(F-p)*y;U<1?U=0:U>a&&(U=a+1),uo(D,U,s)}else{D[1]=.49;const U=(F-h)*v;U>1e3?D[0]=1e3:U<-1e3?D[0]=-1e3:D[0]=U}for(let U=0;U<w;++U)M[O++]=D[U]}return go.set(t,{stringHash:c,textureCoordinates:C}),C}function ed(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{const n=t.getInputData();return n?(e.static||t.update(),e.bounds=n.getBounds()):e.bounds=la(),e.bounds},t.setForceCompileOnly=n=>{e.forceCompileOnly=n},t.setSelectionWebGLIdsToVTKIds=n=>{e.selectionWebGLIdsToVTKIds=n},t.createDefaultLookupTable=()=>{e.lookupTable=NT.newInstance()},t.getColorModeAsString=()=>E.enumToString(dr,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>E.enumToString(zt,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(n,r,a,s,i)=>{if(!n||!e.scalarVisibility)return{scalars:null,cellFlag:!1};let o=null,c=!1;if(r===zt.DEFAULT)o=n.getPointData().getScalars(),o||(o=n.getCellData().getScalars(),c=!0);else if(r===zt.USE_POINT_DATA)o=n.getPointData().getScalars();else if(r===zt.USE_CELL_DATA)o=n.getCellData().getScalars(),c=!0;else if(r===zt.USE_POINT_FIELD_DATA){const u=n.getPointData();a===Da.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}else if(r===zt.USE_CELL_FIELD_DATA){const u=n.getCellData();c=!0,a===Da.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}else if(r===zt.USE_FIELD_DATA){const u=n.getFieldData();a===Da.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}return{scalars:o,cellFlag:c}},t.mapScalars=(n,r)=>{const{scalars:a,cellFlag:s}=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName);if(e.areScalarsMappedFromCells=s,!a){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}const i=`${t.getMTime()}${a.getMTime()}${r}`;if(e.colorBuildString!==i){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(a,s))e.mapScalarsToTexture(a,s,r);else{e.colorCoordinates=null,e.colorTextureMap=null;const o=t.getLookupTable();o&&(o.build(),e.colorMapColors=o.mapScalars(a,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${a.getMTime()}${r}`}},e.mapScalarsToTexture=(n,r,a)=>{const s=e.lookupTable.getRange(),i=e.lookupTable.usingLogScale(),o=e.lookupTable.getAlpha(),c=i?[Math.log10(s[0]),Math.log10(s[1])]:s;if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==a){e.lookupTable.setAlpha(a),e.colorTextureMap=null,e.lookupTable.build();const g=e.lookupTable.getNumberOfAvailableColors(),f=2048,l=f**3-3,v=4096-2,p=2,y=r?l:v;e.numberOfColorsInRange=Math.min(Math.max(g,p),y);const T=e.numberOfColorsInRange+3,S=e.numberOfColorsInRange+2,d=r?[Math.min(Math.ceil(T/f**0),f),Math.min(Math.ceil(T/f**1),f),Math.min(Math.ceil(T/f**2),f)]:[S,2,1],x=d[0]*d[1]*d[2],w=new Float64Array(x);w.fill(NaN);const C=e.numberOfColorsInRange,M=C+2,R=[0,0,0],V=c[0],O=c[1]-c[0];for(let L=0;L<M;++L){const F=qT(R,d),U=V+O*(L-1)/(C-1),N=i?10**U:U;w[F]=N,ZT(R,d)}const D=ee.newInstance({numberOfComponents:1,values:w}),B=e.lookupTable.mapScalars(D,e.colorMode,0);e.colorTextureMap=CT.newInstance(),e.colorTextureMap.setDimensions(d),e.colorTextureMap.getPointData().setScalars(B),e.lookupTable.setAlpha(o)}const u=e.lookupTable.getVectorMode()===YT.MAGNITUDE&&n.getNumberOfComponents()>1?-1:e.lookupTable.getVectorComponent();e.colorCoordinates=JT(n,u,c,i,e.numberOfColorsInRange,e.colorTextureMap.getDimensions(),r)},t.getIsOpaque=()=>{const n=t.getInputData(),a=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||a==null)return!0;const s=t.getLookupTable();return s?(s.build(),s.areScalarsOpaque(a,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=(n,r)=>r&&e.colorMode!==dr.DIRECT_SCALARS?!0:!(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup()||!n||e.colorMode===dr.DEFAULT&&n.getDataType()===QT.UNSIGNED_CHAR||e.colorMode===dr.DIRECT_SCALARS),t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let n=e.mtime;if(e.lookupTable!==null){const r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.getPrimitiveCount=()=>{const n=t.getInputData();return{points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=mn("AcquireInvertibleLookupTable"),t.valueToColor=mn("ValueToColor"),t.colorToValue=mn("ColorToValue"),t.useInvertibleColorFor=mn("UseInvertibleColorFor"),t.clearInvertibleColor=mn("ClearInvertibleColor"),t.processSelectorPixelBuffers=(n,r)=>{if(!n||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;const a=n.getRawPixelBuffer(ke.ID_LOW24),s=n.getRawPixelBuffer(ke.ID_HIGH24),i=n.getCurrentPass(),o=n.getFieldAssociation();let c=null;o===fo.FIELD_ASSOCIATION_POINTS?c=e.selectionWebGLIdsToVTKIds.points:o===fo.FIELD_ASSOCIATION_CELLS&&(c=e.selectionWebGLIdsToVTKIds.cells),c&&r.forEach(u=>{if(i===ke.ID_LOW24){let g=0;s&&(g+=s[u],g*=256),g+=a[u+2],g*=256,g+=a[u+1],g*=256,g+=a[u];const f=c[g],l=n.getPixelBuffer(ke.ID_LOW24);l[u]=f&255,l[u+1]=(f&65280)>>8,l[u+2]=(f&16711680)>>16}else if(i===ke.ID_HIGH24&&s){let g=0;g+=s[u],g*=256,g+=a[u+2],g*=256,g+=a[u+1],g*=256,g+=a[u];const f=c[g],l=n.getPixelBuffer(ke.ID_HIGH24);l[u]=(f&4278190080)>>24}})}}const td={colorMapColors:null,areScalarsMappedFromCells:!1,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,numberOfColorsInRange:0,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function _u(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,td,n),Iv.extend(t,e,n),E.get(t,e,["areScalarsMappedFromCells","colorCoordinates","colorMapColors","colorTextureMap","numberOfColorsInRange","selectionWebGLIdsToVTKIds"]),E.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),E.setGetArray(t,e,["scalarRange"],2),Uu.implementCoincidentTopologyMethods(t,e),ed(t,e)}const nd=E.newInstance(_u,"vtkMapper");var an={newInstance:nd,extend:_u,...XT,...IT,...ii};const{isVtkObject:rd}=E;function Gu(t){let e=0;return t.filter((n,r)=>r===e?(e+=n+1,!0):!1)}function bu(t){let e=0;for(let n=0;n<t.length;)n+=t[n]+1,e++;return e}const ad={extractCellSizes:Gu,getNumberOfCells:bu};function sd(t,e){e.classHierarchy.push("vtkCellArray");const n={...t};t.getNumberOfCells=r=>(e.numberOfCells!==void 0&&!r||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=bu(t.getData())),e.numberOfCells),t.getCellSizes=r=>(e.cellSizes!==void 0&&!r||(e.cellSizes=Gu(t.getData())),e.cellSizes),t.resize=r=>{const a=t.getNumberOfTuples();n.resize(r);const s=t.getNumberOfTuples();s<a&&(s===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=r=>{n.setData(r,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=r=>{let a=r;const s=e.values[a++];return e.values.subarray(a,a+s)},t.insertNextCell=r=>{let a;rd(r)?a=r.getPointsIds():a=r;const s=t.getNumberOfCells();return t.insertNextTuples([a.length,...a]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(a.length),s},t.getMaxCellSize=()=>t.getCellSizes().reduce((r,a)=>Math.max(r,a),0)}function id(t){return{empty:!0,numberOfComponents:1,dataType:xe.UNSIGNED_INT,...t}}function $u(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ee.extend(t,e,id(n)),sd(t,e)}const od=E.newInstance($u,"vtkCellArray");var lo={newInstance:od,extend:$u,...ad};const{vtkErrorMacro:cd}=E;function fd(t,e){let n=0;e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(s){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==s&&(e.size=s*i,e.values=E.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(i),t.modified())},t.setPoint=function(s){for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];t.setTuple(s,o)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(s,i,o)=>t.insertNextTuple([s,i,o]),t.insertPoint=(s,i)=>t.insertTuple(s,i);const r=t.getBounds;t.getBounds=()=>(n<e.mtime&&t.computeBounds(),r());const a=t.getBoundsByReference;t.getBoundsByReference=()=>(n<e.mtime&&t.computeBounds(),a()),t.computeBounds=()=>{if(t.getNumberOfComponents()===3){const s=t.getRange(0);e.bounds[0]=s[0],e.bounds[1]=s[1];const i=t.getRange(1);e.bounds[2]=i[0],e.bounds[3]=i[1];const o=t.getRange(2);e.bounds[4]=o[0],e.bounds[5]=o[1]}else if(t.getNumberOfComponents()===2){const s=t.getRange(0);e.bounds[0]=s[0],e.bounds[1]=s[1];const i=t.getRange(1);e.bounds[2]=i[0],e.bounds[3]=i[1],e.bounds[4]=0,e.bounds[5]=0}else cd(`getBounds called on an array with components of ${t.getNumberOfComponents()}`),Ys(e.bounds);n=E.getCurrentGlobalMTime()},t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}const ud={empty:!0,numberOfComponents:3,dataType:xe.FLOAT,bounds:[1,-1,1,-1,1,-1]};function zu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ud,n),ee.extend(t,e,n),E.getArray(t,e,["bounds"],6),fd(t,e)}const gd=E.newInstance(zu,"vtkPoints");var Jn={newInstance:gd,extend:zu};function ld(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(r){e.pointsIds=r;let a=e.points.getData();a.length!==3*e.pointsIds.length&&(a=E.newTypedArray(n.getDataType(),3*e.pointsIds.length));const s=n.getData();e.pointsIds.forEach((i,o)=>{let c=3*i,u=3*o;a[u]=s[c],a[++u]=s[++c],a[++u]=s[++c]}),e.points.setData(a)}else{e.points=n,e.pointsIds=new Array(n.getNumberOfPoints());for(let a=n.getNumberOfPoints()-1;a>=0;--a)e.pointsIds[a]=a}},t.getBounds=()=>e.points.getBounds(),t.getLength2=()=>{const n=j.getLengths(t.getBounds());return n[0]*n[0]+n[1]*n[1]+n[2]*n[2]},t.getParametricDistance=n=>{let r,a=0;for(let s=0;s<3;s++)n[s]<0?r=-n[s]:n[s]>1?r=n[s]-1:r=0,r>a&&(a=r);return a},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=n=>{n.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(n,r,a,s,i,o,c)=>{},t.evaluatePosition=(n,r,a,s,i,o)=>{E.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const pd={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function Wu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pd,n),E.obj(t,e),e.points||(e.points=Jn.newInstance()),E.get(t,e,["points","pointsIds"]),ld(t,e)}const hd=E.newInstance(Wu,"vtkCell");var sn={newInstance:hd,extend:Wu};function yd(t,e){let n=e;for(e>=t.array.length&&(n+=t.array.length);n>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=n}function vd(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=n=>{const r=n.getPoints().getNumberOfPoints(),a=n.getNumberOfCells(),s=new Uint32Array(r);if(n.isA("vtkPolyData")){for(let i=0;i<a;++i){const{cellPointIds:o}=n.getCellPoints(i);o.forEach(c=>{t.incrementLinkCount(c)})}t.allocateLinks(r),e.maxId=r-1;for(let i=0;i<a;++i){const{cellPointIds:o}=n.getCellPoints(i);o.forEach(c=>{t.insertCellReference(c,s[c]++,i)})}}else{for(let i=0;i<a;i++)sn.newInstance().getPointsIds().forEach(c=>{t.incrementLinkCount(c)});t.allocateLinks(r),e.maxId=r-1;for(let i=0;i<a;++i)sn.newInstance().getPointsIds().forEach(c=>{t.insertCellReference(c,s[c]++,i)})}},t.allocate=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(n).fill().map(()=>({ncells:0,cells:null})),e.extend=r,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=n=>e.array[n],t.getNcells=n=>e.array[n].ncells,t.getCells=n=>e.array[n].cells,t.insertNextPoint=n=>{e.array.push({ncells:n,cells:Array(n)}),++e.maxId},t.insertNextCellReference=(n,r)=>{e.array[n].cells[e.array[n].ncells++]=r},t.deletePoint=n=>{e.array[n].ncells=0,e.array[n].cells=null},t.removeCellReference=(n,r)=>{e.array[r].cells=e.array[r].cells.filter(a=>a!==n),e.array[r].ncells=e.array[r].cells.length},t.addCellReference=(n,r)=>{e.array[r].cells[e.array[r].ncells++]=n},t.resizeCellList=(n,r)=>{e.array[n].cells.length=r},t.squeeze=()=>{yd(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{e.array=[...n.array],e.extend=n.extend,e.maxId=n.maxId},t.incrementLinkCount=n=>{++e.array[n].ncells},t.allocateLinks=n=>{for(let r=0;r<n;++r)e.array[r].cells=new Array(e.array[r].ncells)},t.insertCellReference=(n,r,a)=>{e.array[n].cells[r]=a}}const Td={array:null,maxId:0,extend:0};function Hu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Td,n),E.obj(t,e),vd(t,e)}const dd=E.newInstance(Hu,"vtkCellLinks");var xd={newInstance:dd,extend:Hu};const Q={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_QUAD:9,VTK_QUADRATIC_EDGE:21,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42},ls=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function Sd(t){return t<ls.length?ls[t]:"UnknownClass"}function Cd(t){return ls.findIndex(t)}function wd(t){return t<Q.VTK_QUADRATIC_EDGE||t===Q.VTK_CONVEX_POINT_SET||t===Q.VTK_POLYHEDRON}function Ed(t){return t===Q.VTK_TRIANGLE_STRIP||t===Q.VTK_POLY_LINE||t===Q.VTK_POLY_VERTEX}const Md={getClassNameFromTypeId:Sd,getTypeIdFromClassName:Cd,isLinear:wd,hasSubCells:Ed};function Rd(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=n>0?n:1,e.extend=r>0?r:1,e.maxId=-1,e.typeArray=new Uint8Array(n),e.locationArray=new Uint32Array(n)},t.insertCell=(n,r,a)=>{e.typeArray[n]=r,e.locationArray[n]=a,n>e.maxId&&(e.maxId=n)},t.insertNextCell=(n,r)=>(t.insertCell(++e.maxId,n,r),e.maxId),t.setCellTypes=(n,r,a)=>{e.size=n,e.typeArray=r,e.locationArray=a,e.maxId=n-1},t.getCellLocation=n=>e.locationArray[n],t.deleteCell=n=>{e.typeArray[n]=Q.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=n=>{const r=t.getNumberOfTypes();for(let a=0;a<r;++a)if(n===t.getCellType(a))return!0;return!1},t.insertNextType=n=>t.insertNextCell(n,-1),t.getCellType=n=>e.typeArray[n],t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{t.allocate(n.getSize(),n.getExtend()),e.typeArray.set(n.getTypeArray()),e.locationArray.set(n.getLocationArray()),e.maxId=n.getMaxId()}}const Od={size:0,maxId:-1,extend:1e3};function Au(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Od,n),E.obj(t,e),E.get(t,e,["size","maxId","extend"]),E.getArray(t,e,["typeArray","locationArray"]),Rd(t,e)}const Dd=E.newInstance(Au,"vtkCellTypes");var ps={newInstance:Dd,extend:Au,...Md};const ju={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var Ku={IntersectionState:ju};const{IntersectionState:Ar}=Ku;function Tn(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const a={t:Number.MIN_VALUE,distance:0},s=[];let i;s[0]=n[0]-e[0],s[1]=n[1]-e[1],s[2]=n[2]-e[2];const o=s[0]*(t[0]-e[0])+s[1]*(t[1]-e[1])+s[2]*(t[2]-e[2]),c=W(s,s);let u=1e-5*o;return c!==0&&(a.t=o/c),u<0&&(u=-u),-u<c&&c<u||c<=0||a.t<0?i=e:a.t>1?i=n:(i=s,s[0]=e[0]+a.t*s[0],s[1]=e[1]+a.t*s[1],s[2]=e[2]+a.t*s[2]),r&&(r[0]=i[0],r[1]=i[1],r[2]=i[2]),a.distance=Se(i,t),a}function Pu(t,e,n,r,a,s){const i=[],o=[],c=[];a[0]=0,s[0]=0,ye(e,t,i),ye(r,n,o),ye(n,t,c);const u=[W(i,i),-W(i,o),-W(i,o),W(o,o)],g=[];if(g[0]=W(i,c),g[1]=-W(o,c),Vf(u,g,2)===0){let f=Number.MAX_VALUE;const l=[t,e,n,r],h=[n,n,t,t],v=[r,r,e,e];s[0],s[0],a[0],a[0],a[0],a[0],s[0],s[0];let p;for(let y=0;y<4;y++)p=Tn(l[y],h[y],v[y]),p.distance<f&&(f=p.distance,p.t);return Ar.ON_LINE}return a[0]=g[0],s[0]=g[1],a[0]>=0&&a[0]<=1&&s[0]>=0&&s[0]<=1?Ar.YES_INTERSECTION:Ar.NO_INTERSECTION}const Ld={distanceToLine:Tn,intersection:Pu};function Vd(t,e){e.classHierarchy.push("vtkLine");function n(r){return r>=0&&r<=1}t.getCellDimension=()=>1,t.intersectWithLine=(r,a,s,i,o)=>{const c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};o[1]=0,o[2]=0;const u=[],g=[],f=[];e.points.getPoint(0,g),e.points.getPoint(1,f);const l=[],h=[],v=Pu(r,a,g,f,l,h);if(c.t=l[0],c.betweenPoints=n(c.t),o[0]=h[0],v===Ar.YES_INTERSECTION){for(let p=0;p<3;p++)i[p]=g[p]+o[0]*(f[p]-g[p]),u[p]=r[p]+c.t*(a[p]-r[p]);if(Se(i,u)<=s*s)return c.intersect=1,c}else{let p;if(c.t<0)return p=Tn(r,g,f,i),p.distance<=s*s&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return p=Tn(a,g,f,i),p.distance<=s*s&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(o[0]<0)return o[0]=0,p=Tn(g,r,a,i),c.t=p.t,p.distance<=s*s&&(c.intersect=1),c;if(o[0]>1)return o[0]=1,p=Tn(f,r,a,i),c.t=p.t,p.distance<=s*s&&(c.intersect=1),c}return c},t.evaluateLocation=(r,a,s)=>{const i=[],o=[];e.points.getPoint(0,i),e.points.getPoint(1,o);for(let c=0;c<3;c++)a[c]=i[c]+r[0]*(o[c]-i[c]);s[0]=1-r[0],s[1]=r[0]},t.evaluateOrientation=(r,a,s)=>e.orientations?(Ur(a,e.orientations[0],e.orientations[1],r[0]),s[0]=1-r[0],s[1]=r[0],!0):!1}const Bd={orientations:null};function Xu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Bd,n),sn.extend(t,e,n),E.setGet(t,e,["orientations"]),Vd(t,e)}const Fd=E.newInstance(Xu,"vtkLine");var Re={newInstance:Fd,extend:Xu,...Ld,...Ku};function md(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=et(e.points):e.points=Jn.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};const n=t.shallowCopy;t.shallowCopy=function(s){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(s,i),e.points=Jn.newInstance(),e.points.shallowCopy(s.getPoints())};const r=t.getMTime;t.getMTime=()=>{var i;const s=r();return Math.max(s,((i=e.points)==null?void 0:i.getMTime())??s)};const a=t.initialize;t.initialize=()=>{var s;return(s=e.points)==null||s.initialize(),a()}}const kd={};function Iu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kd,n),cn.extend(t,e,n),E.setGet(t,e,["points"]),md(t,e)}const Ud=E.newInstance(Iu,"vtkPointSet");var Nd={newInstance:Ud,extend:Iu};function _d(t,e){e.classHierarchy.push("vtkPolyLine");const n=Re.newInstance();n.getPoints().setNumberOfPoints(2),t.getCellDimension=()=>1,t.intersectWithLine=(r,a,s,i,o,c,u)=>{const g={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null},f=t.getNumberOfPoints()-1;let l=Number.MAX_VALUE;for(let h=0;h<f;h++){const v=[0,0,0];n.getPoints().getData().set(e.points.getData().subarray(3*h,3*(h+2)));const p=n.intersectWithLine(s,i,o,c,u);if(p.intersect===1&&p.t<=g.t+o&&p.t>=r&&p.t<=a){g.intersect=1;const y=n.getParametricDistance(v);if(y<l||y===l&&p.t<g.t){g.subId=h,g.t=p.t,l=y;for(let T=0;T<3;T++)c[T],v[T]}}}return g},t.evaluateLocation=(r,a,s,i)=>(n.getPoints().getData().set(e.points.getData().subarray(3*r,3*(r+2))),n.evaluateLocation(a,s,i)),t.evaluateOrientation=(r,a,s,i)=>(e.orientations?n.setOrientations([e.orientations[r],e.orientations[r+1]]):n.setOrientations(null),n.evaluateOrientation(a,s,i)),t.getDistancesToFirstPoint=()=>{const r=e.distancesTime.getMTime();if(r<e.points.getMTime()||r<t.getMTime()){const a=t.getNumberOfPoints();if(e.distances?e.distances.length=a:e.distances=new Array(a),a>0){const s=new Array(3),i=new Array(3);let o=0;e.distances[0]=o,e.points.getPoint(0,s);for(let c=1;c<a;++c)e.points.getPoint(c,i),o+=e.distanceFunction(s,i),e.distances[c]=o,Tc(s,i)}e.distancesTime.modified()}return e.distances},t.findPointIdAtDistanceFromFirstPoint=r=>{const a=t.getDistancesToFirstPoint();if(a.length<2)return-1;let s=0,i=a.length-1;if(r<a[s]||r>a[i]||a[i]===0)return-1;for(;i-s>1;){const o=Math.floor((s+i)/2);a[o]<=r?s=o:i=o}return s}}const Gd={orientations:null,distanceFunction:op};function Yu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Gd,n),sn.extend(t,e,n),E.setGet(t,e,["orientations","distanceFunction"]),e.distancesTime={},E.obj(e.distancesTime,{mtime:0}),_d(t,e)}const bd=E.newInstance(Yu,"vtkPolyLine");var Qu={newInstance:bd,extend:Yu};function $d(t,e){e.classHierarchy.push("vtkPriorityQueue"),t.push=(n,r)=>{const a=e.elements.findIndex(s=>s.priority>n);e.elements.splice(a,0,{priority:n,element:r})},t.pop=()=>e.elements.length>0?e.elements.shift().element:null,t.deleteById=n=>{e.elements=e.elements.filter(r=>{let{element:a}=r;return a.id!==n})},t.length=()=>e.elements.length}const zd={elements:[]};function Zu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zd,n),E.obj(t,e),$d(t,e)}const Wd=E.newInstance(Zu,"vtkPriorityQueue");var Hd={newInstance:Wd,extend:Zu};const xr=1e-6,po=11920929e-14,Ad=1e-8,Pt={FAILURE:-1,OUTSIDE:0,INSIDE:1,INTERSECTION:2,ON_LINE:3};function ho(t,e,n,r,a){return(r[t]-n[t])*(a[e]-n[e])-(a[t]-n[t])*(r[e]-n[e])}function jd(t,e,n,r){if(t[0]<n[0]||t[0]>n[1]||t[1]<n[2]||t[1]>n[3]||t[2]<n[4]||t[2]>n[5])return Pt.OUTSIDE;if(we(r)<=po)return Pt.FAILURE;let a=Ad*((n[1]-n[0])*(n[1]-n[0])+(n[3]-n[2])*(n[3]-n[2])+(n[5]-n[4])*(n[5]-n[4]));a*=a,a=a===0?po:a;const s=[],i=[];for(let g=0;g<e.length;){if(s[0]=e[g++],s[1]=e[g++],s[2]=e[g++],Se(t,s)<=a)return Pt.INSIDE;const{distance:f,t:l}=Re.distanceToLine(t,s,i);if(f<=a&&l>0&&l<1)return Pt.INSIDE}let o,c;Math.abs(r[0])>Math.abs(r[1])?Math.abs(r[0])>Math.abs(r[2])?(o=1,c=2):(o=0,c=1):Math.abs(r[1])>Math.abs(r[2])?(o=0,c=2):(o=0,c=1);let u=0;for(let g=0;g<e.length;)s[0]=e[g++],s[1]=e[g++],s[2]=e[g++],g<e.length?(i[0]=e[g],i[1]=e[g+1],i[2]=e[g+2]):(i[0]=e[0],i[1]=e[1],i[2]=e[2]),s[c]<=t[c]?i[c]>t[c]&&ho(o,c,s,i,t)>0&&++u:i[c]<=t[c]&&ho(o,c,s,i,t)<0&&--u;return u===0?Pt.OUTSIDE:Pt.INSIDE}function Kd(t,e,n){const r=t.length,a=[];e.getPoint(t[0],a),n[0]=a[0],n[1]=a[0],n[2]=a[1],n[3]=a[1],n[4]=a[2],n[5]=a[2];for(let i=1;i<r;i++)e.getPoint(t[i],a),j.addPoint(n,...a);const s=j.getLengths(n);return W(s,s)}function Pd(t,e,n){n.length=3,n[0]=0,n[1]=0,n[2]=0;const r=[];let a=[],s=[];const i=[],o=[];e.getPoint(t[0],r),e.getPoint(t[1],a);for(let c=2;c<t.length;c++){e.getPoint(t[c],s),ye(s,a,i),ye(r,a,o);const u=[0,0,0];Ue(i,o,u),En(n,u,n),[a,s]=[s,a]}return we(n)}function Xd(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];n[0]=0,n[1]=0,n[2]=0;const r=t.length,a=[];for(let s=0;s<r;s++)e.getPoint(t[s],a),n[0]+=a[0],n[1]+=a[1],n[2]+=a[2];return n[0]/=r,n[1]/=r,n[2]/=r,n}const Id={PolygonWithPointIntersectionState:Pt,pointInPolygon:jd,getBounds:Kd,getNormal:Pd,computeCentroid:Xd};function Yd(t,e){e.classHierarchy.push("vtkPolygon");function n(){const o=[0,0,0],c=[0,0,0];e.normal=[0,0,0];const u=[...e.firstPoint.point];let g=e.firstPoint;for(let f=0;f<e.pointCount;f++){ye(g.point,u,o),ye(g.next.point,u,c);const l=[0,0,0];Ue(o,c,l),En(e.normal,l,e.normal),g=g.next}return we(e.normal)}function r(o){const c=[0,0,0],u=[0,0,0],g=[0,0,0],f=[0,0,0];ye(o.point,o.previous.point,c),ye(o.next.point,o.point,u),ye(o.previous.point,o.next.point,g),Ue(c,u,f);const l=W(f,e.normal);if(l<=0)return-1;const h=$e(c)+$e(u)+$e(g);return h*h/l}function a(o){if(e.pointCount<=3)return!0;const c=o.previous,u=o.next,g=[0,0,0];ye(u.point,c.point,g);const f=[0,0,0];if(Ue(g,e.normal,f),we(f),$e(f)===0)return!1;let l=Ut.evaluate(f,c.point,u.next.point),h=l>xr?1:l<-xr?-1:0,v=h<0?1:0;for(let p=u.next.next;p.id!==c.id;p=p.next){const y=p.previous;l=Ut.evaluate(f,c.point,p.point);const T=l>xr?1:l<-xr?-1:0;if(T!==h){if(v||(v=T<=0?1:0),Re.intersection(c.point,u.point,p.point,y.point,[0],[0])===ju.YES_INTERSECTION)return!1;h=T}}return v===1}function s(o,c){e.pointCount-=1;const u=o.previous,g=o.next;e.tris=e.tris.concat(o.point),e.tris=e.tris.concat(g.point),e.tris=e.tris.concat(u.point),u.next=g,g.previous=u,c.deleteById(u.id),c.deleteById(g.id);const f=r(u);f>0&&c.push(f,u);const l=r(g);l>0&&c.push(l,g),o.id===e.firstPoint.id&&(e.firstPoint=g)}function i(){n();const o=Hd.newInstance();let c=e.firstPoint;for(let u=0;u<e.pointCount;u++){const g=r(c);g>0&&o.push(g,c),c=c.next}for(;e.pointCount>2&&o.length()>0;)if(e.pointCount===o.length()){const u=o.pop();s(u,o)}else{const u=o.pop();a(u)&&s(u,o)}return e.pointCount<=2}t.triangulate=()=>e.firstPoint?i():null,t.setPoints=o=>{e.pointCount=o.length,e.firstPoint={id:0,point:o[0],next:null,previous:null};let c=e.firstPoint;for(let u=1;u<e.pointCount;u++)c.next={id:u,point:o[u],next:null,previous:c},c=c.next;e.firstPoint.previous=c,c.next=e.firstPoint},t.getPointArray=()=>e.tris}const Qd={firstPoint:null,pointCount:0,tris:[]};function qu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Qd,n),E.obj(t,e),Yd(t,e)}const Zd=E.newInstance(qu,"vtkPolygon");var qd={newInstance:Zd,extend:qu,...Id};function ci(t,e,n,r){const a=n[0]-e[0],s=n[1]-e[1],i=n[2]-e[2],o=t[0]-e[0],c=t[1]-e[1],u=t[2]-e[2];r[0]=s*u-i*c,r[1]=i*o-a*u,r[2]=a*c-s*o}function er(t,e,n,r){ci(t,e,n,r);const a=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);a!==0&&(r[0]/=a,r[1]/=a,r[2]/=a)}function Ju(t){t[0]=-1,t[1]=1,t[2]=0,t[3]=-1,t[4]=0,t[5]=1}function Jd(t,e,n,r,a,s){let i=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,o=!1;const c=[],u=[],g=[],f=[],l=[];er(t,e,n,f),er(r,a,s,l);const h=-W(f,t),v=-W(l,r),p=[W(l,t)+v,W(l,e)+v,W(l,n)+v];if(p[0]*p[1]>i&&p[0]*p[2]>i)return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};const y=[W(f,r)+h,W(f,a)+h,W(f,s)+h];if(y[0]*y[1]>i&&y[0]*y[2]>i)return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};if(Math.abs(f[0]-l[0])<1e-9&&Math.abs(f[1]-l[1])<1e-9&&Math.abs(f[2]-l[2])<1e-9&&Math.abs(h-v)<1e-9)return o=!0,{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};const T=[t,e,n],S=[r,a,s],d=W(f,l),x=(h-v*d)/(d*d-1),w=(v-h*d)/(d*d-1),C=[x*f[0]+w*l[0],x*f[1]+w*l[1],x*f[2]+w*l[2]],M=Ue(f,l,[]);we(M);let R=0,V=0;const O=[],D=[];let B=50,L=50;for(let N=0;N<3;N++){const G=N,H=(N+1)%3,k=Ut.intersectWithLine(T[G],T[H],r,l);k.intersection&&k.t>0-i&&k.t<1+i&&(k.t<1+i&&k.t>1-i&&(B=R),O[R++]=W(k.x,M)-W(C,M));const _=Ut.intersectWithLine(S[G],S[H],t,f);_.intersection&&_.t>0-i&&_.t<1+i&&(_.t<1+i&&_.t>1-i&&(L=V),D[V++]=W(_.x,M)-W(C,M))}if(R>2){R--;const N=O[2];O[2]=O[B],O[B]=N}if(V>2){V--;const N=D[2];D[2]=D[L],D[L]=N}if(R!==2||V!==2)return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};if(Number.isNaN(O[0])||Number.isNaN(O[1])||Number.isNaN(D[0])||Number.isNaN(D[1]))return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};if(O[0]>O[1]){const N=O[1];O[1]=O[0],O[0]=N}if(D[0]>D[1]){const N=D[1];D[1]=D[0],D[0]=N}let F,U;return O[1]<D[0]||D[1]<O[0]?{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g}:(O[0]<D[0]?O[1]<D[1]?(g[0]=2,g[1]=1,F=D[0],U=O[1]):(g[0]=2,g[1]=2,F=D[0],U=D[1]):O[1]<D[1]?(g[0]=1,g[1]=1,F=O[0],U=O[1]):(g[0]=1,g[1]=2,F=O[0],U=D[1]),Ja(C,M,F,c),Ja(C,M,U,u),{intersect:!0,coplanar:o,pt1:c,pt2:u,surfaceId:g})}const ex={computeNormalDirection:ci,computeNormal:er,interpolationDerivs:Ju,intersectWithTriangle:Jd};function tx(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(n,r,a,s,i)=>{const o={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};i[2]=0;const c=[],u=a*a,g=[],f=[],l=[];e.points.getPoint(0,g),e.points.getPoint(1,f),e.points.getPoint(2,l);const h=[],v=[];if(er(g,f,l,h),h[0]!==0||h[1]!==0||h[2]!==0){const d=Ut.intersectWithLine(n,r,g,h);if(o.betweenPoints=d.betweenPoints,o.t=d.t,s[0]=d.x[0],s[1]=d.x[1],s[2]=d.x[2],!d.intersection)return i[0]=0,i[1]=0,o.intersect=0,o;const x=t.evaluatePosition(s,c,i,v);if(x.evaluation>=0)return x.dist2<=u?(o.intersect=1,o):(o.intersect=x.evaluation,o)}const p=Se(g,f),y=Se(f,l),T=Se(l,g);e.line||(e.line=Re.newInstance()),p>y&&p>T?(e.line.getPoints().setPoint(0,g),e.line.getPoints().setPoint(1,f)):y>T&&y>p?(e.line.getPoints().setPoint(0,f),e.line.getPoints().setPoint(1,l)):(e.line.getPoints().setPoint(0,l),e.line.getPoints().setPoint(1,g));const S=e.line.intersectWithLine(n,r,a,s,i);if(o.betweenPoints=S.betweenPoints,o.t=S.t,S.intersect){const d=[],x=[],w=[];for(let C=0;C<3;C++)d[C]=g[C]-l[C],x[C]=f[C]-l[C],w[C]=s[C]-l[C];return i[0]=W(w,d)/T,i[1]=W(w,x)/y,o.intersect=1,o}return i[0]=0,i[1]=0,o.intersect=0,o},t.evaluatePosition=(n,r,a,s)=>{const i={subId:0,dist2:0,evaluation:-1};let o,c;const u=[],g=[],f=[],l=[];let h;const v=[],p=[],y=[];let T=0,S=0;const d=[];let x,w,C,M=[];const R=[],V=[],O=[];i.subId=0,a[2]=0,e.points.getPoint(1,u),e.points.getPoint(2,g),e.points.getPoint(0,f),ci(u,g,f,l),Ut.generalizedProjectPoint(n,u,l,O);let D=0;for(o=0;o<3;o++)l[o]<0?h=-l[o]:h=l[o],h>D&&(D=h,S=o);for(c=0,o=0;o<3;o++)o!==S&&(d[c++]=o);for(o=0;o<2;o++)v[o]=O[d[o]]-f[d[o]],p[o]=u[d[o]]-f[d[o]],y[o]=g[d[o]]-f[d[o]];if(T=ie(p,y),T===0)return a[0]=0,a[1]=0,i.evaluation=-1,i;if(a[0]=ie(v,y)/T,a[1]=ie(p,v)/T,s[0]=1-(a[0]+a[1]),s[1]=a[0],s[2]=a[1],s[0]>=0&&s[0]<=1&&s[1]>=0&&s[1]<=1&&s[2]>=0&&s[2]<=1)r&&(i.dist2=Se(O,n),r[0]=O[0],r[1]=O[1],r[2]=O[2]),i.evaluation=1;else{let B;if(r){if(s[1]<0&&s[2]<0)for(x=Se(n,f),w=Re.distanceToLine(n,u,f,B,R),C=Re.distanceToLine(n,f,g,B,V),x<w?(i.dist2=x,M=f):(i.dist2=w,M=R),C<i.dist2&&(i.dist2=C,M=V),o=0;o<3;o++)r[o]=M[o];else if(s[2]<0&&s[0]<0)for(x=Se(n,u),w=Re.distanceToLine(n,u,f,B,R),C=Re.distanceToLine(n,u,g,B,V),x<w?(i.dist2=x,M=u):(i.dist2=w,M=R),C<i.dist2&&(i.dist2=C,M=V),o=0;o<3;o++)r[o]=M[o];else if(s[1]<0&&s[0]<0)for(x=Se(n,g),w=Re.distanceToLine(n,g,f,B,R),C=Re.distanceToLine(n,u,g,B,V),x<w?(i.dist2=x,M=g):(i.dist2=w,M=R),C<i.dist2&&(i.dist2=C,M=V),o=0;o<3;o++)r[o]=M[o];else if(s[0]<0){const L=Re.distanceToLine(n,u,g,r);i.dist2=L.distance}else if(s[1]<0){const L=Re.distanceToLine(n,g,f,r);i.dist2=L.distance}else if(s[2]<0){const L=Re.distanceToLine(n,u,f,r);i.dist2=L.distance}}i.evaluation=0}return i},t.evaluateLocation=(n,r,a)=>{const s=[],i=[],o=[];e.points.getPoint(0,s),e.points.getPoint(1,i),e.points.getPoint(2,o);const c=1-n[0]-n[1];for(let u=0;u<3;u++)r[u]=s[u]*c+i[u]*n[0]+o[u]*n[1];a[0]=c,a[1]=n[0],a[2]=n[1]},t.getParametricDistance=n=>{let r,a=0;const s=[];s[0]=n[0],s[1]=n[1],s[2]=1-n[0]-n[1];for(let i=0;i<3;i++)s[i]<0?r=-s[i]:s[i]>1?r=s[i]-1:r=0,r>a&&(a=r);return a},t.derivatives=(n,r,a,s,i)=>{const o=e.points.getPoint(0),c=e.points.getPoint(1),u=e.points.getPoint(2),g=[],f=[],l=[],h=[];er(o,c,u,g),ye(c,o,f),ye(u,o,h),Ue(g,f,l);const v=we(f);if(v<=0||we(l)<=0){for(let w=0;w<s;w++)for(let C=0;C<3;C++)i[w*s+C]=0;return}const p=[0,0],y=[v,0],T=[W(h,f),W(h,l)],S=new Array(6);Ju(S);const d=[y[0]-p[0],y[1]-p[1],T[0]-p[0],T[1]-p[1]],x=E.newTypedArray(De.Float64Array,4);Is(d,x,2);for(let w=0;w<s;w++){let C=0,M=0;for(let O=0;O<3;O++)C+=S[O]*a[s*O+w],M+=S[3+O]*a[s*O+w];const R=C*x[0]+M*x[1],V=C*x[2]+M*x[3];i[3*w]=R*f[0]+V*l[0],i[3*w+1]=R*f[1]+V*l[1],i[3*w+2]=R*f[2]+V*l[2]}},t.cellBoundary=(n,r,a)=>{const s=r[0]-r[1],i=.5*(1-r[0])-r[1],o=2*r[0]+r[1]-1;return s>=0&&i>=0?(a[0]=e.pointsIds[0],a[1]=e.pointsIds[1]):i<0&&o>=0?(a[0]=e.pointsIds[1],a[1]=e.pointsIds[2]):(a[0]=e.pointsIds[2],a[1]=e.pointsIds[0]),!(r[0]<0||r[1]<0||r[0]>1||r[1]>1||1-r[0]-r[1]<0)}}const nx={};function eg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nx,n),sn.extend(t,e,n),tx(t,e)}const rx=E.newInstance(eg,"vtkTriangle");var Ta={newInstance:rx,extend:eg,...ex};function yo(){return{intersected:!1,subId:-1,x:[0,0,0],pCoords:[0,0,0],t:-1}}function ax(t,e){e.classHierarchy.push("vtkQuad"),t.getCellDimension=()=>2,t.getCellType=()=>Q.VTK_QUAD,t.getNumberOfEdges=()=>4,t.getNumberOfFaces=()=>0,t.intersectWithLine=(n,r,a,s,i)=>{let o={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1},c;const u=e.points.getPoint(0,[]),g=e.points.getPoint(1,[]),f=e.points.getPoint(2,[]),l=e.points.getPoint(3,[]),h=Se(u,f),v=Se(g,l);if(h===v){let C,M=0,R=0;for(let V=0;V<4;V++)C=e.pointsIds[V],C>M&&(M=C,R=V);R===0||R===2?c=0:c=1}else h<v?c=0:c=1;let p=null;e.triangle?p=e.triangle.getPoints():(e.triangle=Ta.newInstance(),p=Jn.newInstance(),p.setNumberOfPoints(3),e.triangle.initialize(p));let y;const T=yo();let S;const d=yo();let x,w;switch(c){case 0:p.setPoint(0,...u),p.setPoint(1,...g),p.setPoint(2,...f),y=e.triangle.intersectWithLine(n,r,a,T.x,T.pCoords),p.setPoint(0,...f),p.setPoint(1,...l),p.setPoint(2,...u),S=e.triangle.intersectWithLine(n,r,a,d.x,d.pCoords),x=y.intersect&&S.intersect?y.t<=S.t:y.intersect,w=y.intersect&&S.intersect?S.t<y.t:S.intersect,x?(o=y,s[0]=T.x[0],s[1]=T.x[1],s[2]=T.x[2],i[0]=T.pCoords[0]+T.pCoords[1],i[1]=T.pCoords[1],i[2]=T.pCoords[2]):w&&(o=S,s[0]=d.x[0],s[1]=d.x[1],s[2]=d.x[2],i[0]=1-(d.pCoords[0]+d.pCoords[1]),i[1]=1-d.pCoords[1],i[2]=d.pCoords[2]);break;case 1:p.setPoint(0,...u),p.setPoint(1,...g),p.setPoint(2,...l),y=e.triangle.intersectWithLine(n,r,a,T.x,T.pCoords),p.setPoint(0,...f),p.setPoint(1,...l),p.setPoint(2,...g),S=e.triangle.intersectWithLine(n,r,a,d.x,d.pCoords),x=y.intersect&&S.intersect?y.t<=S.t:y.intersect,w=y.intersect&&S.intersect?S.t<y.t:S.intersect,x?(o=y,s[0]=T.x[0],s[1]=T.x[1],s[2]=T.x[2],i[0]=T.pCoords[0],i[1]=T.pCoords[1],i[2]=T.pCoords[2]):w&&(o=S,s[0]=d.x[0],s[1]=d.x[1],s[2]=d.x[2],i[0]=1-d.pCoords[0],i[1]=1-d.pCoords[1],i[2]=d.pCoords[2]);break}return o},t.interpolationFunctions=(n,r)=>{const a=1-n[0],s=1-n[1];r[0]=a*s,r[1]=n[0]*s,r[2]=n[0]*n[1],r[3]=a*n[1]},t.evaluateLocation=(n,r,a)=>{const s=[];t.interpolationFunctions(n,a),r[0]=0,r[1]=0,r[2]=0;for(let i=0;i<4;i++){e.points.getPoint(i,s);for(let o=0;o<3;o++)r[o]+=s[o]*a[i]}}}const sx={};function tg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sx,n),sn.extend(t,e,n),ax(t,e)}const ix=E.newInstance(tg,"vtkQuad");var ng={newInstance:ix,extend:tg};const{vtkErrorMacro:rg}=E;function vo(t){return()=>rg(`vtkTriangleStrip.${t} - NOT IMPLEMENTED`)}function ox(t,e){if(!Array.isArray(t)||t.length<3){rg("decomposeStrip - Invalid points array");return}let n=t[0],r=t[1];for(let a=0;a<t.length-2;a++){const s=t[a+2];a%2?e.insertNextCell([r,n,s]):e.insertNextCell([n,r,s]),n=r,r=s}}const cx={decomposeStrip:ox};function fx(t,e){e.classHierarchy.push("vtkTriangleStrip");const n=t.initialize;t.initialize=(r,a)=>{e.triangle.initialize(r,a),n(r,a)},t.getCellType=()=>Q.VTK_TRIANGLE_STRIP,t.getCellDimension=()=>2,t.getNumberOfEdges=()=>e.pointsIds.length,t.getNumberOfFaces=()=>0,t.evaluatePosition=(r,a,s,i,o)=>{const c=[0,0,0];let u=Number.MAX_VALUE,g=0;const f=[],l=[],h=[];s[2]=0,l[0]=0,l[1]=0,l[2]=0;const v=e.triangle.getPoints();v.setNumberOfPoints(3);const y=e.triangle.getPointsIds().length;for(let T=0;T<y;T++)o[T]=0;for(let T=0;T<y-2;T++){const S=[];v.getPoint(T,S);const d=[];v.getPoint(T+1,d);const x=[];v.getPoint(T+2,x),v.setData(Float32Array.from([...S,...d,...x]),3);const w=e.triangle.evaluatePosition(r,h,c,f),C=w.dist2;w.evaluation>=0&&(C<u||C===u&&g===0)&&(g=w,a&&(a[0]=h[0],a[1]=h[1],a[2]=h[2]),s[0]=c[0],s[1]=c[1],u=C,l[0]=f[0],l[1]=f[1],l[2]=f[2])}return i[0]=u,o[0]=l[0],o[1]=l[1],o[2]=l[2],g},t.evaluateLocation=(r,a,s,i)=>{const o=[[0,1,2],[1,0,2]],c=r%2,u=e.pointsIds.length;for(let v=0;v<u;v++)i[v]=0;const g=1-a[0]-a[1];i[r]=g,i[r+1]=a[0],i[r+2]=a[1];const f=[];e.points.getPoint(r+o[c][0],f);const l=[];e.points.getPoint(r+o[c][1],l);const h=[];e.points.getPoint(r+o[c][2],h);for(let v=0;v<3;v++)s[v]=f[v]*i[r]+l[v]*i[r+1]+h[v]*i[r+2]},t.cellBoundary=(r,a,s)=>{const i=[[0,1,2],[1,0,2]],o=r%2,c=e.triangle.getPointsIds();return c[0]=e.pointsIds[i[o][0]],c[1]=e.pointsIds[i[o][1]],c[2]=e.pointsIds[i[o][2]],e.triangle.cellBoundary(0,a,s)},t.getEdge=r=>{let a,s;const i=e.pointsIds.length;return r===0?(a=0,s=1):r===i-1?(a=r-1,s=r):(a=r-1,s=r+1),e.line.getPointsIds()[0]=e.pointsIds[a],e.line.getPointsIds()[1]=e.pointsIds[s],e.line.getPoints().setPoint(0,e.points.getPoint(a)),e.line.getPoints().setPoint(1,e.points.getPoint(s)),e.line},t.intersectWithLine=(r,a,s,i,o)=>{const c=e.pointsIds.length-2,u=e.triangle.getPoints();u.setNumberOfPoints(3);for(let g=0;g<c;g++){const f=[];e.points.getPoint(e.pointsIds[g],f);const l=[];e.points.getPoint(e.pointsIds[g+1],l);const h=[];e.points.getPoint(e.pointsIds[g+2],h),u.setData(Float32Array.from([...f,...l,...h]),3);const v=e.triangle.intersectWithLine(r,a,s,i,o);if(v.intersect)return v}return!1},t.triangulate=()=>{const r=e.points.getNumberOfPoints()-2;e.tris=new Array(3*r);const a=[[0,1,2],[1,0,2]];for(let s=0;s<r;s++){const i=s%2;for(let o=0;o<3;o++)e.tris[s*3+o]=s+a[i][o]}return!0},t.getPointArray=()=>e.tris,t.derivatives=(r,a,s,i,o)=>{const c=[];e.points.getPoint(r,c);const u=[];e.points.getPoint(r+1,u);const g=[];e.points.getPoint(r+2,g);const f=e.triangle.getPoints();f.setPoint(0,...c),f.setPoint(1,...u),f.setPoint(2,...g),e.triangle.derivatives(0,a,s,i,o)},t.getParametricCenter=r=>(r[0]=.333333,r[1]=.333333,r[2]=0,Math.floor((e.pointsIds.length-2)/2)),t.contour=(r,a,s,i,o,c,u,g,f,l,h)=>vo("contour")(),t.clip=(r,a,s,i,o,c,u,g,f,l)=>vo("clip")()}const ux={line:null,triangle:null,tris:null};function ag(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ux,n),sn.extend(t,e,n),e.line||(e.line=Re.newInstance()),e.triangle||(e.triangle=Ta.newInstance()),fx(t,e)}const gx=E.newInstance(ag,"vtkTriangleStrip");var lx={newInstance:gx,extend:ag,...cx};const gn=["verts","lines","polys","strips"],{vtkWarningMacro:To}=E,px={[Q.VTK_LINE]:Re,[Q.VTK_QUAD]:ng,[Q.VTK_POLY_LINE]:Re,[Q.VTK_TRIANGLE]:Ta,[Q.VTK_TRIANGLE_STRIP]:lx,[Q.VTK_POLY_LINE]:Qu,[Q.VTK_POLYGON]:qd};function hx(t,e){e.classHierarchy.push("vtkPolyData");function n(i){return i.replace(/(?:^\w|[A-Z]|\b\w)/g,o=>o.toUpperCase()).replace(/\s+/g,"")}gn.forEach(i=>{t[`getNumberOf${n(i)}`]=()=>e[i].getNumberOfCells(),e[i]?e[i]=et(e[i]):e[i]=lo.newInstance()}),t.getNumberOfCells=()=>gn.reduce((i,o)=>i+e[o].getNumberOfCells(),0);const r=t.shallowCopy;t.shallowCopy=function(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(i,o),gn.forEach(c=>{e[c]=lo.newInstance(),e[c].shallowCopy(i.getReferenceByName(c))})};const a=t.getMTime;t.getMTime=()=>gn.reduce((i,o)=>{var c;return Math.max(i,((c=e[o])==null?void 0:c.getMTime())??i)},a());const s=t.initialize;t.initialize=()=>(gn.forEach(i=>{var o;return(o=e[i])==null?void 0:o.initialize()}),s()),t.buildCells=()=>{const i=t.getNumberOfVerts(),o=t.getNumberOfLines(),c=t.getNumberOfPolys(),u=t.getNumberOfStrips(),g=i+o+c+u,f=new Uint8Array(g);let l=f;const h=new Uint32Array(g);let v=h;if(i){let p=0;e.verts.getCellSizes().forEach((y,T)=>{v[T]=p,l[T]=y>1?Q.VTK_POLY_VERTEX:Q.VTK_VERTEX,p+=y+1}),v=v.subarray(i),l=l.subarray(i)}if(o){let p=0;e.lines.getCellSizes().forEach((y,T)=>{v[T]=p,l[T]=y>2?Q.VTK_POLY_LINE:Q.VTK_LINE,y===1&&To("Building VTK_LINE ",T," with only one point, but VTK_LINE needs at least two points. Check the input."),p+=y+1}),v=v.subarray(o),l=l.subarray(o)}if(c){let p=0;e.polys.getCellSizes().forEach((y,T)=>{switch(v[T]=p,y){case 3:l[T]=Q.VTK_TRIANGLE;break;case 4:l[T]=Q.VTK_QUAD;break;default:l[T]=Q.VTK_POLYGON;break}y<3&&To("Building VTK_TRIANGLE ",T," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),p+=y+1}),v+=v.subarray(c),l+=l.subarray(c)}if(u){let p=0;l.fill(Q.VTK_TRIANGLE_STRIP,0,u),e.strips.getCellSizes().forEach((y,T)=>{v[T]=p,p+=y+1})}e.cells=ps.newInstance(),e.cells.setCellTypes(g,f,h)},t.buildLinks=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=xd.newInstance(),i>0?e.links.allocate(i):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=i=>e.cells.getCellType(i),t.getCellPoints=i=>{const o=t.getCellType(i);let c=null;switch(o){case Q.VTK_VERTEX:case Q.VTK_POLY_VERTEX:c=e.verts;break;case Q.VTK_LINE:case Q.VTK_POLY_LINE:c=e.lines;break;case Q.VTK_TRIANGLE:case Q.VTK_QUAD:case Q.VTK_POLYGON:c=e.polys;break;case Q.VTK_TRIANGLE_STRIP:c=e.strips;break;default:return c=null,{type:0,cellPointIds:null}}const u=e.cells.getCellLocation(i),g=c.getCell(u);return{cellType:o,cellPointIds:g}},t.getPointCells=i=>e.links.getCells(i),t.getCellEdgeNeighbors=(i,o,c)=>{const u=e.links.getLink(o),g=e.links.getLink(c);return u.cells.filter(f=>f!==i&&g.cells.indexOf(f)!==-1)},t.getCell=function(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const c=t.getCellPoints(i),u=o||px[c.cellType].newInstance();return u.initialize(t.getPoints(),c.cellPointIds),u},t.getMaxCellSize=()=>gn.reduce((i,o)=>{var c,u;return Math.max(i,((u=(c=e[o])==null?void 0:c.getMaxCellSize)==null?void 0:u.call(c))??0)},0)}const yx={};function sg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yx,n),Nd.extend(t,e,n),E.get(t,e,["cells","links"]),E.setGet(t,e,["verts","lines","polys","strips"]),hx(t,e)}const vx=E.newInstance(sg,"vtkPolyData");var St={newInstance:vx,extend:sg};function Tx(t,e){e.classHierarchy.push("vtkTexture"),t.imageLoaded=()=>{e.image.removeEventListener("load",t.imageLoaded),e.imageLoaded=!0,t.modified()},t.setJsImageData=n=>{e.jsImageData!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null,e.imageBitmap=null),e.jsImageData=n,e.imageLoaded=!0,t.modified())},t.setImageBitmap=n=>{e.imageBitmap!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null,e.jsImageData=null),e.imageBitmap=n,e.imageLoaded=!0,t.modified())},t.setCanvas=n=>{e.canvas!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.imageBitmap=null,e.jsImageData=null),e.canvas=n,t.modified())},t.setImage=n=>{e.image!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.canvas=null,e.jsImageData=null,e.imageBitmap=null),e.image=n,e.imageLoaded=!1,n.complete?t.imageLoaded():n.addEventListener("load",t.imageLoaded),t.modified())},t.getDimensionality=()=>{let n=0,r=0,a=1;if(t.getInputData()){const i=t.getInputData();n=i.getDimensions()[0],r=i.getDimensions()[1],a=i.getDimensions()[2]}return e.jsImageData&&(n=e.jsImageData.width,r=e.jsImageData.height),e.canvas&&(n=e.canvas.width,r=e.canvas.height),e.image&&(n=e.image.width,r=e.image.height),e.imageBitmap&&(n=e.imageBitmap.width,r=e.imageBitmap.height),(n>1)+(r>1)+(a>1)},t.getInputAsJsImageData=()=>{if(!e.imageLoaded||t.getInputData())return null;if(e.jsImageData)return e.jsImageData;if(e.imageBitmap)return e.imageBitmap;if(e.canvas)return e.canvas.getContext("2d").getImageData(0,0,e.canvas.width,e.canvas.height);if(e.image){const n=e.image.width,r=e.image.height,s=new OffscreenCanvas(n,r).getContext("2d");return s.translate(0,r),s.scale(1,-1),s.drawImage(e.image,0,0,n,r),s.getImageData(0,0,n,r)}return null}}const dx=(t,e,n)=>{const a=t.createShaderModule({code:`
    @group(0) @binding(0) var inputTexture: texture_2d<f32>;
    @group(0) @binding(1) var outputTexture: texture_storage_2d<rgba8unorm, write>;

    @compute @workgroup_size(8, 8)
    fn main(@builtin(global_invocation_id) global_id: vec3<u32>) {
      let texelCoord = vec2<i32>(global_id.xy);
      let outputSize = textureDimensions(outputTexture);

      if (texelCoord.x >= i32(outputSize.x) || texelCoord.y >= i32(outputSize.y)) {
        return;
      }

      let inputSize = textureDimensions(inputTexture);
      let scale = vec2<f32>(inputSize) / vec2<f32>(outputSize);

      // Compute the floating-point source coordinate
      let srcCoord = (vec2<f32>(texelCoord) + 0.5) * scale - 0.5;

      // Get integer coordinates for the four surrounding texels
      let x0 = i32(floor(srcCoord.x));
      let x1 = min(x0 + 1, i32(inputSize.x) - 1);
      let y0 = i32(floor(srcCoord.y));
      let y1 = min(y0 + 1, i32(inputSize.y) - 1);

      // Compute the weights
      let wx = srcCoord.x - f32(x0);
      let wy = srcCoord.y - f32(y0);

      // Fetch the four texels
      let c00 = textureLoad(inputTexture, vec2<i32>(x0, y0), 0);
      let c10 = textureLoad(inputTexture, vec2<i32>(x1, y0), 0);
      let c01 = textureLoad(inputTexture, vec2<i32>(x0, y1), 0);
      let c11 = textureLoad(inputTexture, vec2<i32>(x1, y1), 0);

      // Bilinear interpolation
      let color = mix(
        mix(c00, c10, wx),
        mix(c01, c11, wx),
        wy
      );

      textureStore(outputTexture, texelCoord, color);
    }
  `}),s=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.COMPUTE,storageTexture:{format:"rgba8unorm",access:"write-only"}},{binding:2,visibility:GPUShaderStage.COMPUTE,sampler:{type:"filtering"}}]}),i=t.createPipelineLayout({bindGroupLayouts:[s]}),o=t.createComputePipeline({label:"ComputeMipmapPipeline",layout:i,compute:{module:a,entryPoint:"main"}}),c=t.createSampler({magFilter:"linear",minFilter:"linear"});for(let u=1;u<n;u++){const g=e.createView({baseMipLevel:u-1,mipLevelCount:1}),f=e.createView({baseMipLevel:u,mipLevelCount:1}),l=t.createBindGroup({layout:o.getBindGroupLayout(0),entries:[{binding:0,resource:g},{binding:1,resource:f},{binding:2,resource:c}]}),h=t.createCommandEncoder({label:"MipmapGenerateCommandEncoder"}),v=h.beginComputePass();v.setPipeline(o),v.setBindGroup(0,l);const p=Math.max(1,e.width>>u),y=Math.max(1,e.height>>u),T=Math.ceil(p/8),S=Math.ceil(y/8);v.dispatchWorkgroups(T,S),v.end(),t.queue.submit([h.finish()])}},xx={image:null,canvas:null,jsImageData:null,imageBitmap:null,imageLoaded:!1,repeat:!1,interpolate:!1,edgeClamp:!1,mipLevel:0,resizable:!1};function ig(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xx,n),E.obj(t,e),E.algo(t,e,6,0),E.get(t,e,["canvas","image","jsImageData","imageBitmap","imageLoaded","resizable"]),E.setGet(t,e,["repeat","edgeClamp","interpolate","mipLevel"]),Tx(t,e)}const Sx=E.newInstance(ig,"vtkTexture"),Cx={generateMipmaps:dx};var tr={newInstance:Sx,extend:ig,...Cx};const wx=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],xo=[[8,7,11,3],[9,1,10,5],[4,9,0,8],[2,11,6,10],[0,3,2,1],[4,5,6,7]],Sr=[[0,1],[1,3],[2,3],[0,2],[4,5],[5,7],[6,7],[4,6],[0,4],[1,5],[3,7],[2,6]],So=[0,1,0,1,0,1,0,1,2,2,2,2],se=[[1,2],[1,2],[0,2],[0,2],[0,1],[0,1]],A=new Float64Array(3),Cr=new Float64Array(3),J=new Float64Array(3),Qt=new Float64Array(3),Wt=new Float64Array(3),wr=new Float64Array(3),La=new Float64Array(16);function Va(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function og(t){const e=[],n=[];for(let r=0;r<3;r++){const a=Gs().domain([t[r*2],t[r*2+1]]);e[r]=a.ticks(5);const s=a.tickFormat(5);n[r]=e[r].map(s)}return{ticks:e,tickStrings:n}}function Ex(t,e){e.classHierarchy.push("vtkCubeAxesActorHelper"),t.setRenderable=n=>{e.renderable!==n&&(e.renderable=n,e.tmActor.addTexture(e.renderable.getTmTexture()),e.tmActor.setProperty(n.getProperty()),e.tmActor.setParentProp(n),t.modified())},t.createPolyDataForOneLabel=(n,r,a,s,i,o,c)=>{const u=e.renderable.get_tmAtlas().get(n);if(!u)return;const g=e.renderable.getTextPolyData().getPoints().getData(),f=e.lastSize;A[0]=g[r*3],A[1]=g[r*3+1],A[2]=g[r*3+2],q(J,A,a),J[0]+=.1,q(Cr,J,s),vt(Wt,Cr,A),J[0]-=.1,J[1]+=.1,q(Cr,J,s),vt(wr,Cr,A);for(let v=0;v<3;v++)Wt[v]/=.5*.1*f[0],wr[v]/=.5*.1*f[1];let l=c.ptIdx,h=c.cellIdx;A[0]=g[r*3],A[1]=g[r*3+1],A[2]=g[r*3+2],i[0]<-.5?at(J,Wt,i[0]*o-u.width):i[0]>.5?at(J,Wt,i[0]*o):at(J,Wt,i[0]*o-u.width/2),Gn(A,A,J),at(J,wr,i[1]*o-u.height/2),Gn(A,A,J),c.points[l*3]=A[0],c.points[l*3+1]=A[1],c.points[l*3+2]=A[2],c.tcoords[l*2]=u.tcoords[0],c.tcoords[l*2+1]=u.tcoords[1],l++,at(J,Wt,u.width),Gn(A,A,J),c.points[l*3]=A[0],c.points[l*3+1]=A[1],c.points[l*3+2]=A[2],c.tcoords[l*2]=u.tcoords[2],c.tcoords[l*2+1]=u.tcoords[3],l++,at(J,wr,u.height),Gn(A,A,J),c.points[l*3]=A[0],c.points[l*3+1]=A[1],c.points[l*3+2]=A[2],c.tcoords[l*2]=u.tcoords[4],c.tcoords[l*2+1]=u.tcoords[5],l++,at(J,Wt,u.width),vt(A,A,J),c.points[l*3]=A[0],c.points[l*3+1]=A[1],c.points[l*3+2]=A[2],c.tcoords[l*2]=u.tcoords[6],c.tcoords[l*2+1]=u.tcoords[7],l++,c.polys[h*4]=3,c.polys[h*4+1]=l-4,c.polys[h*4+2]=l-3,c.polys[h*4+3]=l-2,h++,c.polys[h*4]=3,c.polys[h*4+1]=l-4,c.polys[h*4+2]=l-2,c.polys[h*4+3]=l-1,c.ptIdx+=4,c.cellIdx+=2},t.updateTexturePolyData=()=>{const n=e.camera.getCompositeProjectionMatrix(e.lastAspectRatio,-1,1);ne(n,n);const r=e.renderable.getTextValues().length,a=r*4,s=r*2,i=new Float64Array(a*3),o=new Uint16Array(s*4),c=new Float32Array(a*2);Ve(La,n);const u={ptIdx:0,cellIdx:0,polys:o,points:i,tcoords:c};let g=0,f=0,l=0;const h=e.renderable.getTextPolyData().getPoints().getData(),v=e.renderable.getTextValues();for(;g<h.length/3;){A[0]=h[g*3],A[1]=h[g*3+1],A[2]=h[g*3+2],q(J,A,n),A[0]=h[g*3+3],A[1]=h[g*3+4],A[2]=h[g*3+5],q(Qt,A,n),vt(J,J,Qt);const y=[J[0],J[1]];Cf(y),t.createPolyDataForOneLabel(v[f],g,n,La,y,e.renderable.getAxisTitlePixelOffset(),u),g+=2,f++;for(let T=0;T<e.renderable.getTickCounts()[l];T++)t.createPolyDataForOneLabel(v[f],g,n,La,y,e.renderable.getTickLabelPixelOffset(),u),g++,f++;l++}const p=ee.newInstance({numberOfComponents:2,values:c,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(p),e.tmPolyData.getPoints().setData(i,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(o,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updateAPISpecificData=(n,r,a)=>{(e.lastSize[0]!==n[0]||e.lastSize[1]!==n[1])&&(e.lastSize[0]=n[0],e.lastSize[1]=n[1],e.lastAspectRatio=n[0]/n[1],e.forceUpdate=!0),e.camera=r,t.updateTexturePolyData()}}const Mx=E.newInstance(function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},n),E.obj(t,e),e.tmPolyData=St.newInstance(),e.tmMapper=an.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmActor=rn.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),E.setGet(t,e,["renderable"]),E.get(t,e,["lastSize","lastAspectRatio","axisTextStyle","tickTextStyle","tmActor","ticks"]),e.forceUpdate=!1,e.lastRedrawTime={},E.obj(e.lastRedrawTime,{mtime:0}),e.lastRebuildTime={},E.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.lastTickBounds=[],Ex(t,e)},"vtkCubeAxesActorHelper");function Rx(t,e){e.classHierarchy.push("vtkCubeAxesActor"),t.setCamera=r=>{e.camera!==r&&(e.cameraModifiedSub&&(e.cameraModifiedSub.unsubscribe(),e.cameraModifiedSub=null),e.camera=r,r&&(e.cameraModifiedSub=r.onModified(t.update)),t.update(),t.modified())},t.computeFacesToDraw=()=>{const r=e.camera.getViewMatrix();ne(r,r);let a=!1;const s=j.getDiagonalLength(e.dataBounds),i=Math.sin(e.faceVisibilityAngle*Math.PI/180);for(let o=0;o<6;o++){let c=!1;const u=Math.floor(o/2),g=(u+1)%3,f=(u+2)%3;e.dataBounds[g*2]!==e.dataBounds[g*2+1]&&e.dataBounds[f*2]!==e.dataBounds[f*2+1]&&(A[u]=e.dataBounds[o]-.1*s*wx[o][u],A[g]=.5*(e.dataBounds[g*2]+e.dataBounds[g*2+1]),A[f]=.5*(e.dataBounds[f*2]+e.dataBounds[f*2+1]),q(J,A,r),A[u]=e.dataBounds[o],q(Qt,A,r),vt(J,Qt,J),mt(J,J),c=J[2]>i,e.camera.getParallelProjection()||(mt(Qt,Qt),c=Ms(Qt,J)>i)),c!==e.lastFacesToDraw[o]&&(e.lastFacesToDraw[o]=c,a=!0)}return a},t.updatePolyData=(r,a,s)=>{let i=0,o=0;i+=8;let c=0;for(let h=0;h<12;h++)a[h]>0&&c++;if(o+=c,e.gridLines)for(let h=0;h<6;h++)r[h]&&(i+=s[se[h][0]].length*2+s[se[h][1]].length*2,o+=s[se[h][0]].length+s[se[h][1]].length);const u=new Float64Array(i*3),g=new Uint32Array(o*3);let f=0,l=0;for(let h=0;h<2;h++)for(let v=0;v<2;v++)for(let p=0;p<2;p++)u[f*3]=e.dataBounds[p],u[f*3+1]=e.dataBounds[2+v],u[f*3+2]=e.dataBounds[4+h],f++;for(let h=0;h<12;h++)a[h]>0&&(g[l*3]=2,g[l*3+1]=Sr[h][0],g[l*3+2]=Sr[h][1],l++);if(e.gridLines){for(let h=0;h<6;h++)if(r[h]){const v=Math.floor(h/2);let p=s[se[h][0]];for(let y=0;y<p.length;y++)u[f*3+v]=e.dataBounds[h],u[f*3+se[h][0]]=p[y],u[f*3+se[h][1]]=e.dataBounds[se[h][1]*2],f++,u[f*3+v]=e.dataBounds[h],u[f*3+se[h][0]]=p[y],u[f*3+se[h][1]]=e.dataBounds[se[h][1]*2+1],f++,g[l*3]=2,g[l*3+1]=f-2,g[l*3+2]=f-1,l++;p=s[se[h][1]];for(let y=0;y<p.length;y++)u[f*3+v]=e.dataBounds[h],u[f*3+se[h][1]]=p[y],u[f*3+se[h][0]]=e.dataBounds[se[h][0]*2],f++,u[f*3+v]=e.dataBounds[h],u[f*3+se[h][1]]=p[y],u[f*3+se[h][0]]=e.dataBounds[se[h][0]*2+1],f++,g[l*3]=2,g[l*3+1]=f-2,g[l*3+2]=f-1,l++}}e.polyData.getPoints().setData(u,3),e.polyData.getPoints().modified(),e.polyData.getLines().setData(g,1),e.polyData.getLines().modified(),e.polyData.modified()},t.updateTextData=(r,a,s,i)=>{let o=0;for(let h=0;h<12;h++)a[h]===1&&(o+=2,o+=s[So[h]].length);const c=e.polyData.getPoints().getData(),u=new Float64Array(o*3);let g=0,f=0,l=0;for(let h=0;h<6;h++)if(r[h])for(let v=0;v<4;v++){const p=xo[h][v];if(a[p]===1){const y=So[p],T=Sr[p][0]*3,S=Sr[p][1]*3;u[g*3]=.5*(c[T]+c[S]),u[g*3+1]=.5*(c[T+1]+c[S+1]),u[g*3+2]=.5*(c[T+2]+c[S+2]),g++;const d=Math.floor(h/2);u[g*3+d]=e.dataBounds[h],u[g*3+se[h][0]]=.5*(e.dataBounds[se[h][0]*2]+e.dataBounds[se[h][0]*2+1]),u[g*3+se[h][1]]=.5*(e.dataBounds[se[h][1]*2]+e.dataBounds[se[h][1]*2+1]),g++,e.textValues[f]=e.axisLabels[y],f++;const x=(y+1)%3,w=(y+2)%3,C=s[y],M=i[y];e.tickCounts[l]=C.length;for(let R=0;R<C.length;R++)u[g*3+y]=C[R],u[g*3+x]=c[T+x],u[g*3+w]=c[T+w],g++,e.textValues[f]=M[R],f++;l++}}e.textPolyData.getPoints().setData(u,3),e.textPolyData.modified()},t.update=()=>{if(!e.camera)return;const r=t.computeFacesToDraw(),a=e.lastFacesToDraw;let s=!1;for(let i=0;i<6;i++)e.dataBounds[i]!==e.lastTickBounds[i]&&(s=!0,e.lastTickBounds[i]=e.dataBounds[i]);if(r||s||e.forceUpdate){const i=new Array(12).fill(0);for(let c=0;c<6;c++)if(a[c])for(let u=0;u<4;u++)i[xo[c][u]]++;const o=e.generateTicks(e.dataBounds);t.updatePolyData(a,i,o.ticks),t.updateTextData(a,i,o.ticks,o.tickStrings),(s||e.forceUpdate)&&t.updateTextureAtlas(o.tickStrings)}e.forceUpdate=!1},t.updateTextureAtlas=r=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e._tmAtlas.clear();let a=0,s=1;for(let i=0;i<3;i++){if(!e._tmAtlas.has(e.axisLabels[i])){Va(e.tmContext,e.axisTextStyle);const o=e.tmContext.measureText(e.axisLabels[i]),c={height:o.actualBoundingBoxAscent+2,startingHeight:s,width:o.width+2,textStyle:e.axisTextStyle};e._tmAtlas.set(e.axisLabels[i],c),s+=c.height,a<c.width&&(a=c.width)}Va(e.tmContext,e.tickTextStyle);for(let o=0;o<r[i].length;o++)if(!e._tmAtlas.has(r[i][o])){const c=e.tmContext.measureText(r[i][o]),u={height:c.actualBoundingBoxAscent+2,startingHeight:s,width:c.width+2,textStyle:e.tickTextStyle};e._tmAtlas.set(r[i][o],u),s+=u.height,a<u.width&&(a=u.width)}}a=Ke(a),s=Ke(s),e._tmAtlas.forEach(i=>{i.tcoords=[0,(s-i.startingHeight-i.height)/s,i.width/a,(s-i.startingHeight-i.height)/s,i.width/a,(s-i.startingHeight)/s,0,(s-i.startingHeight)/s]}),e.tmCanvas.width=a,e.tmCanvas.height=s,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,a,s),e._tmAtlas.forEach((i,o)=>{Va(e.tmContext,i.textStyle),e.tmContext.fillText(o,1,i.startingHeight+i.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified()},t.onModified(()=>{e.forceUpdate=!0,t.update()}),t.setTickTextStyle=r=>{e.tickTextStyle={...e.tickTextStyle,...r},t.modified()},t.setAxisTextStyle=r=>{e.axisTextStyle={...e.axisTextStyle,...r},t.modified()},t.get_tmAtlas=()=>e._tmAtlas,t.getBounds=()=>(t.update(),j.setBounds(e.bounds,e.gridActor.getBounds()),j.scaleAboutCenter(e.bounds,e.boundsScaleFactor,e.boundsScaleFactor,e.boundsScaleFactor),e.bounds);const n=E.chain(t.setProperty,e.gridActor.setProperty);t.setProperty=r=>n(r)[0]}function Ox(t,e,n){return{boundsScaleFactor:1.3,camera:null,dataBounds:[...j.INIT_BOUNDS],faceVisibilityAngle:8,gridLines:!0,axisLabels:null,axisTitlePixelOffset:35,tickLabelPixelOffset:12,generateTicks:og,...n,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif",...n==null?void 0:n.axisTextStyle},tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif",...n==null?void 0:n.tickTextStyle}}}function cg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};rn.extend(t,e,Ox(t,e,n)),e.lastFacesToDraw=[!1,!1,!1,!1,!1,!1],e.axisLabels=["X-Axis","Y-Axis","Z-Axis"],e.tickCounts=[],e.textValues=[],e.lastTickBounds=[],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.tmTexture=tr.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),e.gridMapper=an.newInstance(),e.polyData=St.newInstance(),e.gridMapper.setInputData(e.polyData),e.gridActor=rn.newInstance(),e.gridActor.setMapper(e.gridMapper),e.gridActor.setProperty(t.getProperty()),e.gridActor.setParentProp(t),e.textPolyData=St.newInstance(),E.setGet(t,e,["axisTitlePixelOffset","boundsScaleFactor","faceVisibilityAngle","gridLines","tickLabelPixelOffset","generateTicks"]),E.setGetArray(t,e,["dataBounds"],6),E.setGetArray(t,e,["axisLabels"],3),E.get(t,e,["axisTextStyle","tickTextStyle","camera","tmTexture","textValues","textPolyData","tickCounts","gridActor"]),Rx(t,e)}const Dx=E.newInstance(cg,"vtkCubeAxesActor");var fg={newInstance:Dx,extend:cg,newCubeAxesActorHelper:Mx,defaultGenerateTicks:og};function Lx(t,e){e.classHierarchy.push("vtkOpenGLCubeAxesActor"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,s=e._openGLRenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e._openGLRenderWindow.getRenderable())}}}const Vx={};function Bx(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Vx,n),fe.extend(t,e,n),e.CubeAxesActorHelper=fg.newCubeAxesActorHelper(),Lx(t,e)}const Fx=re(Bx,"vtkOpenGLCubeAxesActor");Ie("vtkCubeAxesActor",Fx);const In={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var ug={ObjectType:In};const{ObjectType:jr}=ug,mx={};function kx(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function n(o){switch(o){case jr.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case jr.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case jr.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let r=null,a=null,s=!0,i="";t.getType=()=>r,t.setType=o=>{r=o},t.getHandle=()=>a,t.isReady=()=>s===!1,t.generateBuffer=o=>{const c=n(o);return a===null&&(a=e.context.createBuffer(),r=o),n(r)===c},t.upload=(o,c)=>t.generateBuffer(c)?(e.context.bindBuffer(n(r),a),e.context.bufferData(n(r),o,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=o.length*o.BYTES_PER_ELEMENT,s=!1,!0):(i="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>a?(e.context.bindBuffer(n(r),a),!0):!1,t.release=()=>a?(e.context.bindBuffer(n(r),null),!0):!1,t.releaseGraphicsResources=()=>{a!==null&&(e.context.bindBuffer(n(r),null),e.context.deleteBuffer(a),a=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=o=>{e._openGLRenderWindow!==o&&(t.releaseGraphicsResources(),e._openGLRenderWindow=o,e.context=null,o&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>i}const Ux={objectType:jr.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function gg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ux,n),E.obj(t,e),E.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),E.moveToProtected(t,e,["openGLRenderWindow"]),kx(t,e)}const Nx=E.newInstance(gg);var lg={newInstance:Nx,extend:gg,...mx,...ug};function _x(t){let e=0,n=0;for(let a=0;a<3;++a){const s=t.getRange(a),i=s[1]-s[0];e+=i*i;const o=.5*(s[1]+s[0]);n+=o*o}const r=e>0&&(Math.abs(n)/e>1e6||Math.abs(Math.log10(e))>3||e===0&&n>1e6);if(r){const a=new Float64Array(3),s=new Float64Array(3);for(let i=0;i<3;++i){const o=t.getRange(i),c=o[1]-o[0];a[i]=.5*(o[1]+o[0]),s[i]=c>0?1/c:1}return{useShiftAndScale:r,coordShift:a,coordScale:s}}return{useShiftAndScale:r,coordShift:new Float32Array([0,0,0]),coordScale:new Float32Array([1,1,1])}}const{vtkErrorMacro:Co}=E;function Gx(t,e){const n=new Float64Array(3);ip(n,e);const r=new Float64Array(16);return uc(r,tn(),t,n),r}function bx(t,e){return t===null||e===null?!1:!(xi(t,[0,0,0])&&xi(e,[1,1,1]))}function $x(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(In.ARRAY_BUFFER),t.createVBO=function(n,r,a,s){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!n.getData()||!n.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];const o=s.points.getData();let c=null,u=null,g=null;const f=s.colors?s.colors.getNumberOfComponents():0,l=s.tcoords?s.tcoords.getNumberOfComponents():0;s.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=s.normals.getData()),s.customAttributes&&s.customAttributes.forEach(k=>{k&&(e.customData.push({data:k.getData(),offset:4*e.blockSize,components:k.getNumberOfComponents(),name:k.getName()}),e.blockSize+=k.getNumberOfComponents())}),s.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=l,e.blockSize+=l,u=s.tcoords.getData()),s.colors?(e.colorComponents=s.colors.getNumberOfComponents(),e.colorOffset=0,g=s.colors.getData(),e.colorBO||(e.colorBO=lg.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let h=0,v=0,p=0,y=0,T=0,S=0,d;const x={anythingToPoints(k,_,b,z){for(let $=0;$<k;++$)d(_[b+$],z)},linesToWireframe(k,_,b,z){for(let $=0;$<k-1;++$)d(_[b+$],z),d(_[b+$+1],z)},polysToWireframe(k,_,b,z){if(k>2)for(let $=0;$<k;++$)d(_[b+$],z),d(_[b+($+1)%k],z)},stripsToWireframe(k,_,b,z){if(k>2){for(let $=0;$<k-1;++$)d(_[b+$],z),d(_[b+$+1],z);for(let $=0;$<k-2;$++)d(_[b+$],z),d(_[b+$+2],z)}},polysToSurface(k,_,b,z){for(let $=0;$<k-2;$++)d(_[b+0],z),d(_[b+$+1],z),d(_[b+$+2],z)},stripsToSurface(k,_,b,z){for(let $=0;$<k-2;$++)d(_[b+$],z),d(_[b+$+1+$%2],z),d(_[b+$+1+($+1)%2],z)}},w={anythingToPoints(k,_){return k},linesToWireframe(k,_){return k>1?(k-1)*2:0},polysToWireframe(k,_){return k>2?k*2:0},stripsToWireframe(k,_){return k>2?k*4-6:0},polysToSurface(k,_){return k>2?(k-2)*3:0},stripsToSurface(k,_,b){return k>2?(k-2)*3:0}};let C=null,M=null;a===Xe.POINTS||r==="verts"?(C=x.anythingToPoints,M=w.anythingToPoints):a===Xe.WIREFRAME||r==="lines"?(C=x[`${r}ToWireframe`],M=w[`${r}ToWireframe`]):(C=x[`${r}ToSurface`],M=w[`${r}ToSurface`]);const R=n.getData(),V=R.length;let O=0;for(let k=0;k<V;)O+=M(R[k],R),k+=R[k]+1;let D=null;const B=new Float32Array(O*e.blockSize);g&&(D=new Uint8Array(O*4));let L=0,F=0;const{useShiftAndScale:U,coordShift:N,coordScale:G}=_x(s.points);if(U?t.setCoordShiftAndScale(N,G):e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null),i)if(!i.points&&!i.cells)i.points=new Int32Array(O),i.cells=new Int32Array(O);else{const k=new Int32Array(O+i.points.length);k.set(i.points),i.points=k;const _=new Int32Array(O+i.cells.length);_.set(i.cells),i.cells=_}let H=s.vertexOffset;d=function(_,b){if(i&&(i.points[H]=_,i.cells[H]=S+s.cellOffset),++H,h=_*3,e.coordShiftAndScaleEnabled?(B[L++]=(o[h++]-e.coordShift[0])*e.coordScale[0],B[L++]=(o[h++]-e.coordShift[1])*e.coordScale[1],B[L++]=(o[h++]-e.coordShift[2])*e.coordScale[2]):(B[L++]=o[h++],B[L++]=o[h++],B[L++]=o[h++]),c!==null&&(s.haveCellNormals?v=(S+s.cellOffset)*3:v=_*3,B[L++]=c[v++],B[L++]=c[v++],B[L++]=c[v++]),e.customData.forEach(z=>{T=_*z.components;for(let $=0;$<z.components;++$)B[L++]=z.data[T++]}),u!==null){s.useTCoordsPerCell?p=b*l:p=_*l;for(let z=0;z<l;++z)B[L++]=u[p++]}g!==null&&(s.haveCellScalars?y=(S+s.cellOffset)*f:y=_*f,D[F++]=g[y++],D[F++]=g[y++],D[F++]=g[y++],D[F++]=f===4?g[y++]:255)};for(let k=0;k<V;k+=R[k]+1,S++)C(R[k],R,k+1,S+s.cellOffset);return e.elementCount=O,t.upload(B,In.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(D,In.ARRAY_BUFFER)),S},t.setCoordShiftAndScale=(n,r)=>{if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){Co("Wrong type for coordShift, expected vec3 or null");return}if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){Co("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||n===null||!Si(n,e.coordShift))&&(e.coordShift=n),(e.coordScale===null||r===null||!Si(r,e.coordScale))&&(e.coordScale=r),e.coordShiftAndScaleEnabled=bx(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=Gx(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}const zx={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function pg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zx,n),lg.extend(t,e,n),E.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),E.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),$x(t,e)}const Wx=E.newInstance(pg);var Hx={newInstance:Wx,extend:pg};const{vtkErrorMacro:Ax}=E;function jx(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let n=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":n=e.context.FRAGMENT_SHADER;break;case"Vertex":default:n=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(n),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){const a=e.context.getShaderInfoLog(e.handle);return Ax(`Error compiling shader '${e.source}': ${a}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}const Kx={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function hg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Kx,n),E.obj(t,e),E.setGet(t,e,["shaderType","source","error","handle","context"]),jx(t,e)}const Px=E.newInstance(hg,"vtkShader");var Ba={newInstance:Px,extend:hg};const{vtkErrorMacro:tt}=E;function Xx(t,e,n,r){const a=typeof n=="string"?n:n.join(`
`),s=r===!1?e:new RegExp(e,"g"),i=t.replace(s,a);return{replace:i!==a,result:i}}function Ix(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(tt(e.error),0):t.link()?(t.setCompiled(!0),1):(tt(`Links failed: ${e.error}`),0):(tt(e.fragmentShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),tt(e.fragmentShader.getError()),0):(tt(e.vertexShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),tt(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=n=>{e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){const r=e.context.getProgramInfoLog(e.handle);return tt(`Error linking shader ${r}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(n,r)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const s=new Float32Array(r);return e.context.uniformMatrix4fv(a,!1,s),!0},t.setUniformMatrix3x3=(n,r)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const s=new Float32Array(r);return e.context.uniformMatrix3fv(a,!1,s),!0},t.setUniformf=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1f(a,r),!0)},t.setUniformfv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1fv(a,r),!0)},t.setUniformi=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1i(a,r),!0)},t.setUniformiv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1iv(a,r),!0)},t.setUniform2f=(n,r,a)=>{const s=t.findUniform(n);if(s===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(s,r,a),!0},t.setUniform2fv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2fv(a,r),!0)},t.setUniform2i=(n,r,a)=>{const s=t.findUniform(n);if(s===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(s,r,a),!0},t.setUniform2iv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2iv(a,r),!0)},t.setUniform3f=(n,r,a,s)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(s===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(i,r,a,s),!0},t.setUniform3fArray=(n,r)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(!Array.isArray(r)||r.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(a,r[0],r[1],r[2]),!0},t.setUniform3fv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3fv(a,r),!0)},t.setUniform3i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];let o=s;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(r,o[0],o[1],o[2]),!0},t.setUniform3iv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3iv(a,r),!0)},t.setUniform4f=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];let o=s;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(r,o[0],o[1],o[2],o[3]),!0},t.setUniform4fv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4fv(a,r),!0)},t.setUniform4i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];let o=s;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(r,o[0],o[1],o[2],o[3]),!0},t.setUniform4iv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4iv(a,r),!0)},t.findUniform=n=>{if(!n||!e.linked)return-1;let r=e.uniformLocs[n];return r!==void 0?r:(r=e.context.getUniformLocation(e.handle,n),r===null?(e.error=`Uniform ${n} not found in current shader program.`,e.uniformLocs[n]=-1,-1):(e.uniformLocs[n]=r,r))},t.isUniformUsed=n=>{if(!n)return!1;let r=e.uniformLocs[n];return r!==void 0?r!==null:e.linked?(r=e.context.getUniformLocation(e.handle,n),e.uniformLocs[n]=r,r!==null):(tt("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=n=>{if(!n)return!1;if(n in e.attributeLocs)return!0;if(!e.linked)return tt("attempt to find uniform when the shader program is not linked"),!1;const r=e.context.getAttribLocation(e.handle,n);return r===-1?!1:(e.attributeLocs[n]=r,!0)},t.attachShader=n=>{if(n.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){const r=e.context.createProgram();if(r===0)return e.error="Could not create shader program.",!1;e.handle=r,e.linked=!1}return n.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=n.getHandle()),n.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=n.getHandle()),e.context.attachShader(e.handle,n.getHandle()),t.setLinked(!1),!0},t.detachShader=n=>{if(n.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),n.getShaderType()){case"Vertex":return e.vertexShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=n=>{e.context=n,e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.setLastCameraMTime=n=>{e.lastCameraMTime=n}}const Yx={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function yg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Yx,n),e.attributesLocs={},e.uniformLocs={},e.vertexShader=Ba.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=Ba.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=Ba.newInstance(),e.geometryShader.setShaderType("Geometry"),E.obj(t,e),E.get(t,e,["lastCameraMTime"]),E.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),Ix(t,e)}const Qx=E.newInstance(yg,"vtkShaderProgram");var m={newInstance:Qx,extend:yg,substitute:Xx};function Zx(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const a=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,a.buffer);for(let s=0;s<a.attributes.length;++s){const i=a.attributes[s],o=i.isMatrix?i.size:1;for(let c=0;c<o;++c)n.enableVertexAttribArray(i.index+c),n.vertexAttribPointer(i.index+c,i.size,i.type,i.normalize,i.stride,i.offset+i.stride*c/i.size),i.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(i.index+c,1):n.vertexAttribDivisor(i.index+c,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const a=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,a.buffer);for(let s=0;s<a.attributes.length;++s){const i=a.attributes[s],o=i.isMatrix?i.size:1;for(let c=0;c<o;++c)n.enableVertexAttribArray(i.index+c),n.vertexAttribPointer(i.index+c,i.size,i.type,i.normalize,i.stride,i.offset+i.stride*c/i.size),i.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(i.index+c,0):n.vertexAttribDivisor(i.index+c,0)),n.disableVertexAttribArray(i.index+c)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(n,r,a,s,i,o,c,u)=>t.addAttributeArrayWithDivisor(n,r,a,s,i,o,c,u,0,!1),t.addAttributeArrayWithDivisor=(n,r,a,s,i,o,c,u,g,f)=>{if(!n||!n.isBound()||r.getHandle()===0||r.getType()!==In.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=n.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==n.getHandle()))return!1;const l=e.context,h={};if(h.name=a,h.index=l.getAttribLocation(e.handleProgram,a),h.offset=s,h.stride=i,h.type=o,h.size=c,h.normalize=u,h.isMatrix=f,h.divisor=g,h.Index===-1)return!1;if(r.bind(),l.enableVertexAttribArray(h.index),l.vertexAttribPointer(h.index,h.size,h.type,h.normalize,h.stride,h.offset),g>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(h.index,1):l.vertexAttribDivisor(h.index,1)),h.buffer=r.getHandle(),!e.supported){let v=!1;for(let p=0;p<e.buffers.length;++p){const y=e.buffers[p];if(y.buffer===h.buffer){v=!0;let T=!1;for(let S=0;S<y.attributes.length;++S)y.attributes[S].name===a&&(T=!0,y.attributes[S]=h);T||y.attributes.push(h)}}v||e.buffers.push({buffer:h.buffer,attributes:[h]})}return!0},t.addAttributeMatrixWithDivisor=(n,r,a,s,i,o,c,u,g)=>{const f=t.addAttributeArrayWithDivisor(n,r,a,s,i,o,c,u,g,!0);if(!f)return f;const l=e.context,h=l.getAttribLocation(e.handleProgram,a);for(let v=1;v<c;v++)l.enableVertexAttribArray(h+v),l.vertexAttribPointer(h+v,c,o,u,i,s+i*v/c),g>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(h+v,1):l.vertexAttribDivisor(h+v,1));return!0},t.removeAttributeArray=n=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let r=0;r<e.buffers.length;++r){const a=e.buffers[r];for(let s=0;s<a.attributes.length;++s)if(a.attributes[s].name===n)return a.attributes.splice(s,1),a.attributes.length||e.buffers.splice(r,1),!0}return!0},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const qx={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function vg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qx,n),e.buffers=[],E.obj(t,e),E.get(t,e,["supported"]),E.setGet(t,e,["forceEmulation"]),Zx(t,e)}const Jx=E.newInstance(vg,"vtkOpenGLVertexArrayObject");var Tg={newInstance:Jx,extend:vg};const Lt={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function e2(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=n=>{e.context=n.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(n),e.CABO.setOpenGLRenderWindow(n)},t.releaseGraphicsResources=n=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(n,r,a,s)=>{if(e.CABO.getElementCount()){const i=t.getOpenGLMode(a),o=t.haveWideLines(n,r),c=e.context,u=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1),i===c.LINES&&o?(t.updateShaders(n,r,s),c.drawArraysInstanced(i,0,e.CABO.getElementCount(),2*Math.ceil(r.getProperty().getLineWidth()))):(c.lineWidth(r.getProperty().getLineWidth()),t.updateShaders(n,r,s),c.drawArrays(i,0,e.CABO.getElementCount()),c.lineWidth(1));const f=(i===c.POINTS?1:0)||(i===c.LINES?2:3);return e.pointPicking&&c.depthMask(u),e.CABO.getElementCount()/f}return 0},t.getOpenGLMode=n=>{if(e.pointPicking)return e.context.POINTS;const r=e.primitiveType;return n===Xe.POINTS||r===Lt.Points?e.context.POINTS:n===Xe.WIREFRAME||r===Lt.Lines||r===Lt.TrisEdges||r===Lt.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(n,r)=>r.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=r.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(n,r,a)=>!!(a.getNeedToRebuildShaders(t,n,r)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<a.getMTime()||t.getShaderSourceTime().getMTime()<r.getMTime()),t.updateShaders=(n,r,a)=>{if(t.getNeedToRebuildShaders(n,r,a)){const s={Vertex:null,Fragment:null,Geometry:null};a.buildShaders(s,n,r);const i=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);i!==t.getProgram()&&(t.setProgram(i),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),a.setMapperShaderParameters(t,n,r),a.setPropertyShaderParameters(t,n,r),a.setCameraShaderParameters(t,n,r),a.setLightingShaderParameters(t,n,r),a.invokeShaderCallbacks(t,n,r)},t.setMapperShaderParameters=(n,r,a)=>{if(t.haveWideLines(n,r)){t.getProgram().setUniform2f("viewportSize",a.usize,a.vsize);const s=parseFloat(r.getProperty().getLineWidth()),i=s/2;t.getProgram().setUniformf("lineWidthStepSize",s/Math.ceil(s)),t.getProgram().setUniformf("halfLineWidth",i)}e.primitiveType===Lt.Points||r.getProperty().getRepresentation()===Xe.POINTS?t.getProgram().setUniformf("pointSize",r.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(n,r,a)=>{let s=n.Vertex;s=m.substitute(s,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,s=m.substitute(s,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(a.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(r,a)&&(s=m.substitute(s,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,s=m.substitute(s,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),n.Vertex=s},t.getPointPickingPrimitiveSize=()=>e.primitiveType===Lt.Points?2:e.primitiveType===Lt.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}const t2={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function dg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,t2,n),E.obj(t,e),e.shaderSourceTime={},E.obj(e.shaderSourceTime),e.attributeUpdateTime={},E.obj(e.attributeUpdateTime),E.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=m.newInstance(),e.VAO=Tg.newInstance(),e.CABO=Hx.newInstance(),e2(t,e)}const n2=E.newInstance(dg);var Bn={newInstance:n2,extend:dg,primTypes:Lt};const r2={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},hs={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var xg={Wrap:r2,Filter:hs};const Sg=new Float32Array(1),a2=new Int32Array(Sg.buffer);function s2(t){Sg[0]=t;const e=a2[0];let n=e>>16&32768,r=e>>12&2047;const a=e>>23&255;return a<103?n:a>142?(n|=31744,n|=(a===255?0:1)&&e&8388607,n):a<113?(r|=2048,n|=(r>>114-a)+(r>>113-a&1),n):(n|=a-112<<10|r>>1,n+=r&1,n)}function i2(t){const e=(t&32768)>>15,n=(t&31744)>>10,r=t&1023;return n===0?(e?-1:1)*2**-14*(r/2**10):n===31?r?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(n-15)*(1+r/2**10)}var Je={fromHalf:i2,toHalf:s2};function o2(){try{const r=new Int16Array([0,32767]),a=[1,1],s=document.createElement("canvas");s.width=4,s.height=4;const i=s.getContext("webgl2");if(!i)return!1;const o=i.getExtension("EXT_texture_norm16");if(!o)return!1;const c=`#version 300 es
    void main() {
      gl_PointSize = ${4 .toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,u=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `,g=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(g,c),i.compileShader(g),!i.getShaderParameter(g,i.COMPILE_STATUS))return!1;const f=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(f,u),i.compileShader(f),!i.getShaderParameter(f,i.COMPILE_STATUS))return!1;const l=i.createProgram();if(i.attachShader(l,g),i.attachShader(l,f),i.linkProgram(l),!i.getProgramParameter(l,i.LINK_STATUS))return!1;const h=i.createTexture();i.bindTexture(i.TEXTURE_2D,h),i.texImage2D(i.TEXTURE_2D,0,o.R16_SNORM_EXT,2,1,0,i.RED,i.SHORT,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.useProgram(l),i.drawArrays(i.POINTS,0,1);const v=new Uint8Array(4);i.readPixels(a[0],a[1],1,1,i.RGBA,i.UNSIGNED_BYTE,v);const[p,y,T]=v,S=i.getExtension("WEBGL_lose_context");return S&&S.loseContext(),p===y&&y===T&&p!==0}catch{return!1}}let Fa;function c2(){return Fa===void 0&&(Fa=o2()),Fa}const{Wrap:pt,Filter:he}=xg,{VtkDataTypes:P}=ee,{vtkDebugMacro:ma,vtkErrorMacro:Ht,vtkWarningMacro:wo,requiredParam:I}=ft,{toHalf:f2}=Je;function u2(t,e){e.classHierarchy.push("vtkOpenGLTexture");function n(){return{internalFormat:e.internalFormat,format:e.format,openGLDataType:e.openGLDataType,width:e.width,height:e.height}}t.render=function(){let v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(v?e._openGLRenderWindow=v:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(he.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(he.LINEAR),t.setMagnificationFilter(he.LINEAR)):(t.setMinificationFilter(he.NEAREST),t.setMagnificationFilter(he.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(pt.REPEAT),t.setWrapS(pt.REPEAT),t.setWrapT(pt.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImageBitmap()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(he.LINEAR_MIPMAP_LINEAR)),e.renderable.getImageBitmap()&&e.renderable.getImageLoaded()&&(t.create2DFromImageBitmap(e.renderable.getImageBitmap()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(he.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(he.LINEAR_MIPMAP_LINEAR));const y=e.renderable.getCanvas();t.create2DFromRaw({width:y.width,height:y.height,numComps:4,dataType:P.UNSIGNED_CHAR,data:y,flip:!0}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){const y=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(he.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw({width:y.width,height:y.height,numComps:4,dataType:P.UNSIGNED_CHAR,data:y.data,flip:!0}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}const p=e.renderable.getInputData(0);if(p&&p.getPointData().getScalars()){const y=p.getExtent(),T=p.getPointData().getScalars(),S=[];for(let d=0;d<e.renderable.getNumberOfInputPorts();++d){const x=e.renderable.getInputData(d),w=x?x.getPointData().getScalars().getData():null;w&&S.push(w)}e.renderable.getInterpolate()&&T.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(he.LINEAR_MIPMAP_LINEAR)),S.length%6===0?t.createCubeFromRaw({width:y[1]-y[0]+1,height:y[3]-y[2]+1,numComps:T.getNumberOfComponents(),dataType:T.getDataType(),data:S}):t.create2DFromRaw({width:y[1]-y[0]+1,height:y[3]-y[2]+1,numComps:T.getNumberOfComponents(),dataType:T.getDataType(),data:T.getData()}),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()};const r=()=>{if(!((e.minificationFilter===he.LINEAR||e.magnificationFilter===he.LINEAR)&&!c2()))return e.oglNorm16Ext};t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=v=>{v&&e.handle&&(v.activateTexture(t),v.deactivateTexture(t),e.context.deleteTexture(e.handle),e._prevTexParams=null,e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(v),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let v=!1;if(e.context&&e.handle){let p=0;switch(e.target){case e.context.TEXTURE_2D:p=e.context.TEXTURE_BINDING_2D;break;default:wo("impossible case");break}v=e.context.getIntegerv(p)===e.handle}return v},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(v,p)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(v,p)),e.internalFormat||ma(`Unable to find suitable internal format for T=${v} NC= ${p}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&wo("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(v,p)=>{let y=0;return y=e._openGLRenderWindow.getDefaultTextureInternalFormat(v,p,r(),t.useHalfFloat()),y||(y||(ma("Unsupported internal texture type!"),ma(`Unable to find suitable internal format for T=${v} NC= ${p}`)),y)},t.useHalfFloat=()=>e.enableUseHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=v=>{e._forceInternalFormat=!0,v!==e.internalFormat&&(e.internalFormat=v,t.modified())},t.getFormat=(v,p)=>(e.format=t.getDefaultFormat(v,p),e.format),t.getDefaultFormat=(v,p)=>{if(e._openGLRenderWindow.getWebgl2())switch(p){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(p){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e._prevTexParams=null,e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=v=>{const p=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(v){case P.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(r()&&!p&&P.SHORT):return e.context.SHORT;case(r()&&!p&&P.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(p&&P.SHORT):return e.context.HALF_FLOAT;case(p&&P.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case P.FLOAT:case P.VOID:default:return e.context.FLOAT}switch(v){case P.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case P.FLOAT:case P.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{const y=e.context.getExtension("OES_texture_half_float");if(y&&e.context.getExtension("OES_texture_half_float_linear"))return y.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(v){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||p)&&(e.openGLDataType=t.getDefaultDataType(v)),e.openGLDataType},t.getShiftAndScale=()=>{let v=0,p=1;switch(e.openGLDataType){case e.context.BYTE:p=127.5,v=p-128;break;case e.context.UNSIGNED_BYTE:p=255,v=0;break;case e.context.SHORT:p=32767.5,v=p-32768;break;case e.context.UNSIGNED_SHORT:p=65536,v=0;break;case e.context.INT:p=21474836475e-1,v=p-2147483648;break;case e.context.UNSIGNED_INT:p=4294967295,v=0;break;case e.context.FLOAT:}return{shift:v,scale:p}},t.getOpenGLFilterMode=v=>{switch(v){case he.NEAREST:return e.context.NEAREST;case he.LINEAR:return e.context.LINEAR;case he.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case he.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case he.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case he.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=v=>{switch(v){case pt.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case pt.REPEAT:return e.context.REPEAT;case pt.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}};function a(v){const[p,y,T,S,d,x]=v;return[y-p+1,S-T+1,x-d+1]}function s(v){const[p,y,T]=a(v);return p*y*T}function i(v,p,y,T,S){const[d,x,w,C,M,R]=y,[V,O]=p,D=V*O;let B=S;for(let L=M;L<=R;L++){const F=L*D;for(let U=w;U<=C;U++){const N=F+U*V;for(let G=N+d,H=N+x;G<=H;G++,B++)T[B]=v[G]}}}function o(v,p){const T=(arguments.length>2&&arguments[2]!==void 0?arguments[2]:null)||v.constructor,S=p.reduce((C,M)=>C+s(M),0),d=new T(S),x=[e.width,e.height,e.depth];let w=0;return p.forEach(C=>{i(v,x,C,d,w),w+=s(C)}),d}t.updateArrayDataTypeForGL=function(v,p){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,T=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];const S=[];let d=e.width*e.height*e.components;y&&(d*=e.depth);const x=!!T.length;if(v!==P.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let C=0;C<p.length;C++)if(p[C])if(x)S.push(o(p[C],T,Float32Array));else{const M=p[C].length>d?p[C].subarray(0,d):p[C];S.push(new Float32Array(M))}else S.push(null);if(v!==P.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let C=0;C<p.length;C++)if(p[C])if(x)S.push(o(p[C],T,Uint8Array));else{const M=p[C].length>d?p[C].subarray(0,d):p[C];S.push(new Uint8Array(M))}else S.push(null);let w=!1;if(e._openGLRenderWindow.getWebgl2())w=e.openGLDataType===e.context.HALF_FLOAT;else{const C=e.context.getExtension("OES_texture_half_float");w=C&&e.openGLDataType===C.HALF_FLOAT_OES}if(w)for(let C=0;C<p.length;C++)if(p[C]){const M=x?o(p[C],T):p[C],R=new Uint16Array(x?M.length:d),V=R.length;for(let O=0;O<V;O++)R[O]=f2(M[O]);S.push(R)}else S.push(null);if(S.length===0)for(let C=0;C<p.length;C++)S.push(x&&p[C]?o(p[C],T):p[C]);return S};function c(v){if(e._openGLRenderWindow.getWebgl2())return v;const p=[],y=e.width,T=e.height,S=e.components;if(v&&(!zn(y)||!zn(T))){const d=e.context.getExtension("OES_texture_half_float"),x=Ke(y),w=Ke(T),C=x*w*e.components;for(let M=0;M<v.length;M++)if(v[M]!==null){let R=null;const V=T/w,O=y/x;let D=!1;e.openGLDataType===e.context.FLOAT?R=new Float32Array(C):d&&e.openGLDataType===d.HALF_FLOAT_OES?(R=new Uint16Array(C),D=!0):R=new Uint8Array(C);for(let B=0;B<w;B++){const L=B*x*S,F=B*V;let U=Math.floor(F),N=Math.ceil(F);N>=T&&(N=T-1);const G=F-U,H=1-G;U=U*y*S,N=N*y*S;for(let k=0;k<x;k++){const _=k*S,b=k*O;let z=Math.floor(b),$=Math.ceil(b);$>=y&&($=y-1);const ze=b-z;z*=S,$*=S;for(let Le=0;Le<S;Le++)D?R[L+_+Le]=Je.toHalf(Je.fromHalf(v[M][U+z+Le])*H*(1-ze)+Je.fromHalf(v[M][U+$+Le])*H*ze+Je.fromHalf(v[M][N+z+Le])*G*(1-ze)+Je.fromHalf(v[M][N+$+Le])*G*ze):R[L+_+Le]=v[M][U+z+Le]*H*(1-ze)+v[M][U+$+Le]*H*ze+v[M][N+z+Le]*G*(1-ze)+v[M][N+$+Le]*G*ze}}p.push(R),e.width=x,e.height=w}else p.push(null)}if(p.length===0)for(let d=0;d<v.length;d++)p.push(v[d]);return p}function u(v){var p;return e._openGLRenderWindow?e.resizable||(p=e.renderable)!=null&&p.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&r()&&(v===P.UNSIGNED_SHORT||v===P.SHORT)):!1:!1}t.create2DFromRaw=function(){let{width:v=I("width"),height:p=I("height"),numComps:y=I("numComps"),dataType:T=I("dataType"),data:S=I("data"),flip:d=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(t.getOpenGLDataType(T,!0),t.getInternalFormat(T,y),t.getFormat(T,y),!e.internalFormat||!e.format||!e.openGLDataType)return Ht("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=y,e.width=v,e.height=p,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const x=[S],w=t.updateArrayDataTypeForGL(T,x),C=c(w);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,d),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),u(T)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),C[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,C[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,C[0]),e.generateMipmap&&e.context.generateMipmap(e.target),d&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*y*e._openGLRenderWindow.getDefaultTextureByteSize(T,r(),t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=function(){let{width:v=I("width"),height:p=I("height"),numComps:y=I("numComps"),dataType:T=I("dataType"),data:S=I("data")}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(t.getOpenGLDataType(T),t.getInternalFormat(T,y),t.getFormat(T,y),!e.internalFormat||!e.format||!e.openGLDataType)return Ht("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=y,e.width=v,e.height=p,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=S.length/6-1,t.createTexture(),t.bind();const d=t.updateArrayDataTypeForGL(T,S),x=c(d),w=[];let C=e.width,M=e.height;for(let R=0;R<x.length;R++){R%6===0&&R!==0&&(C/=2,M/=2),w[R]=Dn(T,M*C*e.components);for(let V=0;V<M;++V){const O=V*C*e.components,D=(M-V-1)*C*e.components;w[R].set(x[R].slice(D,D+C*e.components),O)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),u(T)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let R=0;R<6;R++){let V=0,O=e.width,D=e.height;for(;O>=1&&D>=1;){let B=null;V<=e.maxLevel&&(B=w[6*V+R]),u(T)?B!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+R,V,0,0,O,D,e.format,e.openGLDataType,B):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+R,V,e.internalFormat,O,D,0,e.format,e.openGLDataType,B),V++,O/=2,D/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*y*e._openGLRenderWindow.getDefaultTextureByteSize(T,r(),t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=function(){let{width:v=I("width"),height:p=I("height"),dataType:y=I("dataType"),data:T=I("data")}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.getOpenGLDataType(y),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?y===P.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(Ht("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=v,e.height=p,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),u(y)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),T!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,T)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,T),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(y,r(),t.useHalfFloat()),t.deactivate(),!0)},t.create2DFromImage=v=>{if(t.getOpenGLDataType(P.UNSIGNED_CHAR),t.getInternalFormat(P.UNSIGNED_CHAR,4),t.getFormat(P.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return Ht("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const p=!e._openGLRenderWindow.getWebgl2()&&(!zn(v.width)||!zn(v.height));let y=v,T=v.width,S=v.height,d=!0;const x=window.chrome;if(p||x){const w=new OffscreenCanvas(Ke(v.width),Ke(v.height));T=w.width,S=w.height;const C=w.getContext("2d");C.translate(0,w.height),C.scale(1,-1),C.drawImage(v,0,0,v.width,v.height,0,0,w.width,w.height),y=w,d=!1}return e.width=T,e.height=S,e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,d),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),u(P.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,y)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,y),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(P.UNSIGNED_CHAR,r(),t.useHalfFloat()),t.deactivate(),!0},t.create2DFromImageBitmap=v=>(t.getOpenGLDataType(P.UNSIGNED_CHAR),t.getInternalFormat(P.UNSIGNED_CHAR,4),t.getFormat(P.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType?(Ht("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),e.width=v.width,e.height=v.height,u(P.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,v)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,v),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(P.UNSIGNED_CHAR,r(),t.useHalfFloat()),t.deactivate(),!0));function g(v,p,y){const T=new Array(y),S=new Array(y);for(let d=0;d<y;++d)T[d]=v[d],S[d]=p[d]-v[d]||1;return{scale:S,offset:T}}function f(v,p){for(let y=0;y<v.length;y++){const T=v[y],S=p[y]+T;if(T<-2048||T>2048||S<-2048||S>2048)return!1}return!0}function l(v,p,y,T){t.getOpenGLDataType(v);const S=f(p,y)||T;let d=!1;if(e._openGLRenderWindow.getWebgl2())d=e.openGLDataType===e.context.FLOAT&&e.context.getExtension("OES_texture_float_linear")===null&&S||e.openGLDataType===e.context.HALF_FLOAT;else{const x=e.context.getExtension("OES_texture_half_float");d=x&&e.openGLDataType===x.HALF_FLOAT_OES}e.canUseHalfFloat=d&&S}function h(v,p){const y=v.getNumberOfComponents(),T=v.getDataType(),S=v.getData(),d=new Array(y),x=new Array(y);for(let C=0;C<y;++C){const[M,R]=v.getRange(C);d[C]=M,x[C]=R}const w=g(d,x,y);return l(T,w.offset,w.scale,p),t.useHalfFloat()||t.getOpenGLDataType(T,!0),{numComps:y,dataType:T,data:S,scaleOffsets:w}}t.create2DFilterableFromRaw=function(){let{width:v=I("width"),height:p=I("height"),numComps:y=I("numComps"),dataType:T=I("dataType"),data:S=I("data"),preferSizeOverAccuracy:d=!1,ranges:x=void 0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.create2DFilterableFromDataArray({width:v,height:p,dataArray:ee.newInstance({numComps:y,dataType:T,values:S,ranges:x}),preferSizeOverAccuracy:d})},t.create2DFilterableFromDataArray=function(){let{width:v=I("width"),height:p=I("height"),dataArray:y=I("dataArray"),preferSizeOverAccuracy:T=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{numComps:S,dataType:d,data:x}=h(y,T);t.create2DFromRaw({width:v,height:p,numComps:S,dataType:d,data:x})},t.updateVolumeInfoForGL=(v,p)=>{var S,d;let y=!1;const T=t.useHalfFloat();(!((S=e.volumeInfo)!=null&&S.scale)||!((d=e.volumeInfo)!=null&&d.offset))&&(e.volumeInfo={scale:new Array(p),offset:new Array(p)});for(let x=0;x<p;++x)e.volumeInfo.scale[x]=1,e.volumeInfo.offset[x]=0;if(r()&&!T&&v===P.SHORT){for(let x=0;x<p;++x)e.volumeInfo.scale[x]=32767;y=!0}if(r()&&!T&&v===P.UNSIGNED_SHORT){for(let x=0;x<p;++x)e.volumeInfo.scale[x]=65535;y=!0}if(v===P.UNSIGNED_CHAR){for(let x=0;x<p;++x)e.volumeInfo.scale[x]=255;y=!0}return(v===P.FLOAT||T&&(v===P.SHORT||v===P.UNSIGNED_SHORT))&&(y=!0),y},t.create3DFromRaw=function(){let{width:v=I("width"),height:p=I("height"),depth:y=I("depth"),numComps:T=I("numComps"),dataType:S=I("dataType"),data:d=I("data"),updatedExtents:x=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},w=S,C=d;if(!t.updateVolumeInfoForGL(w,T)&&C){const L=v*p*y,F=structuredClone(e.volumeInfo),U=new Float32Array(L*T);e.volumeInfo.offset=F.offset,e.volumeInfo.scale=F.scale;let N=0;const G=F.scale.map(H=>1/H);for(let H=0;H<L;H++)for(let k=0;k<T;k++)U[N]=(C[N]-F.offset[k])*G[k],N++;w=P.FLOAT,C=U}if(t.getOpenGLDataType(w),t.getInternalFormat(w,T),t.getFormat(w,T),!e.internalFormat||!e.format||!e.openGLDataType)return Ht("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=T,e.width=v,e.height=p,e.depth=y,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const M=x.length>0,R=!M||!Sc(e._prevTexParams,n()),V=[C],D=t.updateArrayDataTypeForGL(w,V,!0,R?[]:x),B=c(D);if(e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),R)u(w)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),B[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,B[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,B[0]),e._prevTexParams=n();else if(M){const L=B[0];let F=0;for(let U=0;U<x.length;U++){const N=x[U],G=a(N),H=s(N),k=new L.constructor(L.buffer,F,H);F+=k.byteLength,e.context.texSubImage3D(e.target,0,N[0],N[2],N[4],G[0],G[1],G[2],e.format,e.openGLDataType,k)}}return e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(w,r(),t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(){let{width:v=I("width"),height:p=I("height"),depth:y=I("depth"),numComps:T=I("numComps"),dataType:S=I("dataType"),data:d=I("data"),preferSizeOverAccuracy:x=!1,ranges:w=void 0,updatedExtents:C=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.create3DFilterableFromDataArray({width:v,height:p,depth:y,dataArray:ee.newInstance({numComps:T,dataType:S,values:d,ranges:w}),preferSizeOverAccuracy:x,updatedExtents:C})},t.create3DFilterableFromDataArray=function(){let{width:v=I("width"),height:p=I("height"),depth:y=I("depth"),dataArray:T=I("dataArray"),preferSizeOverAccuracy:S=!1,updatedExtents:d=[]}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{numComps:x,dataType:w,data:C,scaleOffsets:M}=h(T,S),R=[],V=[];for(let ue=0;ue<x;++ue)R[ue]=0,V[ue]=1;if(e.volumeInfo={scale:V,offset:R,dataComputedScale:M.scale,dataComputedOffset:M.offset,width:v,height:p,depth:y},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw({width:v,height:p,depth:y,numComps:x,dataType:w,data:C,updatedExtents:d});const O=v*p*y,D=structuredClone(M);let B=(ue,_e,wt,be,We)=>{ue[_e]=wt},L=P.UNSIGNED_CHAR;if(w===P.UNSIGNED_CHAR)for(let ue=0;ue<x;++ue)D.offset[ue]=0,D.scale[ue]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(L=P.FLOAT,B=(ue,_e,wt,be,We)=>{ue[_e]=(wt-be)/We}):(L=P.UNSIGNED_CHAR,B=(ue,_e,wt,be,We)=>{ue[_e]=255*(wt-be)/We});if(t.getOpenGLDataType(L),t.getInternalFormat(L,x),t.getFormat(L,x),!e.internalFormat||!e.format||!e.openGLDataType)return Ht("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=x,e.depth=1,e.numberOfDimensions=2;let F=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);F>4096&&(L===P.FLOAT||x>=3)&&(F=4096);let U=1,N=1;O>F*F&&(U=Math.ceil(Math.sqrt(O/(F*F))),N=U);let G=Math.sqrt(O)/U;G=Ke(G);const H=Math.floor(G*U/v),k=Math.ceil(y/H),_=Ke(p*k/N);e.width=G,e.height=_,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=H,e.volumeInfo.yreps=k,e.volumeInfo.xstride=U,e.volumeInfo.ystride=N,e.volumeInfo.offset=D.offset,e.volumeInfo.scale=D.scale;let b;const z=G*_*x;L===P.FLOAT?b=new Float32Array(z):b=new Uint8Array(z);let $=0;const ze=Math.floor(v/U),Le=Math.floor(p/N);for(let ue=0;ue<k;ue++){const _e=Math.min(H,y-ue*H),wt=x*(e.width-_e*Math.floor(v/U));for(let be=0;be<Le;be++){for(let We=0;We<_e;We++){const Gt=x*((ue*H+We)*v*p+N*be*v);for(let Ca=0;Ca<ze;Ca++)for(let Fn=0;Fn<x;Fn++)B(b,$,C[Gt+U*Ca*x+Fn],D.offset[Fn],D.scale[Fn]),$++}$+=wt}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),u(L)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),b!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,b)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,b),t.deactivate(),!0},t.setOpenGLRenderWindow=v=>{e._openGLRenderWindow!==v&&(t.releaseGraphicsResources(),e._openGLRenderWindow=v,e.context=null,v&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=v=>v&&v.isCurrent()?v.getIntegerv(v.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=v=>{e.enableUseHalfFloat=v}}const g2={_openGLRenderWindow:null,_forceInternalFormat:!1,_prevTexParams:null,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:pt.CLAMP_TO_EDGE,wrapT:pt.CLAMP_TO_EDGE,wrapR:pt.CLAMP_TO_EDGE,minificationFilter:he.NEAREST,magnificationFilter:he.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function Cg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,g2,n),fe.extend(t,e,n),e.sendParametersTime={},Me(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},Me(e.textureBuildTime,{mtime:0}),nr(t,e,["format","openGLDataType"]),Te(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),Ne(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),rr(t,e,["openGLRenderWindow"]),u2(t,e)}const wg=re(Cg,"vtkOpenGLTexture");var dt={newInstance:wg,extend:Cg,...xg};Ie("vtkTexture",wg);var l2=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,p2=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;function h2(t,e){t.replaceShaderCoincidentOffset=(n,r,a)=>{const s=t.getCoincidentParameters(r,a);if(s&&(s.factor!==0||s.offset!==0)){let i=n.Fragment;i=m.substitute(i,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(s.factor!==0?(i=m.substitute(i,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,i=m.substitute(i,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):i=m.substitute(i,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(s.factor!==0?(i=m.substitute(i,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,i=m.substitute(i,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):i=m.substitute(i,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),n.Fragment=i}}}function y2(t,e){t.applyShaderReplacements=(n,r,a)=>{let s=null;if(r&&(s=r.ShaderReplacements),s)for(let i=0;i<s.length;i++){const o=s[i];if(a&&o.replaceFirst||!a&&!o.replaceFirst){const c=o.shaderType,u=n[c],g=m.substitute(u,o.originalValue,o.replacementValue,o.replaceAll);n[c]=g.result}}},t.buildShaders=(n,r,a)=>{t.getReplacedShaderTemplate(n,r,a),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(n);const s=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(n,s,!0),t.replaceShaderValues(n,r,a),t.applyShaderReplacements(n,s)},t.getReplacedShaderTemplate=(n,r,a)=>{const s=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(n,r,a);let i=n.Vertex;if(s){const u=s.VertexShaderCode;u!==void 0&&u!==""&&(i=u)}n.Vertex=i;let o=n.Fragment;if(s){const u=s.FragmentShaderCode;u!==void 0&&u!==""&&(o=u)}n.Fragment=o;let c=n.Geometry;if(s){const u=s.GeometryShaderCode;u!==void 0&&(c=u)}n.Geometry=c}}var aa={implementReplaceShaderCoincidentOffset:h2,implementBuildShadersWithReplacements:y2};const{FieldAssociations:ka}=cn,{primTypes:ve}=Bn,{Representation:ln,Shading:Eo}=Vn,{ScalarMode:Er}=an,{Filter:Mo,Wrap:Ro}=dt,{vtkErrorMacro:At}=ft,v2={type:"StartEvent"},T2={type:"EndEvent"},{CoordinateSystem:d2}=cr;function x2(t){const e=t.getSelector();return e?e.getCurrentPass():ke.MIN_KNOWN_PASS-1}function S2(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=r=>{r&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(r,a)=>{r&&(e.currentRenderPass=a,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let i=ve.Start;i<ve.End;i++)e.primitives[i].setOpenGLRenderWindow(e._openGLRenderWindow)}const a=e.openGLActor.getRenderable(),s=e._openGLRenderer.getRenderable();t.renderPiece(s,a)},t.getShaderTemplate=(r,a,s)=>{r.Vertex=l2,r.Fragment=p2,r.Geometry=""},t.replaceShaderColor=(r,a,s)=>{let i=r.Vertex,o=r.Geometry,c=r.Fragment;const u=e.lastBoundBO.getReferenceByName("lastLightComplexity");let g=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];u&&(g=g.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let f=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];u&&(f=f.concat(["  vec3 specularColor;","  float specularPower;"])),f=f.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),u&&(f=f.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(g=g.concat(["varying vec4 vertexColorVSOutput;"]),i=m.substitute(i,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,i=m.substitute(i,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,o=m.substitute(o,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,o=m.substitute(o,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?c=m.substitute(c,"//VTK::Color::Impl",f.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:(e.renderable.getAreScalarsMappedFromCells()||e.renderable.getInterpolateScalarsBeforeMapping())&&e.renderable.getColorCoordinates()&&!e.drawingEdges?c=m.substitute(c,"//VTK::Color::Impl",f.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(s.getBackfaceProperty()&&!e.drawingEdges&&(g=g.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),u?(g=g.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),f=f.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):f=f.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(g=g.concat(["uniform samplerBuffer texture1;"])),c=m.substitute(c,"//VTK::Color::Impl",f).result),c=m.substitute(c,"//VTK::Color::Dec",g).result,r.Vertex=i,r.Geometry=o,r.Fragment=c},t.replaceShaderLight=(r,a,s)=>{let i=r.Fragment;const o="",c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),u=e.lastBoundBO.getReferenceByName("lastLightCount");let g=[];switch(c){case 0:i=m.substitute(i,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:i=m.substitute(i,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let f=0;f<u;++f)g=g.concat([`uniform vec3 lightColor${f};`,`uniform vec3 lightDirectionVC${f}; // normalized`,`uniform vec3 lightHalfAngleVC${f}; // normalized`]);i=m.substitute(i,"//VTK::Light::Dec",g).result,g=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let f=0;f<u;++f)g=g.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${f}));`,`  diffuseL += ((df${o}) * lightColor${f});`,`  if (dot(normalVCVSOutput, lightDirectionVC${f}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${f},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${o} * lightColor${f});`,"    }"]);g=g.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),i=m.substitute(i,"//VTK::Light::Impl",g,!1).result;break;case 3:for(let f=0;f<u;++f)g=g.concat([`uniform vec3 lightColor${f};`,`uniform vec3 lightDirectionVC${f}; // normalized`,`uniform vec3 lightHalfAngleVC${f}; // normalized`,`uniform vec3 lightPositionVC${f};`,`uniform vec3 lightAttenuation${f};`,`uniform float lightConeAngle${f};`,`uniform float lightExponent${f};`,`uniform int lightPositional${f};`]);i=m.substitute(i,"//VTK::Light::Dec",g).result,g=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let f=0;f<u;++f)g=g.concat(["  attenuation = 1.0;",`  if (lightPositional${f} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${f};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${f};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${f}.x`,`       + lightAttenuation${f}.y * distanceVC`,`       + lightAttenuation${f}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${f} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${f});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${f})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${f});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${o}) * lightColor${f});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${f},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${o}) * lightColor${f});`,"    }"]);g=g.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),i=m.substitute(i,"//VTK::Light::Impl",g,!1).result;break;default:At("bad light complexity")}r.Fragment=i},t.replaceShaderNormal=(r,a,s)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let o=r.Vertex,c=r.Geometry,u=r.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(o=m.substitute(o,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,o=m.substitute(o,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,c=m.substitute(c,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,c=m.substitute(c,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,u=m.substitute(u,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,u=m.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(u=m.substitute(u,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,u=m.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(s.getProperty().getRepresentation())===e.context.LINES?(u=m.substitute(u,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,u=m.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(u=m.substitute(u,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,u=m.substitute(u,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,u=m.substitute(u,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),r.Vertex=o,r.Geometry=c,r.Fragment=u}},t.replaceShaderPositionVC=(r,a,s)=>{e.lastBoundBO.replaceShaderPositionVC(r,a,s);let i=r.Vertex,o=r.Geometry,c=r.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(i=m.substitute(i,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,i=m.substitute(i,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,i=m.substitute(i,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,o=m.substitute(o,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,o=m.substitute(o,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,c=m.substitute(c,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,c=m.substitute(c,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(i=m.substitute(i,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,i=m.substitute(i,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),r.Vertex=i,r.Geometry=o,r.Fragment=c},t.replaceShaderTCoord=(r,a,s)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let i=r.Vertex,o=r.Geometry,c=r.Fragment;if(e.drawingEdges)return;i=m.substitute(i,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;const u=e.openGLActor.getActiveTextures();let g=2,f=2;if(u&&u.length>0&&(g=u[0].getComponents(),u[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(f=3)),e.renderable.getColorTextureMap()&&(g=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),f=2),f===2){if(i=m.substitute(i,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,o=m.substitute(o,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,o=m.substitute(o,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=m.substitute(c,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,u&&u.length>=1)switch(g){case 1:c=m.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=m.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=m.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(i=m.substitute(i,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,o=m.substitute(o,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,o=m.substitute(o,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=m.substitute(c,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,g){case 1:c=m.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=m.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=m.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}r.Vertex=i,r.Geometry=o,r.Fragment=c}},t.replaceShaderClip=(r,a,s)=>{let i=r.Vertex,o=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();i=m.substitute(i,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,i=m.substitute(i,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=m.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,o=m.substitute(o,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=i,r.Fragment=o},t.getCoincidentParameters=(r,a)=>{let s={factor:0,offset:0};const i=a.getProperty();if(e.renderable.getResolveCoincidentTopology()==_t.PolygonOffset||i.getEdgeVisibility()&&i.getRepresentation()===ln.SURFACE){const c=e.lastBoundBO.getPrimitiveType();c===ve.Points||i.getRepresentation()===ln.POINTS?s=e.renderable.getCoincidentTopologyPointOffsetParameter():c===ve.Lines||i.getRepresentation()===ln.WIREFRAME?s=e.renderable.getCoincidentTopologyLineOffsetParameters():(c===ve.Tris||c===ve.TriStrips)&&(s=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(c===ve.TrisEdges||c===ve.TriStripsEdges)&&(s=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),s.factor/=2,s.offset/=2)}const o=e._openGLRenderer.getSelector();return o&&o.getFieldAssociation()===ka.FIELD_ASSOCIATION_POINTS&&(s.offset-=2),s},t.replaceShaderPicking=(r,a,s)=>{let i=r.Fragment,o=r.Vertex;if(i=m.substitute(i,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===ke.ID_LOW24||e.lastSelectionState===ke.ID_HIGH24)&&(o=m.substitute(o,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,o=m.substitute(o,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,i=m.substitute(i,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,i=m.substitute(i,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case ke.ID_LOW24:i=m.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case ke.ID_HIGH24:i=m.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float((idx/16777216)%256)/255.0, 0.0, 0.0, 1.0);").result;break;default:i=m.substitute(i,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,i=m.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}r.Fragment=i,r.Vertex=o}},t.replaceShaderValues=(r,a,s)=>{if(t.replaceShaderColor(r,a,s),t.replaceShaderNormal(r,a,s),t.replaceShaderLight(r,a,s),t.replaceShaderTCoord(r,a,s),t.replaceShaderPicking(r,a,s),t.replaceShaderClip(r,a,s),t.replaceShaderCoincidentOffset(r,a,s),t.replaceShaderPositionVC(r,a,s),e.haveSeenDepthRequest){let i=r.Fragment;i=m.substitute(i,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,i=m.substitute(i,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,r.Fragment=i}},t.getNeedToRebuildShaders=(r,a,s)=>{let i=0,o=0;const c=r.getPrimitiveType(),u=e.currentInput;let g=!1;const f=u.getPointData().getNormals(),l=u.getCellData().getNormals(),h=s.getProperty().getInterpolation()===Eo.FLAT,v=s.getProperty().getRepresentation(),p=r.getOpenGLMode(v,c);if((p===e.context.TRIANGLES||l&&!f||!h&&f||!h&&p===e.context.LINES)&&(g=!0),s.getProperty().getLighting()&&g){i=0;const d=a.getLightsByReference();for(let x=0;x<d.length;++x){const w=d[x];w.getSwitch()>0&&(o++,i===0&&(i=1)),i===1&&(o>1||w.getIntensity()!==1||!w.lightTypeIsHeadLight())&&(i=2),i<3&&w.getPositional()&&(i=3)}}let y=!1;const T=e.lastBoundBO.getReferenceByName("lastLightComplexity"),S=e.lastBoundBO.getReferenceByName("lastLightCount");return(T!==i||S!==o)&&(e.lastBoundBO.set({lastLightComplexity:i},!0),e.lastBoundBO.set({lastLightCount:o},!0),y=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(y=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||r.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||y?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(r,a,s)=>{const i=e.renderable.getViewSpecificProperties().ShadersCallbacks;i&&i.forEach(o=>{o.callback(o.userData,r,a,s)})},t.setMapperShaderParameters=(r,a,s)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isUniformUsed("VertexIDOffset")&&r.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){const c=e.lastBoundBO.getReferenceByName("lastLightComplexity");r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||At("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("normalMC")&&r.getCABO().getNormalOffset()&&c>0?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"normalMC",r.getCABO().getNormalOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||At("Error setting normalMC in shader VAO."):r.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((u,g)=>{r.getProgram().isAttributeUsed(`${u}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${u}MC`,r.getCABO().getCustomData()[g].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[g].components,!1)||At(`Error setting ${u}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||At("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),r.getProgram().isAttributeUsed("scalarColor")&&r.getCABO().getColorComponents()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"scalarColor",r.getCABO().getColorOffset(),r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||At("Error setting scalarColor in shader VAO."):r.getVAO().removeAttributeArray("scalarColor"),r.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes(),u=[],f=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,l=f?Oe(e.tmpMat4,s.getMatrix()):s.getMatrix();f&&(ne(l,l),pe(l,l,f),ne(l,l));for(let h=0;h<c;h++){const v=[];e.renderable.getClippingPlaneInDataCoords(l,h,v);for(let p=0;p<4;p++)u.push(v[p])}r.getProgram().setUniformi("numClipPlanes",c),r.getProgram().setUniform4fv("clipPlanes",u)}e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const i=e.openGLActor.getActiveTextures();if(i)for(let c=0;c<i.length;++c){const g=i[c].getTextureUnit(),f=`texture${g+1}`;r.getProgram().isUniformUsed(f)&&r.getProgram().setUniformi(f,g)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(a,s);r.getProgram().setUniformf("coffset",c.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",c.factor)}r.setMapperShaderParameters(a,s,e._openGLRenderer.getTiledSizeAndOrigin());const o=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",o?o.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",o?o.getCurrentPass()+1:0)},t.setLightingShaderParameters=(r,a,s)=>{const i=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(i<2)return;const o=r.getProgram();let c=0;const u=a.getLightsByReference();for(let l=0;l<u.length;++l){const h=u[l];if(h.getSwitch()>0){const p=h.getColorByReference(),y=h.getIntensity();e.lightColor[0]=p[0]*y,e.lightColor[1]=p[1]*y,e.lightColor[2]=p[2]*y;const T=h.getDirection(),S=a.getActiveCamera().getViewMatrix(),d=[...T];h.lightTypeIsSceneLight()&&(d[0]=S[0]*T[0]+S[1]*T[1]+S[2]*T[2],d[1]=S[4]*T[0]+S[5]*T[1]+S[6]*T[2],d[2]=S[8]*T[0]+S[9]*T[1]+S[10]*T[2],we(d)),e.lightDirection[0]=d[0],e.lightDirection[1]=d[1],e.lightDirection[2]=d[2],we(e.lightDirection),o.setUniform3fArray(`lightColor${c}`,e.lightColor),o.setUniform3fArray(`lightDirectionVC${c}`,e.lightDirection),c++}}if(i<3)return;const f=a.getActiveCamera().getViewMatrix();ne(f,f),c=0;for(let l=0;l<u.length;++l){const h=u[l];if(h.getSwitch()>0){const p=h.getTransformedPosition(),y=new Float64Array(3);q(y,p,f),o.setUniform3fArray(`lightAttenuation${c}`,h.getAttenuationValuesByReference()),o.setUniformi(`lightPositional${c}`,h.getPositional()),o.setUniformf(`lightExponent${c}`,h.getExponent()),o.setUniformf(`lightConeAngle${c}`,h.getConeAngle()),o.setUniform3fArray(`lightPositionVC${c}`,[y[0],y[1],y[2]]),c++}}};function n(r,a,s){return a.identity(s),r.reduce((i,o,c)=>c===0?o?a.copy(i,o):a.identity(i):o?a.multiply(i,i,o):i,s)}t.setCameraShaderParameters=(r,a,s)=>{const i=r.getProgram(),o=e.openGLCamera.getKeyMatrices(a),c=a.getActiveCamera(),u=e.openGLCamera.getKeyMatrixTime().getMTime(),g=i.getLastCameraMTime(),l=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,h=s.getIsIdentity(),v=h?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(s.getCoordinateSystem()===d2.DISPLAY){const p=e._openGLRenderer.getTiledSizeAndOrigin();Y(e.tmpMat4),e.tmpMat4[0]=2/p.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/p.vsize,e.tmpMat4[13]=-1,pe(e.tmpMat4,e.tmpMat4,l),i.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else i.setUniformMatrix("MCPCMatrix",n([o.wcpc,v.mcwc,l],ja,e.tmpMat4));i.isUniformUsed("MCVCMatrix")&&i.setUniformMatrix("MCVCMatrix",n([o.wcvc,v.mcwc,l],ja,e.tmpMat4)),i.isUniformUsed("normalMatrix")&&i.setUniformMatrix3x3("normalMatrix",n([o.normalMatrix,v.normalMatrix],kl,e.tmpMat3)),g!==u&&(i.isUniformUsed("cameraParallel")&&i.setUniformi("cameraParallel",c.getParallelProjection()),i.setLastCameraMTime(u)),h||i.setLastCameraMTime(0)},t.setPropertyShaderParameters=(r,a,s)=>{const i=r.getProgram();let o=s.getProperty(),c=o.getOpacity(),u=e.drawingEdges?o.getEdgeColorByReference():o.getAmbientColorByReference(),g=e.drawingEdges?o.getEdgeColorByReference():o.getDiffuseColorByReference(),f=e.drawingEdges?1:o.getAmbient(),l=e.drawingEdges?0:o.getDiffuse(),h=e.drawingEdges?0:o.getSpecular();const v=o.getSpecularPower();i.setUniformf("opacityUniform",c),i.setUniform3fArray("ambientColorUniform",u),i.setUniform3fArray("diffuseColorUniform",g),i.setUniformf("ambient",f),i.setUniformf("diffuse",l);const p=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(p<1)return;let y=o.getSpecularColorByReference();if(i.setUniform3fArray("specularColorUniform",y),i.setUniformf("specularPowerUniform",v),i.setUniformf("specular",h),i.isUniformUsed("ambientIntensityBF")){if(o=s.getBackfaceProperty(),c=o.getOpacity(),u=o.getAmbientColor(),f=o.getAmbient(),g=o.getDiffuseColor(),l=o.getDiffuse(),y=o.getSpecularColor(),h=o.getSpecular(),i.setUniformf("ambientIntensityBF",f),i.setUniformf("diffuseIntensityBF",l),i.setUniformf("opacityUniformBF",c),i.setUniform3fArray("ambientColorUniformBF",u),i.setUniform3fArray("diffuseColorUniformBF",g),p<1)return;i.setUniformf("specularIntensityBF",h),i.setUniform3fArray("specularColorUniformBF",y),i.setUniformf("specularPowerUniformBF",v)}},t.updateMaximumPointCellIds=(r,a)=>{var o,c,u,g;const s=e._openGLRenderer.getSelector();if(!s)return;if((c=(o=e.selectionWebGLIdsToVTKIds)==null?void 0:o.points)!=null&&c.length){const f=e.selectionWebGLIdsToVTKIds.points.length;s.setMaximumPointId(f-1)}if((g=(u=e.selectionWebGLIdsToVTKIds)==null?void 0:u.cells)!=null&&g.length){const f=e.selectionWebGLIdsToVTKIds.cells.length;s.setMaximumCellId(f-1)}s.getFieldAssociation()===ka.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(r,a)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;const s=x2(e._openGLRenderer);if(e.lastSelectionState!==s&&(e.selectionStateChanged.modified(),e.lastSelectionState=s),e._openGLRenderer.getSelector())switch(s){default:e._openGLRenderer.getSelector().renderProp(a)}t.updateBufferObjects(r,a),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(r,a)=>{const s=a.getProperty().getRepresentation(),i=a.getProperty().getEdgeVisibility()&&s===ln.SURFACE,o=e._openGLRenderer.getSelector(),c=o&&o.getFieldAssociation()===ka.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===ke.ID_LOW24||e.lastSelectionState===ke.ID_HIGH24);for(let u=ve.Start;u<ve.End;u++)e.primitives[u].setPointPicking(c),e.primitives[u].getCABO().getElementCount()&&(e.drawingEdges=i&&(u===ve.TrisEdges||u===ve.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[u],e.primitiveIDOffset+=e.primitives[u].drawArrays(r,a,s,t),e.vertexIDOffset+=e.primitives[u].getCABO().getElementCount()))},t.renderPieceFinish=(r,a)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(r,a)=>{if(t.invokeEvent(v2),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(T2),!e.currentInput){At("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const s=e.context,i=a.getProperty().getBackfaceCulling(),o=a.getProperty().getFrontfaceCulling();!i&&!o?e._openGLRenderWindow.disableCullFace():o?(e._openGLRenderWindow.enableCullFace(),s.cullFace(s.FRONT)):(e._openGLRenderWindow.enableCullFace(),s.cullFace(s.BACK)),t.renderPieceStart(r,a),t.renderPieceDraw(r,a),t.renderPieceFinish(r,a)},t.updateBufferObjects=(r,a)=>{t.getNeedToRebuildBufferObjects(r,a)&&t.buildBufferObjects(r,a),t.updateMaximumPointCellIds()},t.getNeedToRebuildBufferObjects=(r,a)=>{const s=e.VBOBuildTime.getMTime();return s<t.getMTime()||s<e.renderable.getMTime()||s<a.getMTime()||s<e.currentInput.getMTime()},t.buildBufferObjects=(r,a)=>{const s=e.currentInput;if(s===null)return;e.renderable.mapScalars(s,1);const i=e.renderable.getColorMapColors();e.haveCellScalars=!1;const o=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(o===Er.USE_CELL_DATA||o===Er.USE_CELL_FIELD_DATA||o===Er.USE_FIELD_DATA||!s.getPointData().getScalars())&&o!==Er.USE_POINT_FIELD_DATA&&i&&(e.haveCellScalars=!0);let c=a.getProperty().getInterpolation()!==Eo.FLAT?s.getPointData().getNormals():null;c===null&&s.getCellData().getNormals()&&(e.haveCellNormals=!0,c=s.getCellData().getNormals());const u=a.getProperty().getRepresentation();let g=s.getPointData().getTCoords();e.openGLActor.getActiveTextures()||(g=null);let f=!1;if(e.renderable.getColorCoordinates()){g=e.renderable.getColorCoordinates(),f=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=dt.newInstance({resizable:!0}));const h=e.internalColorTexture;h.setMinificationFilter(Mo.NEAREST),h.setMagnificationFilter(Mo.NEAREST),h.setWrapS(Ro.CLAMP_TO_EDGE),h.setWrapT(Ro.CLAMP_TO_EDGE),h.setOpenGLRenderWindow(e._openGLRenderWindow);const v=e.renderable.getColorTextureMap(),p=v.getExtent(),y=v.getPointData().getScalars();h.create2DFromRaw({width:p[1]-p[0]+1,height:p[3]-p[2]+1,numComps:y.getNumberOfComponents(),dataType:y.getDataType(),data:y.getData()}),h.activate(),h.sendParameters(),h.deactivate()}const l=`${s.getMTime()}A${u}B${s.getMTime()}C${c?c.getMTime():1}D${i?i.getMTime():1}E${a.getProperty().getEdgeVisibility()}F${g?g.getMTime():1}`;if(e.VBOBuildString!==l){const v={points:s.getPoints(),normals:c,tcoords:g,colors:i,cellOffset:0,vertexOffset:0,useTCoordsPerCell:f,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(T=>s.getPointData().getArrayByName(T))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});const p=[{inRep:"verts",cells:s.getVerts()},{inRep:"lines",cells:s.getLines()},{inRep:"polys",cells:s.getPolys()},{inRep:"strips",cells:s.getStrips()},{inRep:"polys",cells:s.getPolys()},{inRep:"strips",cells:s.getStrips()}],y=a.getProperty().getEdgeVisibility()&&u===ln.SURFACE;for(let T=ve.Start;T<ve.End;T++)T!==ve.TrisEdges&&T!==ve.TriStripsEdges?(v.cellOffset+=e.primitives[T].getCABO().createVBO(p[T].cells,p[T].inRep,u,v,e.selectionWebGLIdsToVTKIds),v.vertexOffset+=e.primitives[T].getCABO().getElementCount()):y?e.primitives[T].getCABO().createVBO(p[T].cells,p[T].inRep,ln.WIREFRAME,{...v,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[T].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),e.VBOBuildString=l}e.VBOBuildTime.modified()},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(a=>{r+=a.getAllocatedGPUMemoryInBytes()}),r}}const C2={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:ke.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function w2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,C2,n),fe.extend(t,e,n),aa.implementReplaceShaderCoincidentOffset(t,e,n),aa.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=ve,e.tmpMat3=Nt(new Float64Array(9)),e.tmpMat4=Y(new Float64Array(16));for(let r=ve.Start;r<ve.End;r++)e.primitives[r]=Bn.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Te(t,e,["context"]),e.VBOBuildTime={},Me(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},Me(e.selectionStateChanged,{mtime:0}),S2(t,e)}const E2=re(w2,"vtkOpenGLPolyDataMapper");Ie("vtkMapper",E2);var M2=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

uniform int PrimitiveIDOffset;

// Texture coordinates
//VTK::TCoord::Dec

// Scalar coloring
//VTK::Color::Dec

// Depth Peeling
//VTK::DepthPeeling::Dec

// picking support
//VTK::Picking::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Color::Impl
  //VTK::TCoord::Impl

  //VTK::DepthPeeling::Impl
  //VTK::Picking::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }
}
`,R2=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model Coordinates
// WC - WC world coordinates
// VC - View Coordinates
// DC - Display Coordinates

in vec4 vertexWC;

// frag position in VC
//VTK::PositionVC::Dec

// material property values
//VTK::Color::Dec

// Texture coordinates
//VTK::TCoord::Dec

// Apple Bug
//VTK::PrimID::Dec

uniform mat4 WCVCMatrix;  // World to view matrix

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  gl_Position = WCVCMatrix*vertexWC;

  //VTK::TCoord::Impl

  //VTK::Color::Impl

  //VTK::PositionVC::Impl
}
`;const Eg={BACKGROUND:0,FOREGROUND:1};var Mg={DisplayLocation:Eg};const{primTypes:Qe}=Bn,{Filter:Oo,Wrap:Do}=dt,{vtkErrorMacro:kn}=ft,O2={type:"StartEvent"},D2={type:"EndEvent"};function L2(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper2D"),t.buildPass=r=>{r&&(e.openGLActor2D=t.getFirstAncestorOfType("vtkOpenGLActor2D"),e._openGLRenderer=e.openGLActor2D.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.overlayPass=r=>{r&&t.render()},t.getShaderTemplate=(r,a,s)=>{r.Vertex=R2,r.Fragment=M2,r.Geometry=""},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let i=Qe.Start;i<Qe.End;i++)e.primitives[i].setOpenGLRenderWindow(e._openGLRenderWindow)}const a=e.openGLActor2D.getRenderable(),s=e._openGLRenderer.getRenderable();t.renderPiece(s,a)},t.renderPiece=(r,a)=>{if(t.invokeEvent(O2),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(D2),!e.currentInput){kn("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const s=e.context;e._openGLRenderWindow.enableCullFace(),s.cullFace(s.BACK),t.renderPieceStart(r,a),t.renderPieceDraw(r,a),t.renderPieceFinish(r,a)},t.renderPieceStart=(r,a)=>{if(e.primitiveIDOffset=0,e._openGLRenderer.getSelector())switch(e._openGLRenderer.getSelector().getCurrentPass()){default:e._openGLRenderer.getSelector().renderProp(a)}e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),t.updateBufferObjects(r,a),e.lastBoundBO=null},t.getNeedToRebuildShaders=(r,a,s)=>r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime(),t.updateBufferObjects=(r,a)=>{t.getNeedToRebuildBufferObjects(r,a)&&t.buildBufferObjects(r,a)},t.getNeedToRebuildBufferObjects=(r,a)=>{const s=e.VBOBuildTime.getMTime();return!!(s<t.getMTime()||s<e._openGLRenderWindow.getMTime()||s<e.renderable.getMTime()||s<a.getMTime()||s<e.currentInput.getMTime()||e.renderable.getTransformCoordinate()&&s<r.getMTime())},t.buildBufferObjects=(r,a)=>{const s=e.currentInput;if(s===null)return;e.renderable.mapScalars(s,a.getProperty().getOpacity());const i=e.renderable.getColorMapColors(),o=a.getProperty().getRepresentation();let c=s.getPointData().getTCoords();e.openGLActor2D.getActiveTextures()||(c=null);let u=!1;if(e.renderable.getColorCoordinates()){c=e.renderable.getColorCoordinates(),u=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=dt.newInstance({resizable:!0}));const v=e.internalColorTexture;v.setMinificationFilter(Oo.NEAREST),v.setMagnificationFilter(Oo.NEAREST),v.setWrapS(Do.CLAMP_TO_EDGE),v.setWrapT(Do.CLAMP_TO_EDGE),v.setOpenGLRenderWindow(e._openGLRenderWindow);const p=e.renderable.getColorTextureMap(),y=p.getExtent(),T=p.getPointData().getScalars();v.create2DFromRaw({width:y[1]-y[0]+1,height:y[3]-y[2]+1,numComps:T.getNumberOfComponents(),dataType:T.getDataType(),data:T.getData()}),v.activate(),v.sendParameters(),v.deactivate()}const g=e.renderable.getTransformCoordinate(),l=r.getRenderWindow().getViews()[0].getViewportSize(r),h=`${s.getMTime()}A${o}B${s.getMTime()}C${i?i.getMTime():1}D${c?c.getMTime():1}E${g?r.getMTime():1}F${l}`;if(e.VBOBuildString!==h){let v=s.getPoints();if(g){const y=Jn.newInstance(),T=v.getNumberOfPoints();y.setNumberOfPoints(T);const S=[];for(let d=0;d<T;++d){v.getPoint(d,S),g.setValue(S);const x=g.getComputedDoubleViewportValue(r);y.setPoint(d,x[0],x[1],0)}v=y}const p={points:v,tcoords:c,colors:i,cellOffset:0,useTCoordsPerCell:u,haveCellScalars:e.renderable.getAreScalarsMappedFromCells(),customAttributes:e.renderable.getCustomShaderAttributes().map(y=>s.getPointData().getArrayByName(y))};p.cellOffset+=e.primitives[Qe.Points].getCABO().createVBO(s.getVerts(),"verts",o,p),p.cellOffset+=e.primitives[Qe.Lines].getCABO().createVBO(s.getLines(),"lines",o,p),p.cellOffset+=e.primitives[Qe.Tris].getCABO().createVBO(s.getPolys(),"polys",o,p),p.cellOffset+=e.primitives[Qe.TriStrips].getCABO().createVBO(s.getStrips(),"strips",o,p),e.VBOBuildTime.modified(),e.VBOBuildString=h}},t.renderPieceDraw=(r,a)=>{const s=a.getProperty().getRepresentation();e.context.depthMask(!0);for(let o=Qe.Start;o<Qe.End;o++)e.primitives[o].getCABO().getElementCount()&&(e.lastBoundBO=e.primitives[o],e.primitiveIDOffset+=e.primitives[o].drawArrays(r,a,s,t))},t.renderPieceFinish=(r,a)=>{e.lastBoundBO&&e.lastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.replaceShaderValues=(r,a,s)=>{t.replaceShaderColor(r,a,s),t.replaceShaderTCoord(r,a,s),t.replaceShaderPicking(r,a,s),t.replaceShaderPositionVC(r,a,s)},t.replaceShaderColor=(r,a,s)=>{let i=r.Vertex,o=r.Geometry,c=r.Fragment,u=["uniform vec3 diffuseColorUniform;","uniform float opacityUniform;"],g=["vec3 diffuseColor = diffuseColorUniform;","float opacity = opacityUniform;"];e.lastBoundBO.getCABO().getColorComponents()!==0?(u=u.concat(["varying vec4 vertexColorVSOutput;"]),i=m.substitute(i,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,i=m.substitute(i,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,o=m.substitute(o,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,o=m.substitute(o,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result,c=m.substitute(c,"//VTK::Color::Impl",g.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result):e.renderable.getAreScalarsMappedFromCells()&&(g=g.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  opacity = opacity*texColor.a;"])),g=g.concat(["gl_FragData[0] = vec4(diffuseColor, opacity);"]),c=m.substitute(c,"//VTK::Color::Dec",u).result,c=m.substitute(c,"//VTK::Color::Impl",g).result,r.Vertex=i,r.Geometry=o,r.Fragment=c},t.replaceShaderTCoord=(r,a,s)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let i=r.Vertex,o=r.Geometry,c=r.Fragment;const u=e.lastBoundBO.getCABO().getTCoordComponents();u===1?(i=m.substitute(i,"//VTK::TCoord::Dec",["in float tcoordMC;","out float tcoordVCVSOutput;"]).result,i=m.substitute(i,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,o=m.substitute(o,"//VTK::TCoord::Dec",[`in float tcoordVCVSOutput[];
`,"out float tcoordVCGSOutput;"]).result,o=m.substitute(o,["//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=m.substitute(c,"//VTK::TCoord::Dec",["in float tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=m.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, vec2(tcoordVCVSOutput,0));"]).result):u===2&&(i=m.substitute(i,"//VTK::TCoord::Dec",["in vec2 tcoordMC;","out vec2 tcoordVCVSOutput;"]).result,i=m.substitute(i,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,o=m.substitute(o,"//VTK::TCoord::Dec",[`in vec2 tcoordVCVSOutput[];
`,"out vec2 tcoordVCGSOutput;"]).result,o=m.substitute(o,"//VTK::TCoord::Impl",["tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=m.substitute(c,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=m.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, tcoordVCVSOutput.st);"]).result),e.renderable.getAreScalarsMappedFromCells()&&(o=m.substitute(o,"//VTK::PrimID::Impl",["gl_PrimitiveID = gl_PrimitiveIDIn;"]).result),r.Vertex=i,r.Geometry=o,r.Fragment=c}},t.replaceShaderPicking=(r,a,s)=>{let i=r.Fragment;i=m.substitute(i,"//VTK::Picking::Dec",["uniform vec3 mapperIndex;","uniform int picking;"]).result,i=m.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result,r.Fragment=i},t.replaceShaderPositionVC=(r,a,s)=>{e.lastBoundBO.replaceShaderPositionVC(r,a,s)},t.invokeShaderCallbacks=(r,a,s)=>{const i=e.renderable.getViewSpecificProperties().ShadersCallbacks;i&&i.forEach(o=>{o.callback(o.userData,r,a,s)})},t.setMapperShaderParameters=(r,a,s)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isAttributeUsed("vertexWC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexWC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||kn("Error setting vertexWC in shader VAO.")),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){e.renderable.getCustomShaderAttributes().forEach((c,u)=>{r.getProgram().isAttributeUsed(`${c}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${c}MC`,r.getCABO().getCustomData()[u].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[u].components,!1)||kn(`Error setting ${c}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||kn("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),r.getProgram().isAttributeUsed("scalarColor")&&r.getCABO().getColorComponents()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"scalarColor",r.getCABO().getColorOffset(),r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||kn("Error setting scalarColor in shader VAO."):r.getVAO().removeAttributeArray("scalarColor"),e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&e.internalColorTexture.getTextureUnit()>-1&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const i=e.openGLActor2D.getActiveTextures();if(i)for(let c=0;c<i.length;++c){const g=i[c].getTextureUnit(),f=`texture${g+1}`;r.getProgram().isUniformUsed(f)&&r.getProgram().setUniformi(f,g)}r.setMapperShaderParameters(a,s,e._openGLRenderer.getTiledSizeAndOrigin());const o=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",o?o.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",o?o.getCurrentPass()+1:0)}},t.setPropertyShaderParameters=(r,a,s)=>{const i=e.renderable.getColorMapColors();if(!i||i.getNumberOfComponents()===0){const o=r.getProgram(),c=s.getProperty(),u=c.getOpacity();o.setUniformf("opacityUniform",u);const g=c.getColor();o.setUniform3fArray("diffuseColorUniform",g)}},t.setLightingShaderParameters=(r,a,s)=>{};function n(r,a,s){return a.identity(s),r.reduce((i,o,c)=>c===0?o?a.copy(i,o):a.identity(i):o?a.multiply(i,i,o):i,s)}t.setCameraShaderParameters=(r,a,s)=>{const i=r.getProgram(),c=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,g=a.getRenderWindow().getViews()[0].getViewportSize(a),f=a.getViewport(),l=s.getActualPositionCoordinate().getComputedDoubleViewportValue(a),h=[0,0,1,1],v=[0,0,1,1];if(v[0]=f[0]>=h[0]?f[0]:h[0],v[1]=f[1]>=h[1]?f[1]:h[1],v[2]=f[2]<=h[2]?f[2]:h[2],v[3]=f[3]<=h[3]?f[3]:h[3],v[0]>=v[2]||v[1]>=v[3])return;g[0]=$n(g[0]*(v[2]-v[0])/(f[2]-f[0])),g[1]=$n(g[1]*(v[3]-v[1])/(f[3]-f[1]));const p=e._openGLRenderer.getParent().getSize(),y=$n(l[0]-(v[0]-f[0])*p[0]),T=$n(l[1]-(v[1]-f[1])*p[1]),S=-y;let d=-y+g[0];const x=-T;let w=-T+g[1];S===d&&(d=S+1),x===w&&(w=x+1);const C=Y(new Float64Array(16));C[0]=2/(d-S),C[1*4+1]=2/(w-x),C[0*4+3]=-1*(d+S)/(d-S),C[1*4+3]=-1*(w+x)/(w-x),C[2*4+2]=0,C[2*4+3]=s.getProperty().getDisplayLocation()===Eg.FOREGROUND?-1:1,C[3*4+3]=1,ne(C,C),i.setUniformMatrix("WCVCMatrix",n([C,c],ja,e.tmpMat4))},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(a=>{r+=a.getAllocatedGPUMemoryInBytes()}),r}}const V2={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null};function B2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,V2,n),fe.extend(t,e,n),aa.implementReplaceShaderCoincidentOffset(t,e,n),aa.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=Qe,e.tmpMat4=Y(new Float64Array(16));for(let r=Qe.Start;r<Qe.End;r++)e.primitives[r]=Bn.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);Te(t,e,["context"]),e.VBOBuildTime={},Me(e.VBOBuildTime,{mtime:0}),L2(t,e)}const F2=re(B2,"vtkOpenGLPolyDataMapper2D");Ie("vtkMapper2D",F2);const{VectorMode:m2}=Fu;function Ua(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function Rg(t,e){return n=>{const r=n.getLastSize(),a=(r[0]/700)**.8,s=(r[1]/700)**.8,i=Math.min(a,s),o=n.getAxisTextStyle(),c=n.getTickTextStyle();Object.assign(o,e.axisTextStyle),Object.assign(c,e.tickTextStyle),o.fontSize=Math.max(24*i,12),n.getLastAspectRatio()>1?c.fontSize=Math.max(20*i,10):c.fontSize=Math.max(16*i,10);const u=n.updateTextureAtlas();n.setTopTitle(!1);const g=n.getBoxSizeByReference();if(n.getLastAspectRatio()>1)n.setTickLabelPixelOffset(.3*c.fontSize),u.titleWidth<=u.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize?(n.setTopTitle(!0),n.setAxisTitlePixelOffset(.2*c.fontSize),g[0]=2*(u.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize)/r[0],n.setBoxPosition([.98-g[0],-.92])):(n.setAxisTitlePixelOffset(.2*c.fontSize),g[0]=2*(u.titleHeight+n.getAxisTitlePixelOffset()+u.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize)/r[0],n.setBoxPosition([.99-g[0],-.92])),g[1]=Math.max(1.2,Math.min(1.84/s,1.84));else{n.setAxisTitlePixelOffset(1.2*c.fontSize),n.setTickLabelPixelOffset(.1*c.fontSize);const f=2*(.8*c.fontSize+u.titleHeight+n.getAxisTitlePixelOffset())/r[1],l=2*u.tickWidth/r[0];g[0]=Math.min(1.9,Math.max(1.4,1.4*l*(n.getTicks().length+3))),g[1]=f,n.setBoxPosition([-.5*g[0],-.97])}n.recomputeBarSegments(u)}}function Og(t,e){return n=>{const r=n.getLastTickBounds(),a=Gs().domain([r[0],r[1]]),s=a.ticks(5),i=a.tickFormat(5);n.setTicks(s),n.setTickStrings(s.map(i))}}function k2(t,e){e.classHierarchy.push("vtkScalarBarActorHelper"),t.setRenderable=a=>{e.renderable!==a&&(e.renderable=a,e.barActor.setProperty(a.getProperty()),e.barActor.setParentProp(a),e.barActor.setCoordinateSystemToDisplay(),e.tmActor.setProperty(a.getProperty()),e.tmActor.setParentProp(a),e.tmActor.setCoordinateSystemToDisplay(),e.generateTicks=a.generateTicks,e.axisTextStyle={...a.getAxisTextStyle()},e.tickTextStyle={...a.getTickTextStyle()},t.modified())},t.updateAPISpecificData=(a,s,i)=>{(e.lastSize[0]!==a[0]||e.lastSize[1]!==a[1])&&(e.lastSize[0]=a[0],e.lastSize[1]=a[1],e.lastAspectRatio=a[0]/a[1],e.forceUpdate=!0);const o=e.renderable.getScalarsToColors();if(!(!o||!e.renderable.getVisibility())&&(e.barMapper.setLookupTable(o),e.camera=s,e.renderWindow=i,e.forceUpdate||Math.max(o.getMTime(),t.getMTime(),e.renderable.getMTime())>e.lastRebuildTime.getMTime())){const c=o.getMappingRange();if(e.lastTickBounds=[...c],e.renderable.getGenerateTicks()(t),e.renderable.getAutomated())e.renderable.getAutoLayout()(t);else{e.axisTextStyle={...e.renderable.getAxisTextStyle()},e.tickTextStyle={...e.renderable.getTickTextStyle()},e.barPosition=[...e.renderable.getBarPosition()],e.barSize=[...e.renderable.getBarSize()],e.boxPosition=[...e.renderable.getBoxPosition()],e.boxSize=[...e.renderable.getBoxSize()],e.axisTitlePixelOffset=e.renderable.getAxisTitlePixelOffset(),e.tickLabelPixelOffset=e.renderable.getTickLabelPixelOffset();const u=t.updateTextureAtlas();t.recomputeBarSegments(u)}t.updatePolyDataForLabels(),t.updatePolyDataForBarSegments(),e.lastRebuildTime.modified(),e.forceUpdate=!1}},t.updateTextureAtlas=()=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left";const a={},s=new Map;let i=0,o=1;Ua(e.tmContext,e.axisTextStyle);let c=e.tmContext.measureText(e.renderable.getAxisLabel()),u={height:c.actualBoundingBoxAscent+2,startingHeight:o,width:c.width+2,textStyle:e.axisTextStyle};s.set(e.renderable.getAxisLabel(),u),o+=u.height,i=u.width,a.titleWidth=u.width,a.titleHeight=u.height,a.tickWidth=0,a.tickHeight=0,Ua(e.tmContext,e.tickTextStyle);const g=[...t.getTickStrings(),"NaN","Below","Above"];for(let f=0;f<g.length;f++)s.has(g[f])||(c=e.tmContext.measureText(g[f]),u={height:c.actualBoundingBoxAscent+2,startingHeight:o,width:c.width+2,textStyle:e.tickTextStyle},s.set(g[f],u),o+=u.height,i<u.width&&(i=u.width),a.tickWidth<u.width&&(a.tickWidth=u.width),a.tickHeight<u.height&&(a.tickHeight=u.height));return i=Ke(i),o=Ke(o),s.forEach(f=>{f.tcoords=[0,(o-f.startingHeight-f.height)/o,f.width/i,(o-f.startingHeight-f.height)/o,f.width/i,(o-f.startingHeight)/o,0,(o-f.startingHeight)/o]}),e.tmCanvas.width=i,e.tmCanvas.height=o,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,i,o),s.forEach((f,l)=>{Ua(e.tmContext,f.textStyle),e.tmContext.fillText(l,1,f.startingHeight+f.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified(),e._tmAtlas=s,a},t.computeBarSize=a=>{e.vertical=e.boxSize[1]>e.boxSize[0];const s=2*a.tickHeight/e.lastSize[1],i=[1,1];if(e.vertical){const o=2*(a.tickWidth+e.tickLabelPixelOffset)/e.lastSize[0];if(e.topTitle){const c=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0]-o,e.barSize[1]=e.boxSize[1]-c}else{const c=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[0];e.barSize[0]=e.boxSize[0]-c-o,e.barSize[1]=e.boxSize[1]}e.barPosition[0]=e.boxPosition[0]+o,e.barPosition[1]=e.boxPosition[1],i[1]=s}else{const o=(2*a.tickWidth-8)/e.lastSize[0],c=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0],e.barPosition[0]=e.boxPosition[0],e.barSize[1]=e.boxSize[1]-c,e.barPosition[1]=e.boxPosition[1],i[0]=o}return i},t.recomputeBarSegments=a=>{var l,h,v,p;const s=t.computeBarSize(a);e.barSegments=[];const i=[0,0],o=e.vertical?1:0,c=e.vertical?.01:.02;function u(y,T){e.barSegments.push({corners:[[...i],[i[0]+s[0],i[1]],[i[0]+s[0],i[1]+s[1]],[i[0],i[1]+s[1]]],scalars:T,title:y}),i[o]+=s[o]+c}e.renderable.getDrawNanAnnotation()&&e.renderable.getScalarsToColors().getNanColor()&&u("NaN",[NaN,NaN,NaN,NaN]),e.renderable.getDrawBelowRangeSwatch()&&((h=(l=e.renderable.getScalarsToColors()).getUseBelowRangeColor)!=null&&h.call(l))&&u("Below",[-.1,-.1,-.1,-.1]);const g=(p=(v=e.renderable.getScalarsToColors()).getUseAboveRangeColor)==null?void 0:p.call(v);i[o]+=c;const f=s[o];s[o]=g?1-2*c-s[o]-i[o]:1-c-i[o],u("ticks",e.vertical?[0,0,.995,.995]:[0,.995,.995,0]),e.renderable.getDrawAboveRangeSwatch()&&g&&(s[o]=f,i[o]+=c,u("Above",[1.1,1.1,1.1,1.1]))};const n=new Float64Array(3);t.createPolyDataForOneLabel=(a,s,i,o,c,u)=>{const g=e._tmAtlas.get(a);if(!g)return;let f=u.ptIdx,l=u.cellIdx;n[0]=(.5*s[0]+.5)*e.lastSize[0],n[1]=(.5*s[1]+.5)*e.lastSize[1],n[2]=s[2],n[0]+=c[0],n[1]+=c[1];const h=[],v=o==="vertical"?[1,0]:[0,1];o==="vertical"?(h[0]=g.width,h[1]=-g.height,i[0]==="middle"?n[1]-=g.width/2:i[0]==="right"&&(n[1]-=g.width),i[1]==="middle"?n[0]+=g.height/2:i[1]==="top"&&(n[0]+=g.height)):(h[0]=g.width,h[1]=g.height,i[0]==="middle"?n[0]-=g.width/2:i[0]==="right"&&(n[0]-=g.width),i[1]==="middle"?n[1]-=g.height/2:i[1]==="top"&&(n[1]-=g.height)),u.points[f*3]=n[0],u.points[f*3+1]=n[1],u.points[f*3+2]=n[2],u.tcoords[f*2]=g.tcoords[0],u.tcoords[f*2+1]=g.tcoords[1],f++,n[v[0]]+=h[0],u.points[f*3]=n[0],u.points[f*3+1]=n[1],u.points[f*3+2]=n[2],u.tcoords[f*2]=g.tcoords[2],u.tcoords[f*2+1]=g.tcoords[3],f++,n[v[1]]+=h[1],u.points[f*3]=n[0],u.points[f*3+1]=n[1],u.points[f*3+2]=n[2],u.tcoords[f*2]=g.tcoords[4],u.tcoords[f*2+1]=g.tcoords[5],f++,n[v[0]]-=h[0],u.points[f*3]=n[0],u.points[f*3+1]=n[1],u.points[f*3+2]=n[2],u.tcoords[f*2]=g.tcoords[6],u.tcoords[f*2+1]=g.tcoords[7],f++,u.polys[l*4]=3,u.polys[l*4+1]=f-4,u.polys[l*4+2]=f-3,u.polys[l*4+3]=f-2,l++,u.polys[l*4]=3,u.polys[l*4+1]=f-4,u.polys[l*4+2]=f-2,u.polys[l*4+3]=f-1,u.ptIdx+=4,u.cellIdx+=2};const r=new Float64Array(3);t.updatePolyDataForLabels=()=>{const a=t.getTickStrings().length+e.barSegments.length,s=a*4,i=a*2,o=new Float64Array(s*3),c=new Uint16Array(i*4),u=new Float32Array(s*2),g={ptIdx:0,cellIdx:0,polys:c,points:o,tcoords:u},f=e.vertical?0:1,l=e.vertical?1:0;r[2]=-.99;const h=e.vertical?["right","middle"]:["middle","bottom"];let v=[0,1];const p=[0,0];e.vertical?(p[0]=-e.tickLabelPixelOffset,e.topTitle?(r[0]=e.boxPosition[0]+.5*e.boxSize[0],r[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],g)):(r[0]=e.barPosition[0]+e.barSize[0],r[1]=e.barPosition[1]+.5*e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","top"],"vertical",[e.axisTitlePixelOffset,0],g)),v=[-1,0]):(p[1]=e.tickLabelPixelOffset,r[0]=e.barPosition[0]+.5*e.barSize[0],r[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],g)),r[f]=e.barPosition[f]+(.5*v[f]+.5)*e.barSize[f],r[l]=e.barPosition[l]+e.barSize[l]*.5;let y=null;for(let M=0;M<e.barSegments.length;M++){const R=e.barSegments[M];R.title==="ticks"?y=R:(r[l]=e.barPosition[l]+.5*e.barSize[l]*(R.corners[2][l]+R.corners[0][l]),t.createPolyDataForOneLabel(R.title,r,h,"horizontal",p,g))}const T=e.barPosition[l]+e.barSize[l]*y.corners[0][l],S=e.barSize[l]*(y.corners[2][l]-y.corners[0][l]),d=t.getTicks(),x=t.getTickStrings(),w=t.getTickPositions();for(let M=0;M<d.length;M++){const R=w?w[M]:(d[M]-e.lastTickBounds[0])/(e.lastTickBounds[1]-e.lastTickBounds[0]);r[l]=T+S*R,t.createPolyDataForOneLabel(x[M],r,h,"horizontal",p,g)}const C=ee.newInstance({numberOfComponents:2,values:u,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(C),e.tmPolyData.getPoints().setData(o,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(c,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updatePolyDataForBarSegments=()=>{var p,y;const a=e.renderable.getScalarsToColors();let s=0;e.renderable.getDrawNanAnnotation()&&a.getNanColor()&&(s+=1),e.renderable.getDrawBelowRangeSwatch()&&((p=a.getUseBelowRangeColor)!=null&&p.call(a))&&(s+=1),e.renderable.getDrawAboveRangeSwatch()&&((y=a.getUseAboveRangeColor)!=null&&y.call(a))&&(s+=1);const i=4*(1+s),o=i;let c=1;a.getVectorMode()===m2.COMPONENT&&(c=a.getVectorComponent()+1);const u=new Float64Array(i*3),g=new Uint16Array(o*5),f=new Float32Array(i*c);let l=0,h=0;for(let T=0;T<e.barSegments.length;T++){const S=e.barSegments[T];for(let d=0;d<4;d++){r[0]=e.barPosition[0]+S.corners[d][0]*e.barSize[0],r[1]=e.barPosition[1]+S.corners[d][1]*e.barSize[1],u[l*3]=(.5*r[0]+.5)*e.lastSize[0],u[l*3+1]=(.5*r[1]+.5)*e.lastSize[1],u[l*3+2]=r[2];for(let x=0;x<c;x++)f[l*c+x]=e.lastTickBounds[0]+S.scalars[d]*(e.lastTickBounds[1]-e.lastTickBounds[0]);l++}g[h*5]=4,g[h*5+1]=l-4,g[h*5+2]=l-3,g[h*5+3]=l-2,g[h*5+4]=l-1,h++}const v=ee.newInstance({numberOfComponents:c,values:f,name:"Scalars"});e.polyData.getPointData().setScalars(v),e.polyData.getPoints().setData(u,3),e.polyData.getPoints().modified(),e.polyData.getPolys().setData(g,1),e.polyData.getPolys().modified(),e.polyData.modified()}}const U2=E.newInstance(function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},n),E.obj(t,e),E.setGet(t,e,["axisTitlePixelOffset","tickLabelPixelOffset","renderable","topTitle","ticks","tickStrings","tickPositions"]),E.get(t,e,["lastSize","lastAspectRatio","lastTickBounds","axisTextStyle","tickTextStyle","barActor","tmActor"]),E.getArray(t,e,["boxPosition","boxSize"]),E.setArray(t,e,["boxPosition","boxSize"],2),e.forceUpdate=!1,e.lastRebuildTime={},E.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.barMapper=an.newInstance(),e.barMapper.setInterpolateScalarsBeforeMapping(!0),e.barMapper.setUseLookupTableScalarRange(!0),e.polyData=St.newInstance(),e.barMapper.setInputData(e.polyData),e.barActor=rn.newInstance(),e.barActor.setMapper(e.barMapper),e.tmPolyData=St.newInstance(),e.tmMapper=an.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmTexture=tr.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),e.tmActor=rn.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),e.tmActor.addTexture(e.tmTexture),e.barPosition=[0,0],e.barSize=[0,0],e.boxPosition=[.88,-.92],e.boxSize=[.1,1.1],e.lastTickBounds=[],k2(t,e)},"vtkScalarBarActorHelper");function N2(t,e){e.classHierarchy.push("vtkScalarBarActor"),t.setTickTextStyle=n=>{e.tickTextStyle={...e.tickTextStyle,...n},t.modified()},t.setAxisTextStyle=n=>{e.axisTextStyle={...e.axisTextStyle,...n},t.modified()},t.resetAutoLayoutToDefault=()=>{t.setAutoLayout(Rg(t,e))},t.resetGenerateTicksToDefault=()=>{t.setGenerateTicks(Og())}}function _2(t){return{automated:!0,autoLayout:null,axisLabel:"Scalar Value",barPosition:[0,0],barSize:[0,0],boxPosition:[.88,-.92],boxSize:[.1,1.1],scalarToColors:null,axisTitlePixelOffset:36,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif"},tickLabelPixelOffset:14,tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif"},generateTicks:null,drawNanAnnotation:!0,drawBelowRangeSwatch:!0,drawAboveRangeSwatch:!0,...t}}function Dg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,_2(n)),e.autoLayout||(e.autoLayout=Rg(t,e)),e.generateTicks||(e.generateTicks=Og()),rn.extend(t,e,n),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),E.setGet(t,e,["automated","autoLayout","axisTitlePixelOffset","axisLabel","scalarsToColors","tickLabelPixelOffset","generateTicks","drawNanAnnotation","drawBelowRangeSwatch","drawAboveRangeSwatch"]),E.get(t,e,["axisTextStyle","tickTextStyle"]),E.getArray(t,e,["barPosition","barSize","boxPosition","boxSize"]),E.setArray(t,e,["barPosition","barSize","boxPosition","boxSize"],2),N2(t,e)}const G2=E.newInstance(Dg,"vtkScalarBarActor");var Lg={newInstance:G2,extend:Dg,newScalarBarActorHelper:U2};function b2(t,e){e.classHierarchy.push("vtkOpenGLScalarBarActor"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,s=e._openGLRenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e._openGLRenderWindow.getRenderable())}}}const $2={};function z2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$2,n),fe.extend(t,e,n),e.scalarBarActorHelper=Lg.newScalarBarActorHelper(),b2(t,e)}const W2=re(z2,"vtkOpenGLScalarBarActor");Ie("vtkScalarBarActor",W2);const{vtkErrorMacro:Lo}=ft;function H2(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=n=>{if(n){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const r=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(r.getActiveCamera())}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOpaqueActorCount()}},t.opaquePass=(n,r)=>{if(n&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);const a=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",a);const s=e._openGLRenderer.getRenderable(),i=e.openGLCamera.getKeyMatrices(s),o=new Float64Array(16);if(Ve(o,i.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",o),e.lastFormat==="box"){const c=s.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",c[0],c[1],c[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){const r=new Float32Array(12);for(let o=0;o<4;o++)r[o*3]=o%2*2-1,r[o*3+1]=o>1?1:-1,r[o*3+2]=1;const a=ee.newInstance({numberOfComponents:3,values:r});a.setName("points");const s=new Uint16Array(8);s[0]=3,s[1]=0,s[2]=1,s[3]=3,s[4]=3,s[5]=0,s[6]=3,s[7]=2;const i=ee.newInstance({numberOfComponents:1,values:s});e.tris.getCABO().createVBO(i,"polys",Xe.SURFACE,{points:a,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Lo("Error setting vertexMC in shader VAO."));const n=e.renderable.getTextures();n.length||Lo("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==n[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(n[0]))}}const A2={context:null};function j2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,A2,n),fe.extend(t,e,n),e.openGLTexture=dt.newInstance(),e.tris=Bn.newInstance(),e.keyMatrixTime={},Me(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:Nt(new Float64Array(9)),mcwc:Y(new Float64Array(16))},Te(t,e,["context"]),Ne(t,e,["activeTextures"]),H2(t,e)}const K2=re(j2);Ie("vtkSkybox",K2);const{vtkDebugMacro:P2}=ft;function X2(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");const a=e._openGLRenderer.getAspectRatio(),s=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,i=e._openGLRenderer.getTiledSizeAndOrigin();let o=null;if(e.renderable.getUseZValues()){const c=r.getZBufferTexture(),u=Math.floor(c.getWidth()),g=Math.floor(c.getHeight()),f=e._openGLRenderWindow.getContext();c.bind();const l=r.getFramebuffer();l?l.saveCurrentBindingsAndBuffers():P2("No framebuffer to save/restore");const h=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,h),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,c.getHandle(),0),f.checkFramebufferStatus(f.FRAMEBUFFER)===f.FRAMEBUFFER_COMPLETE&&(o=new Uint8Array(u*g*4),f.viewport(0,0,u,g),f.readPixels(0,0,u,g,f.RGBA,f.UNSIGNED_BYTE,o)),l&&l.restorePreviousBindingsAndBuffers(),f.deleteFramebuffer(h)}e.renderable.invokeCallback(e.renderable.getInputData(),s,a,i,o)},t.queryPass=(n,r)=>{n&&e.renderable.getUseZValues()&&r.requestDepth()}}const I2={};function Y2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,I2,n),fe.extend(t,e,n),X2(t,e)}const Q2=re(Y2,"vtkOpenGLPixelSpaceCallbackMapper");Ie("vtkPixelSpaceCallbackMapper",Q2);const Vg=Object.create(null);function ut(t,e){Vg[t]=e}function Z2(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}const q2={};function Bg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,q2,n),e.overrides=Vg,rf.extend(t,e,n),Z2(t,e)}const J2=E.newInstance(Bg,"vtkWebGPUViewNodeFactory");var eS={newInstance:J2,extend:Bg};function tS(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(n,r,a,s)=>{if(Y(n),e.renderable.getParallelProjection()){const i=e.renderable.getParallelScale(),o=i*r,c=i,u=(s[0]-1)*o,g=(s[0]+1)*o,f=(s[1]-1)*c,l=(s[1]+1)*c,h=1/(g-u),v=1/(l-f);n[0]=2*h,n[5]=2*v,n[10]=1/(a[1]-a[0]),n[12]=(g+u)*h,n[13]=(l+f)*v,n[14]=a[1]/(a[1]-a[0])}else{const i=Math.tan(Math.PI*e.renderable.getViewAngle()/360);let o,c;e.renderable.getUseHorizontalViewAngle()===!0?(o=a[0]*i,c=a[0]*i/r):(o=a[0]*i*r,c=a[0]*i);const u=(s[0]-1)*o,g=(s[0]+1)*o,f=(s[1]-1)*c,l=(s[1]+1)*c;n[0]=2*a[0]/(g-u),n[5]=2*a[0]/(l-f),n[12]=(u+g)/(g-u),n[13]=(f+l)/(l-f),n[10]=0,n[14]=a[0],n[11]=-1,n[15]=0}},t.convertToOpenGLDepth=n=>{if(e.renderable.getParallelProjection())return 1-n;const r=e.renderable.getClippingRangeByReference();let a=-r[0]/n;return a=(r[0]+r[1])/(r[1]-r[0])+2*r[0]*r[1]/(a*(r[1]-r[0])),.5*a+.5},t.getKeyMatrices=n=>{const r=n.getRenderable(),a=n.getParent();if(Math.max(a.getMTime(),t.getMTime(),r.getMTime(),e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatrixTime.getMTime()){const s=e.renderable.getViewMatrix();Oe(e.keyMatrices.normalMatrix,s),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Ve(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),ne(e.keyMatrices.wcvc,s);const i=n.getStabilizedCenterByReference();le(e.keyMatrices.scvc,e.keyMatrices.wcvc,i);const o=n.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,o,c,e.renderable.getWindowCenterByReference()),pe(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),Ve(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}const nS={keyMatrixTime:null,keyMatrices:null};function rS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nS,n),fe.extend(t,e,n),e.keyMatrixTime={},E.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},E.setGet(t,e,["keyMatrixTime"]),tS(t,e)}const aS=E.newInstance(rS);ut("vtkCamera",aS);function sS(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=n=>{if(e.bindables.length===n.length){let r=!0;for(let a=0;a<e.bindables.length;a++)e.bindables[a]!==n[a]&&(r=!1);if(r)return}e.bindables=n,t.modified()},t.getBindGroupLayout=n=>{const r=[];for(let a=0;a<e.bindables.length;a++){const s=e.bindables[a].getBindGroupLayoutEntry();s.binding=a,r.push(s)}return n.getBindGroupLayout({entries:r})},t.getBindGroup=n=>{let r=t.getMTime();for(let s=0;s<e.bindables.length;s++){const i=e.bindables[s].getBindGroupTime().getMTime();r=i>r?i:r}if(r<e.bindGroupTime.getMTime())return e.bindGroup;const a=[];for(let s=0;s<e.bindables.length;s++){const i=e.bindables[s].getBindGroupEntry();i.binding=s,a.push(i)}return e.bindGroup=n.getHandle().createBindGroup({layout:t.getBindGroupLayout(n),entries:a,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=n=>{const r=[],a=n.getBindGroupLayoutCount(e.label);for(let s=0;s<e.bindables.length;s++)r.push(e.bindables[s].getShaderCode(s,a));return r.join(`
`)}}const iS={device:null,handle:null,label:null};function Fg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iS,n),E.obj(t,e),e.bindables=[],e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),E.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),E.setGet(t,e,["label","device","arrayInformation"]),sS(t,e)}const oS=E.newInstance(Fg);var mg={newInstance:oS,extend:Fg};function cS(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(n,r)=>{e.device=n,e.handle=e.device.getHandle().createShaderModule({code:r.getCode()})}}const fS={device:null,handle:null};function kg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fS,n),E.obj(t,e),E.get(t,e,["lastCameraMTime"]),E.setGet(t,e,["device","handle"]),cS(t,e)}const uS=E.newInstance(kg,"vtkWebGPUShaderModule");var gS={newInstance:uS,extend:kg};function lS(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const a=Array.isArray(n)?n.join(`
`):n;let s=!1;t.search(e)!==-1&&(s=!0);let i="";r&&(i="g");const o=new RegExp(e,i),c=t.replace(o,a);return{replace:s,result:c}}function pS(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=n=>{const r=n.getType(),a=n.getHash(),s=e._shaderModules.keys();for(let o=0;o<s.length;o++){const c=s[o];if(c.getHash()===a&&c.getType()===r)return e._shaderModules.get(c)}const i=gS.newInstance();return i.initialize(e.device,n),e._shaderModules.set(n,i),i}}const hS={shaderModules:null,device:null,window:null};function Ug(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hS,n),e._shaderModules=new Map,E.obj(t,e),E.setGet(t,e,["device","window"]),pS(t,e)}const yS=E.newInstance(Ug,"vtkWebGPUShaderCache");var K={newInstance:yS,extend:Ug,substitute:lS};function vS(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(n,r)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=r;const a=[];for(let s=0;s<e.layouts.length;s++)a.push(e.layouts[s].layout);e.pipelineLayout=n.getHandle().createPipelineLayout({bindGroupLayouts:a}),e.pipelineDescription.layout=e.pipelineLayout;for(let s=0;s<e.shaderDescriptions.length;s++){const i=e.shaderDescriptions[s],o=n.getShaderModule(i);i.getType()==="vertex"&&(e.pipelineDescription.vertex.module=o.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),i.getType()==="fragment"&&(e.pipelineDescription.fragment.module=o.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=n.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=n=>{for(let r=0;r<e.shaderDescriptions.length;r++)if(e.shaderDescriptions[r].getType()===n)return e.shaderDescriptions[r];return null},t.addBindGroupLayout=n=>{n&&e.layouts.push({layout:n.getBindGroupLayout(e.device),label:n.getLabel()})},t.getBindGroupLayout=n=>e.layouts[n].layout,t.getBindGroupLayoutCount=n=>{for(let r=0;r<e.layouts.length;r++)if(e.layouts[r].label===n)return r;return 0},t.bindVertexInput=(n,r)=>{r.bindBuffers(n)}}const TS={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function Ng(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TS,n),Me(t,e),e.layouts=[],e.shaderDescriptions=[],Ne(t,e,["handle","pipelineDescription"]),Te(t,e,["device","renderEncoder","topology","vertexState"]),vS(t,e)}const dS=re(Ng,"vtkWebGPUPipeline");var xS={newInstance:dS,extend:Ng};function SS(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=n=>e.outputNames.includes(n),t.addOutput=function(n,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(n),e.outputNames.push(r),e.outputInterpolations.push(a)},t.addBuiltinOutput=(n,r)=>{e.builtinOutputTypes.push(n),e.builtinOutputNames.push(r)},t.addBuiltinInput=(n,r)=>{e.builtinInputTypes.push(n),e.builtinInputNames.push(r)},t.replaceShaderCode=(n,r)=>{const a=[];let s=[];if(r&&a.push(r.getShaderCode()),n||e.builtinInputNames.length){const i=[];if(i.push(`struct ${e.type}Input
{`),n){const o=n.getOutputNamesByReference(),c=n.getOutputTypesByReference(),u=n.getOutputInterpolationsByReference();for(let g=0;g<o.length;g++)u[g]!==void 0?i.push(`  @location(${g}) @interpolate(${u[g]}) ${o[g]} : ${c[g]},`):i.push(`  @location(${g}) ${o[g]} : ${c[g]},`)}for(let o=0;o<e.builtinInputNames.length;o++)i.push(`  ${e.builtinInputNames[o]} : ${e.builtinInputTypes[o]},`);i.length>1&&(i.push("};"),s=i,a[a.length-1]+=",",a.push(`input: ${e.type}Input`))}if(a.length&&(e.code=K.substitute(e.code,"//VTK::IOStructs::Input",a).result),e.outputNames.length+e.builtinOutputNames.length){const i=[`struct ${e.type}Output
{`];for(let o=0;o<e.outputNames.length;o++)e.outputInterpolations[o]!==void 0?i.push(`  @location(${o}) @interpolate(${e.outputInterpolations[o]}) ${e.outputNames[o]} : ${e.outputTypes[o]},`):i.push(`  @location(${o}) ${e.outputNames[o]} : ${e.outputTypes[o]},`);for(let o=0;o<e.builtinOutputNames.length;o++)i.push(`  ${e.builtinOutputNames[o]} : ${e.builtinOutputTypes[o]},`);i.push("};"),s=s.concat(i),e.code=K.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=K.substitute(e.code,"//VTK::IOStructs::Dec",s).result}}const CS={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function _g(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CS,n),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],E.obj(t,e),E.setGet(t,e,["type","hash","code"]),E.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),SS(t,e)}const wS=E.newInstance(_g,"vtkWebGPUShaderDescription");var Vo={newInstance:wS,extend:_g};const Bo={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function ES(t){return!t||t.length<6?0:t in Bo?Bo[t]:(X(`unknown format ${t}`),null)}function MS(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));const n=e===1?t.length-1:t.length-3,r=Number(t[n]);if(Number.isNaN(r))return X(`unknown format ${t}`),0;const a=5-r/2;return e*a}function RS(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function OS(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{X(`unknown format ${t}`);return}const n=t.split("x")[0],r=Number(n[n.length-1]);if(Number.isNaN(r)){X(`unknown format ${t}`);return}return e+=8*(5-r/2),e+="Array",e}function DS(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{X(`unknown format ${t}`);return}let n=1;return t[t.length-2]==="x"&&(n=Number(t[t.length-1])),n===4?`vec4<${e}>`:n===3?`vec3<${e}>`:n===2?`vec2<${e}>`:e}function LS(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function VS(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";X(`unknown format ${t}`)}}var Ce={getDetailsFromTextureFormat:ES,getByteStrideFromBufferFormat:MS,getNumberOfComponentsFromBufferFormat:RS,getNativeTypeFromBufferFormat:OS,getShaderTypeFromBufferFormat:DS,getByteStrideFromShaderFormat:LS,getNativeTypeFromShaderFormat:VS};function BS(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!e.includes(t[n]))return!1;return!0}function FS(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(n,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",s=r;Array.isArray(s)||(s=[s]);for(let i=0;i<e.inputs.length;i++)if(BS(e.inputs[i].names,s)){if(e.inputs[i].buffer===n)return;e.inputs[i].buffer=n;return}e.inputs.push({buffer:n,stepMode:a,names:s}),e.inputs=e.inputs.sort((i,o)=>i.names[0]<o.names[0]?-1:i.names[0]>o.names[0]?1:0)},t.removeBufferIfPresent=n=>{for(let r=0;r<e.inputs.length;r++)e.inputs[r].names.includes(n)&&e.inputs.splice(r,1)},t.getBuffer=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer;return null},t.hasAttribute=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return!0;return!1},t.getAttributeTime=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let n="",r=0;for(let a=0;a<e.inputs.length;a++)for(let s=0;s<e.inputs[a].names.length;s++){const i=e.inputs[a].buffer.getArrayInformation()[s],o=Ce.getShaderTypeFromBufferFormat(i.format);r>0&&(n+=`,
`),n=`${n}  @location(${r}) ${e.inputs[a].names[s]} : ${o}`,r++}return n},t.getVertexInputInformation=()=>{const n={};if(e.inputs.length){const r=[];let a=0;for(let s=0;s<e.inputs.length;s++){const i=e.inputs[s].buffer,o={arrayStride:i.getStrideInBytes(),stepMode:e.inputs[s].stepMode,attributes:[]},c=i.getArrayInformation();for(let u=0;u<e.inputs[s].names.length;u++)o.attributes.push({shaderLocation:a,offset:c[u].offset,format:c[u].format}),a++;r.push(o)}n.buffers=r}return n},t.bindBuffers=n=>{for(let r=0;r<e.inputs.length;r++)n.setVertexBuffer(r,e.inputs[r].buffer.getHandle());e.indexBuffer&&n.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}const mS={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function Gg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mS,n),Me(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],Te(t,e,["created","device","handle","indexBuffer"]),FS(t,e)}const kS=re(Gg,"vtkWebGPUVertexInput");var US={newInstance:kS,extend:Gg};const NS=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,_S=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function GS(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(n,r,a)=>{const s=Vo.newInstance({type:"vertex",hash:n,code:e.vertexShaderTemplate}),i=Vo.newInstance({type:"fragment",hash:n,code:e.fragmentShaderTemplate}),o=r.getShaderDescriptions();o.push(s),o.push(i);const c=e.vertexShaderTemplate+e.fragmentShaderTemplate,u=new RegExp("//VTK::[^:]*::","g"),f=c.match(u).filter((l,h,v)=>v.indexOf(l)===h).map(l=>`replaceShader${l.substring(7,l.length-2)}`);for(let l=0;l<f.length;l++){const h=f[l];h!=="replaceShaderIOStructs"&&e.shaderReplacements.has(h)&&e.shaderReplacements.get(h)(n,r,a)}t.replaceShaderIOStructs(n,r,a)},t.replaceShaderIOStructs=(n,r,a)=>{const s=r.getShaderDescription("vertex");s.replaceShaderCode(null,a),r.getShaderDescription("fragment").replaceShaderCode(s)},t.replaceShaderRenderEncoder=(n,r,a)=>{e.renderEncoder.replaceShaderCode(r)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(n,r,a)=>{if(!e.WebGPURenderer)return;const s=e.WebGPURenderer.getBindGroup().getShaderCode(r),i=r.getShaderDescription("vertex");let o=i.getCode();o=K.substitute(o,"//VTK::Renderer::Dec",[s]).result,i.setCode(o);const c=r.getShaderDescription("fragment");o=c.getCode(),o=K.substitute(o,"//VTK::Renderer::Dec",[s]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(n,r,a)=>{const s=e.bindGroup.getShaderCode(r),i=r.getShaderDescription("vertex");let o=i.getCode();o=K.substitute(o,"//VTK::Mapper::Dec",[s]).result,i.setCode(o);const c=r.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),o=c.getCode(),o=K.substitute(o,"//VTK::Mapper::Dec",[s]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(n,r,a)=>{const s=r.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let i=s.getCode();i=K.substitute(i,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,s.setCode(i)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(n,r,a)=>{r.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=n=>{e.textureViews.includes(n)||e.textureViews.push(n)},t.prepareToDraw=n=>{e.renderEncoder=n,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=n=>{n.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=n=>{t.prepareToDraw(n),n.setPipeline(e.pipeline),t.draw(n)},t.draw=n=>{const r=n.getBoundPipeline();n.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(n),r.bindVertexInput(n,e.vertexInput);const a=e.vertexInput.getIndexBuffer();a?n.drawIndexed(a.getIndexCount(),e.numberOfInstances,0,0,0):n.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{const n=[...e.additionalBindables];e.UBO&&n.push(e.UBO),e.SSBO&&n.push(e.SSBO);for(let r=0;r<e.textureViews.length;r++){n.push(e.textureViews[r]);const a=e.textureViews[r].getSampler();a&&n.push(a)}return n},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=xS.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}const bS={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function bg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bS,n),fe.extend(t,e,n),e.textureViews=[],e.vertexInput=US.newInstance(),e.bindGroup=mg.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||_S,e.vertexShaderTemplate=e.vertexShaderTemplate||NS,e.shaderReplacements=new Map,E.get(t,e,["pipeline","vertexInput"]),E.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),GS(t,e)}const $S=E.newInstance(bg,"vtkWebGPUSimpleMapper");var fi={newInstance:$S,extend:bg};function zS(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(n,r,a)=>{const s=r.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),s.addOutput("vec4<f32>","vertexVC");let i=s.getCode();i=K.substitute(i,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,s.setCode(i)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{const n=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(n,["vertexBC"]),e.numberOfVertices=6}}const WS={};function $g(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WS,n),fi.extend(t,e,n),zS(t,e)}const HS=E.newInstance($g,"vtkWebGPUFullScreenQuad");var Rn={newInstance:HS,extend:$g};const AS={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},jS={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6};var fr={BufferUsage:AS,PrimitiveTypes:jS};const Na=["getMappedRange","mapAsync","unmap"];function KS(t,e,n,r){const a=r.byteLength,s=t.createBuffer({size:a,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),i=s.getMappedRange(0,a);new Uint8Array(i).set(new Uint8Array(r)),s.unmap();const o=t.createCommandEncoder();o.copyBufferToBuffer(s,0,e,n,a);const c=o.finish();t.queue.submit([c]),s.destroy()}function PS(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n,usage:r,label:e.label}),e.sizeInBytes=n,e.usage=r},t.write=n=>{KS(e.device.getHandle(),e.handle,0,n.buffer)},t.createAndWrite=(n,r)=>{const a=Math.ceil(n.byteLength/4)*4;e.handle=e.device.getHandle().createBuffer({size:a,usage:r,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=a,e.usage=r,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(n.buffer)),e.handle.unmap()};for(let n=0;n<Na.length;n++)t[Na[n]]=function(){return e.handle[Na[n]](...arguments)}}const XS={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function zg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XS,n),E.obj(t,e),E.get(t,e,["handle","sizeInBytes","usage"]),E.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),PS(t,e)}const IS=E.newInstance(zg);var On={newInstance:IS,extend:zg,...fr};const{Representation:Fo}=Vn,{PrimitiveTypes:Bt}=fr;class YS{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return!0}get(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return this.values[n]}set(e,n){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=n)}}function QS(t){switch(t){case Bt.Points:return"points";case Bt.Lines:return"lines";case Bt.Triangles:case Bt.TriangleEdges:return"polys";case Bt.TriangleStripEdges:case Bt.TriangleStrips:return"strips";default:return""}}function Mr(t,e,n){let r=t.pointIdToFlatId[e];return r<0&&(r=t.flatId,t.pointIdToFlatId[e]=r,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=n,t.flatId++),r}function ZS(t,e,n){const r=t.length;for(let i=0;i<r;i++){let o=t[i];if(n.cellProvokedMap.has(o)){n.ibo[n.iboId++]=n.cellProvokedMap.get(o);for(let c=i+1;c<i+r;c++){o=t[c%r];const u=Mr(n,o,e);n.ibo[n.iboId++]=u}return}}for(let i=0;i<r;i++){let o=t[i];if(!n.provokedPointIds[o]){let c=Mr(n,o,e);n.provokedPointIds[o]=1,n.cellProvokedMap.set(o,c),n.flatIdToCellId[c]=e,n.ibo[n.iboId++]=c;for(let u=i+1;u<i+r;u++)o=t[u%r],c=Mr(n,o,e),n.ibo[n.iboId++]=c;return}}let a=t[0],s=n.flatId;n.cellProvokedMap.set(a,s),n.flatIdToPointId[n.flatId]=a,n.flatIdToCellId[n.flatId]=e,n.flatId++,n.ibo[n.iboId++]=s;for(let i=1;i<r;i++)a=t[i],s=Mr(n,a,e),n.ibo[n.iboId++]=s}function qS(t,e,n){const r=t.length;n.iboSize+=r;for(let a=0;a<r;a++){const s=t[a];if(n.cellProvokedMap.has(s))return}for(let a=0;a<r;a++){const s=t[a];if(!n.provokedPointIds[s]){n.provokedPointIds[s]=1,n.cellProvokedMap.set(s,1);return}}n.cellProvokedMap.set(t[0],1),n.extraPoints++}let lt;const mo=new Uint32Array(1),He=new Uint32Array(2),Rt=new Uint32Array(3),_a={anythingToPoints(t,e,n,r,a){for(let s=0;s<t;++s)mo[0]=e[n+s],lt(mo,r,a)},linesToWireframe(t,e,n,r,a){for(let s=0;s<t-1;++s)He[0]=e[n+s],He[1]=e[n+s+1],lt(He,r,a)},polysToWireframe(t,e,n,r,a){if(t>2)for(let s=0;s<t;++s)He[0]=e[n+s],He[1]=e[n+(s+1)%t],lt(He,r,a)},stripsToWireframe(t,e,n,r,a){if(t>2){for(let s=0;s<t-1;++s)He[0]=e[n+s],He[1]=e[n+s+1],lt(He,r,a);for(let s=0;s<t-2;s++)He[0]=e[n+s],He[1]=e[n+s+2],lt(He,r,a)}},polysToSurface(t,e,n,r,a){for(let s=0;s<t-2;s++)Rt[0]=e[n],Rt[1]=e[n+s+1],Rt[2]=e[n+s+2],lt(Rt,r,a)},stripsToSurface(t,e,n,r,a){for(let s=0;s<t-2;s++)Rt[0]=e[n+s],Rt[1]=e[n+s+1+s%2],Rt[2]=e[n+s+1+(s+1)%2],lt(Rt,r,a)}};function JS(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=n=>{const r=n.cells,a=n.primitiveType,s=n.representation,i=n.cellOffset,o=r.getData(),c=o.length,u=QS(a),g=n.numberOfPoints,f={provokedPointIds:new Uint8Array(g),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new YS};let l=null;s===Fo.POINTS||a===Bt.Points?l=_a.anythingToPoints:s===Fo.WIREFRAME||a===Bt.Lines?l=_a[`${u}ToWireframe`]:l=_a[`${u}ToSurface`],lt=qS;let h=i||0;for(let v=0;v<c;)f.cellProvokedMap.clear(),l(o[v],o,v+1,h,f),v+=o[v]+1,h++;g<=65535?f.flatIdToPointId=new Uint16Array(g+f.extraPoints):f.flatIdToPointId=new Uint32Array(g+f.extraPoints),g+f.extraPoints<36863?f.pointIdToFlatId=new Int16Array(g):f.pointIdToFlatId=new Int32Array(g),g+f.extraPoints<=65535?(f.ibo=new Uint16Array(f.iboSize),n.format="uint16"):(f.ibo=new Uint32Array(f.iboSize),n.format="uint32"),h<=65535?f.flatIdToCellId=new Uint16Array(g+f.extraPoints):f.flatIdToCellId=new Uint32Array(g+f.extraPoints),f.pointIdToFlatId.fill(-1),f.provokedPointIds.fill(0),lt=ZS,h=i||0;for(let v=0;v<c;)f.cellProvokedMap.clear(),l(o[v],o,v+1,h,f),v+=o[v]+1,h++;delete f.provokedPointIds,delete f.pointIdToFlatId,n.nativeArray=f.ibo,e.flatIdToPointId=f.flatIdToPointId,e.flatIdToCellId=f.flatIdToCellId,e.flatSize=f.flatId,e.indexCount=f.iboId}}const eC={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function Wg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eC,n),On.extend(t,e,n),E.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),JS(t,e)}const tC=E.newInstance(Wg);var nC={newInstance:tC,extend:Wg,...fr};const{BufferUsage:Ot}=fr,{vtkErrorMacro:rC}=ft,{VtkDataTypes:jt}=ee,aC={};function sC(t){let e;switch(t.getDataType()){case jt.UNSIGNED_CHAR:e="uint8";break;case jt.FLOAT:e="float32";break;case jt.UNSIGNED_INT:e="uint32";break;case jt.INT:e="sint32";break;case jt.DOUBLE:e="float32";break;case jt.UNSIGNED_SHORT:e="uint16";break;case jt.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||rC(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function ko(t,e,n,r,a){const s={},i=t.getFlatSize();if(!i)return s;let o=[0,0,0,0];a.shift&&(a.shift.length?o=a.shift:o.fill(a.shift));let c=[1,1,1,1];a.scale&&(a.scale.length?c=a.scale:c.fill(a.scale));const u=Object.prototype.hasOwnProperty.call(a,"packExtra")?a.packExtra:!1;let g,f=0;const l=n+(u?1:0),h=Dn(r,i*l);let v=t.getFlatIdToPointId();a.cellData&&(v=t.getFlatIdToCellId()),n===1?g=function(y){h[f++]=c[0]*e[y]+o[0]}:n===2?g=function(y){h[f++]=c[0]*e[y]+o[0],h[f++]=c[1]*e[y+1]+o[1]}:n===3&&!u?g=function(y){h[f++]=c[0]*e[y]+o[0],h[f++]=c[1]*e[y+1]+o[1],h[f++]=c[2]*e[y+2]+o[2]}:n===3&&u?g=function(y){h[f++]=c[0]*e[y]+o[0],h[f++]=c[1]*e[y+1]+o[1],h[f++]=c[2]*e[y+2]+o[2],h[f++]=c[3]*1+o[3]}:n===4&&(g=function(y){h[f++]=c[0]*e[y]+o[0],h[f++]=c[1]*e[y+1]+o[1],h[f++]=c[2]*e[y+2]+o[2],h[f++]=c[3]*e[y+3]+o[3]});for(let p=0;p<i;p++){const y=n*v[p];g(y)}return s.nativeArray=h,s}function iC(t,e,n,r){const a=[t[r*3]-t[n*3],t[r*3+1]-t[n*3+1],t[r*3+2]-t[n*3+2]],s=[t[e*3]-t[n*3],t[e*3+1]-t[n*3+1],t[e*3+2]-t[n*3+2]],i=[];return Ue(a,s,i),we(i),i}function oC(t,e){const n=e.getData(),r=t.getData();if(!r||!n)return null;const a=new Int8Array(t.getNumberOfCells()*4),s=r.length;let i=0;for(let o=0;o<s;){const c=iC(n,r[o+1],r[o+2],r[o+3]);a[i++]=127*c[0],a[i++]=127*c[1],a[i++]=127*c[2],a[i++]=127,o+=r[o]+1}return a}function cC(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function n(r){r.dataArray&&!r.nativeArray&&(r.nativeArray=r.dataArray.getData());let a,s;if(r.usage===Ot.Index&&(a=nC.newInstance({label:r.label}),a.setDevice(e.device),s=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,a.buildIndexBuffer(r),a.createAndWrite(r.nativeArray,s),a.setArrayInformation([{format:r.format}])),a||(a=On.newInstance({label:r.label}),a.setDevice(e.device)),r.usage===Ot.UniformArray&&(s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a.createAndWrite(r.nativeArray,s)),r.usage===Ot.Storage&&(s=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,a.createAndWrite(r.nativeArray,s)),r.usage===Ot.Texture&&(s=GPUBufferUsage.COPY_SRC,a.createAndWrite(r.nativeArray,s)),r.usage===Ot.PointArray){s=GPUBufferUsage.VERTEX;const i=Ce.getNativeTypeFromBufferFormat(r.format),o=ko(r.indexBuffer,r.dataArray.getData(),r.dataArray.getNumberOfComponents(),i,{packExtra:r.packExtra,shift:r.shift,scale:r.scale,cellData:r.cellData,cellOffset:r.cellOffset});a.createAndWrite(o.nativeArray,s),a.setStrideInBytes(Ce.getByteStrideFromBufferFormat(r.format)),a.setArrayInformation([{offset:0,format:r.format,interpolation:r.cellData?"flat":"perspective"}])}if(r.usage===Ot.NormalsFromPoints){s=GPUBufferUsage.VERTEX;const i=Ce.getNativeTypeFromBufferFormat(r.format),o=oC(r.cells,r.dataArray),c=ko(r.indexBuffer,o,4,i,{cellData:!0});a.createAndWrite(c.nativeArray,s),a.setStrideInBytes(Ce.getByteStrideFromBufferFormat(r.format)),a.setArrayInformation([{offset:0,format:r.format,interpolation:"flat"}])}return r.usage===Ot.RawVertex&&(s=GPUBufferUsage.VERTEX,a.createAndWrite(r.nativeArray,s),a.setStrideInBytes(Ce.getByteStrideFromBufferFormat(r.format)),a.setArrayInformation([{offset:0,format:r.format}])),a.setSourceTime(r.time),a}t.hasBuffer=r=>e.device.hasCachedObject(r),t.getBuffer=r=>r.hash?e.device.getCachedObject(r.hash,n,r):n(r),t.getBufferForPointArray=(r,a)=>{const s=sC(r),i={hash:`${r.getMTime()}I${a.getMTime()}${s}`,usage:Ot.PointArray,format:s,dataArray:r,indexBuffer:a};return t.getBuffer(i)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=On.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);const r=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(r,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}const fC={device:null,fullScreenQuadBuffer:null};function Hg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fC,n),Me(t,e),Te(t,e,["device"]),cC(t,e)}const uC=re(Hg);var fn={newInstance:uC,extend:Hg,...aC,...fr};const{BufferUsage:gC}=fn,{vtkErrorMacro:pn}=E;function lC(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){pn(`entry named ${n} already exists`);return}e._bufferEntryNames.set(n,e.bufferEntries.length);const a=Ce.getByteStrideFromShaderFormat(r);e.bufferEntries.push({name:n,type:r,sizeInBytes:a,offset:e.sizeInBytes,nativeType:Ce.getNativeTypeFromShaderFormat(r)}),e.sizeInBytes+=a},t.send=n=>{if(!e._buffer){const r={nativeArray:e.Float32Array,usage:gC.Storage,label:e.label};e._buffer=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e._sendTime.modified();return}n.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[n]=E.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r,a)=>{const s=e._bufferEntryNames.get(n);if(s===void 0){pn(`entry named ${n} not found in UBO`);return}const i=e.bufferEntries[s];t.createView(i.nativeType);const o=e[i.nativeType];o[(i.offset+r*e.sizeInBytes)/o.BYTES_PER_ELEMENT]=a},t.setArray=(n,r,a)=>{const s=e._bufferEntryNames.get(n);if(s===void 0){pn(`entry named ${n} not found in UBO`);return}const i=e.bufferEntries[s];t.createView(i.nativeType);const o=e[i.nativeType],c=(i.offset+r*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let u=0;u<a.length;u++)o[c+u]=a[u]},t.setAllInstancesFromArray=(n,r)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){pn(`entry named ${n} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType],o=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const u=(s.offset+c*e.sizeInBytes)/i.BYTES_PER_ELEMENT;for(let g=0;g<o;g++)i[u+g]=r[c*o+g]}},t.setAllInstancesFromArrayColorToFloat=(n,r)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){pn(`entry named ${n} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType],o=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const u=(s.offset+c*e.sizeInBytes)/i.BYTES_PER_ELEMENT;for(let g=0;g<o;g++)i[u+g]=r[c*o+g]/255}},t.setAllInstancesFromArray3x3To4x4=(n,r)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){pn(`entry named ${n} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType],o=9;for(let c=0;c<e.numberOfInstances;c++){const u=(s.offset+c*e.sizeInBytes)/i.BYTES_PER_ELEMENT;for(let g=0;g<3;g++)for(let f=0;f<3;f++)i[u+g*4+f]=r[c*o+g*3+f]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(n,r)=>{const a=[`struct ${e.label}StructEntry
{`];for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];a.push(`  ${i.name}: ${i.type},`)}return a.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${n}) @group(${r}) var<storage, read> ${e.label}: ${e.label}Struct;
`),a.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}const pC={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function Ag(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pC,n),E.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},E.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},E.get(t,e,["bindGroupTime"]),E.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),lC(t,e)}const hC=E.newInstance(Ag,"vtkWebGPUStorageBuffer");var ys={newInstance:hC,extend:Ag};const{BufferUsage:yC}=fn,{vtkErrorMacro:Ga}=E;function vC(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){Ga(`entry named ${n} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(n,e.bufferEntries.length),e.bufferEntries.push({name:n,type:r,sizeInBytes:Ce.getByteStrideFromShaderFormat(r),offset:-1,nativeType:Ce.getNativeTypeFromShaderFormat(r),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let n=0;const r=[];let a=4;for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];i.sizeInBytes%16===0&&(a=Math.max(16,a)),i.sizeInBytes%8===0&&(a=Math.max(8,a))}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];i.packed===!1&&i.sizeInBytes%16===0&&(i.packed=!0,i.offset=n,r.push(i),n+=i.sizeInBytes)}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];if(i.packed===!1&&i.sizeInBytes===12)for(let o=0;o<e.bufferEntries.length;o++){const c=e.bufferEntries[o];if(c.packed===!1&&c.sizeInBytes===4){i.packed=!0,i.offset=n,r.push(i),n+=i.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];if(!i.packed&&i.sizeInBytes%8===0)for(let o=s+1;o<e.bufferEntries.length;o++){const c=e.bufferEntries[o];if(!c.packed&&c.sizeInBytes%8===0){i.packed=!0,i.offset=n,r.push(i),n+=i.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];if(!i.packed&&i.sizeInBytes%8===0){let o=!1;for(let c=0;!o&&c<e.bufferEntries.length;c++){const u=e.bufferEntries[c];if(!u.packed&&u.sizeInBytes===4)for(let g=c+1;g<e.bufferEntries.length;g++){const f=e.bufferEntries[g];if(!f.packed&&f.sizeInBytes===4){i.packed=!0,i.offset=n,r.push(i),n+=i.sizeInBytes,u.packed=!0,u.offset=n,r.push(u),n+=u.sizeInBytes,f.packed=!0,f.offset=n,r.push(f),n+=f.sizeInBytes,o=!0;break}}}}}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];!i.packed&&i.sizeInBytes>4&&(i.packed=!0,i.offset=n,r.push(i),n+=i.sizeInBytes)}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];i.packed||(i.packed=!0,i.offset=n,r.push(i),n+=i.sizeInBytes)}e.bufferEntries=r,e._bufferEntryNames.clear();for(let s=0;s<e.bufferEntries.length;s++)e._bufferEntryNames.set(e.bufferEntries[s].name,s);e.sizeInBytes=n,e.sizeInBytes=a*Math.ceil(e.sizeInBytes/a),e.sortDirty=!1},t.sendIfNeeded=n=>{if(!e.UBO){const r={nativeArray:e.Float32Array,usage:yC.UniformArray,label:e.label};e.UBO=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(n.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[n]=E.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r)=>{t.sortBufferEntries();const a=e._bufferEntryNames.get(n);if(a===void 0){Ga(`entry named ${n} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType];s.lastValue!==r&&(i[s.offset/i.BYTES_PER_ELEMENT]=r,e.sendDirty=!0),s.lastValue=r},t.setArray=(n,r)=>{t.sortBufferEntries();const a=e._bufferEntryNames.get(n);if(a===void 0){Ga(`entry named ${n} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType];let o=!1;for(let c=0;c<r.length;c++)(!s.lastValue||s.lastValue[c]!==r[c])&&(i[s.offset/i.BYTES_PER_ELEMENT+c]=r[c],o=!0);o&&(e.sendDirty=!0,s.lastValue=[...r])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(n,r)=>{t.sortBufferEntries();const a=[`struct ${e.label}Struct
{`];for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];a.push(`  ${i.name}: ${i.type},`)}return a.push(`};
@binding(${n}) @group(${r}) var<uniform> ${e.label}: ${e.label}Struct;`),a.join(`
`)}}const TC={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function jg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TC,n),E.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},E.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,E.get(t,e,["binding","bindGroupTime"]),E.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),vC(t,e)}const dC=E.newInstance(jg,"vtkWebGPUUniformBuffer");var Jt={newInstance:dC,extend:jg};const{vtkDebugMacro:xC}=ft,Uo=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,SC=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,Rr=new Float64Array(16),No=new Float64Array(16);function CC(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function wC(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{const n=e.camera.getClippingRange(),r=e.camera.getPositionByReference(),a=e.camera.getDirectionOfProjectionByReference(),s=[],i=[];at(i,a,.5*(n[0]+n[1])),Gn(s,r,i),Pa(i,s,e.stabilizedCenter),dc(i)/(n[1]-n[0])>e.recenterThreshold&&(e.stabilizedCenter=s,e.stabilizedTime.modified())},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let a=0;a<r.length;++a)r[a].getSwitch()>0&&n++;return n||(xC("No lights are on, creating one."),e.renderable.createLight()),n},t.updateUBO=()=>{var r;const n=e.UBO.getSendTime();if(e._parent.getMTime()>n||t.getMTime()>n||e.camera.getMTime()>n||e.renderable.getMTime()>n){const a=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",a.wcvc),e.UBO.setArray("SCPCMatrix",a.scpc),e.UBO.setArray("PCSCMatrix",a.pcsc),e.UBO.setArray("SCVCMatrix",a.scvc),e.UBO.setArray("VCPCMatrix",a.vcpc),e.UBO.setArray("WCVCNormals",a.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",(r=e.renderable.getEnvironmentTexture())==null?void 0:r.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());const s=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[s.usize,s.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());const i=e._parent.getDevice();e.UBO.sendIfNeeded(i)}},t.updateSSBO=()=>{const n=e.renderable.getLights(),r=e.webgpuCamera.getKeyMatrices(t);let a=`${e.renderable.getMTime()}`;for(let s=0;s<n.length;s++)a+=n[s].getMTime();if(a!==e.lightTimeString){const s=new Float32Array(n.length*4),i=new Float32Array(n.length*4),o=new Float32Array(n.length*4),c=new Float32Array(n.length*4);for(let g=0;g<n.length;g++){const f=g*4,l=n[g].getPosition();q(l,l,r.wcvc),s[f]=l[0],s[f+1]=l[1],s[f+2]=l[2],s[f+3]=0,i[f]=-n[g].getDirection()[0],i[f+1]=-n[g].getDirection()[1],i[f+2]=-n[g].getDirection()[2],i[f+3]=0,o[f]=n[g].getColor()[0],o[f+1]=n[g].getColor()[1],o[f+2]=n[g].getColor()[2],o[f+3]=n[g].getIntensity()*5,c[f]=CC(n[g]),c[f+1]=Math.cos(oe(n[g].getConeAngle())),c[f+2]=Math.cos(oe(n[g].getConeAngle()+n[g].getConeFalloff())),c[f+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(n.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",s),e.SSBO.setAllInstancesFromArray("LightDir",i),e.SSBO.setAllInstancesFromArray("LightColor",o),e.SSBO.setAllInstancesFromArray("LightData",c);const u=e._parent.getDevice();e.SSBO.send(u)}e.lightTimeString=a},t.scissorAndViewport=n=>{const r=t.getYInvertedTiledSizeAndOrigin();n.getHandle().setViewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize,0,1),n.getHandle().setScissorRect(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)},t.bindUBO=n=>{n.activateBindGroup(e.bindGroup)},t.opaquePass=n=>{n?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{var s;if(e.renderable.getTransparent()||e.suppressClear)return;const n=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=Rn.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(Uo);const i=Jt.newInstance({label:"mapperUBO"});i.addEntry("FSQMatrix","mat4x4<f32>"),i.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(i),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&((s=e.backgroundTex)!=null&&s.getImageLoaded())){e.clearFSQ.setFragmentShaderTemplate(SC);const i=Jt.newInstance({label:"mapperUBO"});i.addEntry("FSQMatrix","mat4x4<f32>"),i.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(i);const o=n.getTextureManager().getTextureForVTKTexture(e.backgroundTex,"EnvironmentTexture");if(o.getReady()){const c=o.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([c]),e.backgroundTexLoaded=!0;const u=e.backgroundTex.getInterpolate()?"linear":"nearest";c.addSampler(n,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:u,magFilter:u,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=Rn.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(Uo);const i=Jt.newInstance({label:"mapperUBO"});i.addEntry("FSQMatrix","mat4x4<f32>"),i.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(i)}const r=e.webgpuCamera.getKeyMatrices(t),a=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",a),ne(No,r.normalMatrix),Aa(Rr,r.scvc,r.pcsc),Aa(Rr,No,Rr),e.clearFSQ.getUBO().setArray("FSQMatrix",Rr),e.clearFSQ.getUBO().sendIfNeeded(n),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.convertToOpenGLDepth=n=>e.webgpuCamera.convertToOpenGLDepth(n),t.getYInvertedTiledSizeAndOrigin=()=>{const n=t.getTiledSizeAndOrigin(),r=e._parent.getSizeByReference();return n.lowerLeftV=r[1]-n.vsize-n.lowerLeftV,n},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],a=n[0]-r[0],s=n[1]-r[1],i=e._parent.normalizedDisplayToDisplay(a,s),o=Math.round(i[0]),c=Math.round(i[1]),u=n[2]-r[0],g=n[3]-r[1],f=e._parent.normalizedDisplayToDisplay(u,g);let l=Math.round(f[0])-o,h=Math.round(f[1])-c;return l<0&&(l=0),h<0&&(h=0),{usize:l,vsize:h,lowerLeftU:o,lowerLeftV:c}},t.getPropFromID=n=>{for(let r=0;r<e.children.length;r++)if((e.children[r].getPropID?e.children[r].getPropID():-1)===n)return e.children[r];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}const EC={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function MC(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,EC,n),fe.extend(t,e,n),e.UBO=Jt.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=ys.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=mg.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=Y(new Float64Array(16)),e.stabilizedTime={},Me(e.stabilizedTime,{mtime:0}),Ne(t,e,["bindGroup","stabilizedTime"]),Ln(t,e,["stabilizedCenter"]),Te(t,e,["renderEncoder","selector","suppressClear","UBO"]),wC(t,e)}const RC=re(MC,"vtkWebGPURenderer");ut("vtkRenderer",RC);const{CoordinateSystem:_o}=cr;function OC(t,e){e.classHierarchy.push("vtkWebGPUActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const r=e.renderable.getMatrix();e.bufferShift[0]=r[3],e.bufferShift[1]=r[7],e.bufferShift[2]=r[11];const a=n.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===_o.WORLD&&(e.bufferShift[0]-=a[0],e.bufferShift[1]-=a[1],e.bufferShift[2]-=a[2]),ne(e.keyMatrices.bcwc,r),e.renderable.getIsIdentity()?Y(e.keyMatrices.normalMatrix):(Oe(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Ve(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),ne(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),le(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===_o.WORLD?le(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-a[0],-a[1],-a[2]]):Oe(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const DC={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function LC(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DC,n),fe.extend(t,e,n),e.keyMatricesTime={},E.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},E.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],OC(t,e)}const VC=E.newInstance(LC);ut("vtkActor",VC);const{CoordinateSystem:Go}=cr;function BC(t,e){e.classHierarchy.push("vtkWebGPUActor2D"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.bufferShift[0]=0,e.bufferShift[1]=0,e.bufferShift[2]=0;const r=n.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===Go.WORLD&&(e.bufferShift[0]-=r[0],e.bufferShift[1]-=r[1],e.bufferShift[2]-=r[2]),Y(e.keyMatrices.bcwc),Y(e.keyMatrices.normalMatrix),le(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===Go.WORLD?le(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-r[0],-r[1],-r[2]]):Oe(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const FC={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function mC(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FC,n),fe.extend(t,e,n),e.keyMatricesTime={},E.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},E.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],BC(t,e)}const kC=E.newInstance(mC);ut("vtkActor2D",kC);function UC(t,e){e.classHierarchy.push("vtkWebGPUCubeAxesActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,s=e.WebGPURenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e.WebGPURenderWindow.getRenderable())}}}const NC={};function _C(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NC,n),fe.extend(t,e,n),e.CubeAxesActorHelper=fg.newCubeAxesActorHelper(),UC(t,e)}const GC=re(_C,"vtkWebGPUCubeAxesActor");ut("vtkCubeAxesActor",GC);const{DisplayLocation:vs}=Mg;function bC(t,e){e.classHierarchy.push("vtkProperty2D"),t.setDisplayLocationToBackground=()=>t.setDisplayLocation(vs.BACKGROUND),t.setDisplayLocationToForeground=()=>t.setDisplayLocation(vs.FOREGROUND),t.setRepresentationToWireframe=()=>t.setRepresentation(Xe.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(Xe.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(Xe.POINTS),t.getRepresentationAsString=()=>E.enumToString(Xe,e.representation)}const $C={color:[1,1,1],opacity:1,pointSize:1,lineWidth:1,representation:Xe.SURFACE,displayLocation:vs.FOREGROUND};function zC(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$C,n),E.obj(t,e),E.setGet(t,e,["opacity","lineWidth","pointSize","displayLocation","representation"]),E.setGetArray(t,e,["color"],3),bC(t,e)}E.newInstance(zC,"vtkProperty2D");var WC={...Mg};const{BufferUsage:de,PrimitiveTypes:Be}=fn,{Representation:Or}=Vn,{ScalarMode:Dr}=an,{CoordinateSystem:HC}=cr,{DisplayLocation:bo}=WC,AC=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,jC=`
struct PBRData {
  diffuse: vec3<f32>,
  specular: vec3<f32>,
}

struct Material {
  ior: f32,
  roughness: f32,
  metallic: f32,
  base: vec3<f32>,
};

struct DirectionalLight {
  direction: vec3<f32>,
  color: vec3<f32>,
};

struct PointLight {
  position: vec3<f32>,
  color: vec3<f32>,
};

struct SpotLight {
  position: vec3<f32>,
  direction: vec3<f32>,
  cones: vec2<f32>,
  color: vec3<f32>,
};

const pi: f32 = 3.14159265359;

// Dot product with the max already in it
fn mdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  return max(0.0, dot(a, b));
}
// Dot product with a max in it that does not allow for negative values
// Physically based rendering is accurate as long as normals are accurate,
// however this is pretty often not the case. In order to prevent negative
// values from ruining light calculations and creating zones of zero light,
// this remapping is used, which smoothly clamps the dot product between
// zero and one while still maintaining a good amount of accuracy.
fn cdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  var d: f32 = max(0.0, dot(a, b));
  d = pow((d + 1.0) / 2.0, 2.6);
  return d;
}

// Lambertian diffuse model
fn lambertDiffuse(base: vec3<f32>, N: vec3<f32>, L: vec3<f32>) -> vec3<f32> {
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5);
  return (base/pi)*NdotL;
}

// Yasuhiro Fujii improvement on the Oren-Nayar model
// https://mimosa-pudica.net/improved-oren-nayar.html
// p is surface color, o is roughness
fn fujiiOrenNayar(p: vec3<f32>, o: f32, N: vec3<f32>, L: vec3<f32>, V: vec3<f32>) -> vec3<f32> {
  var invpi: f32 = 0.31830988618; // 1/pi

  var o2 = o*o;
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5); // Less physically accurate, but hides the "seams" between lights better

  var NdotV: f32 = mdot(N, V);
  var LdotV: f32 = mdot(L, V);

  var s: f32 = LdotV - NdotL*NdotV;
  var t: f32 = mix(1.0, max(NdotL, NdotV), step(0.0, s)); // Mix with step is the equivalent of an if statement
  var A: vec3<f32> = 0.5*(o2 / (o2 + 0.33)) + 0.17*p*(o2 / (o2 + 0.13));
  A = invpi*(1 - A);
  var B: f32 = 0.45*(o2 / (o2 + 0.09));
  B = invpi*B;

  return p*NdotL*(A + B*(s/t));
}

// Fresnel portion of BRDF (IOR only, simplified)
fn schlickFresnelIOR(V: vec3<f32>, N: vec3<f32>, ior: f32, k: f32) -> f32 {
  var NdotV: f32 = mdot(V, N);
  var F0: f32 = (pow((ior - 1.0), 2.0) + k*k) / (pow((ior + 1.0), 2.0) + k*k); // This takes into account the roughness, which the other one does not
  return F0 + (1.0 - F0) * pow((1.0-NdotV), 5.0);
}

// Fresnel portion of BRDF (Color ior, better)
fn schlickFresnelRGB(V: vec3<f32>, N: vec3<f32>, F0: vec3<f32>) -> vec3<f32> {
  var NdotV: f32 = mdot(V, N);
  return F0 + (1.0 - F0) * pow((1-NdotV), 5.0);
}

// Normal portion of BRDF
// https://learnopengl.com/PBR/Theory
// Trowbridge-Reitz GGX functions: normal, halfway, roughness^2
fn trGGX(N: vec3<f32>, H: vec3<f32>, a: f32) -> f32 {
  var a2: f32 = a*a;
  var NdotH = mdot(N, H);
  var NdotH2 = NdotH*NdotH;

  var denom: f32 = NdotH2 * (a2 - 1.0) + 1.0;

  return a2 / max((pi*denom*denom), 0.000001);
}

// A VERY bad approximation of anisotropy. Real anisotropic calculations require tangent and bitangent
fn anisotrophicTrGGX(N: vec3<f32>, H: vec3<f32>, O: vec3<f32>, s: f32, a: f32) -> f32 {
  var Op: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(O) * s, 0.)).xyz;

  var ggx1: f32 = trGGX(N + Op*s, H, a);
  var ggx2: f32 = trGGX(N - Op*s, H, a);
  return (0.5 * ggx1 + 0.5 * ggx2);
}

// Geometry portion of BRDF
fn schlickGGX(N: vec3<f32>, X: vec3<f32>, k: f32) -> f32 {
  var NdotX = cdot(N, X);
  return NdotX / max(0.000001, (NdotX*(1.0-k) + k));
}

fn smithSurfaceRoughness(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, k: f32) -> f32 {
  var ggx1: f32 = min(1.0, schlickGGX(N, V, k));
  var ggx2: f32 = min(1.0, schlickGGX(N, L, k));
  return ggx1*ggx2;
}

// BRDF Combination
fn cookTorrance(D: f32, F: f32, G: f32, N: vec3<f32>, V: vec3<f32>, L: vec3<f32>) -> f32 {
  var num: f32 = D*F*G;
  var denom: f32 = 4*cdot(V, N)*cdot(L, N);

  return num / max(denom, 0.000001);
}

// Different lighting calculations for different light sources
fn calcDirectionalLight(N: vec3<f32>, V: vec3<f32>, mat: Material, light: DirectionalLight) -> PBRData {
  var L: vec3<f32> = normalize(light.direction); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector

  var alpha = mat.roughness * mat.roughness;
  var k: f32 = alpha * alpha / 2.0;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L); // Fresnel term is replaced with 1 because it is added later
  var incoming: vec3<f32> = light.color;
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5);

  var specular: vec3<f32> = brdf * incoming * angle;
  // Oren-Nayar gives a clay-like effect when fully rough which some people may not want, so it might be better to give a separate
  // control property for the diffuse vs specular roughness
  var diffuse: vec3<f32> = incoming * fujiiOrenNayar(mat.base, mat.roughness, N, L, V);
  // Stores the specular and diffuse separately to allow for finer post processing
  var out = PBRData(diffuse, specular);

  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

fn calcPointLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, mat: Material, light: PointLight) -> PBRData {
  var L: vec3<f32> = normalize(light.position - fragPos);
  var H: vec3<f32> = normalize(L + V);
  var dist = distance(light.position, fragPos);

  var alpha = mat.roughness * mat.roughness;
  var k: f32 = alpha * alpha / 2.0;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  var F: f32 = schlickFresnelIOR(V, N, mat.ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  var incoming: vec3<f32> = light.color * (1.0 / (dist * dist));
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" between light sources

  var specular: vec3<f32> = brdf * incoming * angle;
  var diffuse: vec3<f32> = incoming * fujiiOrenNayar(mat.base, mat.roughness, N, L, V);
  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);

  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// For a reason unknown to me, spheres dont seem to behave propperly with head-on spot lights
fn calcSpotLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, mat: Material, light: SpotLight) -> PBRData {
  var L: vec3<f32> = normalize(light.position - fragPos);
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(light.position, fragPos);

  var alpha = mat.roughness * mat.roughness;
  var k: f32 = alpha * alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);

  var theta: f32 = mdot(normalize(light.direction), L);
  var epsilon: f32 = light.cones.x - light.cones.y;
  var intensity: f32 = (theta - light.cones.y) / epsilon;
  intensity = clamp(intensity, 0.0, 1.0);
  intensity /= dist * dist;

  var incoming: vec3<f32> = light.color * intensity;

  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" between light sources

  var specular: vec3<f32> = brdf * incoming * angle;
  var diffuse: vec3<f32> = incoming * fujiiOrenNayar(mat.base, mat.roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);

  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// Environment mapping stuff
// Takes in a vector and converts it to an equivalent coordinate in a rectilinear texture. Should be replaced with cubemaps at some point
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::TCoord::Dec

// optional surface normal declaration
//VTK::Normal::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  // Temporary ambient, diffuse, and opacity
  var ambientColor: vec4<f32> = mapperUBO.AmbientColor;
  var diffuseColor: vec4<f32> = mapperUBO.DiffuseColor;
  var opacity: f32 = mapperUBO.Opacity;
  var ior: f32 = mapperUBO.BaseIOR;

  // This should be declared somewhere else
  var _diffuseMap: vec4<f32> = vec4<f32>(1.0);
  var _roughnessMap: vec4<f32> = vec4<f32>(1.0);
  var _metallicMap: vec4<f32> = vec4<f32>(1.0);
  var _normalMap: vec4<f32> = vec4<f32>(0.0, 0.0, 1.0, 0.0); // normal map was setting off the normal vector detection in fragment
  var _ambientOcclusionMap: vec4<f32> = vec4<f32>(1.);
  var _emissionMap: vec4<f32> = vec4<f32>(0.);

  //VTK::Color::Impl

  //VTK::TCoord::Impl

  //VTK::Normal::Impl

  var computedColor: vec4<f32> = vec4<f32>(diffuseColor.rgb, 1.0);

  //VTK::Light::Impl

  //VTK::Select::Impl

  // Use texture alpha for transparency
  computedColor.a = mapperUBO.Opacity * _diffuseMap.a;
  if (computedColor.a == 0.0) { discard; };

  //VTK::Position::Impl

  //VTK::RenderEncoder::Impl

  return output;
}
`;function $o(t){return t.indexOf("edge")>=0}function KC(t,e){e.classHierarchy.push("vtkWebGPUCellArrayMapper"),t.buildPass=n=>{n&&(e.is2D?(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.forceZValue=!0):(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.forceZValue=!1),e.coordinateSystem=e.WebGPUActor.getRenderable().getCoordinateSystem(),e.useRendererMatrix=e.coordinateSystem!==HC.DISPLAY,e.WebGPURenderer=e.WebGPUActor.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice())},t.translucentPass=n=>{n&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.opaquePass=n=>{n&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.updateUBO=()=>{var o,c;const r=e.WebGPUActor.getRenderable().getProperty(),a=e.UBO.getSendTime();if(t.getMTime()<=a&&r.getMTime()<=a&&e.renderable.getMTime()<=a)return;const s=e.WebGPUActor.getKeyMatrices(e.WebGPURenderer);if(e.UBO.setArray("BCWCMatrix",s.bcwc),e.UBO.setArray("BCSCMatrix",s.bcsc),e.UBO.setArray("MCWCNormals",s.normalMatrix),e.is2D){const u=((o=r.getDisplayLocation)==null?void 0:o.call(r))??bo.BACKGROUND;e.UBO.setValue("ZValue",u===bo.FOREGROUND?1:0);const g=r.getColorByReference();e.UBO.setValue("AmbientIntensity",1),e.UBO.setArray("DiffuseColor",[...g,1]),e.UBO.setValue("DiffuseIntensity",0),e.UBO.setValue("SpecularIntensity",0)}else e.UBO.setValue("AmbientIntensity",r.getAmbient()),e.UBO.setArray("AmbientColor",[...r.getAmbientColorByReference(),1]),e.UBO.setValue("DiffuseIntensity",r.getDiffuse()),e.UBO.setArray("DiffuseColor",[...r.getDiffuseColorByReference(),1]),e.UBO.setValue("Roughness",r.getRoughness()),e.UBO.setValue("BaseIOR",r.getBaseIOR()),e.UBO.setValue("Metallic",r.getMetallic()),e.UBO.setValue("NormalStrength",r.getNormalStrength()),e.UBO.setValue("Emission",r.getEmission()),e.UBO.setValue("SpecularIntensity",r.getSpecular()),r.getSpecularColorByReference()&&e.UBO.setArray("SpecularColor",[...r.getSpecularColorByReference(),1]);const i=(c=r.getEdgeColorByReference)==null?void 0:c.call(r);i&&e.UBO.setArray("EdgeColor",[...i,1]),e.UBO.setValue("LineWidth",r.getLineWidth()),e.UBO.setValue("Opacity",r.getOpacity()),e.UBO.setValue("PropID",e.WebGPUActor.getPropID()),e.UBO.sendIfNeeded(e.WebGPURenderWindow.getDevice())},t.haveWideLines=()=>{const n=e.WebGPUActor.getRenderable(),r=n.getProperty().getRepresentation();return n.getProperty().getLineWidth()<=1||e.primitiveType===Be.Verts?!1:e.primitiveType===Be.Triangles||e.primitiveType===Be.TriangleStrips?r===Or.WIREFRAME:!0},t.replaceShaderPosition=(n,r,a)=>{const s=r.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),s.hasOutput("vertexVC")||s.addOutput("vec4<f32>","vertexVC");let i=s.getCode();e.useRendererMatrix?(i=K.substitute(i,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = rendererUBO.SCPCMatrix*mapperUBO.BCSCMatrix*vertexBC;","    output.vertexVC = rendererUBO.SCVCMatrix * mapperUBO.BCSCMatrix * vec4<f32>(vertexBC.xyz, 1.0);","//VTK::Position::Impl"]).result,e.forceZValue&&(i=K.substitute(i,"//VTK::Position::Impl",["pCoord = vec4<f32>(pCoord.xyz/pCoord.w, 1.0);","pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)):(i=K.substitute(i,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = mapperUBO.BCSCMatrix*vertexBC;","    pCoord.x = 2.0* pCoord.x / rendererUBO.viewportSize.x - 1.0;","    pCoord.y = 2.0* pCoord.y / rendererUBO.viewportSize.y - 1.0;","    pCoord.z = 0.5 - 0.5 * pCoord.z;","//VTK::Position::Impl"]).result,e.forceZValue&&(i=K.substitute(i,"//VTK::Position::Impl",["    pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)),t.haveWideLines()&&(s.addBuiltinInput("u32","@builtin(instance_index) instanceIndex"),i=K.substitute(i,"//VTK::Position::Impl",["    var tmpPos: vec4<f32> = pCoord;","    var numSteps: f32 = ceil(mapperUBO.LineWidth - 1.0);","    var offset: f32 = (mapperUBO.LineWidth - 1.0) * (f32(input.instanceIndex / 2u) - numSteps/2.0) / numSteps;","    var tmpPos2: vec3<f32> = tmpPos.xyz / tmpPos.w;","    tmpPos2.x = tmpPos2.x + 2.0 * (f32(input.instanceIndex) % 2.0) * offset / rendererUBO.viewportSize.x;","    tmpPos2.y = tmpPos2.y + 2.0 * (f32(input.instanceIndex + 1u) % 2.0) * offset / rendererUBO.viewportSize.y;","    tmpPos2.z = min(1.0, tmpPos2.z + 0.00001);","    pCoord = vec4<f32>(tmpPos2.xyz * tmpPos.w, tmpPos.w);","//VTK::Position::Impl"]).result),i=K.substitute(i,"//VTK::Position::Impl",["    output.Position = pCoord;"]).result,s.setCode(i)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderNormal=(n,r,a)=>{const s=a.getBuffer("normalMC"),i=e.WebGPUActor.getRenderable();if(s){const o=r.getShaderDescription("vertex");o.hasOutput("normalVC")||o.addOutput("vec3<f32>","normalVC",s.getArrayInformation()[0].interpolation),o.hasOutput("tangentVC")||o.addOutput("vec3<f32>","tangentVC",s.getArrayInformation()[0].interpolation),o.hasOutput("bitangentVC")||o.addOutput("vec3<f32>","bitangentVC",s.getArrayInformation()[0].interpolation);let c=o.getCode();c=K.substitute(c,"//VTK::Normal::Impl",["  output.normalVC = normalize((rendererUBO.WCVCNormals * mapperUBO.MCWCNormals * normalMC).xyz);","  var c1: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 0, 1));","  var c2: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 1, 0));","  var tangent: vec3<f32> = mix(c1, c2, distance(c1, c2));","  output.tangentVC = normalize(tangent);","  output.bitangentVC = normalize(cross(output.normalVC, tangent));"]).result,o.setCode(c);const u=r.getShaderDescription("fragment");c=u.getCode(),i.getProperty().getNormalTexture()?c=K.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  var tangent: vec3<f32> = input.tangentVC;","  var bitangent: vec3<f32> = input.bitangentVC;","  var TCVCMatrix: mat3x3<f32> = mat3x3<f32>(","    tangent.x, bitangent.x, normal.x,","    tangent.y, bitangent.y, normal.y,","    tangent.z, bitangent.z, normal.z,","  );","  var mappedNormal: vec3<f32> = TCVCMatrix * (_normalMap.xyz * 2 - 1);","  normal = mix(normal, mappedNormal, mapperUBO.NormalStrength);","  normal = normalize(normal);"]).result:c=K.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  normal = normalize(normal);"]).result,u.setCode(c)}},e.shaderReplacements.set("replaceShaderNormal",t.replaceShaderNormal),t.replaceShaderLight=(n,r,a)=>{var u;if(n.includes("sel"))return;const s=r.getShaderDescription("vertex");s.hasOutput("vertexVC")||s.addOutput("vec4<f32>","vertexVC");const i=e.WebGPURenderer.getRenderable(),o=r.getShaderDescription("fragment");let c=o.getCode();if(c.includes("var normal:")&&e.useRendererMatrix&&!$o(n)&&!e.is2D&&!n.includes("sel")){const g=["  let fragPos = vec3<f32>(input.vertexVC.xyz);","  let V = mix(normalize(-fragPos), vec3<f32>(0, 0, 1), f32(rendererUBO.cameraParallel)); // View Vector","  let baseColor = _diffuseMap.rgb * diffuseColor.rgb;","  let roughness = max(0.000001, mapperUBO.Roughness * _roughnessMap.r);","  let metallic = mapperUBO.Metallic * _metallicMap.r;","  let alpha = roughness * roughness;","  let k = alpha * alpha / 2.0;","  var diffuse = vec3<f32>(0.);","  var specular = vec3<f32>(0.);","  let emission = _emissionMap.rgb * mapperUBO.Emission;","","  // Material struct","  let mat = Material(ior, roughness, metallic, baseColor);","","  {","    var i = 0;","    loop {","      if (!(i < rendererUBO.LightCount)) { break; }","      switch (i32(rendererLightSSBO.values[i].LightData.x)) {","         // Point Light","         case 0 {","           let color = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           let pos = (rendererLightSSBO.values[i].LightPos).xyz;","           let pointLight = PointLight(pos, color);","           let result = calcPointLight(normal, V, fragPos, mat, pointLight);","           diffuse += max(vec3<f32>(0), result.diffuse);","           specular += max(vec3<f32>(0), result.specular);","          }","         // Directional light","         case 1 {","           let dir = normalize((rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz);","           let color = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           let dirLight = DirectionalLight(dir, color);","           let result = calcDirectionalLight(normal, V, mat, dirLight); // diffuseColor.rgb needs to be fixed with a more dynamic diffuse color","           diffuse += max(vec3<f32>(0), result.diffuse);","           specular += max(vec3<f32>(0), result.specular);","         }","         // Spot Light","         case 2 {","           let color = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           let pos = (rendererLightSSBO.values[i].LightPos).xyz;","           let dir = normalize((rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz);","           let cones = vec2<f32>(rendererLightSSBO.values[i].LightData.y, rendererLightSSBO.values[i].LightData.z);","           let spotLight = SpotLight(pos, dir, cones, color);","           let result = calcSpotLight(normal, V, fragPos, mat, spotLight);","           diffuse += max(vec3<f32>(0), result.diffuse);","           specular += max(vec3<f32>(0), result.specular);","         }","         default { continue; }","       }","      continuing { i++; }","    }","  }","  let fresnel = min(1.0, schlickFresnelIOR(V, normal, ior, k)); // Fresnel","  // This could be controlled with its own variable (that isnt base color) for better artistic control","  let fresnelMetallic = schlickFresnelRGB(V, normal, baseColor); // Fresnel for metal, takes color into account","  let kS = min(vec3<f32>(1.0), mix(vec3<f32>(fresnel), fresnelMetallic, metallic));","  let kD = (1.0 - kS) * (1.0 - metallic);","  let PBR = mapperUBO.DiffuseIntensity * kD * diffuse + kS * specular;","  computedColor = vec4<f32>(PBR + emission, mapperUBO.Opacity);"];(u=i.getEnvironmentTexture())!=null&&u.getImageLoaded()&&g.push("  // To get diffuse IBL, the texture is sampled with normals in worldspace","  let diffuseIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(normal, 1.)).xyz;","  let diffuseCoords = vecToRectCoord(diffuseIBLCoords);","  // To get specular IBL, the texture is sampled as the worldspace reflection between the normal and view vectors","  // Reflections are first calculated in viewspace, then converted to worldspace to sample the environment","  let VreflN = normalize(reflect(-V, normal));","  let reflectionIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(VreflN, 1.)).xyz;","  let specularCoords = vecToRectCoord(reflectionIBLCoords);","  let diffuseIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, diffuseCoords, rendererUBO.MaxEnvironmentMipLevel);","  let level = roughness * rendererUBO.MaxEnvironmentMipLevel;","  let specularIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, specularCoords, level);","  let specularIBLContribution = specularIBL.rgb * rendererUBO.BackgroundSpecularStrength;","  computedColor += vec4<f32>(specularIBLContribution * kS, 0);","  let diffuseIBLContribution = diffuseIBL.rgb * rendererUBO.BackgroundDiffuseStrength;","  computedColor += vec4<f32>(diffuseIBLContribution * baseColor * _ambientOcclusionMap.rgb * kD, 0);"),c=K.substitute(c,"//VTK::Light::Impl",g).result,o.setCode(c)}else c=K.substitute(c,"//VTK::Light::Impl",["  let diffuse = diffuseColor.rgb;","  let specular = mapperUBO.SpecularColor.rgb * mapperUBO.SpecularColor.a;","  computedColor = vec4<f32>(diffuse * _diffuseMap.rgb, mapperUBO.Opacity);"]).result,o.setCode(c)},e.shaderReplacements.set("replaceShaderLight",t.replaceShaderLight),t.replaceShaderColor=(n,r,a)=>{if($o(n)){const u=r.getShaderDescription("fragment");let g=u.getCode();g=K.substitute(g,"//VTK::Color::Impl",["ambientColor = mapperUBO.EdgeColor;","diffuseColor = mapperUBO.EdgeColor;"]).result,u.setCode(g);return}const s=a.getBuffer("colorVI");if(!s)return;const i=r.getShaderDescription("vertex");i.addOutput("vec4<f32>","color",s.getArrayInformation()[0].interpolation);let o=i.getCode();o=K.substitute(o,"//VTK::Color::Impl",["  output.color = colorVI;"]).result,i.setCode(o);const c=r.getShaderDescription("fragment");o=c.getCode(),o=K.substitute(o,"//VTK::Color::Impl",["ambientColor = input.color;","diffuseColor = input.color;","opacity = mapperUBO.Opacity * input.color.a;"]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderColor",t.replaceShaderColor),t.replaceShaderTCoord=(n,r,a)=>{var C,M,R,V,O,D,B,L;if(!a.hasAttribute("tcoord"))return;const s=r.getShaderDescription("vertex"),i=a.getBuffer("tcoord"),o=Ce.getNumberOfComponentsFromBufferFormat(i.getArrayInformation()[0].format);let c=s.getCode();s.addOutput(`vec${o}<f32>`,"tcoordVS"),c=K.substitute(c,"//VTK::TCoord::Impl",["  output.tcoordVS = tcoord;"]).result,s.setCode(c);const u=r.getShaderDescription("fragment");c=u.getCode();const g=e.WebGPUActor.getRenderable(),f=g.getProperty(),l=F=>F?F.getDimensionality()===o:!1,h=[],v=(C=f.getDiffuseTexture)==null?void 0:C.call(f);(v!=null&&v.getImageLoaded()||g.getTextures()[0]||e.colorTexture)&&(l(v)||l(g.getTextures()[0])||l(e.colorTexture))&&h.push("_diffuseMap = textureSample(DiffuseTexture, DiffuseTextureSampler, input.tcoordVS);");const p=(M=f.getORMTexture)==null?void 0:M.call(f),y=(R=f.getRMTexture)==null?void 0:R.call(f),T=(V=f.getRoughnessTexture)==null?void 0:V.call(f),S=(O=f.getMetallicTexture)==null?void 0:O.call(f),d=(D=f.getAmbientOcclusionTexture)==null?void 0:D.call(f),x=(B=f.getEmissionTexture)==null?void 0:B.call(f),w=(L=f.getNormalTexture)==null?void 0:L.call(f);p!=null&&p.getImageLoaded()?l(p)&&h.push("_ambientOcclusionMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).rrra;","_roughnessMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).ggga;","_metallicMap = textureSample(ORMTexture, ORMTextureSampler, input.tcoordVS).bbba;"):y!=null&&y.getImageLoaded()?l(y)&&h.push("_roughnessMap = textureSample(RMTexture, RMTextureSampler, input.tcoordVS).ggga;","_metallicMap = textureSample(RMTexture, RMTextureSampler, input.tcoordVS).bbba;"):(T!=null&&T.getImageLoaded()&&l(T)&&h.push("_roughnessMap = textureSample(RoughnessTexture, RoughnessTextureSampler, input.tcoordVS).ggga;"),S!=null&&S.getImageLoaded()&&l(S)&&h.push("_metallicMap = textureSample(MetallicTexture, MetallicTextureSampler, input.tcoordVS).bbba;"),d!=null&&d.getImageLoaded()&&l(d)&&h.push("_ambientOcclusionMap = textureSample(AmbientOcclusionTexture, AmbientOcclusionTextureSampler, input.tcoordVS).rrra;")),x!=null&&x.getImageLoaded()&&l(x)&&h.push("_emissionMap = textureSample(EmissionTexture, EmissionTextureSampler, input.tcoordVS);"),w!=null&&w.getImageLoaded()&&l(w)&&h.push("_normalMap = textureSample(NormalTexture, NormalTextureSampler, input.tcoordVS);"),c=K.substitute(c,"//VTK::TCoord::Impl",h).result,u.setCode(c)},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderSelect=(n,r,a)=>{if(n.includes("sel")){const s=r.getShaderDescription("fragment");let i=s.getCode();i=K.substitute(i,"//VTK::Select::Impl",["  var compositeID: u32 = 0u;"]).result,s.setCode(i)}},e.shaderReplacements.set("replaceShaderSelect",t.replaceShaderSelect),t.getUsage=(n,r)=>n===Or.POINTS||r===Be.Points?de.Verts:r===Be.Lines?de.Lines:n===Or.WIREFRAME?r===Be.Triangles?de.LinesFromTriangles:de.LinesFromStrips:r===Be.Triangles?de.Triangles:r===Be.TriangleStrips?de.Strips:r===Be.TriangleEdges?de.LinesFromTriangles:de.LinesFromStrips,t.getHashFromUsage=n=>`pt${n}`,t.getTopologyFromUsage=n=>{switch(n){case de.Triangles:return"triangle-list";case de.Verts:return"point-list";case de.Lines:default:return"line-list"}},t.buildVertexInput=()=>{var p,y,T;const n=e.currentInput,r=e.cellArray,a=e.primitiveType;let i=e.WebGPUActor.getRenderable().getProperty().getRepresentation();const o=e.WebGPURenderWindow.getDevice();let c=!1;a===Be.TriangleEdges&&(c=!0,i=Or.WIREFRAME);const u=e.vertexInput,g=n.getPoints();let f=null;if(r?(f=o.getBufferManager().getBuffer({hash:`R${i}P${a}${r.getMTime()}`,usage:de.Index,cells:r,numberOfPoints:g.getNumberOfPoints(),primitiveType:a,representation:i}),u.setIndexBuffer(f)):u.setIndexBuffer(null),g){const S=e.WebGPUActor.getBufferShift(e.WebGPURenderer);u.addBuffer(o.getBufferManager().getBuffer({hash:`${g.getMTime()}I${((p=f==null?void 0:f.getMTime)==null?void 0:p.call(f))??0}${S.join()}float32x4`,usage:de.PointArray,format:"float32x4",dataArray:g,indexBuffer:f,shift:S,packExtra:!0}),["vertexBC"])}else u.removeBufferIfPresent("vertexBC");const l=t.getUsage(i,a);if(e._usesCellNormals=!1,!e.is2D&&(l===de.Triangles||l===de.Strips)){const S=n.getPointData().getNormals(),d={format:"snorm8x4",indexBuffer:f,packExtra:!0,shift:0,scale:127};S?(d.hash=`${S.getMTime()}I${f.getMTime()}snorm8x4`,d.dataArray=S,d.usage=de.PointArray,u.addBuffer(o.getBufferManager().getBuffer(d),["normalMC"])):a===Be.Triangles?(e._usesCellNormals=!0,d.hash=`PFN${g.getMTime()}I${f.getMTime()}snorm8x4`,d.dataArray=g,d.cells=r,d.usage=de.NormalsFromPoints,u.addBuffer(o.getBufferManager().getBuffer(d),["normalMC"])):u.removeBufferIfPresent("normalMC")}else u.removeBufferIfPresent("normalMC");let h=!1;if(e.renderable.getScalarVisibility()){const S=e.renderable.getColorMapColors();if(S&&!c){const d=e.renderable.getScalarMode(),x=(d===Dr.USE_CELL_DATA||d===Dr.USE_CELL_FIELD_DATA||d===Dr.USE_FIELD_DATA||!n.getPointData().getScalars())&&d!==Dr.USE_POINT_FIELD_DATA&&S;u.addBuffer(o.getBufferManager().getBuffer({usage:de.PointArray,format:"unorm8x4",hash:`${x}${S.getMTime()}I${f.getMTime()}unorm8x4`,dataArray:S,indexBuffer:f,cellData:x,cellOffset:0}),["colorVI"]),h=!0}}h||u.removeBufferIfPresent("colorVI");let v=null;(T=(y=e.renderable).getInterpolateScalarsBeforeMapping)!=null&&T.call(y)&&e.renderable.getColorCoordinates()?v=e.renderable.getColorCoordinates():v=n.getPointData().getTCoords(),v&&!c?u.addBuffer(o.getBufferManager().getBufferForPointArray(v,u.getIndexBuffer()),["tcoord"]):u.removeBufferIfPresent("tcoord")},t.updateTextures=()=>{var c,u,g,f,l,h,v,p,y,T,S,d,x,w,C,M,R,V,O;const n=[],r=[],a=(u=(c=e.renderable).getColorTextureMap)==null?void 0:u.call(c);a&&!e.colorTexture&&(e.colorTexture=tr.newInstance({label:"polyDataColor"})),a&&(e.colorTexture.setInputData(a),r.push(["DiffuseTexture",e.colorTexture]));const s=e.WebGPUActor.getRenderable(),i=e.WebGPURenderer.getRenderable();[["DiffuseTexture",(f=(g=s.getProperty()).getDiffuseTexture)==null?void 0:f.call(g)],["DiffuseTexture",s.getTextures()[0]],["DiffuseTexture",e.colorTexture],["ORMTexture",(h=(l=s.getProperty()).getORMTexture)==null?void 0:h.call(l)],["RMTexture",(p=(v=s.getProperty()).getRMTexture)==null?void 0:p.call(v)],["RoughnessTexture",(T=(y=s.getProperty()).getRoughnessTexture)==null?void 0:T.call(y)],["MetallicTexture",(d=(S=s.getProperty()).getMetallicTexture)==null?void 0:d.call(S)],["NormalTexture",(w=(x=s.getProperty()).getNormalTexture)==null?void 0:w.call(x)],["AmbientOcclusionTexture",(M=(C=s.getProperty()).getAmbientOcclusionTexture)==null?void 0:M.call(C)],["EmissionTexture",(V=(R=s.getProperty()).getEmissionTexture)==null?void 0:V.call(R)],["EnvironmentTexture",(O=i.getEnvironmentTexture)==null?void 0:O.call(i)]].forEach(D=>{let[B,L]=D;L&&((L.getInputData()||L.getJsImageData()||L.getCanvas()||L.getImageBitmap())&&r.push([B,L]),L.getImage()&&L.getImageLoaded()&&r.push([B,L]))}),r.forEach(D=>{let[B,L]=D;const F=e.device.getTextureManager().getTextureForVTKTexture(L,B);if(!F.getReady())return;let U=!1;for(let N=0;N<e.textures.length;++N)if(e.textures[N]===F){U=!0,n[N]=!0;break}if(!U){n[e.textures.length]=!0;const N=F.createView(B);e.textures.push(F),e.textureViews.push(N);const G=L.getInterpolate()?"linear":"nearest";let H=null;L.getEdgeClamp()&&L.getRepeat()?H="mirror-repeat":L.getEdgeClamp()?H="clamp-to-edge":L.getRepeat()&&(H="repeat");let k={addressModeU:H,addressModeV:H,addressModeW:H,minFilter:G,magFilter:G};B==="EnvironmentTexture"&&(k={addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:G,magFilter:G,mipmapFilter:"linear"}),N.addSampler(e.device,k)}});for(let D=e.textures.length-1;D>=0;D--)n[D]||(e.textures.splice(D,1),e.textureViews.splice(D,1))},t.computePipelineHash=()=>{let n=`pd${e.useRendererMatrix?"r":""}${e.forceZValue?"z":""}`;if(e.primitiveType===Be.TriangleEdges||e.primitiveType===Be.TriangleStripEdges)n+="edge";else{if(e.vertexInput.hasAttribute("normalMC")&&(n+="n"),e.vertexInput.hasAttribute("colorVI")&&(n+="c"),e.vertexInput.hasAttribute("tcoord")){const a=e.vertexInput.getBuffer("tcoord"),s=Ce.getNumberOfComponentsFromBufferFormat(a.getArrayInformation()[0].format);n+=`t${s}`}e.textures.length&&(n+=`tx${e.textures.length}`)}e._usesCellNormals&&(n+="cn"),e.SSBO&&(n+="ssbo");const r=t.getHashFromUsage(e.usage);n+=r,n+=e.renderEncoder.getPipelineHash(),e.pipelineHash=n},t.updateBuffers=()=>{e.primitiveType!==Be.TriangleEdges&&e.primitiveType!==Be.TriangleStripEdges&&t.updateTextures();const n=e.WebGPUActor.getRenderable(),r=n.getProperty().getRepresentation();e.usage=t.getUsage(r,e.primitiveType),t.buildVertexInput();const a=e.vertexInput.getBuffer("vertexBC");if(t.setNumberOfVertices(a.getSizeInBytes()/a.getStrideInBytes()),t.setTopology(t.getTopologyFromUsage(e.usage)),t.updateUBO(),t.haveWideLines()){const s=n.getProperty();t.setNumberOfInstances(Math.ceil(s.getLineWidth()*2))}else t.setNumberOfInstances(1)}}const PC={is2D:!1,cellArray:null,currentInput:null,cellOffset:0,primitiveType:0,colorTexture:null,renderEncoder:null,textures:null};function Kg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,PC,n),fi.extend(t,e,n),e.fragmentShaderTemplate=jC,e.vertexShaderTemplate=AC,e._tmpMat3=Nt(new Float64Array(9)),e._tmpMat4=Y(new Float64Array(16)),e.UBO=Jt.newInstance({label:"mapperUBO"}),e.UBO.addEntry("BCWCMatrix","mat4x4<f32>"),e.UBO.addEntry("BCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("MCWCNormals","mat4x4<f32>"),e.UBO.addEntry("AmbientColor","vec4<f32>"),e.UBO.addEntry("DiffuseColor","vec4<f32>"),e.UBO.addEntry("EdgeColor","vec4<f32>"),e.UBO.addEntry("SpecularColor","vec4<f32>"),e.UBO.addEntry("AmbientIntensity","f32"),e.UBO.addEntry("DiffuseIntensity","f32"),e.UBO.addEntry("Roughness","f32"),e.UBO.addEntry("Metallic","f32"),e.UBO.addEntry("Ambient","f32"),e.UBO.addEntry("Normal","f32"),e.UBO.addEntry("Emission","f32"),e.UBO.addEntry("NormalStrength","f32"),e.UBO.addEntry("BaseIOR","f32"),e.UBO.addEntry("SpecularIntensity","f32"),e.UBO.addEntry("LineWidth","f32"),e.UBO.addEntry("Opacity","f32"),e.UBO.addEntry("ZValue","f32"),e.UBO.addEntry("PropID","u32"),e.UBO.addEntry("ClipNear","f32"),e.UBO.addEntry("ClipFar","f32"),e.UBO.addEntry("Time","u32"),Te(t,e,["cellArray","currentInput","cellOffset","is2D","primitiveType","renderEncoder"]),e.textures=[],KC(t,e)}const XC=re(Kg,"vtkWebGPUCellArrayMapper");var Pg={newInstance:XC,extend:Kg};const{PrimitiveTypes:Ae}=fn;function IC(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper"),t.createCellArrayMapper=()=>Pg.newInstance(),t.buildPass=n=>{if(n){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.renderable.getStatic()||e.renderable.update();const r=e.renderable.getInputData();e.renderable.mapScalars(r,1),t.updateCellArrayMappers(r)}},t.updateCellArrayMappers=n=>{if(!n){X("No input!");return}const r=[n.getVerts(),n.getLines(),n.getPolys(),n.getStrips()],a=[];let s=0;for(let i=Ae.Points;i<=Ae.TriangleStrips;i++)if(r[i].getNumberOfValues()>0){e.primitives[i]||(e.primitives[i]=t.createCellArrayMapper());const o=e.primitives[i];o.setCellArray(r[i]),o.setCurrentInput(n),o.setCellOffset(s),o.setPrimitiveType(i),o.setRenderable(e.renderable),s+=r[i].getNumberOfCells(),a.push(o)}else e.primitives[i]=null;if(e.WebGPUActor.getRenderable().getProperty().getEdgeVisibility()){if(r[Ae.Triangles].getNumberOfValues()>0){const i=Ae.TriangleEdges;e.primitives[i]||(e.primitives[i]=t.createCellArrayMapper());const o=e.primitives[i];o.setCellArray(r[Ae.Triangles]),o.setCurrentInput(n),o.setCellOffset(e.primitives[Ae.Triangles].getCellOffset()),o.setPrimitiveType(i),o.setRenderable(e.renderable),a.push(o)}else e.primitives[Ae.TriangleEdges]=null;if(r[Ae.TriangleStrips].getNumberOfValues()>0){const i=Ae.TriangleStripEdges;e.primitives[i]||(e.primitives[i]=t.createCellArrayMapper());const o=e.primitives[i];o.setCellArray(r[Ae.TriangleStrips]),o.setCurrentInput(n),o.setCellOffset(e.primitives[Ae.TriangleStrips].getCellOffset()),o.setPrimitiveType(i),o.setRenderable(e.renderable),a.push(o)}else e.primitives[Ae.TriangleStripEdges]=null}t.prepareNodes(),t.addMissingChildren(a),t.removeUnusedNodes()}}const YC={primitives:null};function QC(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YC,n),fe.extend(t,e,n),e.primitives=[],IC(t,e)}const ZC=re(QC,"vtkWebGPUPolyDataMapper");ut("vtkMapper",ZC);const{PrimitiveTypes:zo}=fn;function qC(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper2D"),t.createCellArrayMapper=()=>Pg.newInstance(),t.buildPass=n=>{if(n){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.renderable.getStatic()||e.renderable.update();const r=e.renderable.getInputData();e.renderable.mapScalars(r,1),t.updateCellArrayMappers(r)}},t.updateCellArrayMappers=n=>{const r=[n.getVerts(),n.getLines(),n.getPolys(),n.getStrips()],a=[];let s=0;for(let i=zo.Points;i<=zo.Triangles;i++)if(r[i].getNumberOfValues()>0){e.primitives[i]||(e.primitives[i]=t.createCellArrayMapper());const o=e.primitives[i];o.setCellArray(r[i]),o.setCurrentInput(n),o.setCellOffset(s),o.setPrimitiveType(i),o.setRenderable(e.renderable),o.setIs2D(!0),s+=r[i].getNumberOfCells(),a.push(o)}else e.primitives[i]=null;t.prepareNodes(),t.addMissingChildren(a),t.removeUnusedNodes()}}function JC(t){return{primitives:[],...t}}function ew(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,JC(n)),fe.extend(t,e,n),e.primitives=[],qC(t,e)}const tw=re(ew,"vtkWebGPUPolyDataMapper2D");ut("vtkMapper2D",tw);function nw(t,e){e.classHierarchy.push("vtkWebGPUScalarBarActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,s=e.WebGPURenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e.WebGPURenderWindow.getRenderable())}}}const rw={};function aw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rw,n),fe.extend(t,e,n),e.scalarBarActorHelper=Lg.newScalarBarActorHelper(),nw(t,e)}const sw=re(aw,"vtkWebGPUScalarBarActor");ut("vtkScalarBarActor",sw);function iw(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=n,e.options.addressModeU=r.addressModeU?r.addressModeU:"clamp-to-edge",e.options.addressModeV=r.addressModeV?r.addressModeV:"clamp-to-edge",e.options.addressModeW=r.addressModeW?r.addressModeW:"clamp-to-edge",e.options.magFilter=r.magFilter?r.magFilter:"nearest",e.options.minFilter=r.minFilter?r.minFilter:"nearest",e.options.mipmapFilter=r.mipmapFilter?r.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(n,r)=>`@binding(${n}) @group(${r}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}const ow={device:null,handle:null,label:null,options:null};function Xg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ow,n),E.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),E.get(t,e,["bindGroupTime","handle","options"]),E.setGet(t,e,["bindGroupLayoutEntry","device","label"]),iw(t,e)}const cw=E.newInstance(Xg);var ui={newInstance:cw,extend:Xg};function fw(t,e){e.classHierarchy.push("vtkWebGPUTextureView"),t.create=(n,r)=>{e.texture=n,e.options=r,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=n.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const a=Ce.getDetailsFromTextureFormat(e.texture.getFormat());e.bindGroupLayoutEntry.texture.sampleType=a.sampleType},t.createFromTextureHandle=(n,r)=>{e.texture=null,e.options=r,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=n,e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const a=Ce.getDetailsFromTextureFormat(r.format);e.bindGroupLayoutEntry.texture.sampleType=a.sampleType,e.bindGroupTime.modified()},t.getBindGroupEntry=()=>({resource:t.getHandle()}),t.getShaderCode=(n,r)=>{let a="f32";e.bindGroupLayoutEntry.texture.sampleType==="sint"?a="i32":e.bindGroupLayoutEntry.texture.sampleType==="uint"&&(a="u32");let s=`@binding(${n}) @group(${r}) var ${e.label}: texture_${e.options.dimension}<${a}>;`;return e.bindGroupLayoutEntry.texture.sampleType==="depth"&&(s=`@binding(${n}) @group(${r}) var ${e.label}: texture_depth_${e.options.dimension};`),s},t.addSampler=(n,r)=>{const a=ui.newInstance({label:`${e.label}Sampler`});a.create(n,r),t.setSampler(a)},t.getBindGroupTime=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.bindGroupTime),t.getHandle=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.handle)}const uw={texture:null,handle:null,sampler:null,label:null};function Ig(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uw,n),E.obj(t,e),e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),E.get(t,e,["bindGroupTime","texture"]),E.setGet(t,e,["bindGroupLayoutEntry","label","sampler"]),fw(t,e)}const gw=E.newInstance(Ig);var Yg={newInstance:gw,extend:Ig};function lw(t,e){e.classHierarchy.push("vtkWebGPUTexture"),t.create=(n,r)=>{e.device=n,e.width=r.width,e.height=r.height,e.depth=r.depth?r.depth:1;const a=e.depth===1?"2d":"3d";e.format=r.format?r.format:"rgba8unorm",e.mipLevel=r.mipLevel?r.mipLevel:0,e.usage=r.usage?r.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label,dimension:a,mipLevelCount:e.mipLevel+1})},t.assignFromHandle=(n,r,a)=>{e.device=n,e.handle=r,e.width=a.width,e.height=a.height,e.depth=a.depth?a.depth:1,e.format=a.format?a.format:"rgba8unorm",e.usage=a.usage?a.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST},t.writeImageData=n=>{let r=[];const a=f=>{e.device.getHandle().queue.copyExternalImageToTexture({source:f,flipY:n.flip},{texture:e.handle,premultipliedAlpha:!0,mipLevel:0,origin:{x:0,y:0,z:0}},[f.width,f.height,e.depth]),t.getDimensionality()!==3&&e.mipLevel>0&&tr.generateMipmaps(e.device.getHandle(),e.handle,e.mipLevel+1),e.ready=!0};if(n.canvas){a(n.canvas);return}if(n.imageBitmap){n.width=n.imageBitmap.width,n.height=n.imageBitmap.height,n.depth=1,n.format="rgba8unorm",n.flip=!0,a(n.imageBitmap);return}if(n.jsImageData){n.width=n.jsImageData.width,n.height=n.jsImageData.height,n.depth=1,n.format="rgba8unorm",n.flip=!0,a(n.jsImageData);return}if(n.image){n.width=n.image.width,n.height=n.image.height,n.depth=1,n.format="rgba8unorm",n.flip=!0,a(n.image);return}const s=Ce.getDetailsFromTextureFormat(e.format);let i=e.width*s.stride;const o=(f,l,h)=>{const v=s.elementSize===2&&s.sampleType==="float",p=f.BYTES_PER_ELEMENT,y=f.length/(l*h)*p;if(!v&&y%256===0)return[f,y];const T=y/p,S=s.elementSize,d=256*Math.floor((T*S+255)/256),x=d/S,w=E.newTypedArray(v?"Uint16Array":f.constructor.name,x*l*h),C=l*h;if(v)for(let M=0;M<C;M++){const R=M*T,V=M*x;for(let O=0;O<T;O++)w[V+O]=Je.toHalf(f[R+O])}else if(x===T)w.set(f);else for(let M=0;M<C;M++)w.set(f.subarray(M*T,(M+1)*T),M*x);return[w,d]};n.nativeArray&&(r=n.nativeArray);const c=t.getDimensionality()===3,u=o(r,e.height,c?e.depth:1);i=u[1];const g=u[0];e.device.getHandle().queue.writeTexture({texture:e.handle,mipLevel:0,origin:{x:0,y:0,z:0}},g,{offset:0,bytesPerRow:i,rowsPerImage:e.height},{width:e.width,height:e.height,depthOrArrayLayers:c?e.depth:1}),!c&&e.mipLevel>0&&tr.generateMipmaps(e.device.getHandle(),e.handle,e.mipLevel+1),e.ready=!0},t.getScale=()=>{const n=Ce.getDetailsFromTextureFormat(e.format);return n.elementSize===2&&n.sampleType==="float"?1:255},t.getNumberOfComponents=()=>Ce.getDetailsFromTextureFormat(e.format).numComponents,t.getDimensionality=()=>{let n=0;return e.width>1&&n++,e.height>1&&n++,e.depth>1&&n++,n},t.resizeToMatch=n=>{(n.getWidth()!==e.width||n.getHeight()!==e.height||n.getDepth()!==e.depth)&&(e.width=n.getWidth(),e.height=n.getHeight(),e.depth=n.getDepth(),e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.resize=function(n,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;(n!==e.width||r!==e.height||a!==e.depth)&&(e.width=n,e.height=r,e.depth=a,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.createView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};r.dimension||(r.dimension=e.depth===1?"2d":"3d");const a=Yg.newInstance({label:n});return a.create(t,r),a}}const pw={device:null,handle:null,buffer:null,ready:!1,label:null};function Qg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pw,n),E.obj(t,e),E.get(t,e,["handle","ready","width","height","depth","format","usage"]),E.setGet(t,e,["device","label"]),lw(t,e)}const hw=E.newInstance(Qg);var ct={newInstance:hw,extend:Qg};function yw(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();const a=e.WebGPURenderer.getAspectRatio(),s=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,i=e.WebGPURenderer.getTiledSizeAndOrigin(),o=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),s,a,i,o)}}const vw={};function Tw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vw,n),fe.extend(t,e,n),yw(t,e)}const dw=E.newInstance(Tw,"vtkWebGPUPixelSpaceCallbackMapper");ut("vtkPixelSpaceCallbackMapper",dw);const{vtkDebugMacro:Lr}=E;function xw(t,e){e.classHierarchy.push("vtkCamera");const n=new Float64Array(3),r=new Float64Array([0,0,-1]),a=new Float64Array([0,1,0]),s=Y(new Float64Array(16)),i=Y(new Float64Array(16)),o=new Float64Array(3),c=new Float64Array(3),u=new Float64Array(3),g=Y(new Float64Array(16)),f=Y(new Float64Array(16)),l=new Float64Array(3),h=new Float64Array(3);function v(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{const p=t.getViewMatrix();e.viewUp[0]=p[4],e.viewUp[1]=p[5],e.viewUp[2]=p[6],t.modified()},t.setPosition=(p,y,T)=>{p===e.position[0]&&y===e.position[1]&&T===e.position[2]||(e.position[0]=p,e.position[1]=y,e.position[2]=T,t.computeDistance(),t.modified())},t.setFocalPoint=(p,y,T)=>{p===e.focalPoint[0]&&y===e.focalPoint[1]&&T===e.focalPoint[2]||(e.focalPoint[0]=p,e.focalPoint[1]=y,e.focalPoint[2]=T,t.computeDistance(),t.modified())},t.setDistance=p=>{if(e.distance===p)return;e.distance=p,e.distance<1e-20&&(e.distance=1e-20,Lr("Distance is set to minimum."));const y=e.directionOfProjection;e.focalPoint[0]=e.position[0]+y[0]*e.distance,e.focalPoint[1]=e.position[1]+y[1]*e.distance,e.focalPoint[2]=e.position[2]+y[2]*e.distance,t.modified()},t.computeDistance=()=>{const p=e.focalPoint[0]-e.position[0],y=e.focalPoint[1]-e.position[1],T=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(p*p+y*y+T*T),e.distance<1e-20){e.distance=1e-20,Lr("Distance is set to minimum.");const S=e.directionOfProjection;e.focalPoint[0]=e.position[0]+S[0]*e.distance,e.focalPoint[1]=e.position[1]+S[1]*e.distance,e.focalPoint[2]=e.position[2]+S[2]*e.distance}e.directionOfProjection[0]=p/e.distance,e.directionOfProjection[1]=y/e.distance,e.directionOfProjection[2]=T/e.distance,v()},t.dolly=p=>{if(p<=0)return;const y=e.distance/p;t.setPosition(e.focalPoint[0]-y*e.directionOfProjection[0],e.focalPoint[1]-y*e.directionOfProjection[1],e.focalPoint[2]-y*e.directionOfProjection[2])},t.roll=p=>{const y=e.position,T=e.focalPoint,S=e.viewUp,d=new Float64Array([S[0],S[1],S[2],0]);Y(g);const x=new Float64Array([T[0]-y[0],T[1]-y[1],T[2]-y[2]]);Ye(g,g,oe(p),x),ht(d,d,g),e.viewUp[0]=d[0],e.viewUp[1]=d[1],e.viewUp[2]=d[2],t.modified()},t.azimuth=p=>{const y=e.focalPoint;Y(f),le(f,f,y),Ye(f,f,oe(p),e.viewUp),le(f,f,[-y[0],-y[1],-y[2]]),q(l,e.position,f),t.setPosition(l[0],l[1],l[2])},t.yaw=p=>{const y=e.position;Y(f),le(f,f,y),Ye(f,f,oe(p),e.viewUp),le(f,f,[-y[0],-y[1],-y[2]]),q(h,e.focalPoint,f),t.setFocalPoint(h[0],h[1],h[2])},t.elevation=p=>{const y=e.focalPoint,T=t.getViewMatrix(),S=[-T[0],-T[1],-T[2]];Y(f),le(f,f,y),Ye(f,f,oe(p),S),le(f,f,[-y[0],-y[1],-y[2]]),q(l,e.position,f),t.setPosition(l[0],l[1],l[2])},t.pitch=p=>{const y=e.position,T=t.getViewMatrix(),S=[T[0],T[1],T[2]];Y(f),le(f,f,y),Ye(f,f,oe(p),S),le(f,f,[-y[0],-y[1],-y[2]]),q(h,e.focalPoint,f),t.setFocalPoint(...h)},t.zoom=p=>{p<=0||(e.parallelProjection?e.parallelScale/=p:e.viewAngle/=p,t.modified())},t.translate=(p,y,T)=>{const S=[p,y,T];En(e.position,S,e.position),En(e.focalPoint,S,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=p=>{const y=[...e.viewUp,1],T=[],S=[],d=[];y[0]+=e.position[0],y[1]+=e.position[1],y[2]+=e.position[2],ht(T,[...e.position,1],p),ht(S,[...e.focalPoint,1],p),ht(d,y,p),d[0]-=T[0],d[1]-=T[1],d[2]-=T[2],t.setPosition(...T.slice(0,3)),t.setFocalPoint(...S.slice(0,3)),t.setViewUp(...d.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=p=>{let y=p;y<1e-20&&(y=1e-20,Lr("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+y)},t.setThicknessFromFocalPoint=p=>{let y=p;y<1e-20&&(y=1e-20,Lr("Thickness is set to minimum.")),t.setClippingRange(e.distance-y/2,e.distance+y/2)},t.setRoll=p=>{},t.getRoll=()=>{},t.setObliqueAngles=(p,y)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=function(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Float64Array(24);const T=[[1,0,0,1],[-1,0,0,1],[0,1,0,1],[0,-1,0,1],[0,0,1,1],[0,0,-1,1]],S=t.getCompositeProjectionMatrix(p,-1,1);for(let d=0;d<6;d++)ht(T[d],T[d],S),py(T[d]),y[4*d+0]=T[d][0],y[4*d+1]=T[d][1],y[4*d+2]=T[d][2],y[4*d+3]=T[d][3];return y},t.getCameraLightTransformMatrix=p=>(Oe(p,e.cameraLightTransform),p),t.computeCameraLightTransform=()=>{Oe(s,t.getViewMatrix()),Ve(s,s),oc(i,[e.distance,e.distance,e.distance]),pe(s,s,i),Y(e.cameraLightTransform),le(e.cameraLightTransform,s,[0,0,-1])},t.deepCopy=p=>{},t.physicalOrientationToWorldDirection=p=>{const y=wi(p[0],p[1],p[2],p[3]),T=tn(),S=wi(0,0,1,0);return lp(T,y),Ci(S,y,S),Ci(S,S,T),[S[0],S[1],S[2]]},t.getPhysicalToWorldMatrix=p=>{t.getWorldToPhysicalMatrix(p),Ve(p,p)},t.getWorldToPhysicalMatrix=p=>{Y(p);const y=[3];Ue(e.physicalViewNorth,e.physicalViewUp,y),p[0]=y[0],p[1]=y[1],p[2]=y[2],p[4]=e.physicalViewUp[0],p[5]=e.physicalViewUp[1],p[6]=e.physicalViewUp[2],p[8]=-e.physicalViewNorth[0],p[9]=-e.physicalViewNorth[1],p[10]=-e.physicalViewNorth[2],ne(p,p),it(o,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),en(p,p,o),le(p,p,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=p=>{Ve(s,p),q(o,n,s),t.computeDistance();const y=e.distance;t.setPosition(o[0],o[1],o[2]),q(c,r,s),vt(c,c,o),mt(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),q(u,a,s),vt(u,u,o),mt(u,u),t.setViewUp(u[0],u[1],u[2]),t.setDistance(y)},t.computeViewParametersFromPhysicalMatrix=p=>{t.getWorldToPhysicalMatrix(s),pe(s,p,s),t.computeViewParametersFromViewMatrix(s)},t.setModelTransformMatrix=p=>{e.modelTransformMatrix=p},t.getModelTransformMatrix=()=>e.modelTransformMatrix,t.setViewMatrix=p=>{e.viewMatrix=p,e.viewMatrix&&(Oe(s,e.viewMatrix),t.computeViewParametersFromViewMatrix(s),ne(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.modelTransformMatrix?(pe(s,e.viewMatrix,e.modelTransformMatrix),s):e.viewMatrix;hc(s,e.position,e.focalPoint,e.viewUp),ne(s,s);const p=new Float64Array(16);return e.modelTransformMatrix?pe(p,s,e.modelTransformMatrix):Oe(p,s),p},t.setProjectionMatrix=p=>{e.projectionMatrix=p},t.getProjectionMatrix=(p,y,T)=>{const S=new Float64Array(16);if(Y(S),e.projectionMatrix){const w=1/e.physicalScale;return it(o,w,w,w),Oe(S,e.projectionMatrix),en(S,S,o),ne(S,S),S}Y(s);const d=e.clippingRange[1]-e.clippingRange[0],x=[e.clippingRange[0]+(y+1)*d/2,e.clippingRange[0]+(T+1)*d/2];if(e.parallelProjection){const w=e.parallelScale*p,C=e.parallelScale,M=(e.windowCenter[0]-1)*w,R=(e.windowCenter[0]+1)*w,V=(e.windowCenter[1]-1)*C,O=(e.windowCenter[1]+1)*C;pc(s,M,R,V,O,x[0],x[1]),ne(s,s)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const w=Math.tan(oe(e.viewAngle)/2);let C,M;e.useHorizontalViewAngle===!0?(C=e.clippingRange[0]*w,M=e.clippingRange[0]*w/p):(C=e.clippingRange[0]*w*p,M=e.clippingRange[0]*w);const R=(e.windowCenter[0]-1)*C,V=(e.windowCenter[0]+1)*C,O=(e.windowCenter[1]-1)*M,D=(e.windowCenter[1]+1)*M,B=x[0],L=x[1];s[0]=2*B/(V-R),s[5]=2*B/(D-O),s[2]=(R+V)/(V-R),s[6]=(O+D)/(D-O),s[10]=-(B+L)/(L-B),s[14]=-1,s[11]=-2*B*L/(L-B),s[15]=0}}return Oe(S,s),S},t.getCompositeProjectionMatrix=(p,y,T)=>{const S=t.getViewMatrix(),d=t.getProjectionMatrix(p,y,T);return pe(d,S,d),d},t.setDirectionOfProjection=(p,y,T)=>{if(e.directionOfProjection[0]===p&&e.directionOfProjection[1]===y&&e.directionOfProjection[2]===T)return;e.directionOfProjection[0]=p,e.directionOfProjection[1]=y,e.directionOfProjection[2]=T;const S=e.directionOfProjection;e.focalPoint[0]=e.position[0]+S[0]*e.distance,e.focalPoint[1]=e.position[1]+S[1]*e.distance,e.focalPoint[2]=e.position[2]+S[2]*e.distance,v()},t.setDeviceAngles=(p,y,T,S)=>{const d=[3];Ue(e.physicalViewNorth,e.physicalViewUp,d);const x=Y(new Float64Array(16));Ye(x,x,oe(p),e.physicalViewUp),Ye(x,x,oe(y),d),Ye(x,x,oe(T),e.physicalViewNorth),Ye(x,x,oe(-S),e.physicalViewUp);const w=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),C=new Float64Array(e.physicalViewNorth);q(w,w,x),q(C,C,x),t.setDirectionOfProjection(w[0],w[1],w[2]),t.setViewUp(C[0],C[1],C[2]),t.modified()},t.setOrientationWXYZ=(p,y,T,S)=>{const d=Y(new Float64Array(16));if(p!==0&&(y!==0||T!==0||S!==0)){const C=oe(p),M=tn();Rs(M,[y,T,S],C),Kn(d,M)}const x=new Float64Array(3);q(x,[0,0,-1],d);const w=new Float64Array(3);q(w,[0,1,0],d),t.setDirectionOfProjection(...x),t.setViewUp(...w),t.modified()},t.computeClippingRange=p=>{let y=null,T=null;y=e.viewPlaneNormal,T=e.position;const S=-y[0],d=-y[1],x=-y[2],w=-(S*T[0]+d*T[1]+x*T[2]),C=[S*p[0]+d*p[2]+x*p[4]+w,1e-18];for(let M=0;M<2;M++)for(let R=0;R<2;R++)for(let V=0;V<2;V++){const O=S*p[V]+d*p[2+R]+x*p[4+M]+w;C[0]=O<C[0]?O:C[0],C[1]=O>C[1]?O:C[1]}return C}}const Sw={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,modelTransformMatrix:null,cameraLightTransform:oa(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function Zg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Sw,n),E.obj(t,e),E.get(t,e,["distance"]),E.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),E.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),E.setGetArray(t,e,["clippingRange","windowCenter"],2),E.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),xw(t,e)}const Cw=E.newInstance(Zg,"vtkCamera");var ww={newInstance:Cw,extend:Zg};function Ew(t,e){e.classHierarchy.push("vtkLight");const n=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?q(n,e.position,e.transformMatrix):it(n,e.position[0],e.position[1],e.position[2]),n),t.getTransformedFocalPoint=()=>(e.transformMatrix?q(n,e.focalPoint,e.transformMatrix):it(n,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),n),t.getDirection=()=>(e.directionMTime<e.mtime&&(Pa(e.direction,e.focalPoint,e.position),we(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=r=>{const a=new Float64Array(3);Pa(a,e.position,r),e.focalPoint=a},t.setDirectionAngle=(r,a)=>{const s=oe(r),i=oe(a);t.setPosition(Math.cos(s)*Math.sin(i),Math.sin(s),Math.cos(s)*Math.cos(i)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}const Mw={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function Rw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Mw,n),E.obj(t,e),E.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),E.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),Ew(t,e)}const Ow=E.newInstance(Rw,"vtkLight");var Dw={newInstance:Ow};const{vtkErrorMacro:Kr}=E;function Lw(t){return()=>Kr(`vtkViewport::${t} - NOT IMPLEMENTED`)}function Vw(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=r=>e.props.includes(r),t.addViewProp=r=>{r&&!t.hasViewProp(r)&&e.props.push(r)},t.removeViewProp=r=>{const a=e.props.filter(s=>s!==r);e.props.length!==a.length&&(e.props=a)},t.removeAllViewProps=()=>{e.props=[]};function n(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];a.push(r);const s=r.getNestedProps();if(s&&s.length)for(let i=0;i<s.length;i++)n(s[i],a);return a}t.getViewPropsWithNestedProps=()=>{let r=[];const a=t.getActors2D();a.sort((i,o)=>i.getLayerNumber()-o.getLayerNumber());const s=e.props.filter(i=>!a.includes(i));for(let i=0;i<s.length;i++)n(s[i],r);return r=r.concat(a),r},t.addActor2D=t.addViewProp,t.removeActor2D=r=>{t.removeViewProp(r)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(r=>{e.actors2D=e.actors2D.concat(r.getActors2D())}),e.actors2D),t.displayToView=()=>Kr("call displayToView on your view instead"),t.viewToDisplay=()=>Kr("callviewtodisplay on your view instead"),t.getSize=()=>Kr("call getSize on your View instead"),t.normalizedDisplayToProjection=(r,a,s)=>{const i=t.normalizedDisplayToNormalizedViewport(r,a,s);return t.normalizedViewportToProjection(i[0],i[1],i[2])},t.normalizedDisplayToNormalizedViewport=(r,a,s)=>{const i=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(r-e.viewport[0])/i[0],(a-e.viewport[1])/i[1],s]},t.normalizedViewportToProjection=(r,a,s)=>[r*2-1,a*2-1,s*2-1],t.projectionToNormalizedDisplay=(r,a,s)=>{const i=t.projectionToNormalizedViewport(r,a,s);return t.normalizedViewportToNormalizedDisplay(i[0],i[1],i[2])},t.normalizedViewportToNormalizedDisplay=(r,a,s)=>{const i=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[r*i[0]+e.viewport[0],a*i[1]+e.viewport[1],s]},t.projectionToNormalizedViewport=(r,a,s)=>[(r+1)*.5,(a+1)*.5,(s+1)*.5],t.PickPropFrom=Lw("PickPropFrom")}const Bw={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function qg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Bw,n),E.obj(t,e),E.event(t,e,"event"),E.setGetArray(t,e,["viewport"],4),E.setGetArray(t,e,["background","background2"],3),Vw(t,e)}const Fw=E.newInstance(qg,"vtkViewport");var mw={newInstance:Fw,extend:qg};const{vtkDebugMacro:Un,vtkErrorMacro:Vt,vtkWarningMacro:kw}=ft;function Wo(t){return()=>Vt(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function Uw(t,e){e.classHierarchy.push("vtkRenderer");const n={type:"ComputeVisiblePropBoundsEvent",renderer:t},r={type:"ResetCameraClippingRangeEvent",renderer:t},a={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(Un("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{const s=t.getActiveCameraAndResetIfCreated();e.lights.forEach(i=>{i.lightTypeIsSceneLight()||(i.lightTypeIsHeadLight()?(i.setPositionFrom(s.getPositionByReference()),i.setFocalPointFrom(s.getFocalPointByReference()),i.modified(s.getMTime())):i.lightTypeIsCameraLight()?i.setTransformMatrix(s.getCameraLightTransformMatrix(oa())):Vt("light has unknown light type",i.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=Wo("allocateTime"),t.updateGeometry=Wo("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=s=>{Un(t.getClassName(),t,"setting Layer to ",s),e.layer!==s&&(e.layer=s,t.modified()),t.setPreserveColorBuffer(!!s)},t.setActiveCamera=s=>e.activeCamera===s?!1:(e.activeCamera=s,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:s}),!0),t.makeCamera=()=>{const s=ww.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:s}),s},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(s=>{e.actors=e.actors.concat(s.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=s=>{e.actors=e.actors.filter(i=>i!==s),t.removeViewProp(s),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(i=>{t.removeViewProp(i)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(s=>{e.volumes=e.volumes.concat(s.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=s=>{e.volumes=e.volumes.filter(i=>i!==s),t.removeViewProp(s),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(i=>{t.removeViewProp(i)}),e.volumes=[],t.modified()},t.hasLight=s=>e.lights.includes(s),t.addLight=s=>{s&&!t.hasLight(s)&&(e.lights.push(s),t.modified())},t.removeLight=s=>{e.lights=e.lights.filter(i=>i!==s),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=s=>{e.lights=s,t.modified()},t.makeLight=Dw.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(s,i,o,c)=>{let u=t.normalizedDisplayToProjection(s,i,o);return u=t.projectionToView(u[0],u[1],u[2],c),t.viewToWorld(u[0],u[1],u[2])},t.worldToNormalizedDisplay=(s,i,o,c)=>{let u=t.worldToView(s,i,o);return u=t.viewToProjection(u[0],u[1],u[2],c),t.projectionToNormalizedDisplay(u[0],u[1],u[2])},t.viewToWorld=(s,i,o)=>{if(e.activeCamera===null)return Vt("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();Ve(c,c),ne(c,c);const u=new Float64Array([s,i,o]);return q(u,u,c),u},t.projectionToView=(s,i,o,c)=>{if(e.activeCamera===null)return Vt("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];const u=e.activeCamera.getProjectionMatrix(c,-1,1);Ve(u,u),ne(u,u);const g=new Float64Array([s,i,o]);return q(g,g,u),g},t.worldToView=(s,i,o)=>{if(e.activeCamera===null)return Vt("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();ne(c,c);const u=new Float64Array([s,i,o]);return q(u,u,c),u},t.viewToProjection=(s,i,o,c)=>{if(e.activeCamera===null)return Vt("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];const u=e.activeCamera.getProjectionMatrix(c,-1,1);ne(u,u);const g=new Float64Array([s,i,o]);return q(g,g,u),g},t.computeVisiblePropBounds=()=>{e.allBounds[0]=j.INIT_BOUNDS[0],e.allBounds[1]=j.INIT_BOUNDS[1],e.allBounds[2]=j.INIT_BOUNDS[2],e.allBounds[3]=j.INIT_BOUNDS[3],e.allBounds[4]=j.INIT_BOUNDS[4],e.allBounds[5]=j.INIT_BOUNDS[5];let s=!0;t.invokeEvent(n);for(let i=0;i<e.props.length;++i){const o=e.props[i];if(o.getVisibility()&&o.getUseBounds()){const c=o.getBounds();c&&Wr(c)&&(s=!1,c[0]<e.allBounds[0]&&(e.allBounds[0]=c[0]),c[1]>e.allBounds[1]&&(e.allBounds[1]=c[1]),c[2]<e.allBounds[2]&&(e.allBounds[2]=c[2]),c[3]>e.allBounds[3]&&(e.allBounds[3]=c[3]),c[4]<e.allBounds[4]&&(e.allBounds[4]=c[4]),c[5]>e.allBounds[5]&&(e.allBounds[5]=c[5]))}}return s&&(Ys(e.allBounds),Un("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){const i=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),o=[0,0,0];if(!Wr(i))return Un("Cannot reset camera!"),!1;let c=null;if(t.getActiveCamera())c=e.activeCamera.getViewPlaneNormal();else return Vt("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),o[0]=(i[0]+i[1])/2,o[1]=(i[2]+i[3])/2,o[2]=(i[4]+i[5])/2;let u=i[1]-i[0],g=i[3]-i[2],f=i[5]-i[4];u*=u,g*=g,f*=f;let l=u+g+f;l=l===0?1:l,l=Math.sqrt(l)*.5;const h=oe(e.activeCamera.getViewAngle()),v=l,p=l/Math.sin(h*.5),y=e.activeCamera.getViewUp();return Math.abs(W(y,c))>.999&&(kw("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-y[2],y[0],y[1])),e.activeCamera.setFocalPoint(o[0],o[1],o[2]),e.activeCamera.setPosition(o[0]+p*c[0],o[1]+p*c[1],o[2]+p*c[2]),t.resetCameraClippingRange(i),e.activeCamera.setParallelScale(v),e.activeCamera.setPhysicalScale(l),e.activeCamera.setPhysicalTranslation(-o[0],-o[1],-o[2]),t.invokeEvent(a),!0},t.resetCameraClippingRange=function(){const i=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!Wr(i))return Un("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return Vt("Trying to reset clipping range of non-existent camera"),!1;const o=e.activeCamera.computeClippingRange(i);let c=0;if(e.activeCamera.getParallelProjection())c=.2*e.activeCamera.getParallelScale();else{const u=oe(e.activeCamera.getViewAngle());c=.2*Math.tan(u/2)*o[1]}return o[1]-o[0]<c&&(c=c-o[1]+o[0],o[1]+=c/2,o[0]-=c/2),o[0]<0&&(o[0]=0),o[0]=.99*o[0]-(o[1]-o[0])*e.clippingRangeExpansion,o[1]=1.01*o[1]+(o[1]-o[0])*e.clippingRangeExpansion,o[0]=o[0]>=o[1]?.01*o[1]:o[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),o[0]<e.nearClippingPlaneTolerance*o[1]&&(o[0]=e.nearClippingPlaneTolerance*o[1]),e.activeCamera.setClippingRange(o[0],o[1]),t.invokeEvent(r),!1},t.setRenderWindow=s=>{s!==e._renderWindow&&(e._vtkWindow=s,e._renderWindow=s)},t.visibleActorCount=()=>e.props.filter(s=>s.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let s=e.mtime;const i=e.activeCamera?e.activeCamera.getMTime():0;i>s&&(s=i);const o=e._createdLight?e._createdLight.getMTime():0;return o>s&&(s=o),s},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}const Nw={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:la(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function Jg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,Nw,n),mw.extend(t,e,n),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),Ne(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),Te(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),Ln(t,e,["actors","volumes","lights"]),Vs(t,e,["background"],4,1),rr(t,e,["renderWindow"]),Uw(t,e)}const _w=re(Jg,"vtkRenderer");var Gw={newInstance:_w,extend:Jg};const bw="WebGL",sa=Object.create(null);function gi(t,e){sa[t]=e}function $w(){return Object.keys(sa)}function e0(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return sa[t]&&sa[t](e)}function zw(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=n=>{t.hasRenderer(n)||(n.setRenderWindow(t),e.renderers.push(n),t.modified())},t.removeRenderer=n=>{e.renderers=e.renderers.filter(r=>r!==n),t.modified()},t.hasRenderer=n=>e.renderers.indexOf(n)!==-1,t.newAPISpecificView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e0(n||e.defaultViewAPI,r)},t.addView=n=>{t.hasView(n)||(n.setRenderable(t),e._views.push(n),t.modified())},t.removeView=n=>{e._views=e._views.filter(r=>r!==n),t.modified()},t.hasView=n=>e._views.indexOf(n)!==-1,t.preRender=()=>{e.renderers.forEach(n=>{n.isActiveCameraCreated()||n.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(n=>n.traverseAllPasses())},t.getStatistics=()=>{const n={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(r=>{r.getGraphicsMemoryInfo&&(n.gpuMemoryMB+=r.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(r=>{const a=r.getViewProps(),s=e._views[0].getViewNodeFor(r);a.forEach(i=>{if(i.getVisibility()){n.propCount+=1;const o=i.getMapper&&i.getMapper();if(o&&o.getPrimitiveCount){const c=s.getViewNodeFor(o);if(c){c.getAllocatedGPUMemoryInBytes&&(n.gpuMemoryMB+=c.getAllocatedGPUMemoryInBytes()/1e6);const u=o.getPrimitiveCount();Object.keys(u).forEach(g=>{n[g]||(n[g]=0),n[g]+=u[g]})}}}else n.invisiblePropCount+=1})}),n.str=Object.keys(n).map(r=>`${r}: ${n[r]}`).join(`
`),n},t.captureImages=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return E.setImmediate(t.render),e._views.map(a=>a.captureNextImage?a.captureNextImage(n,r):void 0).filter(a=>!!a)},t.addRenderWindow=n=>e.childRenderWindows.includes(n)?!1:(e.childRenderWindows.push(n),t.modified(),!0),t.removeRenderWindow=n=>{const r=e.childRenderWindows.findIndex(a=>a===n);return r<0?!1:(e.childRenderWindows.splice(r,1),t.modified(),!0)}}const Ww={defaultViewAPI:bw,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function t0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ww,n),E.obj(t,e),E.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),E.get(t,e,["neverRendered"]),E.getArray(t,e,["renderers","childRenderWindows"]),E.moveToProtected(t,e,["views"]),E.event(t,e,"completion"),zw(t,e)}const Hw=E.newInstance(t0,"vtkRenderWindow");var Aw={newInstance:Hw,extend:t0,registerViewConstructor:gi,listViewAPIs:$w,newAPISpecificView:e0};const Ts={Unknown:0,LeftController:1,RightController:2},jn={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},jw={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4},Kw={LeftButton:1,MiddleButton:2,RightButton:3};var n0={Device:Ts,Input:jn,Axis:jw,MouseButton:Kw};const{Device:Vr,Input:Xt}=n0,{vtkWarningMacro:Br,vtkErrorMacro:Fr,normalizeWheel:Pw,vtkOnceErrorMacro:Xw}=E,hn={ctrlKey:!1,altKey:!1,shiftKey:!1},ba={"xr-standard":[Xt.Trigger,Xt.Grip,Xt.TrackPad,Xt.Thumbstick,Xt.A,Xt.B]},li=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function Nn(t){t.cancelable&&t.preventDefault()}function mr(t){const e=Object.create(null);return t.forEach(n=>{let{pointerId:r,position:a}=n;e[r]=a}),e}function Iw(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");const n={...t},r=new Set,a=new Map;let s=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=p=>{Fr("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=p=>{e.interactorStyle!==p&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=p,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>Br("empty event loop");function i(p,y){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(p,y))}t.getCurrentRenderer=()=>(e.currentRenderer||i(0,0),e.currentRenderer);function o(p){const y=e._view.getCanvas(),T=y.getBoundingClientRect(),S=y.width/T.width,d=y.height/T.height,x={x:S*(p.clientX-T.left),y:d*(T.height-p.clientY+T.top),z:0,movementX:S*p.movementX,movementY:d*p.movementY};return(a.size<=1||!e.currentRenderer)&&i(x.x,x.y),x}const c=e._getScreenEventPositionFor||o;function u(p){return{controlKey:p.ctrlKey,altKey:p.altKey,shiftKey:p.shiftKey}}function g(p){const y=u(p);return{key:p.key,keyCode:p.charCode,...y}}function f(p){return p.pointerType||""}const l=()=>{if(e.container===null)return;const{container:p}=e;p.addEventListener("contextmenu",Nn),p.addEventListener("wheel",t.handleWheel),p.addEventListener("DOMMouseScroll",t.handleWheel),p.addEventListener("pointerenter",t.handlePointerEnter),p.addEventListener("pointerleave",t.handlePointerLeave),p.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),p.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),p.addEventListener("pointerup",t.handlePointerUp),p.addEventListener("pointercancel",t.handlePointerCancel),p.addEventListener("keypress",t.handleKeyPress),p.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),p.tabIndex=0,p.style.touchAction="none",p.style.userSelect="none",p.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=p=>{if(p===null)return;n.setContainer(p)&&l()};const h=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,s=1;const{container:p}=e;p&&(p.removeEventListener("contextmenu",Nn),p.removeEventListener("wheel",t.handleWheel),p.removeEventListener("DOMMouseScroll",t.handleWheel),p.removeEventListener("pointerenter",t.handlePointerEnter),p.removeEventListener("pointerleave",t.handlePointerLeave),p.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),p.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),p.removeEventListener("pointerup",t.handlePointerUp),p.removeEventListener("pointercancel",t.handlePointerCancel),p.removeEventListener("keypress",t.handleKeyPress),p.removeEventListener("keydown",t.handleKeyDown)),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),a.clear()};t.unbindEvents=()=>{h(),n.setContainer(null)},t.handleKeyPress=p=>{const y=g(p);t.keyPressEvent(y)},t.handleKeyDown=p=>{const y=g(p);t.keyDownEvent(y)},t.handleKeyUp=p=>{const y=g(p);t.keyUpEvent(y)},t.handlePointerEnter=p=>{const y={...u(p),position:c(p),deviceType:f(p)};t.pointerEnterEvent(y),y.deviceType==="mouse"&&t.mouseEnterEvent(y)},t.handlePointerLeave=p=>{const y={...u(p),position:c(p),deviceType:f(p)};t.pointerLeaveEvent(y),y.deviceType==="mouse"&&t.mouseLeaveEvent(y)},t.handlePointerDown=p=>{if(!(p.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&Nn(p),p.target.hasPointerCapture(p.pointerId)&&p.target.releasePointerCapture(p.pointerId),e.container.setPointerCapture(p.pointerId),a.has(p.pointerId)&&Br("[RenderWindowInteractor] duplicate pointerId detected"),a.set(p.pointerId,{pointerId:p.pointerId,position:c(p)}),p.pointerType){case"pen":case"touch":t.handleTouchStart(p);break;case"mouse":default:t.handleMouseDown(p);break}},t.handlePointerUp=p=>{if(a.has(p.pointerId))switch(e.preventDefaultOnPointerUp&&Nn(p),a.delete(p.pointerId),e.container.releasePointerCapture(p.pointerId),p.pointerType){case"pen":case"touch":t.handleTouchEnd(p);break;case"mouse":default:t.handleMouseUp(p);break}},t.handlePointerCancel=p=>{if(a.has(p.pointerId))switch(a.delete(p.pointerId),p.pointerType){case"pen":case"touch":t.handleTouchEnd(p);break;case"mouse":default:t.handleMouseUp(p);break}},t.handlePointerMove=p=>{if(a.has(p.pointerId)){const y=a.get(p.pointerId);y.position=c(p)}switch(p.pointerType){case"pen":case"touch":t.handleTouchMove(p);break;case"mouse":default:t.handleMouseMove(p);break}},t.handleMouseDown=p=>{const y={...u(p),position:c(p),deviceType:f(p)};switch(p.button){case 0:t.leftButtonPressEvent(y);break;case 1:t.middleButtonPressEvent(y);break;case 2:t.rightButtonPressEvent(y);break;default:Fr(`Unknown mouse button pressed: ${p.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>{var p;return(p=document.exitPointerLock)==null?void 0:p.call(document)},t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function v(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=p=>{if(p===void 0){Fr("undefined requester, can not start animating");return}if(r.has(p)){Br("requester is already registered for animating");return}r.add(p),!e.animationRequest&&r.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=p=>{const y=Date.now()+p;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,y),!e.animationRequest&&r.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(p){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!r.has(p)){if(!y){const T=p&&p.getClassName?p.getClassName():p;Br(`${T} did not request an animation`)}return}r.delete(p),e.animationRequest&&r.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,r.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(p,y,T)=>{p.inputSources.forEach(S=>{const d=S.gripSpace==null?null:y.getPose(S.gripSpace,T),x=S.gripSpace==null?null:y.getPose(S.targetRaySpace,T),w=S.gamepad,C=S.handedness;if(w){w.index in e.lastGamepadValues||(e.lastGamepadValues[w.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let M=0;M<w.buttons.length;++M)M in e.lastGamepadValues[w.index][C].buttons||(e.lastGamepadValues[w.index][C].buttons[M]=!1),e.lastGamepadValues[w.index][C].buttons[M]!==w.buttons[M].pressed&&d!=null&&(t.button3DEvent({gamepad:w,position:d.transform.position,orientation:d.transform.orientation,targetPosition:x.transform.position,targetOrientation:x.transform.orientation,pressed:w.buttons[M].pressed,device:S.handedness==="left"?Vr.LeftController:Vr.RightController,input:ba[w.mapping]&&ba[w.mapping][M]?ba[w.mapping][M]:Xt.Trigger}),e.lastGamepadValues[w.index][C].buttons[M]=w.buttons[M].pressed),e.lastGamepadValues[w.index][C].buttons[M]&&d!=null&&t.move3DEvent({gamepad:w,position:d.transform.position,orientation:d.transform.orientation,targetPosition:x.transform.position,targetOrientation:x.transform.orientation,device:S.handedness==="left"?Vr.LeftController:Vr.RightController})}})},t.handleMouseMove=p=>{const y={...u(p),position:c(p),deviceType:f(p)};e.moveTimeoutID===0?t.startMouseMoveEvent(y):(t.mouseMoveEvent(y),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{const p=Date.now();e._animationFrameCount++,p-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(p-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=p,e._animationFrameCount=1),t.animationEvent(),v(),r.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=p=>{Nn(p);const y={...Pw(p),...u(p),position:c(p),deviceType:f(p)};e.wheelTimeoutID===0&&(Math.abs(y.spinY)>=.3?s=Math.abs(y.spinY):s=1),y.spinY/=s,e.wheelTimeoutID===0?(t.startMouseWheelEvent(y),t.mouseWheelEvent(y)):(t.mouseWheelEvent(y),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=p=>{const y={...u(p),position:c(p),deviceType:f(p)};switch(p.button){case 0:t.leftButtonReleaseEvent(y);break;case 1:t.middleButtonReleaseEvent(y);break;case 2:t.rightButtonReleaseEvent(y);break;default:Fr(`Unknown mouse button released: ${p.button}`);break}},t.handleTouchStart=p=>{const y=[...a.values()];if(e.recognizeGestures&&y.length>1){const T=mr(a);if(y.length===2){const S={...u(hn),position:y[0].position,deviceType:f(p)};t.leftButtonReleaseEvent(S)}t.recognizeGesture("TouchStart",T)}else if(y.length===1){const T={...u(hn),position:c(p),deviceType:f(p)};t.leftButtonPressEvent(T)}},t.handleTouchMove=p=>{const y=[...a.values()];if(e.recognizeGestures&&y.length>1){const T=mr(a);t.recognizeGesture("TouchMove",T)}else if(y.length===1){const T={...u(hn),position:y[0].position,deviceType:f(p)};t.mouseMoveEvent(T)}},t.handleTouchEnd=p=>{const y=[...a.values()];if(e.recognizeGestures)if(y.length===0){const T={...u(hn),position:c(p),deviceType:f(p)};t.leftButtonReleaseEvent(T)}else if(y.length===1){const T=mr(a);t.recognizeGesture("TouchEnd",T);const S={...u(hn),position:y[0].position,deviceType:f(p)};t.leftButtonPressEvent(S)}else{const T=mr(a);t.recognizeGesture("TouchMove",T)}else if(y.length===1){const T={...u(hn),position:y[0].position,deviceType:f(p)};t.leftButtonReleaseEvent(T)}},t.setView=p=>{e._view!==p&&(e._view=p,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>{var p,y,T;return(T=(y=(p=e._view)==null?void 0:p.getRenderable())==null?void 0:y.getRenderersByReference())==null?void 0:T[0]},t.findPokedRenderer=function(){var C,M;let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;const T=(M=(C=e._view)==null?void 0:C.getRenderable())==null?void 0:M.getRenderers();if(!T||T.length===0)return null;T.sort((R,V)=>R.getLayer()-V.getLayer());let S=null,d=null,x=null,w=T.length;for(;w--;){const R=T[w];if(e._view.isInViewport(p,y,R)&&R.getInteractive()){x=R;break}S===null&&R.getInteractive()&&(S=R),d===null&&e._view.isInViewport(p,y,R)&&(d=R)}return x===null&&(x=S),x===null&&(x=d),x==null&&(x=T[0]),x},t.render=()=>{!t.isAnimating()&&!e.inRender&&v()},li.forEach(p=>{const y=p.charAt(0).toLowerCase()+p.slice(1);t[`${y}Event`]=T=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){Xw(`
          Can not forward events without a current renderer on the interactor.
        `);return}const d={type:p,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),...T};t[`invoke${p}`](d)}}),t.recognizeGesture=(p,y)=>{if(Object.keys(y).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),p==="TouchStart"){Object.keys(y).forEach(O=>{e.startingEventPositions[O]=y[O]}),e.currentGesture="Start";return}if(p==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let T=0;const S=[],d=[];Object.keys(y).forEach(O=>{S[T]=y[O],d[T]=e.startingEventPositions[O],T++});const x=Math.sqrt((d[0].x-d[1].x)*(d[0].x-d[1].x)+(d[0].y-d[1].y)*(d[0].y-d[1].y)),w=Math.sqrt((S[0].x-S[1].x)*(S[0].x-S[1].x)+(S[0].y-S[1].y)*(S[0].y-S[1].y));let C=wn(Math.atan2(d[1].y-d[0].y,d[1].x-d[0].x)),M=wn(Math.atan2(S[1].y-S[0].y,S[1].x-S[0].x)),R=M-C;M=M+180>=360?M-180:M+180,C=C+180>=360?C-180:C+180,Math.abs(M-C)<Math.abs(R)&&(R=M-C);const V=[];if(V[0]=(S[0].x-d[0].x+S[1].x-d[1].x)/2,V[1]=(S[0].y-d[0].y+S[1].y-d[1].y)/2,p==="TouchMove")if(e.currentGesture==="Start"){let O=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);O<15&&(O=15);const D=Math.abs(w-x),B=w*3.1415926*Math.abs(R)/360,L=Math.sqrt(V[0]*V[0]+V[1]*V[1]);if(D>O&&D>B&&D>L){e.currentGesture="Pinch";const F={scale:1,touches:y};t.startPinchEvent(F)}else if(B>O&&B>L){e.currentGesture="Rotate";const F={rotation:0,touches:y};t.startRotateEvent(F)}else if(L>O){e.currentGesture="Pan";const F={translation:[0,0],touches:y};t.startPanEvent(F)}}else{if(e.currentGesture==="Rotate"){const O={rotation:R,touches:y};t.rotateEvent(O)}if(e.currentGesture==="Pinch"){const O={scale:w/x,touches:y};t.pinchEvent(O)}if(e.currentGesture==="Pan"){const O={translation:V,touches:y};t.panEvent(O)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=p=>{e._forcedRenderer=!!p,e.currentRenderer=p},t.setContainer=p=>{h();const y=n.setContainer(p??null);return y&&l(),y},t.delete=()=>{for(;r.size;)t.cancelAnimation(r.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),n.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}const Yw={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function r0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Yw,n),E.obj(t,e),e._animationExtendedEnd=0,E.event(t,e,"RenderEvent"),li.forEach(r=>E.event(t,e,r)),E.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),E.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),E.moveToProtected(t,e,["view"]),Iw(t,e)}const Qw=E.newInstance(r0,"vtkRenderWindowInteractor");var a0={newInstance:Qw,extend:r0,handledEvents:li,...n0};const{vtkErrorMacro:Zw,VOID:qw}=E;function Jw(t,e,n,r){return t.getRenderWindow().getViews()[0].worldToDisplay(e,n,r,t)}function eE(t,e,n,r){return t.getRenderWindow().getViews()[0].displayToWorld(e,n,r,t)}const tE={computeWorldToDisplay:Jw,computeDisplayToWorld:eE};function nE(t,e){e.classHierarchy.push("vtkInteractorObserver");const n={...t};function r(){for(;e.subscribedEvents.length;)e.subscribedEvents.pop().unsubscribe()}function a(){a0.handledEvents.forEach(s=>{t[`handle${s}`]&&e.subscribedEvents.push(e._interactor[`on${s}`](i=>e.processEvents?t[`handle${s}`](i):qw,e.priority))})}t.setInteractor=s=>{s!==e._interactor&&(r(),e._interactor=s,s&&e.enabled&&a(),t.modified())},t.setEnabled=s=>{s!==e.enabled&&(r(),s&&(e._interactor?a():Zw(`
          The interactor must be set before subscribing to events
        `)),e.enabled=s,t.modified())},t.computeDisplayToWorld=(s,i,o,c)=>s?e._interactor.getView().displayToWorld(i,o,c,s):null,t.computeWorldToDisplay=(s,i,o,c)=>s?e._interactor.getView().worldToDisplay(i,o,c,s):null,t.setPriority=s=>{n.setPriority(s)&&e._interactor&&(r(),a())}}const rE={enabled:!0,priority:0,processEvents:!0,subscribedEvents:[]};function s0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rE,n),E.obj(t,e),E.event(t,e,"InteractionEvent"),E.event(t,e,"StartInteractionEvent"),E.event(t,e,"EndInteractionEvent"),E.get(t,e,["_interactor","enabled"]),E.setGet(t,e,["priority","processEvents"]),E.moveToProtected(t,e,["interactor"]),nE(t,e)}const aE=E.newInstance(s0,"vtkInteractorObserver");var sE={newInstance:aE,extend:s0,...tE};const iE={IS_START:0,IS_NONE:0,IS_ROTATE:1,IS_PAN:2,IS_SPIN:3,IS_DOLLY:4,IS_CAMERA_POSE:11,IS_WINDOW_LEVEL:1024,IS_SLICE:1025};var pi={States:iE};const{States:st}=pi,$a={Rotate:st.IS_ROTATE,Pan:st.IS_PAN,Spin:st.IS_SPIN,Dolly:st.IS_DOLLY,CameraPose:st.IS_CAMERA_POSE,WindowLevel:st.IS_WINDOW_LEVEL,Slice:st.IS_SLICE};function oE(t,e){e.classHierarchy.push("vtkInteractorStyle"),Object.keys($a).forEach(n=>{E.event(t,e,`Start${n}Event`),t[`start${n}`]=()=>{e.state===st.IS_NONE&&(e.state=$a[n],e._interactor.requestAnimation(t),t.invokeStartInteractionEvent({type:"StartInteractionEvent"}),t[`invokeStart${n}Event`]({type:`Start${n}Event`}))},E.event(t,e,`End${n}Event`),t[`end${n}`]=()=>{e.state===$a[n]&&(e.state=st.IS_NONE,e._interactor.cancelAnimation(t),t.invokeEndInteractionEvent({type:"EndInteractionEvent"}),t[`invokeEnd${n}Event`]({type:`End${n}Event`}),e._interactor.render())}}),e.getRenderer=n=>e.focusedRenderer||n.pokedRenderer,t.handleKeyPress=n=>{const r=e._interactor;let a=null;switch(n.key){case"r":case"R":e.getRenderer(n).resetCamera(),r.render();break;case"w":case"W":a=e.getRenderer(n).getActors(),a.forEach(s=>{const i=s.getProperty();i.setRepresentationToWireframe&&i.setRepresentationToWireframe()}),r.render();break;case"s":case"S":a=e.getRenderer(n).getActors(),a.forEach(s=>{const i=s.getProperty();i.setRepresentationToSurface&&i.setRepresentationToSurface()}),r.render();break;case"v":case"V":a=e.getRenderer(n).getActors(),a.forEach(s=>{const i=s.getProperty();i.setRepresentationToPoints&&i.setRepresentationToPoints()}),r.render();break}}}const cE={state:st.IS_NONE,handleObservers:1,autoAdjustCameraClippingRange:1};function i0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cE,n),sE.extend(t,e,n),E.setGet(t,e,["focusedRenderer"]),oE(t,e)}const fE=E.newInstance(i0,"vtkInteractorStyle");var uE={newInstance:fE,extend:i0,...pi};const{States:nt}=pi;function gE(t,e){e.classHierarchy.push("vtkInteractorStyleTrackballCamera"),t.handleMouseMove=n=>{const r=n.position,a=e.getRenderer(n);switch(e.state){case nt.IS_ROTATE:t.handleMouseRotate(a,r),t.invokeInteractionEvent({type:"InteractionEvent"});break;case nt.IS_PAN:t.handleMousePan(a,r),t.invokeInteractionEvent({type:"InteractionEvent"});break;case nt.IS_DOLLY:t.handleMouseDolly(a,r),t.invokeInteractionEvent({type:"InteractionEvent"});break;case nt.IS_SPIN:t.handleMouseSpin(a,r),t.invokeInteractionEvent({type:"InteractionEvent"});break}e.previousPosition=r},t.handleButton3D=n=>{if(n&&n.pressed&&n.device===Ts.RightController&&(n.input===jn.Trigger||n.input===jn.TrackPad)){t.startCameraPose();return}n&&!n.pressed&&n.device===Ts.RightController&&(n.input===jn.Trigger||n.input===jn.TrackPad)&&e.state===nt.IS_CAMERA_POSE&&t.endCameraPose()},t.handleMove3D=n=>{switch(e.state){case nt.IS_CAMERA_POSE:t.updateCameraPose(n);break}},t.updateCameraPose=n=>{const r=e.getRenderer(n).getActiveCamera(),a=r.getPhysicalTranslation(),i=.5*.05*r.getPhysicalScale(),o=r.physicalOrientationToWorldDirection([n.orientation.x,n.orientation.y,n.orientation.z,n.orientation.w]);r.setPhysicalTranslation(a[0]+o[0]*i,a[1]+o[1]*i,a[2]+o[2]*i)},t.handleLeftButtonPress=n=>{const r=n.position;e.previousPosition=r,n.shiftKey?n.controlKey||n.altKey?t.startDolly():t.startPan():n.controlKey||n.altKey?t.startSpin():t.startRotate()},t.handleLeftButtonRelease=()=>{switch(e.state){case nt.IS_DOLLY:t.endDolly();break;case nt.IS_PAN:t.endPan();break;case nt.IS_SPIN:t.endSpin();break;case nt.IS_ROTATE:t.endRotate();break}},t.handleStartMouseWheel=()=>{t.startDolly()},t.handleEndMouseWheel=()=>{t.endDolly()},t.handleStartPinch=n=>{e.previousScale=n.scale,t.startDolly()},t.handleEndPinch=()=>{t.endDolly()},t.handleStartRotate=n=>{e.previousRotation=n.rotation,t.startRotate()},t.handleEndRotate=()=>{t.endRotate()},t.handleStartPan=n=>{e.previousTranslation=n.translation,t.startPan()},t.handleEndPan=()=>{t.endPan()},t.handlePinch=n=>{t.dollyByFactor(e.getRenderer(n),n.scale/e.previousScale),e.previousScale=n.scale},t.handlePan=n=>{const r=e.getRenderer(n).getActiveCamera();let a=r.getFocalPoint();a=t.computeWorldToDisplay(e.getRenderer(n),a[0],a[1],a[2]);const s=a[2],i=n.translation,o=e.previousTranslation,c=t.computeDisplayToWorld(e.getRenderer(n),a[0]+i[0]-o[0],a[1]+i[1]-o[1],s),u=t.computeDisplayToWorld(e.getRenderer(n),a[0],a[1],s),g=[];g[0]=u[0]-c[0],g[1]=u[1]-c[1],g[2]=u[2]-c[2],a=r.getFocalPoint();const f=r.getPosition();r.setFocalPoint(g[0]+a[0],g[1]+a[1],g[2]+a[2]),r.setPosition(g[0]+f[0],g[1]+f[1],g[2]+f[2]),e._interactor.getLightFollowCamera()&&e.getRenderer(n).updateLightsGeometryToFollowCamera(),r.orthogonalizeViewUp(),e.previousTranslation=n.translation},t.handleRotate=n=>{const r=e.getRenderer(n).getActiveCamera();r.roll(n.rotation-e.previousRotation),r.orthogonalizeViewUp(),e.previousRotation=n.rotation},t.handleMouseRotate=(n,r)=>{if(!e.previousPosition)return;const a=e._interactor,s=r.x-e.previousPosition.x,i=r.y-e.previousPosition.y,o=a.getView().getViewportSize(n);let c=-.1,u=-.1;o[0]&&o[1]&&(c=-20/o[1],u=-20/o[0]);const g=s*u*e.motionFactor,f=i*c*e.motionFactor,l=n.getActiveCamera();!Number.isNaN(g)&&!Number.isNaN(f)&&(l.azimuth(g),l.elevation(f),l.orthogonalizeViewUp()),e.autoAdjustCameraClippingRange&&n.resetCameraClippingRange(),a.getLightFollowCamera()&&n.updateLightsGeometryToFollowCamera()},t.handleMouseSpin=(n,r)=>{if(!e.previousPosition)return;const a=e._interactor,s=n.getActiveCamera(),i=a.getView().getViewportCenter(n),o=wn(Math.atan2(e.previousPosition.y-i[1],e.previousPosition.x-i[0])),c=wn(Math.atan2(r.y-i[1],r.x-i[0]))-o;Number.isNaN(c)||(s.roll(c),s.orthogonalizeViewUp())},t.handleMousePan=(n,r)=>{if(!e.previousPosition)return;const a=n.getActiveCamera();let s=a.getFocalPoint();s=t.computeWorldToDisplay(n,s[0],s[1],s[2]);const i=s[2],o=t.computeDisplayToWorld(n,r.x,r.y,i),c=t.computeDisplayToWorld(n,e.previousPosition.x,e.previousPosition.y,i),u=[];u[0]=c[0]-o[0],u[1]=c[1]-o[1],u[2]=c[2]-o[2],s=a.getFocalPoint();const g=a.getPosition();a.setFocalPoint(u[0]+s[0],u[1]+s[1],u[2]+s[2]),a.setPosition(u[0]+g[0],u[1]+g[1],u[2]+g[2]),e._interactor.getLightFollowCamera()&&n.updateLightsGeometryToFollowCamera()},t.handleMouseDolly=(n,r)=>{if(!e.previousPosition)return;const a=r.y-e.previousPosition.y,i=e._interactor.getView().getViewportCenter(n),o=e.motionFactor*a/i[1];t.dollyByFactor(n,1.1**o)},t.handleMouseWheel=n=>{const r=1-n.spinY/e.zoomFactor;t.dollyByFactor(e.getRenderer(n),r)},t.dollyByFactor=(n,r)=>{if(Number.isNaN(r))return;const a=n.getActiveCamera();a.getParallelProjection()?a.setParallelScale(a.getParallelScale()/r):(a.dolly(r),e.autoAdjustCameraClippingRange&&n.resetCameraClippingRange()),e._interactor.getLightFollowCamera()&&n.updateLightsGeometryToFollowCamera()}}const lE={motionFactor:10,zoomFactor:10};function o0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lE,n),uE.extend(t,e,n),E.setGet(t,e,["motionFactor","zoomFactor"]),gE(t,e)}const pE=E.newInstance(o0,"vtkInteractorStyleTrackballCamera");var hE={newInstance:pE,extend:o0};function yE(t){return t}function hi(t){if(t===null||t==="null")return null;if(t==="true")return!0;if(t==="false")return!1;if(!(t===void 0||t==="undefined"))return t[0]==="["&&t[t.length-1]==="]"?t.substring(1,t.length-1).split(",").map(e=>hi(e.trim())):t===""||Number.isNaN(Number(t))?t:Number(t)}function vE(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:window.location.search;const n={},r=t?hi:yE;return new URLSearchParams(e).forEach((s,i)=>{i&&(n[i]=s?r(s):!0)}),n}var TE={toNativeType:hi,extractURLParameters:vE};function dE(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.saveCurrentBindings(r),t.saveCurrentBuffers(r)},t.saveCurrentBindings=n=>{if(!e.context){X("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}const r=e.context;e.previousDrawBinding=r.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=n=>{},t.restorePreviousBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.restorePreviousBindings(r),t.restorePreviousBuffers(r)},t.restorePreviousBindings=n=>{if(!e.context){X("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}const r=e.context;r.bindFramebuffer(r.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=n=>{},t.bind=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;r===null&&(r=e.context.FRAMEBUFFER),e.context.bindFramebuffer(r,e.glFramebuffer);for(let a=0;a<e.colorBuffers.length;a++)e.colorBuffers[a].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(n,r)=>{if(!e.context){X("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=n,e.glFramebuffer.height=r},t.setColorBuffer=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const a=e.context;if(!a){X("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let s=a.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())s+=r;else{X("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[r]=n,a.framebufferTexture2D(a.FRAMEBUFFER,s,a.TEXTURE_2D,n.getHandle(),0)},t.removeColorBuffer=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const r=e.context;if(!r){X("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let a=r.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())a+=n;else{X("Using multiple framebuffer attachments requires WebGL 2");return}r.framebufferTexture2D(r.FRAMEBUFFER,a,r.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(n,1)},t.setDepthBuffer=n=>{if(!e.context){X("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,n.getHandle(),0)}else X("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){X("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,null,0)}else X("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){X("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();const n=e.context,r=dt.newInstance();r.setOpenGLRenderWindow(e._openGLRenderWindow),r.setMinificationFilter(hs.LINEAR),r.setMagnificationFilter(hs.LINEAR),r.create2DFromRaw({width:e.glFramebuffer.width,height:e.glFramebuffer.height,numComps:4,dataType:xe.UNSIGNED_CHAR,data:null}),t.setColorBuffer(r),e.depthTexture=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,e.depthTexture),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}const xE={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function c0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xE,n),Me(t,e),e.colorBuffers&&X("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],Ln(t,e,["colorBuffers"]),dE(t,e)}const SE=re(c0,"vtkFramebuffer");var yi={newInstance:SE,extend:c0};function CE(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=n=>{e.currentOperation=n,e.currentTraverseOperation=`traverse${E.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=r,e.preDelegateOperations.forEach(a=>{t.setCurrentOperation(a),n.traverse(t)}),e.delegates.forEach(a=>{a.traverse(n,t)}),e.postDelegateOperations.forEach(a=>{t.setCurrentOperation(a),n.traverse(t)}))}}const wE={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function f0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wE,n),E.obj(t,e),E.get(t,e,["currentOperation"]),E.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),E.moveToProtected(t,e,["currentParent"]),CE(t,e)}const EE=E.newInstance(f0,"vtkRenderPass");var Ct={newInstance:EE,extend:f0};const{Representation:ME}=Vn,{vtkErrorMacro:Ho}=E;function RE(t){const e=m.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}const OE=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function DE(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{const n=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),r=new Float32Array([0,0,1,0,0,1,1,1]),a=new Uint16Array([4,0,1,3,2]),s=ee.newInstance({numberOfComponents:3,values:n});s.setName("points");const i=ee.newInstance({numberOfComponents:2,values:r});i.setName("tcoords");const o=ee.newInstance({numberOfComponents:1,values:a});e.tris.getCABO().createVBO(o,"polys",ME.SURFACE,{points:s,tcoords:i,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=n=>{const r=n.getSize(),a=n.getContext();e.framebuffer=yi.newInstance(),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.create(...r),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=dt.newInstance(),e.translucentRGBATexture.setInternalFormat(a.RGBA16F),e.translucentRGBATexture.setFormat(a.RGBA),e.translucentRGBATexture.setOpenGLDataType(a.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(n),e.translucentRGBATexture.create2DFromRaw({width:r[0],height:r[1],numComps:4,dataType:"Float32Array",data:null}),e.translucentRTexture=dt.newInstance(),e.translucentRTexture.setInternalFormat(a.R16F),e.translucentRTexture.setFormat(a.RED),e.translucentRTexture.setOpenGLDataType(a.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(n),e.translucentRTexture.create2DFromRaw({width:r[0],height:r[1],numComps:1,dataType:"Float32Array",data:null}),e.translucentZTexture=dt.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(n),e.translucentZTexture.createDepthFromRaw({width:r[0],height:r[1],dataType:"Float32Array",data:null}),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=n=>{e.copyShader=n.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),OE,"")},t.createVBO=n=>{const r=n.getContext();e.tris.setOpenGLRenderWindow(n),t.createVertexBuffer();const a=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),r.FLOAT,3,r.FALSE)||Ho("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),r.FLOAT,2,r.FALSE)||Ho("Error setting vertexDC in copy shader VAO.")},t.traverse=(n,r,a)=>{if(e.deleted)return;const s=n.getSize(),i=n.getContext();if(e._supported=!1,r.getSelector()||!i||!n.getWebgl2()||!i.getExtension("EXT_color_buffer_half_float")&&!i.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),r.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(n);else{const c=e.framebuffer.getSize();c===null||c[0]!==s[0]||c[1]!==s[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRTexture.releaseGraphicsResources(n),e.translucentZTexture.releaseGraphicsResources(n),t.createFramebuffer(n)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}i.drawBuffers([i.COLOR_ATTACHMENT0]),i.clearBufferfv(i.COLOR,0,[0,0,0,0]),i.clearBufferfv(i.DEPTH,0,[1]),i.colorMask(!1,!1,!1,!1),a.getOpaqueActorCount()>0&&(a.setCurrentOperation("opaqueZBufferPass"),r.traverse(a)),i.colorMask(!0,!0,!0,!0),i.drawBuffers([i.COLOR_ATTACHMENT0,i.COLOR_ATTACHMENT1]),i.viewport(0,0,s[0],s[1]),i.scissor(0,0,s[0],s[1]),i.clearBufferfv(i.COLOR,0,[0,0,0,1]),i.clearBufferfv(i.COLOR,1,[0,0,0,0]),i.enable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendFuncSeparate(i.ONE,i.ONE,i.ZERO,i.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),r.traverse(t),i.drawBuffers([i.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(n):n.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=Tg.newInstance(),e.copyVAO.setOpenGLRenderWindow(n)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(n),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),i.depthMask(!1),i.depthFunc(i.ALWAYS),i.viewport(0,0,s[0],s[1]),i.scissor(0,0,s[0],s[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),i.drawArrays(i.TRIANGLES,0,e.tris.getCABO().getElementCount()),i.depthMask(!0),i.depthFunc(i.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();const o=r.getTiledSizeAndOrigin();i.scissor(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),i.viewport(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize)},t.getShaderReplacement=()=>e._supported?RE:null,t.releaseGraphicsResources=n=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(n),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(n),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(n),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(n),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(n),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(n),e.tris=null),t.modified()}}const LE={framebuffer:null,copyShader:null,tris:null};function u0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LE,n),Ct.extend(t,e,n),e.VBOBuildTime={},E.obj(e.VBOBuildTime,{mtime:0}),e.tris=Bn.newInstance(),E.get(t,e,["framebuffer"]),DE(t,e)}const VE=E.newInstance(u0,"vtkOpenGLOrderIndependentTranslucentPass");var BE={newInstance:VE,extend:u0};function FE(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=r,t.setCurrentOperation("buildPass"),n.traverse(t);const a=n.getRenderable().getNumberOfLayers(),s=n.getRenderable().getRenderersByReference();for(let i=0;i<a;i++)for(let o=0;o<s.length;o++){const c=s[o],u=n.getViewNodeFor(c);if(c.getDraw()&&c.getLayer()===i){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),u.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){const g=n.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=yi.newInstance()),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.saveCurrentBindingsAndBuffers();const f=e.framebuffer.getSize();(f===null||f[0]!==g[0]||f[1]!==g[1])&&(e.framebuffer.create(g[0],g[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),u.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),u.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),u.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=BE.newInstance()),e.translucentPass.traverse(n,u,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),u.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),u.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}const mE={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function g0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mE,n),Ct.extend(t,e,n),E.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),FE(t,e)}const kE=E.newInstance(g0,"vtkForwardPass");var UE={newInstance:kE,extend:g0};const{FieldAssociations:NE}=cn;function _E(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(n,r,a,s,i)=>{},t.selectAsync=async(n,r,a,s,i)=>{const o=await t.getSourceDataAsync(n,r,a,s,i);return o?o.generateSelection(r,a,s,i):[]}}const GE={fieldAssociation:NE.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function l0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GE,n),E.obj(t,e),E.setGet(t,e,["fieldAssociation","captureZValues"]),_E(t,e)}const bE=E.newInstance(l0,"vtkHardwareSelector");var p0={newInstance:bE,extend:l0};const $E={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},zE={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5};var WE={SelectionContent:$E,SelectionField:zE};function HE(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}const AE={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function h0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AE,n),E.obj(t,e),e.properties={},E.setGet(t,e,["contentType","fieldType","properties","selectionList"]),HE(t,e)}const jE=E.newInstance(h0,"vtkSelectionNode");var da={newInstance:jE,extend:h0,...WE};const{PassTypes:ge}=Nu,{SelectionContent:KE,SelectionField:Ao}=da,{FieldAssociations:Yn}=cn,{vtkErrorMacro:y0}=E,Ft=1;function v0(t){return`${t.propID} ${t.compositeID}`}function T0(t,e,n,r){if(!n)return 0;const a=(e*(r[2]-r[0]+1)+t)*4;return n[a+3]}function yt(t,e,n,r){if(!n)return 0;const a=(e*(r[2]-r[0]+1)+t)*4,s=n[a],i=n[a+1];return(n[a+2]*256+i)*256+s}function d0(t,e){let n=e;return n<<=24,n|=t,n}function PE(t,e,n,r){{if(r[0]=e[0],r[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;const a=[e[0]-t.area[0],e[1]-t.area[1]],s=yt(a[0],a[1],t.pixBuffer[ge.ACTOR_PASS],t.area);if(s<=0||s-Ft>=t.props.length)return null;const i={};i.valid=!0,i.propID=s-Ft,i.prop=t.props[i.propID];let o=yt(a[0],a[1],t.pixBuffer[ge.COMPOSITE_INDEX_PASS],t.area);if((o<0||o>16777215)&&(o=0),i.compositeID=o-Ft,t.captureZValues){const g=(a[1]*(t.area[2]-t.area[0]+1)+a[0])*4;i.zValue=(256*t.zBuffer[g]+t.zBuffer[g+1])/65535,i.displayPosition=e}if(t.pixBuffer[ge.ID_LOW24]&&T0(a[0],a[1],t.pixBuffer[ge.ID_LOW24],t.area)===0)return i;const c=yt(a[0],a[1],t.pixBuffer[ge.ID_LOW24],t.area),u=yt(a[0],a[1],t.pixBuffer[ge.ID_HIGH24],t.area);return i.attributeID=d0(c,u),i}}function x0(t,e,n,r,a){const s=[];let i=0;return e.forEach((o,c)=>{const u=da.newInstance();switch(u.setContentType(KE.INDICES),t){case Yn.FIELD_ASSOCIATION_CELLS:u.setFieldType(Ao.CELL);break;case Yn.FIELD_ASSOCIATION_POINTS:u.setFieldType(Ao.POINT);break;default:y0("Unknown field association")}u.getProperties().propID=o.info.propID,u.getProperties().prop=o.info.prop,u.getProperties().compositeID=o.info.compositeID,u.getProperties().attributeID=o.info.attributeID,u.getProperties().pixelCount=o.pixelCount,n&&(u.getProperties().displayPosition=[o.info.displayPosition[0],o.info.displayPosition[1],o.info.zValue],u.getProperties().worldPosition=a.displayToWorld(o.info.displayPosition[0],o.info.displayPosition[1],o.info.zValue,r)),u.setSelectionList(o.attributeIDs),s[i]=u,i++}),s}function XE(t,e,n,r,a){const s=Math.floor(e),i=Math.floor(n),o=Math.floor(r),c=Math.floor(a),u=new Map,g=[0,0];for(let f=i;f<=c;f++)for(let l=s;l<=o;l++){const v=PE(t,[l,f],0,g);if(v&&v.valid){const p=v0(v);if(!u.has(p))u.set(p,{info:v,pixelCount:1,attributeIDs:[v.attributeID]});else{const y=u.get(p);y.pixelCount++,t.captureZValues&&v.zValue<y.info.zValue&&(y.info=v),y.attributeIDs.indexOf(v.attributeID)===-1&&y.attributeIDs.push(v.attributeID)}}}return x0(t.fieldAssociation,u,t.captureZValues,t.renderer,t.openGLRenderWindow)}function IE(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;const r=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=yi.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();const a=e.framebuffer.getSize();!a||a[0]!==r[0]||a[1]!==r[1]?(e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===Yn.FIELD_ASSOCIATION_POINTS){const a=e._openGLRenderWindow.getContext(),s=a.isEnabled(a.BLEND);a.disable(a.BLEND),e._openGLRenderWindow.traverseAllPasses(),s&&a.enable(a.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending=r.isEnabled(r.BLEND),r.disable(r.BLEND)},t.postCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending&&r.enable(r.BLEND)},t.select=()=>{let r=null;return t.captureBuffers()&&(r=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),r},t.getSourceDataAsync=async(r,a,s,i,o)=>{if(e._renderer=r,a===void 0){const u=e._openGLRenderWindow.getSize();t.setArea(0,0,u[0]-1,u[1]-1)}else t.setArea(a,s,i,o);if(!t.captureBuffers())return!1;const c={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:r,openGLRenderWindow:e._openGLRenderWindow};return c.generateSelection=function(){for(var u=arguments.length,g=new Array(u),f=0;f<u;f++)g[f]=arguments[f];return XE(c,...g)},c},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return y0("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);const r=e._openGLRenderWindow.getRenderPasses();t.beginSelection();const a=[];for(e.currentPass=ge.MIN_KNOWN_PASS;e.currentPass<=ge.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===ge.ACTOR_PASS&&typeof r[0].requestDepth=="function"&&typeof r[0].getFramebuffer=="function"&&r[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),a.push(e.currentPass));return a.forEach(s=>{e.currentPass=s,t.processPixelBuffers()}),e.currentPass=ge.MAX_KNOWN_PASS,t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((r,a)=>{t.isPropHit(a)&&r.processSelectorPixelBuffers(t,e.propPixels[a])})},t.passRequired=r=>{if(r===ge.ID_HIGH24){if(e.fieldAssociation===Yn.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===Yn.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=r=>{if(e.pixBuffer[r]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[r]){const a=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[r]=new Uint8Array(a),e.rawPixBuffer[r].set(e.pixBuffer[r])}if(r===ge.ACTOR_PASS){if(e.captureZValues){const a=e._openGLRenderWindow.getRenderPasses();if(typeof a[0].requestDepth=="function"&&typeof a[0].getFramebuffer=="function"){const s=a[0].getFramebuffer();s.saveCurrentBindingsAndBuffers(),s.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),s.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[r])}},t.buildPropHitList=r=>{let a=0;for(let s=0;s<=e.area[3]-e.area[1];s++)for(let i=0;i<=e.area[2]-e.area[0];i++){let o=yt(i,s,r,e.area);o>0&&(o--,o in e.hitProps||(e.hitProps[o]=!0,e.propPixels[o]=[]),e.propPixels[o].push(a*4)),++a}},t.renderProp=r=>{e.currentPass===ge.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+Ft),e.props.push(r))},t.renderCompositeIndex=r=>{e.currentPass===ge.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(r+Ft)},t.renderAttributeId=r=>{r<0||(e.maxAttributeId=r>e.maxAttributeId?r:e.maxAttributeId)},t.passTypeToString=r=>E.enumToString(ge,r),t.isPropHit=r=>!!e.hitProps[r],t.setPropColorValueFromInt=r=>{e.propColorValue[0]=r%256/255,e.propColorValue[1]=Math.floor(r/256)%256/255,e.propColorValue[2]=Math.floor(r/65536)%256/255},t.getPixelInformation=(r,a,s)=>{const i=a<0?0:a;if(i===0){if(s[0]=r[0],s[1]=r[1],r[0]<e.area[0]||r[0]>e.area[2]||r[1]<e.area[1]||r[1]>e.area[3])return null;const g=[r[0]-e.area[0],r[1]-e.area[1]],f=yt(g[0],g[1],e.pixBuffer[ge.ACTOR_PASS],e.area);if(f<=0||f-Ft>=e.props.length)return null;const l={};l.valid=!0,l.propID=f-Ft,l.prop=e.props[l.propID];let h=yt(g[0],g[1],e.pixBuffer[ge.COMPOSITE_INDEX_PASS],e.area);if((h<0||h>16777215)&&(h=0),l.compositeID=h-Ft,e.captureZValues){const y=(g[1]*(e.area[2]-e.area[0]+1)+g[0])*4;l.zValue=(256*e.zBuffer[y]+e.zBuffer[y+1])/65535,l.displayPosition=r}if(e.pixBuffer[ge.ID_LOW24]&&T0(g[0],g[1],e.pixBuffer[ge.ID_LOW24],e.area)===0)return l;const v=yt(g[0],g[1],e.pixBuffer[ge.ID_LOW24],e.area),p=yt(g[0],g[1],e.pixBuffer[ge.ID_HIGH24],e.area);return l.attributeID=d0(v,p),l}const o=[r[0],r[1]],c=[0,0];let u=t.getPixelInformation(r,0,s);if(u&&u.valid)return u;for(let g=1;g<i;++g){for(let f=o[1]>g?o[1]-g:0;f<=o[1]+g;++f)if(c[1]=f,o[0]>=g&&(c[0]=o[0]-g,u=t.getPixelInformation(c,0,s),u&&u.valid)||(c[0]=o[0]+g,u=t.getPixelInformation(c,0,s),u&&u.valid))return u;for(let f=o[0]>=g?o[0]-(g-1):0;f<=o[0]+(g-1);++f)if(c[0]=f,o[1]>=g&&(c[1]=o[1]-g,u=t.getPixelInformation(c,0,s),u&&u.valid)||(c[1]=o[1]+g,u=t.getPixelInformation(c,0,s),u&&u.valid))return u}return s[0]=r[0],s[1]=r[1],null},t.generateSelection=(r,a,s,i)=>{const o=Math.floor(r),c=Math.floor(a),u=Math.floor(s),g=Math.floor(i),f=new Map,l=[0,0];for(let h=c;h<=g;h++)for(let v=o;v<=u;v++){const p=[v,h],y=t.getPixelInformation(p,0,l);if(y&&y.valid){const T=v0(y);if(!f.has(T))f.set(T,{info:y,pixelCount:1,attributeIDs:[y.attributeID]});else{const S=f.get(T);S.pixelCount++,e.captureZValues&&y.zValue<S.info.zValue&&(S.info=y),S.attributeIDs.indexOf(y.attributeID)===-1&&S.attributeIDs.push(y.attributeID)}}}return x0(e.fieldAssociation,f,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=r=>e.rawPixBuffer[r],t.getPixelBuffer=r=>e.pixBuffer[r],t.attach=(r,a)=>{e._openGLRenderWindow=r,e._renderer=a};const n=t.setArea;t.setArea=function(){return n(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}const YE={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function S0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YE,n),p0.extend(t,e,n),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),E.setGetArray(t,e,["area"],4),E.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),E.setGetArray(t,e,["propColorValue"],3),E.moveToProtected(t,e,["renderer","openGLRenderWindow"]),E.event(t,e,"event"),IE(t,e)}const QE=E.newInstance(S0,"vtkOpenGLHardwareSelector");var C0={newInstance:QE,extend:S0,...Nu},w0={exports:{}};(function(t,e){(function(n){t.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function a(T,S){var d=T[0],x=T[1],w=T[2],C=T[3];d+=(x&w|~x&C)+S[0]-680876936|0,d=(d<<7|d>>>25)+x|0,C+=(d&x|~d&w)+S[1]-389564586|0,C=(C<<12|C>>>20)+d|0,w+=(C&d|~C&x)+S[2]+606105819|0,w=(w<<17|w>>>15)+C|0,x+=(w&C|~w&d)+S[3]-1044525330|0,x=(x<<22|x>>>10)+w|0,d+=(x&w|~x&C)+S[4]-176418897|0,d=(d<<7|d>>>25)+x|0,C+=(d&x|~d&w)+S[5]+1200080426|0,C=(C<<12|C>>>20)+d|0,w+=(C&d|~C&x)+S[6]-1473231341|0,w=(w<<17|w>>>15)+C|0,x+=(w&C|~w&d)+S[7]-45705983|0,x=(x<<22|x>>>10)+w|0,d+=(x&w|~x&C)+S[8]+1770035416|0,d=(d<<7|d>>>25)+x|0,C+=(d&x|~d&w)+S[9]-1958414417|0,C=(C<<12|C>>>20)+d|0,w+=(C&d|~C&x)+S[10]-42063|0,w=(w<<17|w>>>15)+C|0,x+=(w&C|~w&d)+S[11]-1990404162|0,x=(x<<22|x>>>10)+w|0,d+=(x&w|~x&C)+S[12]+1804603682|0,d=(d<<7|d>>>25)+x|0,C+=(d&x|~d&w)+S[13]-40341101|0,C=(C<<12|C>>>20)+d|0,w+=(C&d|~C&x)+S[14]-1502002290|0,w=(w<<17|w>>>15)+C|0,x+=(w&C|~w&d)+S[15]+1236535329|0,x=(x<<22|x>>>10)+w|0,d+=(x&C|w&~C)+S[1]-165796510|0,d=(d<<5|d>>>27)+x|0,C+=(d&w|x&~w)+S[6]-1069501632|0,C=(C<<9|C>>>23)+d|0,w+=(C&x|d&~x)+S[11]+643717713|0,w=(w<<14|w>>>18)+C|0,x+=(w&d|C&~d)+S[0]-373897302|0,x=(x<<20|x>>>12)+w|0,d+=(x&C|w&~C)+S[5]-701558691|0,d=(d<<5|d>>>27)+x|0,C+=(d&w|x&~w)+S[10]+38016083|0,C=(C<<9|C>>>23)+d|0,w+=(C&x|d&~x)+S[15]-660478335|0,w=(w<<14|w>>>18)+C|0,x+=(w&d|C&~d)+S[4]-405537848|0,x=(x<<20|x>>>12)+w|0,d+=(x&C|w&~C)+S[9]+568446438|0,d=(d<<5|d>>>27)+x|0,C+=(d&w|x&~w)+S[14]-1019803690|0,C=(C<<9|C>>>23)+d|0,w+=(C&x|d&~x)+S[3]-187363961|0,w=(w<<14|w>>>18)+C|0,x+=(w&d|C&~d)+S[8]+1163531501|0,x=(x<<20|x>>>12)+w|0,d+=(x&C|w&~C)+S[13]-1444681467|0,d=(d<<5|d>>>27)+x|0,C+=(d&w|x&~w)+S[2]-51403784|0,C=(C<<9|C>>>23)+d|0,w+=(C&x|d&~x)+S[7]+1735328473|0,w=(w<<14|w>>>18)+C|0,x+=(w&d|C&~d)+S[12]-1926607734|0,x=(x<<20|x>>>12)+w|0,d+=(x^w^C)+S[5]-378558|0,d=(d<<4|d>>>28)+x|0,C+=(d^x^w)+S[8]-2022574463|0,C=(C<<11|C>>>21)+d|0,w+=(C^d^x)+S[11]+1839030562|0,w=(w<<16|w>>>16)+C|0,x+=(w^C^d)+S[14]-35309556|0,x=(x<<23|x>>>9)+w|0,d+=(x^w^C)+S[1]-1530992060|0,d=(d<<4|d>>>28)+x|0,C+=(d^x^w)+S[4]+1272893353|0,C=(C<<11|C>>>21)+d|0,w+=(C^d^x)+S[7]-155497632|0,w=(w<<16|w>>>16)+C|0,x+=(w^C^d)+S[10]-1094730640|0,x=(x<<23|x>>>9)+w|0,d+=(x^w^C)+S[13]+681279174|0,d=(d<<4|d>>>28)+x|0,C+=(d^x^w)+S[0]-358537222|0,C=(C<<11|C>>>21)+d|0,w+=(C^d^x)+S[3]-722521979|0,w=(w<<16|w>>>16)+C|0,x+=(w^C^d)+S[6]+76029189|0,x=(x<<23|x>>>9)+w|0,d+=(x^w^C)+S[9]-640364487|0,d=(d<<4|d>>>28)+x|0,C+=(d^x^w)+S[12]-421815835|0,C=(C<<11|C>>>21)+d|0,w+=(C^d^x)+S[15]+530742520|0,w=(w<<16|w>>>16)+C|0,x+=(w^C^d)+S[2]-995338651|0,x=(x<<23|x>>>9)+w|0,d+=(w^(x|~C))+S[0]-198630844|0,d=(d<<6|d>>>26)+x|0,C+=(x^(d|~w))+S[7]+1126891415|0,C=(C<<10|C>>>22)+d|0,w+=(d^(C|~x))+S[14]-1416354905|0,w=(w<<15|w>>>17)+C|0,x+=(C^(w|~d))+S[5]-57434055|0,x=(x<<21|x>>>11)+w|0,d+=(w^(x|~C))+S[12]+1700485571|0,d=(d<<6|d>>>26)+x|0,C+=(x^(d|~w))+S[3]-1894986606|0,C=(C<<10|C>>>22)+d|0,w+=(d^(C|~x))+S[10]-1051523|0,w=(w<<15|w>>>17)+C|0,x+=(C^(w|~d))+S[1]-2054922799|0,x=(x<<21|x>>>11)+w|0,d+=(w^(x|~C))+S[8]+1873313359|0,d=(d<<6|d>>>26)+x|0,C+=(x^(d|~w))+S[15]-30611744|0,C=(C<<10|C>>>22)+d|0,w+=(d^(C|~x))+S[6]-1560198380|0,w=(w<<15|w>>>17)+C|0,x+=(C^(w|~d))+S[13]+1309151649|0,x=(x<<21|x>>>11)+w|0,d+=(w^(x|~C))+S[4]-145523070|0,d=(d<<6|d>>>26)+x|0,C+=(x^(d|~w))+S[11]-1120210379|0,C=(C<<10|C>>>22)+d|0,w+=(d^(C|~x))+S[2]+718787259|0,w=(w<<15|w>>>17)+C|0,x+=(C^(w|~d))+S[9]-343485551|0,x=(x<<21|x>>>11)+w|0,T[0]=d+T[0]|0,T[1]=x+T[1]|0,T[2]=w+T[2]|0,T[3]=C+T[3]|0}function s(T){var S=[],d;for(d=0;d<64;d+=4)S[d>>2]=T.charCodeAt(d)+(T.charCodeAt(d+1)<<8)+(T.charCodeAt(d+2)<<16)+(T.charCodeAt(d+3)<<24);return S}function i(T){var S=[],d;for(d=0;d<64;d+=4)S[d>>2]=T[d]+(T[d+1]<<8)+(T[d+2]<<16)+(T[d+3]<<24);return S}function o(T){var S=T.length,d=[1732584193,-271733879,-1732584194,271733878],x,w,C,M,R,V;for(x=64;x<=S;x+=64)a(d,s(T.substring(x-64,x)));for(T=T.substring(x-64),w=T.length,C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x=0;x<w;x+=1)C[x>>2]|=T.charCodeAt(x)<<(x%4<<3);if(C[x>>2]|=128<<(x%4<<3),x>55)for(a(d,C),x=0;x<16;x+=1)C[x]=0;return M=S*8,M=M.toString(16).match(/(.*?)(.{0,8})$/),R=parseInt(M[2],16),V=parseInt(M[1],16)||0,C[14]=R,C[15]=V,a(d,C),d}function c(T){var S=T.length,d=[1732584193,-271733879,-1732584194,271733878],x,w,C,M,R,V;for(x=64;x<=S;x+=64)a(d,i(T.subarray(x-64,x)));for(T=x-64<S?T.subarray(x-64):new Uint8Array(0),w=T.length,C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x=0;x<w;x+=1)C[x>>2]|=T[x]<<(x%4<<3);if(C[x>>2]|=128<<(x%4<<3),x>55)for(a(d,C),x=0;x<16;x+=1)C[x]=0;return M=S*8,M=M.toString(16).match(/(.*?)(.{0,8})$/),R=parseInt(M[2],16),V=parseInt(M[1],16)||0,C[14]=R,C[15]=V,a(d,C),d}function u(T){var S="",d;for(d=0;d<4;d+=1)S+=r[T>>d*8+4&15]+r[T>>d*8&15];return S}function g(T){var S;for(S=0;S<T.length;S+=1)T[S]=u(T[S]);return T.join("")}g(o("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function T(S,d){return S=S|0||0,S<0?Math.max(S+d,0):Math.min(S,d)}ArrayBuffer.prototype.slice=function(S,d){var x=this.byteLength,w=T(S,x),C=x,M,R,V,O;return d!==n&&(C=T(d,x)),w>C?new ArrayBuffer(0):(M=C-w,R=new ArrayBuffer(M),V=new Uint8Array(R),O=new Uint8Array(this,w,M),V.set(O),R)}}();function f(T){return/[\u0080-\uFFFF]/.test(T)&&(T=unescape(encodeURIComponent(T))),T}function l(T,S){var d=T.length,x=new ArrayBuffer(d),w=new Uint8Array(x),C;for(C=0;C<d;C+=1)w[C]=T.charCodeAt(C);return S?w:x}function h(T){return String.fromCharCode.apply(null,new Uint8Array(T))}function v(T,S,d){var x=new Uint8Array(T.byteLength+S.byteLength);return x.set(new Uint8Array(T)),x.set(new Uint8Array(S),T.byteLength),x}function p(T){var S=[],d=T.length,x;for(x=0;x<d-1;x+=2)S.push(parseInt(T.substr(x,2),16));return String.fromCharCode.apply(String,S)}function y(){this.reset()}return y.prototype.append=function(T){return this.appendBinary(f(T)),this},y.prototype.appendBinary=function(T){this._buff+=T,this._length+=T.length;var S=this._buff.length,d;for(d=64;d<=S;d+=64)a(this._hash,s(this._buff.substring(d-64,d)));return this._buff=this._buff.substring(d-64),this},y.prototype.end=function(T){var S=this._buff,d=S.length,x,w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C;for(x=0;x<d;x+=1)w[x>>2]|=S.charCodeAt(x)<<(x%4<<3);return this._finish(w,d),C=g(this._hash),T&&(C=p(C)),this.reset(),C},y.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},y.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},y.prototype.setState=function(T){return this._buff=T.buff,this._length=T.length,this._hash=T.hash,this},y.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},y.prototype._finish=function(T,S){var d=S,x,w,C;if(T[d>>2]|=128<<(d%4<<3),d>55)for(a(this._hash,T),d=0;d<16;d+=1)T[d]=0;x=this._length*8,x=x.toString(16).match(/(.*?)(.{0,8})$/),w=parseInt(x[2],16),C=parseInt(x[1],16)||0,T[14]=w,T[15]=C,a(this._hash,T)},y.hash=function(T,S){return y.hashBinary(f(T),S)},y.hashBinary=function(T,S){var d=o(T),x=g(d);return S?p(x):x},y.ArrayBuffer=function(){this.reset()},y.ArrayBuffer.prototype.append=function(T){var S=v(this._buff.buffer,T),d=S.length,x;for(this._length+=T.byteLength,x=64;x<=d;x+=64)a(this._hash,i(S.subarray(x-64,x)));return this._buff=x-64<d?new Uint8Array(S.buffer.slice(x-64)):new Uint8Array(0),this},y.ArrayBuffer.prototype.end=function(T){var S=this._buff,d=S.length,x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w,C;for(w=0;w<d;w+=1)x[w>>2]|=S[w]<<(w%4<<3);return this._finish(x,d),C=g(this._hash),T&&(C=p(C)),this.reset(),C},y.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},y.ArrayBuffer.prototype.getState=function(){var T=y.prototype.getState.call(this);return T.buff=h(T.buff),T},y.ArrayBuffer.prototype.setState=function(T){return T.buff=l(T.buff,!0),y.prototype.setState.call(this,T)},y.ArrayBuffer.prototype.destroy=y.prototype.destroy,y.ArrayBuffer.prototype._finish=y.prototype._finish,y.ArrayBuffer.hash=function(T,S){var d=c(new Uint8Array(T)),x=g(d);return S?p(x):x},y})})(w0);var ZE=w0.exports;const qE=ca(ZE),JE=["lastShaderProgramBound","context","_openGLRenderWindow"];function eM(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(n,r,a)=>{let s=r;a.length>0&&(s=m.substitute(s,"VSOut","GSOut").result);const i=e._openGLRenderWindow.getWebgl2();let o=`
`,c=`#version 100
`;i?c=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(o=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(o+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),s=m.substitute(s,"//VTK::System::Dec",[`${c}
`,i?"":`#extension GL_OES_standard_derivatives : enable
`,o,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let u=m.substitute(n,"//VTK::System::Dec",[`${c}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(i){u=m.substitute(u,"varying","out").result,s=m.substitute(s,"varying","in").result;let f="",l=0;for(;s.includes(`gl_FragData[${l}]`);)s=m.substitute(s,`gl_FragData\\[${l}\\]`,`fragOutput${l}`).result,f+=`layout(location = ${l}) out vec4 fragOutput${l};
`,l++;s=m.substitute(s,"//VTK::Output::Dec",f).result}const g=m.substitute(a,"//VTK::System::Dec",c).result;return{VSSource:u,FSSource:s,GSSource:g}},t.readyShaderProgramArray=(n,r,a)=>{const s=t.replaceShaderValues(n,r,a),i=t.getShaderProgram(s.VSSource,s.FSSource,s.GSSource);return t.readyShaderProgram(i)},t.readyShaderProgram=n=>!n||!n.getCompiled()&&!n.compileShader()||!t.bindShaderProgram(n)?null:n,t.getShaderProgram=(n,r,a)=>{const s=`${n}${r}${a}`,i=qE.hash(s);if(!(i in e.shaderPrograms)){const o=m.newInstance();return o.setContext(e.context),o.getVertexShader().setSource(n),o.getFragmentShader().setSource(r),a&&o.getGeometryShader().setSource(a),o.setMd5Hash(i),e.shaderPrograms[i]=o,o}return e.shaderPrograms[i]},t.releaseGraphicsResources=n=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(r=>e.shaderPrograms[r]).forEach(r=>r.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=n=>(e.lastShaderProgramBound===n||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),n.bind(),e.lastShaderProgramBound=n),1)}const tM={lastShaderProgramBound:null,shaderPrograms:null,context:null};function E0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tM,n),e.shaderPrograms={},E.obj(t,e),E.setGet(t,e,JE),E.moveToProtected(t,e,["openGLRenderWindow"]),eM(t,e)}const nM=E.newInstance(E0,"vtkShaderCache");var rM={newInstance:nM,extend:E0};const{vtkErrorMacro:aM}=E;function sM(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]===!0&&aM("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=n=>{if(e.context!==n){if(e.context!==0&&t.deleteTable(),e.context=n,e.context){e.numberOfTextureUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}t.modified()}},t.allocate=()=>{for(let n=0;n<e.numberOfTextureUnits;n++)if(!t.isAllocated(n))return e.textureUnits[n]=!0,n;return-1},t.allocateUnit=n=>t.isAllocated(n)?-1:(e.textureUnits[n]=!0,n),t.isAllocated=n=>e.textureUnits[n],t.free=n=>{e.textureUnits[n]=!1},t.freeAll=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}}const iM={context:null,numberOfTextureUnits:0,textureUnits:0};function M0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iM,n),E.obj(t,e),e.textureUnits=[],E.get(t,e,["numberOfTextureUnits"]),E.setGet(t,e,["context"]),sM(t,e)}const oM=E.newInstance(M0,"vtkOpenGLTextureUnitManager");var cM={newInstance:oM,extend:M0};function fM(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=n=>{const r=n.getViewportByReference();return e.size[0]*(r[2]-r[0])/((r[3]-r[1])*e.size[1])},t.isInViewport=(n,r,a)=>{const s=a.getViewportByReference(),i=t.getFramebufferSize();return s[0]*i[0]<=n&&s[2]*i[0]>=n&&s[1]*i[1]<=r&&s[3]*i[1]>=r},t.getViewportSize=n=>{const r=n.getViewportByReference(),a=t.getFramebufferSize();return[(r[2]-r[0])*a[0],(r[3]-r[1])*a[1]]},t.getViewportCenter=n=>{const r=t.getViewportSize(n);return[r[0]*.5,r[1]*.5]},t.displayToNormalizedDisplay=(n,r,a)=>{const s=t.getFramebufferSize();return[n/s[0],r/s[1],a]},t.normalizedDisplayToDisplay=(n,r,a)=>{const s=t.getFramebufferSize();return[n*s[0],r*s[1],a]},t.worldToView=(n,r,a,s)=>s.worldToView(n,r,a),t.viewToWorld=(n,r,a,s)=>s.viewToWorld(n,r,a),t.worldToDisplay=(n,r,a,s)=>{const i=s.worldToView(n,r,a),o=t.getViewportSize(s),c=s.viewToProjection(i[0],i[1],i[2],o[0]/o[1]),u=s.projectionToNormalizedDisplay(c[0],c[1],c[2]);return t.normalizedDisplayToDisplay(u[0],u[1],u[2])},t.displayToWorld=(n,r,a,s)=>{const i=t.displayToNormalizedDisplay(n,r,a),o=s.normalizedDisplayToProjection(i[0],i[1],i[2]),c=t.getViewportSize(s),u=s.projectionToView(o[0],o[1],o[2],c[0]/c[1]);return s.viewToWorld(u[0],u[1],u[2])},t.normalizedDisplayToViewport=(n,r,a,s)=>{let i=s.getViewportByReference();i=t.normalizedDisplayToDisplay(i[0],i[1],0);const o=t.normalizedDisplayToDisplay(n,r,a);return[o[0]-i[0]-.5,o[1]-i[1]-.5,a]},t.viewportToNormalizedViewport=(n,r,a,s)=>{const i=t.getViewportSize(s);return i&&i[0]!==0&&i[1]!==0?[n/(i[0]-1),r/(i[1]-1),a]:[n,r,a]},t.normalizedViewportToViewport=(n,r,a,s)=>{const i=t.getViewportSize(s);return[n*(i[0]-1),r*(i[1]-1),a]},t.displayToLocalDisplay=(n,r,a)=>{const s=t.getFramebufferSize();return[n,s[1]-r-1,a]},t.viewportToNormalizedDisplay=(n,r,a,s)=>{let i=s.getViewportByReference();i=t.normalizedDisplayToDisplay(i[0],i[1],0);const o=n+i[0]+.5,c=r+i[1]+.5;return t.displayToNormalizedDisplay(o,c,a)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{E.vtkErrorMacro("not implemented")},t.getPixelData=(n,r,a,s)=>{E.vtkErrorMacro("not implemented")},t.createSelector=()=>{E.vtkErrorMacro("not implemented")}}const uM={size:void 0,selector:void 0};function R0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uM,n),e.size||(e.size=[300,300]),E.getArray(t,e,["size"],2),E.get(t,e,["selector"]),fe.extend(t,e,n),fM(t,e)}const gM=E.newInstance(R0,"vtkRenderWindowViewNode");var O0={newInstance:gM,extend:R0};const lM="__getUnderlyingContext";function pM(){const t=new Map,e={apply(a,s,i){return t.has(i[0])?t.get(i[0]):a.apply(s,i)}};function n(a){return{apply(s,i,o){return t.set(a,o[0]),s.apply(i,o)}}}const r=Object.create(null);return r.getParameter=(a,s,i,o)=>new Proxy(o.bind(a),e),r.depthMask=(a,s,i,o)=>new Proxy(o.bind(a),n(a.DEPTH_WRITEMASK)),{get(a,s,i){if(s===lM)return()=>a;let o=Reflect.get(a,s,a);o instanceof Function&&(o=o.bind(a));const c=r[s];return c?c(a,s,i,o):o}}}const{vtkDebugMacro:jo,vtkErrorMacro:Ko}=E,hM={position:"absolute",top:0,left:0,width:"100%",height:"100%"},yM=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","registerGraphicsResourceUser","unregisterGraphicsResourceUser","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function Fe(t,e,n){const r=t.createFramebuffer(),a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,n,null),t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0);const s=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),s===t.FRAMEBUFFER_COMPLETE}let ia=0;const D0=[];function vM(){ia++,D0.forEach(t=>t(ia))}function TM(){ia--,D0.forEach(t=>t(ia))}function Po(t){t.preventDefault()}function dM(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let n;function r(){return n||(n=pM()),n}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",Po,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);const a=[0,0];function s(){e.renderable&&(e.size[0]!==a[0]||e.size[1]!==a[1])&&(a[0]=e.size[0],a[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(s),t.buildPass=f=>{if(f){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(l=>{var h;(h=l.setOpenGLRenderWindow)==null||h.call(l,t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&vM(),e.textureUnitManager=cM.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);const f=e.context;f.blendFuncSeparate(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA),f.depthFunc(f.LEQUAL),f.enable(f.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=f=>{e.el&&e.el!==f&&(e.canvas.parentNode!==e.el&&Ko("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==f&&(e.el=f,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:f,height:l}=e.el.getBoundingClientRect();e.containerSize=[f,l]}return e.containerSize||e.size},t.getFramebufferSize=()=>{var l;return((l=e.activeFramebuffer)==null?void 0:l.getSize())||e.size},t.getPixelData=(f,l,h,v)=>{const p=new Uint8Array((h-f+1)*(v-l+1)*4);return e.context.readPixels(f,l,h-f+1,v-l+1,e.context.RGBA,e.context.UNSIGNED_BYTE,p),p},t.get3DContext=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},l=null;const h=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&h&&(l=e.canvas.getContext("webgl2",f),l&&(e.webgl2=!0,jo("using webgl2"))),l||(jo("using webgl1"),l=e.canvas.getContext("webgl",f)||e.canvas.getContext("experimental-webgl",f)),new Proxy(l,r())},t.get2DContext=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",f)},t.restoreContext=()=>{const f=Ct.newInstance();f.setCurrentOperation("Release"),f.traverse(t,null)},t.activateTexture=f=>{const l=e._textureResourceIds.get(f);if(l!==void 0){e.context.activeTexture(e.context.TEXTURE0+l);return}const h=t.getTextureUnitManager().allocate();if(h<0){Ko("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(f,h),e.context.activeTexture(e.context.TEXTURE0+h)},t.deactivateTexture=f=>{const l=e._textureResourceIds.get(f);l!==void 0&&(t.getTextureUnitManager().free(l),e._textureResourceIds.delete(f))},t.getTextureUnitForTexture=f=>{const l=e._textureResourceIds.get(f);return l!==void 0?l:-1},t.getDefaultTextureByteSize=function(f){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(f){case xe.CHAR:case xe.SIGNED_CHAR:case xe.UNSIGNED_CHAR:return 1;case l:case h:case xe.UNSIGNED_SHORT:case xe.SHORT:case xe.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(f,l){let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(f){case xe.UNSIGNED_CHAR:switch(l){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(h&&!v&&xe.UNSIGNED_SHORT):switch(l){case 1:return h.R16_EXT;case 2:return h.RG16_EXT;case 3:return h.RGB16_EXT;case 4:default:return h.RGBA16_EXT}case(h&&!v&&xe.SHORT):switch(l){case 1:return h.R16_SNORM_EXT;case 2:return h.RG16_SNORM_EXT;case 3:return h.RGB16_SNORM_EXT;case 4:default:return h.RGBA16_SNORM_EXT}case xe.UNSIGNED_SHORT:case xe.SHORT:case xe.FLOAT:default:switch(l){case 1:return v?e.context.R16F:e.context.R32F;case 2:return v?e.context.RG16F:e.context.RG32F;case 3:return v?e.context.RGB16F:e.context.RGB32F;case 4:default:return v?e.context.RGBA16F:e.context.RGBA32F}}switch(l){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=f=>{e.bgImage.src=f.src},t.setUseBackgroundImage=f=>{e.useBackgroundImage=f,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function i(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const l=document.createElement("canvas"),h=l.getContext("2d");l.width=e.canvas.width,l.height=e.canvas.height,h.drawImage(e.canvas,0,0);const v=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(S=>{S.getViewProps().forEach(x=>{if(x.getContainer){const C=x.getContainer().getElementsByTagName("canvas");for(let M=0;M<C.length;M++){const R=C[M],V=R.getBoundingClientRect(),O=V.x-v.x,D=V.y-v.y;h.drawImage(R,O,D)}}})});const T=l.toDataURL(f);l.remove(),t.invokeImageReady(T)}t.captureNextImage=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:l=!1,size:h=null,scale:v=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=f;const p=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:h||v!==1?h||e.size.map(y=>y*v):null},new Promise((y,T)=>{const S=t.onImageReady(d=>{var x;if(e._screenshot.size===null)e.notifyStartCaptureImage=p,S.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(w=>{let{restoreParamsFn:C,arg:M}=w;return C(M)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),y(d);else{const w=document.createElement("img");if(w.style=hM,w.src=d,e._screenshot.placeHolder=e.el.appendChild(w),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,(x=e.rootOpenGLRenderWindow)==null||x.resizeFromChildRenderWindows(),e._screenshot.size=null,t.modified(),l){const C=l!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(M=>{const R=M.getActiveCamera(),V=R.get("focalPoint","position","parallelScale");return{resetCameraArgs:C?{renderer:M}:void 0,resetCameraFn:C?l:M.resetCamera,restoreParamsFn:R.set,arg:JSON.parse(JSON.stringify(V))}}),e._screenshot.cameras.forEach(M=>{let{resetCameraFn:R,resetCameraArgs:V}=M;return R(V)})}t.traverseAllPasses()}})})};let o;t.getHardwareMaximumLineWidth=()=>{if(o!=null)return o;const f=t.get3DContext(),l=f.getParameter(f.ALIASED_LINE_WIDTH_RANGE);return o=l[1],l[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;const f=t.get3DContext(),l=f.getExtension("OES_texture_float"),h=f.getExtension("OES_texture_half_float"),v=f.getExtension("WEBGL_debug_renderer_info"),p=f.getExtension("WEBGL_draw_buffers"),y=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),T=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",f.getParameter(f.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",f.getParameter(f.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",f.getParameter(f.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",f.getParameter(f.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",f.getParameter(f.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",f.getParameter(f.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",y&&f.getParameter(y.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",f.getParameter(f.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",f.getParameter(f.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",f.getParameter(f.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",f.getParameter(f.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",f.getParameter(f.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",f.getParameter(f.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",f.getParameter(f.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",f.getParameter(f.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",f.getParameter(f.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",f.getParameter(f.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",f.getParameter(f.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",f.getParameter(f.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",f.getParameter(f.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[l&&Fe(f,f.RGBA,f.UNSIGNED_BYTE)?"RGBA":"",l&&Fe(f,f.RGB,f.UNSIGNED_BYTE)?"RGB":"",l&&Fe(f,f.LUMINANCE,f.UNSIGNED_BYTE)?"LUMINANCE":"",l&&Fe(f,f.ALPHA,f.UNSIGNED_BYTE)?"ALPHA":"",l&&Fe(f,f.LUMINANCE_ALPHA,f.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[h&&Fe(f,f.RGBA,h.HALF_FLOAT_OES)?"RGBA":"",h&&Fe(f,f.RGB,h.HALF_FLOAT_OES)?"RGB":"",h&&Fe(f,f.LUMINANCE,h.HALF_FLOAT_OES)?"LUMINANCE":"",h&&Fe(f,f.ALPHA,h.HALF_FLOAT_OES)?"ALPHA":"",h&&Fe(f,f.LUMINANCE_ALPHA,h.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[l&&Fe(f,f.RGBA,f.FLOAT)?"RGBA":"",l&&Fe(f,f.RGB,f.FLOAT)?"RGB":"",l&&Fe(f,f.LUMINANCE,f.FLOAT)?"LUMINANCE":"",l&&Fe(f,f.ALPHA,f.FLOAT)?"ALPHA":"",l&&Fe(f,f.LUMINANCE_ALPHA,f.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",p?f.getParameter(p.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",f.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",f.getParameter(f.RENDERER)],["WebGL Vendor","VENDOR",f.getParameter(f.VENDOR)],["WebGL Version","VERSION",f.getParameter(f.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",f.getParameter(f.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",v&&f.getParameter(v.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",v&&f.getParameter(v.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],S={};for(;T.length;){const[d,x,w]=T.pop();x&&(S[x]={label:d,value:w})}return e._glInformation=S,S},t.traverseAllPasses=()=>{var l;if(e.renderPasses)for(let h=0;h<e.renderPasses.length;++h)e.renderPasses[h].traverse(t,null);t.copyParentContent(),e.notifyStartCaptureImage&&i();const f=e.renderable.getChildRenderWindowsByReference();for(let h=0;h<f.length;++h)(l=t.getViewNodeFor(f[h]))==null||l.traverseAllPasses()},t.copyParentContent=()=>{const f=e.rootOpenGLRenderWindow;if(!f||!e.context2D||e.children.some(v=>{var p;return!!((p=v.getSelector)!=null&&p.call(v))}))return;const l=f.getCanvas(),h=e.canvas;e.context2D.drawImage(l,0,l.height-h.height,h.width,h.height,0,0,h.width,h.height)},t.resizeFromChildRenderWindows=()=>{var l;const f=e.renderable.getChildRenderWindowsByReference();if(f.length>0){const h=[0,0];for(let v=0;v<f.length;++v){const p=(l=t.getViewNodeFor(f[v]))==null?void 0:l.getSize();p&&(h[0]=p[0]>h[0]?p[0]:h[0],h[1]=p[1]>h[1]?p[1]:h[1])}t.setSize(...h)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=f=>{if(e.viewStream===f)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=f,e.viewStream){const l=e.renderable.getRenderers()[0];l.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(h=>t.setBackgroundImage(h.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{const f=C0.newInstance();return f.setOpenGLRenderWindow(t),f};function c(){e.canvas.removeEventListener("webglcontextlost",Po),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=E.chain(()=>{e.context&&TM(),t.setContainer(),t.setViewStream()},c,t.delete),t.setActiveFramebuffer=f=>{e.activeFramebuffer=f};const u=t.setSize;t.setSize=(f,l)=>{const h=u(f,l);return h&&t.invokeWindowResizeEvent({width:f,height:l}),h},t.registerGraphicsResourceUser=(f,l)=>{e._graphicsResources.has(f)||t.setGraphicsResourceForObject(f,null,null);const h=e._graphicsResources.get(f);h==null||h.users.add(l)},t.unregisterGraphicsResourceUser=(f,l)=>{var v;const h=e._graphicsResources.get(f);h&&(h.users.delete(l),h.users.size||((v=h.oglObject)==null||v.releaseGraphicsResources(t),e._graphicsResources.delete(f)))},t.getGraphicsResourceForObject=f=>e._graphicsResources.get(f),t.setGraphicsResourceForObject=(f,l,h)=>{var p;if(!f)return;const v=e._graphicsResources.get(f);(p=v==null?void 0:v.oglObject)==null||p.releaseGraphicsResources(t),e._graphicsResources.set(f,{coreObject:f,oglObject:l,hash:h,users:(v==null?void 0:v.users)??new Set})},t.getGraphicsMemoryInfo=()=>{let f=0;return e._graphicsResources.forEach(l=>{let{oglObject:h}=l;f+=h.getAllocatedGPUMemoryInBytes()}),f},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach(f=>{let{oglObject:l}=f;l.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(f=>{const l=t.getViewNodeFor(f);l==null||l.releaseGraphicsResources()})};const g={...t};yM.forEach(f=>{t[f]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[f](...arguments):g[f](...arguments)}})}const xM={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function SM(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xM,n),O0.extend(t,e,n),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=C0.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._glInformation=null,e.myFactory=ch.newInstance(),e.shaderCache=rM.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=UE.newInstance(),E.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),E.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),E.setGetArray(t,e,["size"],2),E.event(t,e,"imageReady"),E.event(t,e,"windowResizeEvent"),dM(t,e)}const L0=E.newInstance(SM,"vtkOpenGLRenderWindow");gi("WebGL",L0);Ie("vtkRenderWindow",L0);const za=["setBindGroup","setIndexBuffer","setVertexBuffer","draw","drawIndexed"];function CM(t,e){e.classHierarchy.push("vtkWebGPURenderEncoder"),t.begin=n=>{e.drawCallbacks=[],e.handle=n.beginRenderPass(e.description),e.label&&e.handle.pushDebugGroup(e.label)},t.end=()=>{for(let n=0;n<e.drawCallbacks.length;n++){const r=e.drawCallbacks[n],a=r.pipeline;t.setPipeline(a);for(let s=0;s<r.callbacks.length;s++)r.callbacks[s](t)}e.label&&e.handle.popDebugGroup(),e.handle.end(),e.boundPipeline=null},t.setPipeline=n=>{var a,s;if(e.boundPipeline===n)return;e.handle.setPipeline(n.getHandle());const r=n.getPipelineDescription();if(e.colorTextureViews.length!==r.fragment.targets.length)console.log(`mismatched attachment counts on pipeline ${r.fragment.targets.length} while encoder has ${e.colorTextureViews.length}`),console.trace();else for(let i=0;i<e.colorTextureViews.length;i++){const o=(a=e.colorTextureViews[i].getTexture())==null?void 0:a.getFormat();o&&o!==r.fragment.targets[i].format&&(console.log(`mismatched attachments for attachment ${i} on pipeline ${r.fragment.targets[i].format} while encoder has ${o}`),console.trace())}if(!e.depthTextureView!=!("depthStencil"in r))console.log("mismatched depth attachments"),console.trace();else if(e.depthTextureView){const i=(s=e.depthTextureView.getTexture())==null?void 0:s.getFormat();i&&i!==r.depthStencil.format&&(console.log(`mismatched depth attachments on pipeline ${r.depthStencil.format} while encoder has ${i}`),console.trace())}e.boundPipeline=n},t.replaceShaderCode=n=>{e.replaceShaderCodeFunction(n)},t.setColorTextureView=(n,r)=>{e.colorTextureViews[n]!==r&&(e.colorTextureViews[n]=r)},t.activateBindGroup=n=>{const r=e.boundPipeline.getDevice(),a=e.boundPipeline.getBindGroupLayoutCount(n.getLabel());e.handle.setBindGroup(a,n.getBindGroup(r));const s=r.getBindGroupLayoutDescription(n.getBindGroupLayout(r)),i=r.getBindGroupLayoutDescription(e.boundPipeline.getBindGroupLayout(a));s!==i&&(console.log(`renderEncoder ${e.pipelineHash} mismatched bind group layouts bind group has
${s}
 versus pipeline
${i}
`),console.trace())},t.attachTextureViews=()=>{for(let n=0;n<e.colorTextureViews.length;n++)e.description.colorAttachments[n]?e.description.colorAttachments[n].view=e.colorTextureViews[n].getHandle():e.description.colorAttachments[n]={view:e.colorTextureViews[n].getHandle()};e.depthTextureView&&(e.description.depthStencilAttachment.view=e.depthTextureView.getHandle())},t.registerDrawCallback=(n,r)=>{for(let a=0;a<e.drawCallbacks.length;a++)if(e.drawCallbacks[a].pipeline===n){e.drawCallbacks[a].callbacks.push(r);return}e.drawCallbacks.push({pipeline:n,callbacks:[r]})};for(let n=0;n<za.length;n++)t[za[n]]=function(){return e.handle[za[n]](...arguments)}}const wM={description:null,handle:null,boundPipeline:null,pipelineHash:null,pipelineSettings:null,replaceShaderCodeFunction:null,depthTextureView:null,label:null};function V0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wM,n),Me(t,e),e.description={colorAttachments:[{view:void 0,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:void 0,depthLoadOp:"clear",depthClearValue:0,depthStoreOp:"store"}},e.replaceShaderCodeFunction=r=>{const a=r.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor");let s=a.getCode();s=K.substitute(s,"//VTK::RenderEncoder::Impl",["output.outColor = computedColor;"]).result,a.setCode(s)},e.pipelineSettings={primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!0,depthCompare:"greater-equal",format:"depth32float"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}},e.colorTextureViews=[],Ne(t,e,["boundPipeline","colorTextureViews"]),Te(t,e,["depthTextureView","description","handle","label","pipelineHash","pipelineSettings","replaceShaderCodeFunction"]),CM(t,e)}const EM=re(V0,"vtkWebGPURenderEncoder");var Tt={newInstance:EM,extend:V0};function MM(t,e){e.classHierarchy.push("vtkWebGPUOpaquePass"),t.traverse=(n,r)=>{if(e.deleted)return;e._currentParent=r;const a=r.getDevice();if(e.renderEncoder)e.colorTexture.resize(r.getCanvas().width,r.getCanvas().height),e.depthTexture.resize(r.getCanvas().width,r.getCanvas().height);else{t.createRenderEncoder(),e.colorTexture=ct.newInstance({label:"opaquePassColor"}),e.colorTexture.create(a,{width:r.getCanvas().width,height:r.getCanvas().height,format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});const s=e.colorTexture.createView("opaquePassColorTexture");e.renderEncoder.setColorTextureView(0,s),e.depthFormat="depth32float",e.depthTexture=ct.newInstance({label:"opaquePassDepth"}),e.depthTexture.create(a,{width:r.getCanvas().width,height:r.getCanvas().height,format:e.depthFormat,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});const i=e.depthTexture.createView("opaquePassDepthTexture");e.renderEncoder.setDepthTextureView(i)}e.renderEncoder.attachTextureViews(),t.setCurrentOperation("opaquePass"),n.setRenderEncoder(e.renderEncoder),n.traverse(t)},t.getColorTextureView=()=>e.renderEncoder.getColorTextureViews()[0],t.getDepthTextureView=()=>e.renderEncoder.getDepthTextureView(),t.createRenderEncoder=()=>{e.renderEncoder=Tt.newInstance({label:"OpaquePass"}),e.renderEncoder.setPipelineHash("op")}}const RM={renderEncoder:null,colorTexture:null,depthTexture:null};function B0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RM,n),Ct.extend(t,e,n),E.get(t,e,["colorTexture","depthTexture"]),MM(t,e)}const OM=E.newInstance(B0,"vtkWebGPUOpaquePass");var DM={newInstance:OM,extend:B0};const LM=`
//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec2<i32> = vec2<i32>(i32(input.fragPos.x), i32(input.fragPos.y));
  var reveal: f32 = textureLoad(oitpAccumTexture, tcoord, 0).r;
  if (reveal == 1.0) { discard; }
  var tcolor: vec4<f32> = textureLoad(oitpColorTexture, tcoord, 0);
  var total: f32 = max(tcolor.a, 0.01);
  var computedColor: vec4<f32> = vec4<f32>(tcolor.r/total, tcolor.g/total, tcolor.b/total, 1.0 - reveal);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function VM(t,e){e.classHierarchy.push("vtkWebGPUOrderIndependentTranslucentPass"),t.traverse=(n,r)=>{if(e.deleted)return;e._currentParent=r;const a=r.getDevice();if(e.translucentRenderEncoder)e.translucentColorTexture.resizeToMatch(e.colorTextureView.getTexture()),e.translucentAccumulateTexture.resizeToMatch(e.colorTextureView.getTexture());else{t.createRenderEncoder(),t.createFinalEncoder(),e.translucentColorTexture=ct.newInstance({label:"translucentPassColor"}),e.translucentColorTexture.create(a,{width:r.getCanvas().width,height:r.getCanvas().height,format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const s=e.translucentColorTexture.createView("oitpColorTexture");e.translucentRenderEncoder.setColorTextureView(0,s),e.translucentAccumulateTexture=ct.newInstance({label:"translucentPassAccumulate"}),e.translucentAccumulateTexture.create(a,{width:r.getCanvas().width,height:r.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const i=e.translucentAccumulateTexture.createView("oitpAccumTexture");e.translucentRenderEncoder.setColorTextureView(1,i),e.fullScreenQuad=Rn.newInstance(),e.fullScreenQuad.setDevice(r.getDevice()),e.fullScreenQuad.setPipelineHash("oitpfsq"),e.fullScreenQuad.setTextureViews(e.translucentRenderEncoder.getColorTextureViews()),e.fullScreenQuad.setFragmentShaderTemplate(LM)}e.translucentRenderEncoder.setDepthTextureView(e.depthTextureView),e.translucentRenderEncoder.attachTextureViews(),t.setCurrentOperation("translucentPass"),n.setRenderEncoder(e.translucentRenderEncoder),n.traverse(t),t.finalPass(r,n)},t.finalPass=(n,r)=>{e.translucentFinalEncoder.setColorTextureView(0,e.colorTextureView),e.translucentFinalEncoder.attachTextureViews(),e.translucentFinalEncoder.begin(n.getCommandEncoder()),r.scissorAndViewport(e.translucentFinalEncoder),e.fullScreenQuad.prepareAndDraw(e.translucentFinalEncoder),e.translucentFinalEncoder.end()},t.getTextures=()=>[e.translucentColorTexture,e.translucentAccumulateTexture],t.createRenderEncoder=()=>{e.translucentRenderEncoder=Tt.newInstance({label:"translucentRender"});const n=e.translucentRenderEncoder.getDescription();n.colorAttachments=[{view:void 0,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:void 0,clearValue:[1,0,0,0],loadOp:"clear",storeOp:"store"}],n.depthStencilAttachment={view:void 0,depthLoadOp:"load",depthStoreOp:"store"},e.translucentRenderEncoder.setReplaceShaderCodeFunction(r=>{const a=r.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor"),a.addOutput("f32","outAccum"),a.addBuiltinInput("vec4<f32>","@builtin(position) fragPos");let s=a.getCode();s=K.substitute(s,"//VTK::RenderEncoder::Impl",["var w: f32 = computedColor.a * pow(0.1 + input.fragPos.z, 2.0);","output.outColor = vec4<f32>(computedColor.rgb*w, w);","output.outAccum = computedColor.a;"]).result,a.setCode(s)}),e.translucentRenderEncoder.setPipelineHash("oitpr"),e.translucentRenderEncoder.setPipelineSettings({primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!1,depthCompare:"greater",format:"depth32float"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"one",dstFactor:"one"},alpha:{srcFactor:"one",dstFactor:"one"}}},{format:"r16float",blend:{color:{srcFactor:"zero",dstFactor:"one-minus-src"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createFinalEncoder=()=>{e.translucentFinalEncoder=Tt.newInstance({label:"translucentFinal"}),e.translucentFinalEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e.translucentFinalEncoder.setReplaceShaderCodeFunction(n=>{const r=n.getShaderDescription("fragment");r.addOutput("vec4<f32>","outColor"),r.addBuiltinInput("vec4<f32>","@builtin(position) fragPos");let a=r.getCode();a=K.substitute(a,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<f32>(computedColor.rgb, computedColor.a);"]).result,r.setCode(a)}),e.translucentFinalEncoder.setPipelineHash("oitpf"),e.translucentFinalEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})}}const BM={colorTextureView:null,depthTextureView:null};function F0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BM,n),Ct.extend(t,e,n),E.setGet(t,e,["colorTextureView","depthTextureView"]),VM(t,e)}const FM=E.newInstance(F0,"vtkWebGPUOrderIndependentTranslucentPass");var mM={newInstance:FM,extend:F0};const yn={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4},kM=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Volume::TraverseDec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

fn getTextureValue(vTex: texture_3d<f32>, tpos: vec4<f32>) -> f32
{
  // todo multicomponent support
  return textureSampleLevel(vTex, clampSampler, tpos.xyz, 0.0).r;
}

fn getGradient(vTex: texture_3d<f32>, tpos: vec4<f32>, vNum: i32, scalar: f32) -> vec4<f32>
{
  var result: vec4<f32>;

  var tstep: vec4<f32> = volumeSSBO.values[vNum].tstep;
  result.x = getTextureValue(vTex, tpos + vec4<f32>(tstep.x, 0.0, 0.0, 1.0)) - scalar;
  result.y = getTextureValue(vTex, tpos + vec4<f32>(0.0, tstep.y, 0.0, 1.0)) - scalar;
  result.z = getTextureValue(vTex, tpos + vec4<f32>(0.0, 0.0, tstep.z, 1.0)) - scalar;
  result.w = 0.0;

  // divide by spacing as that is our delta
  result = result / volumeSSBO.values[vNum].spacing;
  // now we have a gradient in unit tcoords

  var grad: f32 = length(result.xyz);
  if (grad > 0.0)
  {
    // rotate to View Coords, needed for lighting and shading
    var nMat: mat4x4<f32> = rendererUBO.SCVCMatrix * volumeSSBO.values[vNum].planeNormals;
    result = nMat * result;
    result = result / length(result);
  }

  // store gradient magnitude in .w
  result.w = grad;

  return result;
}

fn processVolume(vTex: texture_3d<f32>, vNum: i32, cNum: i32, posSC: vec4<f32>, tfunRows: f32) -> vec4<f32>
{
  var outColor: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);

  // convert to tcoords and reject if outside the volume
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*posSC;
  if (tpos.x < 0.0 || tpos.y < 0.0 || tpos.z < 0.0 ||
      tpos.x > 1.0 || tpos.y > 1.0 || tpos.z > 1.0) { return outColor; }

  var scalar: f32 = getTextureValue(vTex, tpos);

  var coord: vec2<f32> =
    vec2<f32>(scalar * componentSSBO.values[cNum].cScale + componentSSBO.values[cNum].cShift,
      (0.5 + 2.0 * f32(vNum)) / tfunRows);
  var color: vec4<f32> = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);

  var gofactor: f32 = 1.0;
  var normal: vec4<f32> = vec4<f32>(0.0,0.0,0.0,0.0);
  if (componentSSBO.values[cNum].gomin <  1.0 || volumeSSBO.values[vNum].shade[0] > 0.0)
  {
    normal = getGradient(vTex, tpos, vNum, scalar);
    if (componentSSBO.values[cNum].gomin <  1.0)
    {
      gofactor = clamp(normal.a*componentSSBO.values[cNum].goScale + componentSSBO.values[cNum].goShift,
      componentSSBO.values[cNum].gomin, componentSSBO.values[cNum].gomax);
    }
  }

  coord.x = (scalar * componentSSBO.values[cNum].oScale + componentSSBO.values[cNum].oShift);
  var opacity: f32 = textureSampleLevel(ofunTexture, clampSampler, coord, 0.0).r;

  if (volumeSSBO.values[vNum].shade[0] > 0.0)
  {
    color = color*abs(normal.z);
  }

  outColor = vec4<f32>(color.rgb, gofactor * opacity);

  return outColor;
}

// adjust the start and end point of a raycast such that it intersects the unit cube.
// This function is used to take a raycast starting point and step vector
// and numSteps and return the startijng and ending steps for intersecting the
// unit cube. Recall for a 3D texture, the unit cube is the range of texture coordsinates
// that have valid values. So this funtion can be used to take a ray in texture coordinates
// and bound it to intersecting the texture.
//
fn adjustBounds(tpos: vec4<f32>, tstep: vec4<f32>, numSteps: f32) -> vec2<f32>
{
  var result: vec2<f32> = vec2<f32>(0.0, numSteps);
  var tpos2: vec4<f32> = tpos + tstep*numSteps;

  // move tpos to the start of the volume
  var adjust: f32 =
    min(
      max(tpos.x/tstep.x, (tpos.x - 1.0)/tstep.x),
      min(
        max((tpos.y - 1.0)/tstep.y, tpos.y/tstep.y),
        max((tpos.z - 1.0)/tstep.z, tpos.z/tstep.z)));
  if (adjust < 0.0)
  {
    result.x = result.x - adjust;
  }

  // adjust length to the end
  adjust =
    max(
      min(tpos2.x/tstep.x, (tpos2.x - 1.0)/tstep.x),
      max(
        min((tpos2.y - 1.0)/tstep.y, tpos2.y/tstep.y),
        min((tpos2.z - 1.0)/tstep.z, tpos2.z/tstep.z)));
  if (adjust > 0.0)
  {
    result.y = result.y - adjust;
  }

  return result;
}

fn getSimpleColor(scalar: f32, vNum: i32, cNum: i32) -> vec4<f32>
{
  // how many rows (tfuns) do we have in our tfunTexture
  var tfunRows: f32 = f32(textureDimensions(tfunTexture).y);

  var coord: vec2<f32> =
    vec2<f32>(scalar * componentSSBO.values[cNum].cScale + componentSSBO.values[cNum].cShift,
      (0.5 + 2.0 * f32(vNum)) / tfunRows);
  var color: vec4<f32> = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);
  coord.x = (scalar * componentSSBO.values[cNum].oScale + componentSSBO.values[cNum].oShift);
  var opacity: f32 = textureSampleLevel(ofunTexture, clampSampler, coord, 0.0).r;
  return vec4<f32>(color.rgb, opacity);
}

fn traverseMax(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var maxVal: f32 = -1.0e37;
  loop
  {
    var scalar: f32 = getTextureValue(vTex, tpos);
    if (scalar > maxVal)
    {
      maxVal = scalar;
    }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(maxVal, vNum, cNum);
}

fn traverseMin(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var minVal: f32 = 1.0e37;
  loop
  {
    var scalar: f32 = getTextureValue(vTex, tpos);
    if (scalar < minVal)
    {
      minVal = scalar;
    }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(minVal, vNum, cNum);
}

fn traverseAverage(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  let ipRange: vec4<f32> = volumeSSBO.values[vNum].ipScalarRange;
  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var avgVal: f32 = 0.0;
  var sampleCount: f32 = 0.0;
  loop
  {
    var sample: f32 = getTextureValue(vTex, tpos);
    // right now leave filtering off until WebGL changes get merged
    // if (ipRange.z == 0.0 || sample >= ipRange.x && sample <= ipRange.y)
    // {
      avgVal = avgVal + sample;
      sampleCount = sampleCount + 1.0;
    // }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  if (sampleCount <= 0.0)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(avgVal/sampleCount, vNum, cNum);
}

fn traverseAdditive(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  let ipRange: vec4<f32> = volumeSSBO.values[vNum].ipScalarRange;
  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var sumVal: f32 = 0.0;
  loop
  {
    var sample: f32 = getTextureValue(vTex, tpos);
    // right now leave filtering off until WebGL changes get merged
    // if (ipRange.z == 0.0 || sample >= ipRange.x && sample <= ipRange.y)
    // {
      sumVal = sumVal + sample;
    // }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(sumVal, vNum, cNum);
}

fn composite(rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>) -> vec4<f32>
{
  // initial ray position is at the beginning
  var rayPosSC: vec4<f32> = minPosSC;

  // how many rows (tfuns) do we have in our tfunTexture
  var tfunRows: f32 = f32(textureDimensions(tfunTexture).y);

  var curDist: f32 = 0.0;
  var computedColor: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);
  var sampleColor: vec4<f32>;
//VTK::Volume::TraverseCalls

  loop
  {
    // for each volume, sample and accumulate color
//VTK::Volume::CompositeCalls

    // increment position
    curDist = curDist + mapperUBO.SampleDistance;
    rayPosSC = rayPosSC + rayStepSC;

    // check if we have reached a terminating condition
    if (curDist > rayLengthSC) { break; }
    if (computedColor.a > 0.98) { break; }
  }
  return computedColor;
}

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var rayMax: f32 = textureSampleLevel(maxTexture, clampSampler, input.tcoordVS, 0.0).r;
  var rayMin: f32 = textureSampleLevel(minTexture, clampSampler, input.tcoordVS, 0.0).r;

  // discard empty rays
  if (rayMax <= rayMin) { discard; }
  else
  {
    // compute start and end ray positions in view coordinates
    var minPosSC: vec4<f32> = rendererUBO.PCSCMatrix*vec4<f32>(2.0 * input.tcoordVS.x - 1.0, 1.0 - 2.0 * input.tcoordVS.y, rayMax, 1.0);
    minPosSC = minPosSC * (1.0 / minPosSC.w);
    var maxPosSC: vec4<f32> = rendererUBO.PCSCMatrix*vec4<f32>(2.0 * input.tcoordVS.x - 1.0, 1.0 - 2.0 * input.tcoordVS.y, rayMin, 1.0);
    maxPosSC = maxPosSC * (1.0 / maxPosSC.w);

    var rayLengthSC: f32 = distance(minPosSC.xyz, maxPosSC.xyz);
    var rayStepSC: vec4<f32> = (maxPosSC - minPosSC)*(mapperUBO.SampleDistance/rayLengthSC);
    rayStepSC.w = 0.0;

    var computedColor: vec4<f32>;

//VTK::Volume::Loop

//VTK::RenderEncoder::Impl
  }

  return output;
}
`,me=new Float64Array(16),Dt=new Float64Array(16);function UM(t,e){e.classHierarchy.push("vtkWebGPUVolumePassFSQ"),t.replaceShaderPosition=(a,s,i)=>{const o=s.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=o.getCode();c=K.substitute(c,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);"]).result,o.setCode(c),s.getShaderDescription("fragment").addBuiltinInput("vec4<f32>","@builtin(position) fragPos")},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderVolume=(a,s,i)=>{const o=s.getShaderDescription("fragment");let c=o.getCode();const u=[],g=[];for(let l=0;l<e.volumes.length;l++)e.volumes[l].getRenderable().getMapper().getBlendMode()===yn.COMPOSITE_BLEND?(u.push(`    sampleColor = processVolume(volTexture${l}, ${l}, ${e.rowStarts[l]}, rayPosSC, tfunRows);`),u.push(`    computedColor = vec4<f32>(
          sampleColor.a * sampleColor.rgb * (1.0 - computedColor.a) + computedColor.rgb,
          (1.0 - computedColor.a)*sampleColor.a + computedColor.a);`)):(g.push(`  sampleColor = traverseVals[${l}];`),g.push(`  computedColor = vec4<f32>(
          sampleColor.a * sampleColor.rgb * (1.0 - computedColor.a) + computedColor.rgb,
          (1.0 - computedColor.a)*sampleColor.a + computedColor.a);`));c=K.substitute(c,"//VTK::Volume::CompositeCalls",u).result,c=K.substitute(c,"//VTK::Volume::TraverseCalls",g).result,c=K.substitute(c,"//VTK::Volume::TraverseDec",[`var<private> traverseVals: array<vec4<f32>,${e.volumes.length}>;`]).result;let f=!1;for(let l=0;l<e.volumes.length;l++){const h=e.volumes[l].getRenderable().getMapper().getBlendMode();h===yn.COMPOSITE_BLEND?f=!0:h===yn.MAXIMUM_INTENSITY_BLEND?c=K.substitute(c,"//VTK::Volume::Loop",[`    traverseMax(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result:h===yn.MINIMUM_INTENSITY_BLEND?c=K.substitute(c,"//VTK::Volume::Loop",[`    traverseMin(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result:h===yn.AVERAGE_INTENSITY_BLEND?c=K.substitute(c,"//VTK::Volume::Loop",[`    traverseAverage(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result:h===yn.ADDITIVE_INTENSITY_BLEND&&(c=K.substitute(c,"//VTK::Volume::Loop",[`    traverseAdditive(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result)}f&&(c=K.substitute(c,"//VTK::Volume::Loop",["    computedColor = composite(rayLengthSC, minPosSC, rayStepSC);"]).result),o.setCode(c)},e.shaderReplacements.set("replaceShaderVolume",t.replaceShaderVolume),t.updateLUTImage=a=>{let s=t.getMTime();for(let f=0;f<e.volumes.length;f++){const l=e.volumes[f].getRenderable(),h=l.getMapper().getInputData();s=Math.max(s,l.getMTime(),h.getMTime())}if(s<e.lutBuildTime.getMTime())return;e.numRows=0,e.rowStarts=[];for(let f=0;f<e.volumes.length;f++){e.rowStarts.push(e.numRows);const h=e.volumes[f].getRenderable(),v=h.getMapper(),p=h.getProperty(),y=v.getInputData(),S=(y.getPointData()&&y.getPointData().getScalars()).getNumberOfComponents(),x=p.getIndependentComponents()?S:1;e.numRows+=x}const i=new Uint8ClampedArray(e.numRows*2*e.rowLength*4),o=new Float32Array(e.numRows*2*e.rowLength);let c=0;const u=new Float32Array(e.rowLength*3),g=e.rowLength;for(let f=0;f<e.volumes.length;f++){const h=e.volumes[f].getRenderable(),v=h.getMapper(),p=h.getProperty(),y=v.getInputData(),S=(y.getPointData()&&y.getPointData().getScalars()).getNumberOfComponents(),x=p.getIndependentComponents()?S:1;for(let w=0;w<x;++w){const C=p.getRGBTransferFunction(w),M=C.getRange();C.getTable(M[0],M[1],g,u,1);let R=c*g*4;for(let B=0;B<g;++B){i[R+B*4]=255*u[B*3],i[R+B*4+1]=255*u[B*3+1],i[R+B*4+2]=255*u[B*3+2],i[R+B*4+3]=255;for(let L=0;L<4;L++)i[R+(g+B)*4+L]=i[R+B*4+L]}const V=p.getScalarOpacity(w),O=e.sampleDist/p.getScalarOpacityUnitDistance(w),D=V.getRange();V.getTable(D[0],D[1],g,u,1),R=c*g;for(let B=0;B<g;++B)o[R+B]=1-(1-u[B])**O,o[R+B+g]=o[R+B];c+=2}}{const f={nativeArray:i,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},h=a.getTextureManager().getTexture(f).createView("tfunTexture");e.textureViews[2]=h}{const f={nativeArray:o,width:e.rowLength,height:e.numRows*2,depth:1,format:"r16float"},h=a.getTextureManager().getTexture(f).createView("ofunTexture");e.textureViews[3]=h}e.lutBuildTime.modified()},t.updateSSBO=a=>{let s=Math.max(t.getMTime(),e.WebGPURenderer.getStabilizedTime());for(let C=0;C<e.volumes.length;C++){const M=e.volumes[C].getRenderable(),R=M.getMapper(),V=R.getInputData();s=Math.max(s,M.getMTime(),V.getMTime(),R.getMTime())}if(s<e.SSBO.getSendTime())return;const i=e.WebGPURenderer.getStabilizedCenterByReference();e.SSBO.clearData(),e.SSBO.setNumberOfInstances(e.volumes.length);const o=new Float64Array(e.volumes.length*16),c=new Float64Array(e.volumes.length*16),u=new Float64Array(e.volumes.length*4),g=new Float64Array(e.volumes.length*4),f=new Float64Array(e.volumes.length*4),l=new Float64Array(e.volumes.length*4);for(let C=0;C<e.volumes.length;C++){const R=e.volumes[C].getRenderable(),O=R.getMapper().getInputData();Y(me),le(me,me,i);const D=R.getMatrix();ne(Dt,D),Ve(Dt,Dt),pe(me,Dt,me);const B=O.getWorldToIndex();pe(me,B,me);const L=O.getDimensions();Y(Dt),en(Dt,Dt,[1/L[0],1/L[1],1/L[2]]),pe(me,Dt,me);for(let G=0;G<16;G++)o[C*16+G]=me[G];Ve(me,me);for(let G=0;G<4;G++)c[C*16+G*4]=me[G*4],c[C*16+G*4+1]=me[G*4+1],c[C*16+G*4+2]=me[G*4+2],c[C*16+G*4+3]=0;u[C*4]=1/L[0],u[C*4+1]=1/L[1],u[C*4+2]=1/L[2],u[C*4+3]=1,g[C*4]=R.getProperty().getShade()?1:0;const F=O.getSpacing();f[C*4]=F[0],f[C*4+1]=F[1],f[C*4+2]=F[2],f[C*4+3]=1;const U=e.textureViews[C+4].getTexture().getScale(),N=R.getProperty().getIpScalarRange();l[C*4]=N[0]/U,l[C*4+1]=N[1]/U,l[C*4+2]=R.getProperty().getFilterMode()}e.SSBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.SSBO.addEntry("planeNormals","mat4x4<f32>"),e.SSBO.addEntry("shade","vec4<f32>"),e.SSBO.addEntry("tstep","vec4<f32>"),e.SSBO.addEntry("spacing","vec4<f32>"),e.SSBO.addEntry("ipScalarRange","vec4<f32>"),e.SSBO.setAllInstancesFromArray("SCTCMatrix",o),e.SSBO.setAllInstancesFromArray("planeNormals",c),e.SSBO.setAllInstancesFromArray("shade",g),e.SSBO.setAllInstancesFromArray("tstep",u),e.SSBO.setAllInstancesFromArray("spacing",f),e.SSBO.setAllInstancesFromArray("ipScalarRange",l),e.SSBO.send(a),e.componentSSBO.clearData(),e.componentSSBO.setNumberOfInstances(e.numRows);const h=new Float64Array(e.numRows),v=new Float64Array(e.numRows),p=new Float64Array(e.numRows),y=new Float64Array(e.numRows),T=new Float64Array(e.numRows),S=new Float64Array(e.numRows),d=new Float64Array(e.numRows),x=new Float64Array(e.numRows);let w=0;for(let C=0;C<e.volumes.length;C++){const R=e.volumes[C].getRenderable(),V=R.getMapper(),O=R.getProperty(),D=V.getInputData(),L=(D.getPointData()&&D.getPointData().getScalars()).getNumberOfComponents(),F=O.getIndependentComponents(),U=e.textureViews[C+4].getTexture().getFormat(),N=Ce.getDetailsFromTextureFormat(U),G=N.elementSize===2&&N.sampleType==="float",H={scale:[255],offset:[0]};G&&(H.scale[0]=1);for(let k=0;k<L;k++){const _=F?k:0,b=H.scale[k],$=O.getScalarOpacity(_).getRange(),ze=b/($[1]-$[0]),Le=(H.offset[k]-$[0])/($[1]-$[0]);y[w]=Le,p[w]=ze;const _e=O.getRGBTransferFunction(_).getRange();if(v[w]=(H.offset[k]-_e[0])/(_e[1]-_e[0]),h[w]=b/(_e[1]-_e[0]),O.getUseGradientOpacity(_)){const be=O.getGradientOpacityMinimumOpacity(_),We=O.getGradientOpacityMaximumOpacity(_);T[w]=be,S[w]=We;const Gt=[O.getGradientOpacityMinimumValue(_),O.getGradientOpacityMaximumValue(_)];x[w]=b*(We-be)/(Gt[1]-Gt[0]),d[w]=-Gt[0]*(We-be)/(Gt[1]-Gt[0])+be}else T[w]=1,S[w]=1,x[w]=0,d[w]=1;w++}}e.componentSSBO.addEntry("cScale","f32"),e.componentSSBO.addEntry("cShift","f32"),e.componentSSBO.addEntry("oScale","f32"),e.componentSSBO.addEntry("oShift","f32"),e.componentSSBO.addEntry("goShift","f32"),e.componentSSBO.addEntry("goScale","f32"),e.componentSSBO.addEntry("gomin","f32"),e.componentSSBO.addEntry("gomax","f32"),e.componentSSBO.setAllInstancesFromArray("cScale",h),e.componentSSBO.setAllInstancesFromArray("cShift",v),e.componentSSBO.setAllInstancesFromArray("oScale",p),e.componentSSBO.setAllInstancesFromArray("oShift",y),e.componentSSBO.setAllInstancesFromArray("goScale",x),e.componentSSBO.setAllInstancesFromArray("goShift",d),e.componentSSBO.setAllInstancesFromArray("gomin",T),e.componentSSBO.setAllInstancesFromArray("gomax",S),e.componentSSBO.send(a)};const n=t.updateBuffers;t.updateBuffers=()=>{n();let a=e.volumes[0].getRenderable().getMapper().getSampleDistance();for(let s=0;s<e.volumes.length;s++){const c=e.volumes[s].getRenderable().getMapper().getSampleDistance();c<a&&(a=c)}e.sampleDist!==a&&(e.sampleDist=a,e.UBO.setValue("SampleDistance",a),e.UBO.sendIfNeeded(e.device));for(let s=0;s<e.volumes.length;s++){const u=e.volumes[s].getRenderable().getMapper().getInputData(),g=e.device.getTextureManager().getTextureForImageData(u);if(!e.textureViews[s+4]||e.textureViews[s+4].getTexture()!==g){const f=g.createView(`volTexture${s}`);e.textureViews[s+4]=f}}if(e.volumes.length<e.lastVolumeLength)for(let s=e.volumes.length;s<e.lastVolumeLength;s++)e.textureViews.pop();e.lastVolumeLength=e.volumes.length,t.updateLUTImage(e.device),t.updateSSBO(e.device),e.clampSampler||(e.clampSampler=ui.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:"linear",magFilter:"linear"}))},t.computePipelineHash=()=>{e.pipelineHash="volfsq";for(let a=0;a<e.volumes.length;a++){const s=e.volumes[a].getRenderable().getMapper().getBlendMode();e.pipelineHash+=`${s}`}},t.setVolumes=a=>{if(!e.volumes||e.volumes.length!==a.length){e.volumes=[...a],t.modified();return}for(let s=0;s<a.length;s++)if(a[s]!==e.volumes[s]){e.volumes=[...a],t.modified();return}};const r=t.getBindables;t.getBindables=()=>{const a=r();return a.push(e.componentSSBO),a.push(e.clampSampler),a}}const NM={volumes:null,rowLength:1024,lastVolumeLength:0};function m0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NM,n),Rn.extend(t,e,n),e.fragmentShaderTemplate=kM,e.UBO=Jt.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SampleDistance","f32"),e.SSBO=ys.newInstance({label:"volumeSSBO"}),e.componentSSBO=ys.newInstance({label:"componentSSBO"}),e.lutBuildTime={},E.obj(e.lutBuildTime,{mtime:0}),UM(t,e)}const _M=E.newInstance(m0,"vtkWebGPUVolumePassFSQ");var GM={newInstance:_M,extend:m0};const{Representation:bM}=Vn,{BufferUsage:Xo,PrimitiveTypes:$M}=fn,Wa=[[0,4,6],[0,6,2],[1,3,7],[1,7,5],[0,5,4],[0,1,5],[2,6,7],[2,7,3],[0,3,1],[0,2,3],[4,5,7],[4,7,6]],zM=`
//VTK::Renderer::Dec

//VTK::Select::Dec

//VTK::VolumePass::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Select::Impl

  //VTK::TCoord::Impl

  //VTK::VolumePass::Impl

  // use the maximum (closest) of the current value and the zbuffer
  // the blend func will then take the min to find the farthest stop value
  var stopval: f32 = max(input.fragPos.z, textureLoad(opaquePassDepthTexture, vec2<i32>(i32(input.fragPos.x), i32(input.fragPos.y)), 0));

  //VTK::RenderEncoder::Impl
  return output;
}
`,WM=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = textureSample(volumePassColorTexture,
    volumePassColorTextureSampler, mapperUBO.tscale*input.tcoordVS);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function HM(t,e){e.classHierarchy.push("vtkWebGPUVolumePass"),t.initialize=n=>{e._clearEncoder||t.createClearEncoder(n),e._mergeEncoder||t.createMergeEncoder(n),e._copyEncoder||t.createCopyEncoder(n),e._depthRangeEncoder||t.createDepthRangeEncoder(n),e.fullScreenQuad||(e.fullScreenQuad=GM.newInstance(),e.fullScreenQuad.setDevice(n.getDevice()),e.fullScreenQuad.setTextureViews([...e._depthRangeEncoder.getColorTextureViews()])),e._volumeCopyQuad||(e._volumeCopyQuad=Rn.newInstance(),e._volumeCopyQuad.setPipelineHash("volpassfsq"),e._volumeCopyQuad.setDevice(n.getDevice()),e._volumeCopyQuad.setFragmentShaderTemplate(WM),e._copyUBO=Jt.newInstance({label:"mapperUBO"}),e._copyUBO.addEntry("tscale","vec2<f32>"),e._volumeCopyQuad.setUBO(e._copyUBO),e._volumeCopyQuad.setTextureViews([e._colorTextureView]))},t.traverse=(n,r)=>{if(e.deleted)return;e._currentParent=r,t.initialize(r),t.computeTiming(r),t.renderDepthBounds(n,r),e._firstGroup=!0;const a=r.getDevice(),s=a.getHandle().limits.maxSampledTexturesPerShaderStage-4;if(e.volumes.length>s){const i=n.getRenderable().getActiveCamera().getPosition(),o=[];for(let f=0;f<e.volumes.length;f++){const l=e.volumes[f].getRenderable().getBounds(),h=[.5*(l[1]+l[0]),.5*(l[3]+l[2]),.5*(l[5]+l[4])];o[f]=Se(h,i)}const c=[...Array(e.volumes.length).keys()];c.sort((f,l)=>o[l]-o[f]);let u=[],g=c.length%s;for(let f=0;f<c.length;f++)u.push(e.volumes[c[f]]),u.length>=g&&(t.rayCastPass(r,n,u),u=[],g=s,e._firstGroup=!1)}else t.rayCastPass(r,n,e.volumes);if(e._volumeCopyQuad.setWebGPURenderer(n),e._useSmallViewport){const i=e._colorTextureView.getTexture().getWidth(),o=e._colorTextureView.getTexture().getHeight();e._copyUBO.setArray("tscale",[e._smallViewportWidth/i,e._smallViewportHeight/o])}else e._copyUBO.setArray("tscale",[1,1]);e._copyUBO.sendIfNeeded(a),e._copyEncoder.setColorTextureView(0,e.colorTextureView),e._copyEncoder.attachTextureViews(),e._copyEncoder.begin(r.getCommandEncoder()),n.scissorAndViewport(e._copyEncoder),e._volumeCopyQuad.prepareAndDraw(e._copyEncoder),e._copyEncoder.end()},t.delete=E.chain(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},t.delete),t.computeTiming=n=>{const r=n.getRenderable().getInteractor();if(e._lastScale==null){const a=e.volumes[0].getRenderable().getMapper();e._lastScale=a.getInitialInteractionScale()||1}e._useSmallViewport=!1,r.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._colorTexture.resize(n.getCanvas().width,n.getCanvas().height),e._animationRateSubscription||(e._animationRateSubscription=r.onAnimationFrameRateUpdate(()=>{const a=e.volumes[0].getRenderable().getMapper();if(a.getAutoAdjustSampleDistances()){const s=r.getRecentAnimationFrameRate(),i=e._lastScale*r.getDesiredUpdateRate()/s;e._lastScale=i,e._lastScale>400&&(e._lastScale=400)}else e._lastScale=a.getImageSampleDistance()*a.getImageSampleDistance();e._lastScale<1.5&&(e._lastScale=1.5)}))},t.rayCastPass=(n,r,a)=>{const s=e._firstGroup?e._clearEncoder:e._mergeEncoder;s.attachTextureViews(),s.begin(n.getCommandEncoder());let i=e._colorTextureView.getTexture().getWidth(),o=e._colorTextureView.getTexture().getHeight();if(e._useSmallViewport){const c=n.getCanvas(),u=1/Math.sqrt(e._lastScale);e._smallViewportWidth=Math.ceil(u*c.width),e._smallViewportHeight=Math.ceil(u*c.height),i=e._smallViewportWidth,o=e._smallViewportHeight}s.getHandle().setViewport(0,0,i,o,0,1),s.getHandle().setScissorRect(0,0,i,o),e.fullScreenQuad.setWebGPURenderer(r),e.fullScreenQuad.setVolumes(a),e.fullScreenQuad.prepareAndDraw(s),s.end()},t.renderDepthBounds=(n,r)=>{t.updateDepthPolyData(n);const a=e._boundsPoly,s=a.getPoints(),i=a.getPolys();let o={hash:`vp${i.getMTime()}`,usage:Xo.Index,cells:i,numberOfPoints:s.getNumberOfPoints(),primitiveType:$M.Triangles,representation:bM.SURFACE};const c=r.getDevice().getBufferManager().getBuffer(o);e._mapper.getVertexInput().setIndexBuffer(c),o={usage:Xo.PointArray,format:"float32x4",hash:`vp${s.getMTime()}${i.getMTime()}`,dataArray:s,indexBuffer:c,packExtra:!0};const u=r.getDevice().getBufferManager().getBuffer(o);e._mapper.getVertexInput().addBuffer(u,["vertexBC"]),e._mapper.setNumberOfVertices(u.getSizeInBytes()/u.getStrideInBytes()),t.drawDepthRange(n,r)},t.updateDepthPolyData=n=>{let r=!1;for(let g=0;g<e.volumes.length;g++){const f=e.volumes[g].getMTime();(!e._lastMTimes[g]||f!==e._lastMTimes[g])&&(r=!0,e._lastMTimes[g]=f)}const a=n.getStabilizedTime();if((e._lastMTimes.length<=e.volumes.length||a!==e._lastMTimes[e.volumes.length])&&(r=!0,e._lastMTimes[e.volumes.length]=a),!r)return;const s=n.getStabilizedCenterByReference(),i=e.volumes.length*8,o=new Float64Array(i*3),c=e.volumes.length*12,u=new Uint16Array(c*4);for(let g=0;g<e.volumes.length;g++){e.volumes[g].getBoundingCubePoints(o,g*24);let f=g*12*4;const l=g*8;for(let h=0;h<12;h++)u[f++]=3,u[f++]=l+Wa[h][0],u[f++]=l+Wa[h][1],u[f++]=l+Wa[h][2]}for(let g=0;g<o.length;g+=3)o[g]-=s[0],o[g+1]-=s[1],o[g+2]-=s[2];e._boundsPoly.getPoints().setData(o,3),e._boundsPoly.getPoints().modified(),e._boundsPoly.getPolys().setData(u,1),e._boundsPoly.getPolys().modified(),e._boundsPoly.modified()},t.drawDepthRange=(n,r)=>{e._depthRangeTexture.resizeToMatch(e.colorTextureView.getTexture()),e._depthRangeTexture2.resizeToMatch(e.colorTextureView.getTexture()),e._depthRangeEncoder.attachTextureViews(),t.setCurrentOperation("volumeDepthRangePass"),n.setRenderEncoder(e._depthRangeEncoder),n.volumeDepthRangePass(!0),e._mapper.setWebGPURenderer(n),e._mapper.prepareToDraw(e._depthRangeEncoder),e._mapper.registerDrawCallback(e._depthRangeEncoder),n.volumeDepthRangePass(!1)},t.createDepthRangeEncoder=n=>{const r=n.getDevice();e._depthRangeEncoder=Tt.newInstance({label:"VolumePass DepthRange"}),e._depthRangeEncoder.setPipelineHash("volr"),e._depthRangeEncoder.setReplaceShaderCodeFunction(i=>{const o=i.getShaderDescription("fragment");o.addOutput("vec4<f32>","outColor1"),o.addOutput("vec4<f32>","outColor2");let c=o.getCode();c=K.substitute(c,"//VTK::RenderEncoder::Impl",["output.outColor1 = vec4<f32>(input.fragPos.z, 0.0, 0.0, 0.0);","output.outColor2 = vec4<f32>(stopval, 0.0, 0.0, 0.0);"]).result,o.setCode(c)}),e._depthRangeEncoder.setDescription({colorAttachments:[{view:null,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:null,clearValue:[1,1,1,1],loadOp:"clear",storeOp:"store"}]}),e._depthRangeEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"r16float",blend:{color:{srcFactor:"one",dstFactor:"one",operation:"max"},alpha:{srcFactor:"one",dstFactor:"one",operation:"max"}}},{format:"r16float",blend:{color:{srcFactor:"one",dstFactor:"one",operation:"min"},alpha:{srcFactor:"one",dstFactor:"one",operation:"min"}}}]}}),e._depthRangeTexture=ct.newInstance({label:"volumePassMaxDepth"}),e._depthRangeTexture.create(r,{width:n.getCanvas().width,height:n.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const a=e._depthRangeTexture.createView("maxTexture");e._depthRangeEncoder.setColorTextureView(0,a),e._depthRangeTexture2=ct.newInstance({label:"volumePassDepthMin"}),e._depthRangeTexture2.create(r,{width:n.getCanvas().width,height:n.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const s=e._depthRangeTexture2.createView("minTexture");e._depthRangeEncoder.setColorTextureView(1,s),e._mapper.setDevice(n.getDevice()),e._mapper.setTextureViews([e.depthTextureView])},t.createClearEncoder=n=>{e._colorTexture=ct.newInstance({label:"volumePassColor"}),e._colorTexture.create(n.getDevice(),{width:n.getCanvas().width,height:n.getCanvas().height,format:"bgra8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC}),e._colorTextureView=e._colorTexture.createView("volumePassColorTexture"),e._colorTextureView.addSampler(n.getDevice(),{minFilter:"linear",magFilter:"linear"}),e._clearEncoder=Tt.newInstance({label:"VolumePass Clear"}),e._clearEncoder.setColorTextureView(0,e._colorTextureView),e._clearEncoder.setDescription({colorAttachments:[{view:null,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}]}),e._clearEncoder.setPipelineHash("volpf"),e._clearEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"bgra8unorm",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createCopyEncoder=n=>{e._copyEncoder=Tt.newInstance({label:"volumePassCopy"}),e._copyEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._copyEncoder.setPipelineHash("volcopypf"),e._copyEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createMergeEncoder=n=>{e._mergeEncoder=Tt.newInstance({label:"volumePassMerge"}),e._mergeEncoder.setColorTextureView(0,e._colorTextureView),e._mergeEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._mergeEncoder.setReplaceShaderCodeFunction(r=>{const a=r.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor");let s=a.getCode();s=K.substitute(s,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<f32>(computedColor.rgb, computedColor.a);"]).result,a.setCode(s)}),e._mergeEncoder.setPipelineHash("volpf"),e._mergeEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"bgra8unorm",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.setVolumes=n=>{if(!e.volumes||e.volumes.length!==n.length){e.volumes=[...n],t.modified();return}for(let r=0;r<n.length;r++)if(n[r]!==e.volumes[r]){e.volumes=[...n],t.modified();return}}}const AM={colorTextureView:null,depthTextureView:null,volumes:null};function k0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AM,n),Ct.extend(t,e,n),e._mapper=fi.newInstance(),e._mapper.setFragmentShaderTemplate(zM),e._mapper.getShaderReplacements().set("replaceShaderVolumePass",(r,a,s)=>{a.getShaderDescription("fragment").addBuiltinInput("vec4<f32>","@builtin(position) fragPos")}),e._boundsPoly=St.newInstance(),e._lastMTimes=[],E.setGet(t,e,["colorTextureView","depthTextureView"]),HM(t,e)}const jM=E.newInstance(k0,"vtkWebGPUVolumePass");var KM={newInstance:jM,extend:k0};const PM=`
//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = clamp(textureSampleLevel(opaquePassColorTexture, finalPassSampler, input.tcoordVS, 0.0),vec4<f32>(0.0),vec4<f32>(1.0));

  //VTK::RenderEncoder::Impl
  return output;
}
`;function XM(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=r,t.setCurrentOperation("buildPass"),n.traverse(t),e.opaquePass||(e.opaquePass=DM.newInstance());const a=n.getRenderable().getNumberOfLayers(),s=n.getChildren();for(let i=0;i<a;i++)for(let o=0;o<s.length;o++){const c=s[o],u=n.getRenderable().getRenderers()[o];u.getDraw()&&u.getLayer()===i&&(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumes=[],t.setCurrentOperation("queryPass"),c.traverse(t),t.setCurrentOperation("cameraPass"),c.traverse(t),e.opaquePass.traverse(c,n),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=mM.newInstance()),e.translucentPass.setColorTextureView(e.opaquePass.getColorTextureView()),e.translucentPass.setDepthTextureView(e.opaquePass.getDepthTextureView()),e.translucentPass.traverse(c,n)),e.volumes.length>0&&(e.volumePass||(e.volumePass=KM.newInstance()),e.volumePass.setColorTextureView(e.opaquePass.getColorTextureView()),e.volumePass.setDepthTextureView(e.opaquePass.getDepthTextureView()),e.volumePass.setVolumes(e.volumes),e.volumePass.traverse(c,n)),t.finalPass(n,c))}},t.finalPass=(n,r)=>{e._finalBlitEncoder||t.createFinalBlitEncoder(n),e._finalBlitOutputTextureView.createFromTextureHandle(n.getCurrentTexture(),{depth:1,format:n.getPresentationFormat()}),e._finalBlitEncoder.attachTextureViews(),e._finalBlitEncoder.begin(n.getCommandEncoder()),r.scissorAndViewport(e._finalBlitEncoder),e._fullScreenQuad.prepareAndDraw(e._finalBlitEncoder),e._finalBlitEncoder.end()},t.createFinalBlitEncoder=n=>{e._finalBlitEncoder=Tt.newInstance({label:"forwardPassBlit"}),e._finalBlitEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._finalBlitEncoder.setPipelineHash("fpf"),e._finalBlitEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:n.getPresentationFormat(),blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha"}}}]}}),e._fsqSampler=ui.newInstance({label:"finalPassSampler"}),e._fsqSampler.create(n.getDevice(),{minFilter:"linear",magFilter:"linear"}),e._fullScreenQuad=Rn.newInstance(),e._fullScreenQuad.setDevice(n.getDevice()),e._fullScreenQuad.setPipelineHash("fpfsq"),e._fullScreenQuad.setTextureViews([e.opaquePass.getColorTextureView()]),e._fullScreenQuad.setAdditionalBindables([e._fsqSampler]),e._fullScreenQuad.setFragmentShaderTemplate(PM),e._finalBlitOutputTextureView=Yg.newInstance(),e._finalBlitEncoder.setColorTextureView(0,e._finalBlitOutputTextureView)},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.addVolume=n=>{e.volumes.push(n)}}const IM={opaqueActorCount:0,translucentActorCount:0,volumes:null,opaqueRenderEncoder:null,translucentPass:null,volumePass:null};function U0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,IM,n),Ct.extend(t,e,n),E.setGet(t,e,["opaquePass","translucentPass","volumePass"]),XM(t,e)}const YM=E.newInstance(U0,"vtkForwardPass");var QM={newInstance:YM,extend:U0};const{VtkDataTypes:Kt}=ee;function ZM(t,e){e.classHierarchy.push("vtkWebGPUTextureManager");function n(a){if(a.imageData){a.dataArray=a.imageData.getPointData().getScalars(),a.time=a.dataArray.getMTime(),a.nativeArray=a.dataArray.getData();const s=a.imageData.getDimensions();switch(a.width=s[0],a.height=s[1],a.depth=s[2],a.dataArray.getNumberOfComponents()){case 1:a.format="r";break;case 2:a.format="rg";break;case 3:case 4:default:a.format="rgba";break}switch(a.dataArray.getDataType()){case Kt.UNSIGNED_CHAR:a.format+="8unorm";break;case Kt.FLOAT:case Kt.UNSIGNED_INT:case Kt.INT:case Kt.DOUBLE:case Kt.UNSIGNED_SHORT:case Kt.SHORT:default:a.format+="16float";break}}a.image&&(a.width=a.image.width,a.height=a.image.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.usage=GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT),a.jsImageData&&(a.width=a.jsImageData.width,a.height=a.jsImageData.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.nativeArray=a.jsImageData.data,a.usage=GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT),a.imageBitmap&&(a.width=a.imageBitmap.width,a.height=a.imageBitmap.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.usage=GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT),a.canvas&&(a.width=a.canvas.width,a.height=a.canvas.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.usage=GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT)}function r(a){const s=ct.newInstance({label:a.label});return s.create(e.device,{width:a.width,height:a.height,depth:a.depth,format:a.format,usage:a.usage,mipLevel:a.mipLevel}),(a.nativeArray||a.image||a.canvas||a.imageBitmap)&&s.writeImageData(a),s}t.getTexture=a=>a.hash?e.device.getCachedObject(a.hash,r,a):r(a),t.getTextureForImageData=a=>{const s={time:a.getMTime()};return s.imageData=a,n(s),s.hash=s.time+s.format+s.mipLevel,e.device.getTextureManager().getTexture(s)},t.getTextureForVTKTexture=function(a){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;const i={time:a.getMTime(),label:s};return a.getInputData()?i.imageData=a.getInputData():a.getImage()?i.image=a.getImage():a.getJsImageData()?i.jsImageData=a.getJsImageData():a.getImageBitmap()?i.imageBitmap=a.getImageBitmap():a.getCanvas()&&(i.canvas=a.getCanvas()),n(i),i.mipLevel=a.getMipLevel(),i.hash=i.time+i.format+i.mipLevel,e.device.getTextureManager().getTexture(i)}}const qM={handle:null,device:null};function N0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qM,n),E.obj(t,e),E.setGet(t,e,["device"]),ZM(t,e)}const JM=E.newInstance(N0);var eR={newInstance:JM,extend:N0};class tR extends Map{constructor(){super(),this.registry=new FinalizationRegistry(e=>{const n=super.get(e);n&&n.deref&&n.deref()===void 0&&super.delete(e)})}getValue(e){const n=super.get(e);if(n){const r=n.deref();if(r!==void 0)return r;super.delete(e)}}setValue(e,n){let r;return n&&typeof n=="object"&&(r=new WeakRef(n),this.registry.register(n,e),super.set(e,r)),r}}function nR(t,e){e.classHierarchy.push("vtkWebGPUDevice"),t.initialize=n=>{e.handle=n},t.createCommandEncoder=()=>e.handle.createCommandEncoder(),t.submitCommandEncoder=n=>{e.handle.queue.submit([n.finish()])},t.getShaderModule=n=>e.shaderCache.getShaderModule(n),t.getBindGroupLayout=n=>{if(!n.entries)return null;for(let s=0;s<n.entries.length;s++){const i=n.entries[s];i.binding=i.binding||0,i.visibility=i.visibility||GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT}const r=JSON.stringify(n);for(let s=0;s<e.bindGroupLayouts.length;s++)if(e.bindGroupLayouts[s].sval===r)return e.bindGroupLayouts[s].layout;const a=e.handle.createBindGroupLayout(n);return e.bindGroupLayouts.push({sval:r,layout:a}),a},t.getBindGroupLayoutDescription=n=>{for(let r=0;r<e.bindGroupLayouts.length;r++)if(e.bindGroupLayouts[r].layout===n)return e.bindGroupLayouts[r].sval;return vtkErrorMacro("layout not found"),console.trace(),null},t.getPipeline=n=>n in e.pipelines?e.pipelines[n]:null,t.createPipeline=(n,r)=>{r.initialize(t,n),e.pipelines[n]=r},t.onSubmittedWorkDone=()=>e.handle.queue.onSubmittedWorkDone(),t.hasCachedObject=n=>e.objectCache.getValue(n),t.getCachedObject=function(n,r){if(!n)return vtkErrorMacro("attempt to cache an object without a hash"),null;const a=e.objectCache.getValue(n);if(a)return a;for(var s=arguments.length,i=new Array(s>2?s-2:0),o=2;o<s;o++)i[o-2]=arguments[o];const c=r(...i);return e.objectCache.setValue(n,c),c}}const rR={handle:null,pipelines:null,shaderCache:null,bindGroupLayouts:null,bufferManager:null,textureManager:null};function _0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rR,n),Me(t,e),Te(t,e,["handle"]),Ne(t,e,["bufferManager","shaderCache","textureManager"]),e.objectCache=new tR,e.shaderCache=K.newInstance(),e.shaderCache.setDevice(t),e.bindGroupLayouts=[],e.bufferManager=fn.newInstance(),e.bufferManager.setDevice(t),e.textureManager=eR.newInstance(),e.textureManager.setDevice(t),e.pipelines={},nR(t,e)}const aR=re(_0,"vtkWebGPUDevice");var sR={newInstance:aR,extend:_0};function iR(t,e){e.classHierarchy.push("vtkWebGPUHardwareSelectionPass"),t.traverse=(n,r)=>{if(e.deleted)return;e._currentParent=null,t.setCurrentOperation("buildPass"),n.traverse(t);const a=n.getDevice();if(e.selectionRenderEncoder)e.colorTexture.resize(n.getCanvas().width,n.getCanvas().height),e.depthTexture.resizeToMatch(e.colorTexture);else{t.createRenderEncoder(),e.colorTexture=ct.newInstance({label:"hardwareSelectorColor"}),e.colorTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:"rgba32uint",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});const s=e.colorTexture.createView("hardwareSelectColorTexture");e.selectionRenderEncoder.setColorTextureView(0,s),e.depthTexture=ct.newInstance({label:"hardwareSelectorDepth"}),e.depthTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});const i=e.depthTexture.createView("hardwareSelectDepthTexture");e.selectionRenderEncoder.setDepthTextureView(i)}e.selectionRenderEncoder.attachTextureViews(),r.setRenderEncoder(e.selectionRenderEncoder),t.setCurrentOperation("cameraPass"),r.traverse(t),t.setCurrentOperation("opaquePass"),r.traverse(t)},t.createRenderEncoder=()=>{e.selectionRenderEncoder=Tt.newInstance({label:"HardwareSelectionPass"}),e.selectionRenderEncoder.setPipelineHash("sel"),e.selectionRenderEncoder.setReplaceShaderCodeFunction(r=>{const a=r.getShaderDescription("fragment");a.addOutput("vec4<u32>","outColor");let s=a.getCode();s=K.substitute(s,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<u32>(mapperUBO.PropID, compositeID, 0u, 0u);"]).result,a.setCode(s)});const n=e.selectionRenderEncoder.getDescription();n.colorAttachments[0].clearValue=[0,0,0,0],e.selectionRenderEncoder.setPipelineSettings({primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!0,depthCompare:"greater",format:"depth32float"},fragment:{targets:[{format:"rgba32uint",blend:void 0}]}})}}const oR={selectionRenderEncoder:null,colorTexture:null,depthTexture:null};function G0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oR,n),Ct.extend(t,e,n),E.get(t,e,["colorTexture","depthTexture"]),iR(t,e)}const cR=E.newInstance(G0,"vtkWebGPUHardwareSelectionPass");var fR={newInstance:cR,extend:G0};const{SelectionContent:uR,SelectionField:Io}=da,{FieldAssociations:Yo}=cn,{vtkErrorMacro:b0}=E;function gR(t){return`${t.propID} ${t.compositeID}`}function Qo(t,e,n,r){const a=((n.height-e-1)*n.colorBufferWidth+t)*4+r;return n.colorValues[a]}function lR(t,e,n,r){{if(r[0]=e[0],r[1]=e[1],e[0]<0||e[0]>=t.width||e[1]<0||e[1]>=t.height)return null;const a=Qo(e[0],e[1],t,0);if(a<=0)return null;const s={};s.propID=a;let i=Qo(e[0],e[1],t,1);if((i<0||i>16777215)&&(i=0),s.compositeID=i,t.captureZValues){const o=(t.height-e[1]-1)*t.zbufferBufferWidth+e[0];s.zValue=t.depthValues[o],s.zValue=t.webGPURenderer.convertToOpenGLDepth(s.zValue),s.displayPosition=e}return s}}function pR(t,e,n){const r=[];let a=0;return e.forEach((s,i)=>{const o=da.newInstance();switch(o.setContentType(uR.INDICES),t){case Yo.FIELD_ASSOCIATION_CELLS:o.setFieldType(Io.CELL);break;case Yo.FIELD_ASSOCIATION_POINTS:o.setFieldType(Io.POINT);break;default:b0("Unknown field association")}o.getProperties().propID=s.info.propID;const c=n.webGPURenderer.getPropFromID(s.info.propID);o.getProperties().prop=c.getRenderable(),o.getProperties().compositeID=s.info.compositeID,o.getProperties().pixelCount=s.pixelCount,n.captureZValues&&(o.getProperties().displayPosition=[s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue],o.getProperties().worldPosition=n.webGPURenderWindow.displayToWorld(s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue,n.renderer)),o.setSelectionList(s.attributeIDs),r[a]=o,a++}),r}function hR(t,e,n,r,a){const s=Math.floor(e),i=Math.floor(n),o=Math.floor(r),c=Math.floor(a),u=new Map,g=[0,0];for(let f=i;f<=c;f++)for(let l=s;l<=o;l++){const v=lR(t,[l,f],0,g);if(v){const p=gR(v);if(!u.has(p))u.set(p,{info:v,pixelCount:1,attributeIDs:[v.attributeID]});else{const y=u.get(p);y.pixelCount++,t.captureZValues&&v.zValue<y.info.zValue&&(y.info=v),y.attributeIDs.indexOf(v.attributeID)===-1&&y.attributeIDs.push(v.attributeID)}}}return pR(t.fieldAssociation,u,t)}function yR(t,e){e.classHierarchy.push("vtkWebGPUHardwareSelector"),t.endSelection=()=>{e.WebGPURenderer.setSelector(null)},t.getSourceDataAsync=async n=>{if(!n||!e._WebGPURenderWindow)return b0("Renderer and view must be set before calling Select."),!1;e._WebGPURenderWindow.getRenderable().preRender(),e._WebGPURenderWindow.getInitialized()||(e._WebGPURenderWindow.initialize(),await new Promise(h=>{e._WebGPURenderWindow.onInitialized(h)}));const r=e._WebGPURenderWindow.getViewNodeFor(n);if(!r)return!1;const a=r.getSuppressClear();r.setSuppressClear(!0),e._selectionPass.traverse(e._WebGPURenderWindow,r),r.setSuppressClear(a);const s=e._WebGPURenderWindow.getDevice(),i=e._selectionPass.getColorTexture(),o=e._selectionPass.getDepthTexture(),c={area:[0,0,i.getWidth()-1,i.getHeight()-1],captureZValues:e.captureZValues,fieldAssociation:e.fieldAssociation,renderer:n,webGPURenderer:r,webGPURenderWindow:e._WebGPURenderWindow,width:i.getWidth(),height:i.getHeight()};c.colorBufferWidth=16*Math.floor((c.width+15)/16),c.colorBufferSizeInBytes=c.colorBufferWidth*c.height*4*4;const u=On.newInstance({label:"hardwareSelectColorBuffer"});u.setDevice(s),u.create(c.colorBufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);const g=e._WebGPURenderWindow.getCommandEncoder();g.copyTextureToBuffer({texture:i.getHandle()},{buffer:u.getHandle(),bytesPerRow:16*c.colorBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1});let f;e.captureZValues&&(c.zbufferBufferWidth=64*Math.floor((c.width+63)/64),f=On.newInstance({label:"hardwareSelectDepthBuffer"}),f.setDevice(s),c.zbufferSizeInBytes=c.height*c.zbufferBufferWidth*4,f.create(c.zbufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST),g.copyTextureToBuffer({texture:o.getHandle(),aspect:"depth-only"},{buffer:f.getHandle(),bytesPerRow:4*c.zbufferBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1})),s.submitCommandEncoder(g);const l=u.mapAsync(GPUMapMode.READ);if(e.captureZValues){const h=f.mapAsync(GPUMapMode.READ);await Promise.all([l,h]),c.depthValues=new Float32Array(f.getMappedRange().slice()),f.unmap()}else await l;return c.colorValues=new Uint32Array(u.getMappedRange().slice()),u.unmap(),c.generateSelection=(h,v,p,y)=>hR(c,h,v,p,y),c}}const vR={};function $0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vR,n),p0.extend(t,e,n),e._selectionPass=fR.newInstance(),E.setGet(t,e,["_WebGPURenderWindow"]),E.moveToProtected(t,e,["WebGPURenderWindow"]),yR(t,e)}const TR=E.newInstance($0,"vtkWebGPUHardwareSelector");var z0={newInstance:TR,extend:$0};const{vtkErrorMacro:Zo}=E,dR={position:"absolute",top:0,left:0,width:"100%",height:"100%"};function xR(t,e){e.classHierarchy.push("vtkWebGPURenderWindow"),t.getViewNodeFactory=()=>e.myFactory;const n=[0,0];function r(){e.renderable&&(e.size[0]!==n[0]||e.size[1]!==n[1])&&(n[0]=e.size[0],n[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1]),t.recreateSwapChain()),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(r),t.recreateSwapChain=()=>{e.context&&(e.context.unconfigure(),e.presentationFormat=navigator.gpu.getPreferredCanvasFormat(e.adapter),e.context.configure({device:e.device.getHandle(),format:e.presentationFormat,alphaMode:"premultiplied",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST,width:e.size[0],height:e.size[1]}),e._configured=!0)},t.getCurrentTexture=()=>e.context.getCurrentTexture(),t.buildPass=i=>{if(i){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.removeUnusedNodes(),t.initialize()}else e.initialized&&(e._configured||t.recreateSwapChain(),e.commandEncoder=e.device.createCommandEncoder())},t.initialize=()=>{if(!e.initializing){if(e.initializing=!0,!navigator.gpu){Zo("WebGPU is not enabled.");return}t.create3DContextAsync().then(()=>{e.initialized=!0,!e.deleted&&t.invokeInitialized()})}},t.setContainer=i=>{e.el&&e.el!==i&&(e.canvas.parentNode!==e.el&&Zo("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==i&&(e.el=i,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:i,height:o}=e.el.getBoundingClientRect();e.containerSize=[i,o]}return e.containerSize||e.size},t.getFramebufferSize=()=>e.size,t.create3DContextAsync=async()=>{if(e.adapter=await navigator.gpu.requestAdapter({powerPreference:"high-performance"}),!e.deleted){if(e.device=sR.newInstance(),e.device.initialize(await e.adapter.requestDevice()),e.deleted){e.device=null;return}e.context=e.canvas.getContext("webgpu")}},t.releaseGraphicsResources=()=>{const i=Ct.newInstance();i.setCurrentOperation("Release"),i.traverse(t,null),e.adapter=null,e.device=null,e.context=null,e.initialized=!1,e.initializing=!1},t.setBackgroundImage=i=>{e.bgImage.src=i.src},t.setUseBackgroundImage=i=>{e.useBackgroundImage=i,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};async function a(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const o=document.createElement("canvas"),c=o.getContext("2d");o.width=e.canvas.width,o.height=e.canvas.height;const u=await t.getPixelsAsync(),g=new ImageData(u.colorValues,u.width,u.height);c.putImageData(g,0,0);const f=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(p=>{p.getViewProps().forEach(T=>{if(T.getContainer){const d=T.getContainer().getElementsByTagName("canvas");for(let x=0;x<d.length;x++){const w=d[x],C=w.getBoundingClientRect(),M=C.x-f.x,R=C.y-f.y;c.drawImage(w,M,R)}}})});const v=o.toDataURL(i);o.remove(),t.invokeImageReady(v)}t.captureNextImage=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:o=!1,size:c=null,scale:u=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=i;const g=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:c||u!==1?c||e.size.map(f=>f*u):null},new Promise((f,l)=>{const h=t.onImageReady(v=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=g,h.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(p=>{let{restoreParamsFn:y,arg:T}=p;return y(T)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),f(v);else{const p=document.createElement("img");if(p.style=dR,p.src=v,e._screenshot.placeHolder=e.el.appendChild(p),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e._screenshot.size=null,t.modified(),o){const y=o!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(T=>{const S=T.getActiveCamera(),d=S.get("focalPoint","position","parallelScale");return{resetCameraArgs:y?{renderer:T}:void 0,resetCameraFn:y?o:T.resetCamera,restoreParamsFn:S.set,arg:JSON.parse(JSON.stringify(d))}}),e._screenshot.cameras.forEach(T=>{let{resetCameraFn:S,resetCameraArgs:d}=T;return S(d)})}t.traverseAllPasses()}})})},t.traverseAllPasses=()=>{if(!e.deleted)if(e.initialized){if(e.renderPasses)for(let i=0;i<e.renderPasses.length;++i)e.renderPasses[i].traverse(t,null);e.commandEncoder&&(e.device.submitCommandEncoder(e.commandEncoder),e.commandEncoder=null,e.notifyStartCaptureImage&&e.device.onSubmittedWorkDone().then(()=>{a()}))}else{t.initialize();const i=t.onInitialized(()=>{i.unsubscribe(),t.traverseAllPasses()})}},t.setViewStream=i=>{if(e.viewStream===i)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=i,e.viewStream){const o=e.renderable.getRenderers()[0];o.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(c=>t.setBackgroundImage(c.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.getUniquePropID=()=>e.nextPropID++,t.getPropFromID=i=>{for(let o=0;o<e.children.length;o++){const c=e.children[o].getPropFromID(i);if(c!==null)return c}return null},t.getPixelsAsync=async()=>{const i=e.device,o=e.renderPasses[0].getOpaquePass().getColorTexture(),c={width:o.getWidth(),height:o.getHeight()};c.colorBufferWidth=32*Math.floor((c.width+31)/32),c.colorBufferSizeInBytes=c.colorBufferWidth*c.height*8;const u=On.newInstance();u.setDevice(i),u.create(c.colorBufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);const g=e.device.createCommandEncoder();g.copyTextureToBuffer({texture:o.getHandle()},{buffer:u.getHandle(),bytesPerRow:8*c.colorBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1}),i.submitCommandEncoder(g),await u.mapAsync(GPUMapMode.READ),c.colorValues=new Uint16Array(u.getMappedRange().slice()),u.unmap();const l=new Uint8ClampedArray(c.height*c.width*4);for(let h=0;h<c.height;h++)for(let v=0;v<c.width;v++){const p=(h*c.width+v)*4,y=(h*c.colorBufferWidth+v)*4;l[p]=255*Je.fromHalf(c.colorValues[y]),l[p+1]=255*Je.fromHalf(c.colorValues[y+1]),l[p+2]=255*Je.fromHalf(c.colorValues[y+2]),l[p+3]=255*Je.fromHalf(c.colorValues[y+3])}return c.colorValues=l,c},t.createSelector=()=>{const i=z0.newInstance();return i.setWebGPURenderWindow(t),i};const s=t.setSize;t.setSize=(i,o)=>{const c=s(i,o);return c&&t.invokeWindowResizeEvent({width:i,height:o}),c},t.delete=E.chain(t.delete,t.setViewStream)}const SR={initialized:!1,context:null,adapter:null,device:null,canvas:null,cursorVisibility:!0,cursor:"pointer",containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1,nextPropID:1,xrSupported:!1,presentationFormat:null};function CR(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SR,n),e.canvas=document.createElement("canvas"),e.canvas.style.width="100%",e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",O0.extend(t,e,n),e.myFactory=eS.newInstance(),e.renderPasses[0]=QM.newInstance(),e.selector||(e.selector=z0.newInstance(),e.selector.setWebGPURenderWindow(t)),E.event(t,e,"imageReady"),E.event(t,e,"initialized"),E.get(t,e,["commandEncoder","device","presentationFormat","useBackgroundImage","xrSupported"]),E.setGet(t,e,["initialized","context","canvas","device","renderPasses","notifyStartCaptureImage","cursor","useOffScreen"]),E.setGetArray(t,e,["size"],2),E.event(t,e,"windowResizeEvent"),xR(t,e)}const W0=E.newInstance(CR,"vtkWebGPURenderWindow");gi("WebGPU",W0);ut("vtkRenderWindow",W0);const wR=TE.extractURLParameters(),ER={margin:"0",padding:"0",position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden"},MR={position:"absolute",left:"25px",top:"25px",backgroundColor:"white",borderRadius:"5px",listStyle:"none",padding:"5px 10px",margin:"0",display:"block",border:"solid 1px black",maxWidth:"calc(100% - 70px)",maxHeight:"calc(100% - 60px)",overflow:"auto"};function qo(t,e){Object.keys(e).forEach(n=>{t.style[n]=e[n]})}function RR(t,e){e.classHierarchy.push("vtkFullScreenRenderWindow");const n=document.querySelector("body");e.rootContainer||(e.rootContainer=n),e.container||(e.container=document.createElement("div"),qo(e.container,e.containerStyle||ER),e.rootContainer.appendChild(e.container)),e.rootContainer===n&&(document.documentElement.style.height="100%",n.style.height="100%",n.style.padding="0",n.style.margin="0"),e.renderWindow=Aw.newInstance(),e.renderer=Gw.newInstance(),e.renderWindow.addRenderer(e.renderer),e.apiSpecificRenderWindow=e.renderWindow.newAPISpecificView(wR.viewAPI??e.defaultViewAPI),e.apiSpecificRenderWindow.setContainer(e.container),e.renderWindow.addView(e.apiSpecificRenderWindow),e.interactor=a0.newInstance(),e.interactor.setInteractorStyle(hE.newInstance()),e.interactor.setView(e.apiSpecificRenderWindow),e.interactor.initialize(),e.interactor.bindEvents(e.container),t.setBackground=e.renderer.setBackground,t.removeController=()=>{const a=e.controlContainer;a&&a.parentNode.removeChild(a)},t.setControllerVisibility=a=>{e.controllerVisibility=a,e.controlContainer&&(a?e.controlContainer.style.display="block":e.controlContainer.style.display="none")},t.toggleControllerVisibility=()=>{t.setControllerVisibility(!e.controllerVisibility)};function r(a){String.fromCharCode(a.charCode)==="c"&&t.toggleControllerVisibility()}t.addController=a=>{e.controlContainer=document.createElement("div"),qo(e.controlContainer,e.controlPanelStyle||MR),e.rootContainer.appendChild(e.controlContainer),e.controlContainer.innerHTML=a,t.setControllerVisibility(e.controllerVisibility),e.rootContainer.addEventListener("keypress",r)},t.setBackground(...e.background),t.addRepresentation=a=>{a.getActors().forEach(s=>{e.renderer.addActor(s)})},t.removeRepresentation=a=>{a.getActors().forEach(s=>e.renderer.removeActor(s))},t.delete=E.chain(t.setContainer,e.apiSpecificRenderWindow.delete,()=>{var a;(a=e.rootContainer)==null||a.removeEventListener("keypress",r),window.removeEventListener("resize",t.resize)},t.delete),t.resize=()=>{const a=e.container.getBoundingClientRect(),s=window.devicePixelRatio||1;e.apiSpecificRenderWindow.setSize(Math.floor(a.width*s),Math.floor(a.height*s)),e.resizeCallback&&e.resizeCallback(a),e.renderWindow.render()},t.setResizeCallback=a=>{e.resizeCallback=a,t.resize()},e.listenWindowResize&&window.addEventListener("resize",t.resize),t.resize()}const OR={background:[.32,.34,.43],containerStyle:null,controlPanelStyle:null,listenWindowResize:!0,resizeCallback:null,controllerVisibility:!0};function H0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OR,n),E.obj(t,e),E.get(t,e,["renderWindow","renderer","apiSpecificRenderWindow","interactor","rootContainer","container","controlContainer"]),RR(t,e)}const DR=E.newInstance(H0);var LR={newInstance:DR,extend:H0};function VR(t,e){e.classHierarchy.push("vtkAbstractPicker"),t.initialize=()=>{e.renderer=null,e.selectionPoint[0]=0,e.selectionPoint[1]=0,e.selectionPoint[2]=0,e.pickPosition[0]=0,e.pickPosition[1]=0,e.pickPosition[2]=0},t.initializePickList=()=>{e.pickList=[]},t.addPickList=n=>{e.pickList.push(n)},t.deletePickList=n=>{const r=e.pickList.indexOf(n);r!==-1&&e.pickList.splice(r,1)}}const BR={renderer:null,selectionPoint:[0,0,0],pickPosition:[0,0,0],pickFromList:!1,pickList:[]};function A0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BR,n),E.obj(t,e),E.get(t,e,["renderer"]),E.getArray(t,e,["selectionPoint","pickPosition"]),E.setGet(t,e,["pickFromList","pickList"]),VR(t,e)}const FR=E.newInstance(A0,"vtkAbstractPicker");var mR={newInstance:FR,extend:A0};const{vtkErrorMacro:kR}=E,{vtkWarningMacro:kr}=E;function UR(t,e){e.classHierarchy.push("vtkPicker");const n={...t};function r(){n.initialize(),e.actors=[],e.pickedPositions=[],e.mapperPosition[0]=0,e.mapperPosition[1]=0,e.mapperPosition[2]=0,e.mapper=null,e.dataSet=null,e.globalTMin=Number.MAX_VALUE}function a(i,o,c){let u=0;const g=c.getRenderWindow().getViews()[0],f=c.getViewport(),l=g.getSize();let h=l[0]*f[0],v=l[1]*f[1];const p=g.displayToNormalizedDisplay(h,v,i),y=c.normalizedDisplayToWorld(p[0],p[1],p[2],o);h=l[0]*f[2],v=l[1]*f[3];const T=g.displayToNormalizedDisplay(h,v,i),S=c.normalizedDisplayToWorld(T[0],T[1],T[2],o);for(let d=0;d<3;d++)u+=(S[d]-y[d])*(S[d]-y[d]);return Math.sqrt(u)}function s(i,o,c,u){const g=new Float64Array(4),f=new Float64Array(4),l=[],h=[],v=e.pickFromList?e.pickList:i.getActors(),p=new Float64Array(3),y=new Float64Array(3);v.forEach(S=>{var M,R,V;const d=S.getMapper(),x=((V=(M=S.getProperty)==null?void 0:(R=M.call(S)).getOpacity)==null?void 0:V.call(R))===0;if(!(S.getNestedPickable()&&S.getNestedVisibility()&&!x))return;e.transformMatrix=S.getMatrix().slice(0),ne(e.transformMatrix,e.transformMatrix),Ve(e.transformMatrix,e.transformMatrix),ht(g,c,e.transformMatrix),ht(f,u,e.transformMatrix),at(g,g,1/g[3]),at(f,f,1/f[3]),ye(f,g,l);const C=d?j.inflate(d.getBounds(),o):[...j.INIT_BOUNDS];if(j.intersectBox(C,g,l,h,[])){Es(p,e.transformMatrix);const O=e.intersectWithLine(g,f,o*.333*(p[0]+p[1]+p[2]),S,d);if(O<Number.MAX_VALUE){y[0]=(1-O)*c[0]+O*u[0],y[1]=(1-O)*c[1]+O*u[1],y[2]=(1-O)*c[2]+O*u[2];const D=e.actors.indexOf(S);if(D!==-1){const B=e.pickedPositions[D];Se(c,y)<Se(c,B)&&(e.pickedPositions[D]=y.slice(0))}else e.actors.push(S),e.pickedPositions.push(y.slice(0))}}});const T=[];for(let S=0;S<e.pickedPositions.length;S++)T.push({actor:e.actors[S],pickedPosition:e.pickedPositions[S],distance2:Se(c,e.pickedPositions[S])});T.sort((S,d)=>{const x=S.distance2,w=d.distance2;return x<w?-1:x>w?1:0}),e.pickedPositions=[],e.actors=[],T.forEach(S=>{e.pickedPositions.push(S.pickedPosition),e.actors.push(S.actor)})}e.intersectWithLine=(i,o,c,u,g)=>{if(!g)return Number.MAX_VALUE;const f=g.getCenter(),l=vt(new Float64Array(3),o,i),h=W(l,l);return h===0?2:(l[0]*(f[0]-i[0])+l[1]*(f[1]-i[1])+l[2]*(f[2]-i[2]))/h},t.pick=(i,o)=>{if(i.length!==3&&kr("vtkPicker.pick - selection needs three components"),!o)throw kR("vtkPicker.pick - renderer cannot be null"),new Error("renderer cannot be null");r();const c=i[0],u=i[1];let g=i[2];e.renderer=o,e.selectionPoint[0]=c,e.selectionPoint[1]=u,e.selectionPoint[2]=g;const f=new Float64Array(4),l=new Float64Array(4),h=o.getActiveCamera(),v=h.getPosition(),p=h.getFocalPoint(),y=o.getRenderWindow().getViews()[0],T=y.getViewportSize(o);if(T[1]===0){kr("vtkPicker.pick - viewport area is 0");return}const S=T[0]/T[1];let d=[];d=o.worldToNormalizedDisplay(p[0],p[1],p[2],S),d=y.normalizedDisplayToDisplay(d[0],d[1],d[2]),g=d[2];const x=y.displayToNormalizedDisplay(c,u,g),w=o.normalizedDisplayToWorld(x[0],x[1],x[2],S);for(let L=0;L<3;L++)e.pickPosition[L]=w[L];const C=[];for(let L=0;L<3;L++)C[L]=e.pickPosition[L]-v[L];const M=[];for(let L=0;L<3;L++)M[L]=p[L]-v[L];we(M);const R=W(M,C);if(R===0){kr("Picker::Pick Cannot process points");return}const V=h.getClippingRange();let O,D;if(h.getParallelProjection()){O=V[0]-R,D=V[1]-R;for(let L=0;L<3;L++)f[L]=e.pickPosition[L]+O*M[L],l[L]=e.pickPosition[L]+D*M[L]}else{O=V[0]/R,D=V[1]/R;for(let L=0;L<3;L++)f[L]=v[L]+O*C[L],l[L]=v[L]+D*C[L]}f[3]=1,l[3]=1;const B=a(g,S,o)*e.tolerance;s(e.renderer,B,f,l)},t.pick3DPoint=(i,o,c)=>{if(!c)throw new Error("renderer cannot be null");r(),e.renderer=c,Tc(e.selectionPoint,i);const g=c.getRenderWindow().getViews()[0].getViewportSize(c);if(g[1]===0){kr("vtkPicker.pick3DPoint - viewport area is 0");return}const f=g[0]/g[1],l=a(e.selectionPoint[2],f,c)*e.tolerance;s(c,l,i,o)}}const NR={tolerance:.025,mapperPosition:[0,0,0],mapper:null,dataSet:null,actors:[],pickedPositions:[],transformMatrix:null,globalTMin:Number.MAX_VALUE};function j0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NR,n),mR.extend(t,e,n),E.setGet(t,e,["tolerance"]),E.setGetArray(t,e,["mapperPosition"],3),E.get(t,e,["mapper","dataSet","actors","pickedPositions"]),E.event(t,e,"pickChange"),UR(t,e)}const _R=E.newInstance(j0,"vtkPicker");var K0={newInstance:_R,extend:j0};function P0(t,e,n){let r=-1,a=-1,s=0,i=1;for(let f=0;f<3;f++)for(let l=0;l<2;l++){const h=2*f+l,v=(t[h]-e[f])*(1-2*l),p=(t[h]-n[f])*(1-2*l);if(v>0&&p>0)return;if(v>0||p>0){let y=0;if(v!==0&&(y=v/(v-p)),v>0?y>=s&&(s=y,r=h):y<=i&&(i=y,a=h),s>i&&(r<0||a<0))return}}function o(f,l){const h=[0,0,0];for(let v=0;v<2;v++)for(let p=0;p<3;p++)f===2*p||f===2*p+1?h[p]=t[f]:(h[p]=e[p]*(1-l)+n[p]*l,h[p]<t[2*p]&&(h[p]=t[2*p]),h[p]>t[2*p+1]&&(h[p]=t[2*p+1]));return h}const c=o(r,s),u=o(a,i);return{t1:s,t2:i,x1:c,x2:u}}const GR={};function bR(t,e){e.classHierarchy.push("vtkBox"),t.setBounds=function(){let n=[];for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];if(Array.isArray(a[0]))n=a[0];else for(let i=0;i<a.length;i++)n.push(a[i]);if(n.length!==6){console.log("vtkBox.setBounds",n,a);return}j.setBounds(e.bbox,n)},t.getBounds=()=>e.bbox,t.evaluateFunction=(n,r,a)=>{const s=Array.isArray(n)?n:[n,r,a];let i,o,c,u=-Number.MAX_VALUE,g=0;const f=j.getMinPoint(e.bbox),l=j.getMaxPoint(e.bbox);let h=1;for(let v=0;v<3;v++)i=j.getLength(e.bbox,v),i!==0?(c=(s[v]-f[v])/i,c<0?(h=0,o=f[v]-s[v]):c>1?(h=0,o=s[v]-l[v]):(c<=.5?o=f[v]-s[v]:o=s[v]-l[v],o>u&&(u=o))):(o=Math.abs(s[v]-f[v]),o>0&&(h=0)),o>0&&(g+=o*o);return g=Math.sqrt(g),h?u:g},t.addBounds=function(){let n=[];if(Array.isArray(arguments.length<=0?void 0:arguments[0]))n=arguments.length<=0?void 0:arguments[0];else for(let r=0;r<arguments.length;r++)n.push(r<0||arguments.length<=r?void 0:arguments[r]);n.length===6&&(j.addBounds(e.bbox,...n),t.modified())},t.addBox=n=>t.addBounds(n.getBounds()),t.intersectWithLine=(n,r)=>P0(e.bbox,n,r)}const $R={bbox:[...j.INIT_BOUNDS]};function X0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$R,n),bf.extend(t,e,n),bR(t,e)}const zR=E.newInstance(X0,"vtkBox");var WR={newInstance:zR,extend:X0,intersectWithLine:P0,...GR};function Jo(){return{[Q.VTK_LINE]:Re.newInstance(),[Q.VTK_POLY_LINE]:Qu.newInstance(),[Q.VTK_TRIANGLE]:Ta.newInstance(),[Q.VTK_QUAD]:ng.newInstance()}}function I0(t,e,n,r){const a={planeId:-1,t1:0,t2:1,intersect:0},s=t.getNumberOfClippingPlanes(),i=[];for(let o=0;o<s;o++){t.getClippingPlaneInDataCoords(e,o,i);const c=i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3],u=i[0]*r[0]+i[1]*r[1]+i[2]*r[2]+i[3];if(c<0&&u<0)return 0;if(c<0||u<0){let g=0;if(c!==0&&(g=c/(c-u)),c<0?g>=a.t1&&(a.t1=g,a.planeId=o):g<=a.t2&&(a.t2=g),a.t1>a.t2)return a.intersect=0,a}}return a.intersect=1,a}const HR={clipLineWithPlane:I0};function AR(t,e){e.classHierarchy.push("vtkCellPicker");const n={...t};function r(){e.cellId=-1,e.pCoords[0]=0,e.pCoords[1]=0,e.pCoords[2]=0,e.cellIJK[0]=0,e.cellIJK[1]=0,e.cellIJK[2]=0,e.mapperNormal[0]=0,e.mapperNormal[1]=0,e.mapperNormal[2]=1,e.pickNormal[0]=0,e.pickNormal[1]=0,e.pickNormal[2]=1}function a(){e.dataSet=null,e.mapper=null,r()}t.initialize=()=>{a(),n.initialize()},t.computeSurfaceNormal=(s,i,o,c)=>{const u=s.getPointData().getNormals();if(u){c[0]=0,c[1]=0,c[2]=0;const g=[];for(let f=0;f<3;f++)u.getTuple(i.getPointsIds()[f],g),c[0]+=g[0]*o[f],c[1]+=g[1]*o[f],c[2]+=g[2]*o[f];we(c)}else return 0;return 1},t.pick=(s,i)=>{t.initialize();const o=n.pick(s,i);if(o){const c=i.getActiveCamera(),u=[];if(c.getPosition(u),c.getParallelProjection()){const g=[];c.getFocalPoint(g),e.pickNormal[0]=u[0]-g[0],e.pickNormal[1]=u[1]-g[1],e.pickNormal[2]=u[2]-g[2]}else e.pickNormal[0]=u[0]-e.pickPosition[0],e.pickNormal[1]=u[1]-e.pickPosition[1],e.pickNormal[2]=u[2]-e.pickPosition[2];we(e.pickNormal)}return o},e.intersectWithLine=(s,i,o,c,u)=>{let g=Number.MAX_VALUE,f=0,l=1;const h=1e-14,v=I0(u,e.transformMatrix,s,i);if(u&&!v.intersect)return Number.MAX_VALUE;if(u.isA("vtkImageMapper")||u.isA("vtkImageArrayMapper")){const p=u.intersectWithLineForCellPicking(s,i);p&&(g=p.t,e.cellIJK=p.ijk,e.pCoords=p.pCoords)}else if(u.isA("vtkVolumeMapper")){const p=WR.intersectWithLine(u.getBounds(),s,i);f=(p==null?void 0:p.t1)>v.t1?p.t1:v.t1,l=(p==null?void 0:p.t2)<v.t2?p.t2:v.t2,g=e.intersectVolumeWithLine(s,i,f,l,o,c)}else u.isA("vtkMapper")&&(g=e.intersectActorWithLine(s,i,f,l,o,u));if(g<e.globalTMin){if(e.globalTMin=g,Math.abs(g-f)<h&&v.clippingPlaneId>=0){e.mapperPosition[0]=s[0]*(1-f)+i[0]*f,e.mapperPosition[1]=s[1]*(1-f)+i[1]*f,e.mapperPosition[2]=s[2]*(1-f)+i[2]*f;const y=[];u.getClippingPlaneInDataCoords(e.transformMatrix,v.clippingPlaneId,y),we(y),e.mapperNormal[0]=-y[0],e.mapperNormal[1]=-y[1],e.mapperNormal[2]=-y[2]}q(e.pickPosition,e.mapperPosition,e.transformMatrix);const p=e.transformMatrix;e.mapperNormal[0]=p[0]*e.pickNormal[0]+p[4]*e.pickNormal[1]+p[8]*e.pickNormal[2],e.mapperNormal[1]=p[1]*e.pickNormal[0]+p[5]*e.pickNormal[1]+p[9]*e.pickNormal[2],e.mapperNormal[2]=p[2]*e.pickNormal[0]+p[6]*e.pickNormal[1]+p[10]*e.pickNormal[2]}return g},e.intersectVolumeWithLine=(s,i,o,c,u,g)=>{let f=Number.MAX_VALUE;const l=g.getMapper(),h=l.getInputData(),v=h.getDimensions(),p=h.getPointData().getScalars().getData(),y=h.getExtent(),T=h.getWorldToIndex(),S=1;let d=l.getOpacityTextureWidth();d<=0&&(d=1024);const x=new Float32Array(d),w=new Float32Array(d);let C,M;const R=g.getMapper().getSampleDistance();for(let _=0;_<S;++_){C=g.getProperty().getScalarOpacity(_),M=C.getRange(),C.getTable(M[0],M[1],d,x,1);const b=R/g.getProperty().getScalarOpacityUnitDistance(_);for(let z=0;z<d;++z)w[z]=1-(1-x[z])**b}const V=d/(M[1]-M[0]+1),O=[0,0,0,1],D=[0,0,0,1];if(O[0]=s[0],O[1]=s[1],O[2]=s[2],D[0]=i[0],D[1]=i[1],D[2]=i[2],o!==0||c!==1)for(let _=0;_<3;_++)O[_]=s[_]*(1-o)+i[_]*o,D[_]=s[_]*(1-c)+i[_]*c;const B=[0,0,0,0],L=[0,0,0,0];ht(B,O,T),ht(L,D,T);const F=[0,0,0],U=[0,0,0],N=v[1]*v[0],G=v[0],H=1/Math.sqrt(Se(B,L));let k;for(let _=0;_<1;_+=H){k=!0;for(let b=0;b<3;b++)F[b]=B[b]*(1-_)+L[b]*_;for(let b=0;b<3;b++)F[b]<y[2*b]?(F[b]=y[2*b],k=!1):F[b]>y[2*b+1]&&(F[b]=y[2*b+1],k=!1),U[b]=Math.round(F[b]);if(k){const b=U[2]*N+U[1]*G+U[0];let z=p[b];if(z<M[0]?z=M[0]:z>M[1]&&(z=M[1]),z=Math.floor((z-M[0])*V),x[z]>e.opacityThreshold){f=o*(1-_)+c*_;break}}}return f},e.intersectActorWithLine=(s,i,o,c,u,g)=>{let f=Number.MAX_VALUE;const l=[0,0,0];let h=Number.MAX_VALUE;const v=[0,0,0];let p=null,y=null,T=null,S=null;const d=[],x=g.getInputData(),w=[0,0,0],C=[0,0,0];if(w[0]=s[0],w[1]=s[1],w[2]=s[2],C[0]=i[0],C[1]=i[1],C[2]=i[2],o!==0||c!==1)for(let M=0;M<3;M++)w[M]=s[M]*(1-o)+i[M]*o,C[M]=s[M]*(1-c)+i[M]*c;if(x.getCells){x.getCells()||x.buildLinks();const M=Jo(),R=Jo(),V=x.getNumberOfCells();for(let O=0;O<V;O++){const D=[0,0,0];if(T=x.getCellType(O),T===Q.VTK_EMPTY_CELL)continue;const B=M[T];if(B==null)continue;y=R[T],x.getCell(O,B);let L;if(ps.hasSubCells(T)?L=B.intersectWithLine(o,c,s,i,u,d,D):L=B.intersectWithLine(s,i,u,d,D),L.intersect===1&&L.t<=f+e.tolerance&&L.t>=o&&L.t<=c){const F=B.getParametricDistance(D);if(F<h||F===h&&L.t<f){f=L.t,h=F,S=L.subId,p=O,B.deepCopy(y);for(let U=0;U<3;U++)l[U]=d[U],v[U]=D[U]}}}}if(p>=0&&f<e.globalTMin){a();const M=y.getNumberOfPoints(),R=new Array(M);for(let B=0;B<M;B++)R[B]=0;const V=[];ps.hasSubCells(T)?y.evaluateLocation(S,v,V,R):y.evaluateLocation(v,V,R),e.dataSet=x,e.cellId=p,e.pCoords[0]=v[0],e.pCoords[1]=v[1],e.pCoords[2]=v[2];let O=0,D=-1;for(let B=0;B<M;B++)R[B]>O&&(D=B,O=R[B]);D!==-1&&(e.pointId=y.getPointsIds()[D]),e.mapperPosition[0]=l[0],e.mapperPosition[1]=l[1],e.mapperPosition[2]=l[2],t.computeSurfaceNormal(x,y,R,e.mapperNormal)||(e.mapperNormal[0]=s[0]-i[0],e.mapperNormal[1]=s[1]-i[1],e.mapperNormal[2]=s[2]-i[2],we(e.mapperNormal))}return f}}const jR={cellId:-1,pCoords:[],cellIJK:[],pickNormal:[],mapperNormal:[],opacityThreshold:.2};function Y0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jR,n),K0.extend(t,e,n),E.getArray(t,e,["pickNormal","mapperNormal","pCoords","cellIJK"]),E.setGet(t,e,["opacityThreshold"]),E.get(t,e,["cellId"]),AR(t,e)}const KR=E.newInstance(Y0,"vtkCellPicker");var PR={newInstance:KR,extend:Y0,...HR};const{vtkErrorMacro:XR}=E;function IR(t,e){e.classHierarchy.push("vtkPointPicker"),e.intersectWithLine=(n,r,a,s,i)=>{let o=Number.MAX_VALUE;if(i.isA("vtkImageMapper")||i.isA("vtkImageArrayMapper")){const c=i.intersectWithLineForPointPicking(n,r);c&&(o=c.t,e.pointIJK=c.ijk)}else i.isA("vtkMapper")&&(o=e.intersectActorWithLine(n,r,a,i));return o},e.intersectActorWithLine=(n,r,a,s)=>{const i=s.getInputData();let o=0;const c=i.getPoints().getNumberOfPoints();if(c<=o)return 2;const u=[];for(let S=0;S<3;S++)u[S]=r[S]-n[S];const g=W(u,u);if(g===0)return XR("Cannot process points"),2;let f,l=-1,h=Number.MAX_VALUE,v=Number.MAX_VALUE;const p=[],y=[],T=i.getPoints();if(e.useCells){const S=i.getPolys().getData(),d=S[0],x=i.getPolys().getNumberOfCells();for(let w=0;w<x;w++){const C=w*d+1,M=C+d;for(let R=C;R<M;R++){const V=S[R];if(T.getPoint(V,y),f=(u[0]*(y[0]-n[0])+u[1]*(y[1]-n[1])+u[2]*(y[2]-n[2]))/g,f>=0&&f<=1&&f<=h+e.tolerance){let O=0;for(let D=0;D<3;D++){p[D]=n[D]+f*u[D];const B=Math.abs(y[D]-p[D]);B>O&&(O=B)}O<=a&&O<v&&(l=o,y[0],y[1],y[2],v=O,h=f)}}}}else for(o=0;o<c;o++)if(T.getPoint(o,y),f=(u[0]*(y[0]-n[0])+u[1]*(y[1]-n[1])+u[2]*(y[2]-n[2]))/g,f>=0&&f<=1&&f<=h+e.tolerance){let S=0;for(let d=0;d<3;d++){p[d]=n[d]+f*u[d];const x=Math.abs(y[d]-p[d]);x>S&&(S=x)}S<=a&&S<v&&(l=o,y[0],y[1],y[2],v=S,h=f)}return l>-1&&h<e.globalTMin&&(e.globalTMin=h,e.pointId=l),h}}const YR={pointId:-1,pointIJK:[],useCells:!1};function Q0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YR,n),K0.extend(t,e,n),E.getArray(t,e,["pointIJK"]),E.get(t,e,["pointId"]),E.setGet(t,e,["useCells"]),IR(t,e)}const QR=E.newInstance(Q0,"vtkPointPicker");var ZR={newInstance:QR,extend:Q0};const qR=t=>t,ec=1e-6;class Z0{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=Y(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?ol:qR}rotateFromDirections(e,n){const r=new Float64Array(3),a=new Float64Array(3),s=new Float64Array(16);it(r,e[0],e[1],e[2]),it(a,n[0],n[1],n[2]),mt(r,r),mt(a,a);const i=Ms(r,a);return i>=1?this:(dn(this.tmp,r,a),Ka(this.tmp)<ec&&(dn(this.tmp,[1,0,0],e),Ka(this.tmp)<ec&&dn(this.tmp,[0,1,0],e)),cc(s,Math.acos(i),this.tmp),pe(this.matrix,this.matrix,s),this)}rotate(e,n){return it(this.tmp,...n),mt(this.tmp,this.tmp),Ye(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return Ss(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return Cs(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return ws(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,n,r){return it(this.tmp,e,n,r),le(this.matrix,this.matrix,this.tmp),this}scale(e,n,r){return it(this.tmp,e,n,r),en(this.matrix,this.matrix,this.tmp),this}multiply(e){return pe(this.matrix,this.matrix,e),this}multiply3x3(e){return pe(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return Ve(this.matrix,this.matrix),this}identity(){return Y(this.matrix),this}apply(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(Mn(yf,this.matrix))return this;const a=r===-1?e.length:n+r*3;for(let s=n;s<a;s+=3)it(this.tmp,e[s],e[s+1],e[s+2]),q(this.tmp,this.tmp,this.matrix),e[s]=this.tmp[0],e[s+1]=this.tmp[1],e[s+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&Oe(this.matrix,e),this}}function JR(){return new Z0(!0)}function eO(){return new Z0(!1)}var q0={buildFromDegree:JR,buildFromRadian:eO};function tO(t,e){e.classHierarchy.push("vtkConeSource"),t.requestData=(n,r)=>{var h;const a=2*Math.PI/e.resolution,s=-e.height/2,i=e.resolution+1,o=4*e.resolution+1+e.resolution;let c=0;const u=E.newTypedArray(e.pointType,i*3);let g=0;const f=new Uint32Array(o);u[0]=e.height/2,u[1]=0,u[2]=0,e.capping&&(f[g++]=e.resolution);for(let v=0;v<e.resolution;v++)c++,u[c*3+0]=s,u[c*3+1]=e.radius*Math.cos(v*a),u[c*3+2]=e.radius*Math.sin(v*a),e.capping&&(f[e.resolution-g+++1]=c);for(let v=0;v<e.resolution;v++)f[g++]=3,f[g++]=0,f[g++]=v+1,f[g++]=v+2>e.resolution?1:v+2;q0.buildFromRadian().translate(...e.center).rotateFromDirections([1,0,0],e.direction).apply(u);const l=((h=r[0])==null?void 0:h.initialize())||St.newInstance();l.getPoints().setData(u,3),l.getPolys().setData(f,1),r[0]=l}}const nO={height:1,radius:.5,resolution:6,center:[0,0,0],direction:[1,0,0],capping:!0,pointType:"Float64Array"};function J0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nO,n),E.obj(t,e),E.setGet(t,e,["height","radius","resolution","capping"]),E.setGetArray(t,e,["center","direction"],3),E.algo(t,e,0,1),tO(t,e)}const rO=E.newInstance(J0,"vtkConeSource");var aO={newInstance:rO,extend:J0};function sO(t,e){e.classHierarchy.push("vtkSphereSource"),t.requestData=(n,r)=>{let a=r[0];const s=a?a.getPoints().getDataType():e.pointType;a=(a==null?void 0:a.initialize())||St.newInstance();let i=0,{thetaResolution:o}=e,c=e.startTheta<e.endTheta?e.startTheta:e.endTheta;c*=Math.PI/180;let u=e.endTheta>e.startTheta?e.endTheta:e.startTheta;u*=Math.PI/180;let g=e.startPhi<e.endPhi?e.startPhi:e.endPhi;g*=Math.PI/180;let f=e.endPhi>e.startPhi?e.endPhi:e.startPhi;f*=Math.PI/180,Math.abs(c-u)<2*Math.PI&&++o;const l=(u-c)/e.thetaResolution,h=e.startPhi<=0?1:0,v=e.phiResolution+(e.endPhi>=180?-1:0),p=e.phiResolution*o+2,y=e.phiResolution*2*e.thetaResolution;let T=0,S=E.newTypedArray(s,p*3),d=new Float32Array(p*3),x=0,w=new Uint32Array(y*5);e.startPhi<=0&&(S[T*3+0]=e.center[0],S[T*3+1]=e.center[1],S[T*3+2]=e.center[2]+e.radius,d[T*3+0]=0,d[T*3+1]=0,d[T*3+2]=1,T++,i++),e.endPhi>=180&&(S[T*3+0]=e.center[0],S[T*3+1]=e.center[1],S[T*3+2]=e.center[2]-e.radius,d[T*3+0]=0,d[T*3+1]=0,d[T*3+2]=-1,T++,i++);const C=e.phiResolution-i,M=(f-g)/(e.phiResolution-1);for(let O=0;O<o;O++){const D=c+O*l;for(let B=h;B<v;B++){const L=g+B*M,F=e.radius*Math.sin(L);d[T*3+0]=F*Math.cos(D),d[T*3+1]=F*Math.sin(D),d[T*3+2]=e.radius*Math.cos(L),S[T*3+0]=d[T*3+0]+e.center[0],S[T*3+1]=d[T*3+1]+e.center[1],S[T*3+2]=d[T*3+2]+e.center[2];let U=Math.sqrt(d[T*3+0]*d[T*3+0]+d[T*3+1]*d[T*3+1]+d[T*3+2]*d[T*3+2]);U=U===0?1:U,d[T*3+0]/=U,d[T*3+1]/=U,d[T*3+2]/=U,T++}}const R=C*o;if(Math.abs(c-u)<2*Math.PI&&--o,e.startPhi<=0)for(let O=0;O<o;O++)w[x++]=3,w[x++]=C*O+i,w[x++]=C*(O+1)%R+i,w[x++]=0;if(e.endPhi>=180){const O=C-1+i;for(let D=0;D<o;D++)w[x++]=3,w[x++]=C*D+O,w[x++]=i-1,w[x++]=C*(D+1)%R+O}for(let O=0;O<o;O++)for(let D=0;D<C-1;D++){const B=C*O+D+i,L=B+1,F=(C*(O+1)+D)%R+i+1;e.latLongTessellation?(w[x++]=4,w[x++]=B,w[x++]=L,w[x++]=F,w[x++]=F-1):(w[x++]=3,w[x++]=B,w[x++]=L,w[x++]=F,w[x++]=3,w[x++]=B,w[x++]=F,w[x++]=F-1)}S=S.subarray(0,T*3),a.getPoints().setData(S,3),d=d.subarray(0,T*3);const V=ee.newInstance({name:"Normals",values:d,numberOfComponents:3});a.getPointData().setNormals(V),w=w.subarray(0,x),a.getPolys().setData(w,1),r[0]=a}}const iO={radius:.5,latLongTessellation:!1,thetaResolution:8,startTheta:0,endTheta:360,phiResolution:8,startPhi:0,endPhi:180,center:[0,0,0],pointType:"Float64Array"};function el(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iO,n),E.obj(t,e),E.setGet(t,e,["radius","latLongTessellation","thetaResolution","startTheta","endTheta","phiResolution","startPhi","endPhi"]),E.setGetArray(t,e,["center"],3),E.algo(t,e,0,1),sO(t,e)}const oO=E.newInstance(el,"vtkSphereSource");var cO={newInstance:oO,extend:el};function fO(t,e){e.classHierarchy.push("vtkCylinderSource"),t.requestData=(n,r)=>{var C;const a=2*Math.PI/e.resolution;let s=2*e.resolution,i=5*e.resolution;e.capping&&(s=4*e.resolution,i=7*e.resolution+2);const o=E.newTypedArray(e.pointType,s*3);let c=0;const u=new Uint32Array(i),g=new Float32Array(s*3),f=ee.newInstance({numberOfComponents:3,values:g,name:"Normals"}),l=new Float32Array(s*2),h=ee.newInstance({numberOfComponents:2,values:l,name:"TCoords"}),v=[0,0,0],p=[0,0,0],y=[0,0,0],T=[0,0,0],S=[0,0],d=[0,0],x=e.otherRadius==null?e.radius:e.otherRadius;for(let M=0;M<e.resolution;M++){v[0]=Math.cos(M*a+e.initAngle),p[0]=v[0],y[0]=e.radius*v[0]+e.center[0],T[0]=y[0],S[0]=Math.abs(2*M/e.resolution-1),d[0]=S[0],y[1]=.5*e.height+e.center[1],T[1]=-.5*e.height+e.center[1],S[1]=0,d[1]=1,v[2]=-Math.sin(M*a+e.initAngle),p[2]=v[2],y[2]=x*v[2]+e.center[2],T[2]=y[2];const R=2*M;for(let V=0;V<3;V++)g[R*3+V]=v[V],g[(R+1)*3+V]=p[V],o[R*3+V]=y[V],o[(R+1)*3+V]=T[V],V<2&&(l[R*2+V]=S[V],l[(R+1)*2+V]=d[V])}for(let M=0;M<e.resolution;M++){u[c++]=4,u[c++]=2*M,u[c++]=2*M+1;const R=(2*M+3)%(2*e.resolution);u[c++]=R,u[c++]=R-1}if(e.capping){for(let M=0;M<e.resolution;M++){y[0]=e.radius*Math.cos(M*a+e.initAngle),T[0]=y[0],S[0]=y[0],d[0]=y[0],y[0]+=e.center[0],T[0]+=e.center[0],v[1]=1,p[1]=-1,y[1]=.5*e.height+e.center[1],T[1]=-.5*e.height+e.center[1],y[2]=-x*Math.sin(M*a+e.initAngle),T[2]=y[2],S[1]=y[2],d[1]=y[2],y[2]+=e.center[2],T[2]+=e.center[2];const R=2*e.resolution+M,V=3*e.resolution+e.resolution-M-1;for(let O=0;O<3;O++)g[3*R+O]=v[O],g[3*V+O]=p[O],o[3*R+O]=y[O],o[3*V+O]=T[O],O<2&&(l[2*R+O]=S[O],l[2*V+O]=d[O])}u[c++]=e.resolution;for(let M=0;M<e.resolution;M++)u[c++]=2*e.resolution+M;u[c++]=e.resolution;for(let M=0;M<e.resolution;M++)u[c++]=3*e.resolution+M}q0.buildFromRadian().translate(...e.center).rotateFromDirections([0,1,0],e.direction).translate(...e.center.map(M=>M*-1)).apply(o);const w=((C=r[0])==null?void 0:C.initialize())||St.newInstance();w.getPoints().setData(o,3),w.getPolys().setData(u,1),w.getPointData().setNormals(f),w.getPointData().setTCoords(h),r[0]=w}}const uO={height:1,initAngle:0,radius:1,resolution:6,center:[0,0,0],direction:[0,1,0],capping:!0,pointType:"Float64Array"};function tl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uO,n),E.obj(t,e),E.setGet(t,e,["height","initAngle","otherRadius","radius","resolution","capping"]),E.setGetArray(t,e,["center","direction"],3),E.algo(t,e,0,1),fO(t,e)}const gO=E.newInstance(tl,"vtkCylinderSource");var lO={newInstance:gO,extend:tl};class pO{constructor(e,n,r={}){this.subUnsub=[],this.listeners=new Set,this.interactor=e,this.picker=n,this.opts={button:r.button??"left",requireModifiers:r.requireModifiers??{}},this.attach()}dispose(){for(;this.subUnsub.length;){const e=this.subUnsub.pop();try{e&&e()}catch{}}this.listeners.clear()}onPick(e){return this.listeners.add(e),()=>this.listeners.delete(e)}attach(){const e=r=>{const a=this.toUnsubscribe(r);a&&this.subUnsub.push(a)},n=r=>a=>{const{position:s,pokedRenderer:i}=a||{};if(!i||!s)return;const o={shift:!!a.shiftKey,ctrl:!!a.controlKey,alt:!!a.altKey,meta:!!a.metaKey};if(!this.modifiersMatch(o,this.opts.requireModifiers))return;const c=[s.x,s.y,0];this.picker.pick(c,i);const u=this.computePicked(this.picker),g={renderer:i,rawEvent:a,displayPos:c,picked:u,picker:this.picker,modifiers:o,button:r},f=this.normalizePick(this.picker),l=Object.assign(g,f);this.listeners.forEach(h=>h(l))};switch(this.opts.button){case"left":e(this.interactor.onLeftButtonPress(n("left")));break;case"middle":e(this.interactor.onMiddleButtonPress(n("middle")));break;case"right":e(this.interactor.onRightButtonPress(n("right")));break}}computePicked(e){var n,r;return!!(typeof e.getActors=="function"&&(((n=e.getActors())==null?void 0:n.length)??0)>0||typeof e.getProp3Ds=="function"&&(((r=e.getProp3Ds())==null?void 0:r.length)??0)>0||typeof e.getActor=="function"&&e.getActor()||typeof e.getViewProp=="function"&&e.getViewProp()||typeof e.getCellId=="function"&&typeof e.getCellId()=="number"&&e.getCellId()>=0||typeof e.getPointId=="function"&&typeof e.getPointId()=="number"&&e.getPointId()>=0||typeof e.getPropId=="function"&&typeof e.getPropId()=="number"&&e.getPropId()>=0||typeof e.getCompositeID=="function"&&typeof e.getCompositeID()=="number"&&e.getCompositeID()>=0)}normalizePick(e){var i,o;let n=null;typeof e.getActor=="function"&&e.getActor()?n=e.getActor():typeof e.getViewProp=="function"&&e.getViewProp()?n=e.getViewProp():typeof e.getActors=="function"&&((i=e.getActors())!=null&&i.length)?n=e.getActors()[0]:typeof e.getProp3Ds=="function"&&((o=e.getProp3Ds())!=null&&o.length)&&(n=e.getProp3Ds()[0]);const r=typeof e.getPickPosition=="function"?e.getPickPosition():null,a=typeof e.getCellId=="function"?e.getCellId():void 0,s=typeof e.getPointId=="function"?e.getPointId():void 0;return{actor:n,world:r,cellId:a,pointId:s}}modifiersMatch(e,n){return!(n.shift!==void 0&&e.shift!==n.shift||n.ctrl!==void 0&&e.ctrl!==n.ctrl||n.alt!==void 0&&e.alt!==n.alt||n.meta!==void 0&&e.meta!==n.meta)}toUnsubscribe(e){return e?typeof e=="function"?e:typeof e.unsubscribe=="function"?()=>e.unsubscribe():null:null}}const vi=LR.newInstance({rootContainer:document.body,containerStyle:{position:"absolute",top:0,left:0,right:0,bottom:0}}),xa=vi.getRenderer(),nl=vi.getRenderWindow(),hO=vi.getInteractor(),yO=rn,vO=an,TO=aO,dO=cO,xO=lO;function Ti(t,e,n){const r=vO.newInstance();r.setInputConnection(t.getOutputPort());const a=yO.newInstance();return a.setMapper(r),a.getProperty().setColor(...e),a.setPosition(...n),a}const rl=Ti(TO.newInstance({height:1,radius:.5,resolution:40}),[1,.35,.35],[-1.5,0,0]),al=Ti(dO.newInstance({radius:.55,phiResolution:32,thetaResolution:32}),[.35,1,.35],[0,0,0]),sl=Ti(xO.newInstance({height:1.1,radius:.35,resolution:40}),[.35,.35,1],[1.5,0,0]);xa.addActor(rl);xa.addActor(al);xa.addActor(sl);xa.resetCamera();nl.render();const SO=PR,CO=ZR,te={pickerType:document.getElementById("pickerType"),mouseBtn:document.getElementById("mouseBtn"),modifier:document.getElementById("modifier"),status:document.getElementById("status"),actor:document.getElementById("actor"),screen:document.getElementById("screen"),world:document.getElementById("world"),cell:document.getElementById("cell"),point:document.getElementById("point"),mods:document.getElementById("mods"),btn:document.getElementById("btn")};let _n=null,tc=null;function wO(t){if(t==="cell")return SO.newInstance();if(t==="point")return CO.newInstance()}function EO(){te.status.textContent="ready",te.actor.textContent="–",te.screen.textContent="–",te.world.textContent="–",te.cell.textContent="–",te.point.textContent="–",te.mods.textContent="–",te.btn.textContent="–"}function MO(t){return t?t===rl?"Cone (red)":t===al?"Sphere (green)":t===sl?"Cylinder (blue)":"Actor":"–"}function Sa(){_n&&_n.dispose&&_n.dispose(),tc=wO(te.pickerType.value),_n=new pO(hO,tc,{button:te.mouseBtn.value,requireModifiers:function(){const t=te.modifier.value,e={};return t==="shift"&&(e.shift=!0),t==="ctrl"&&(e.ctrl=!0),t==="alt"&&(e.alt=!0),t==="meta"&&(e.meta=!0),e}()}),_n.onPick(t=>{if(te.screen.textContent=`${t.displayPos[0].toFixed(1)}, ${t.displayPos[1].toFixed(1)}`,te.mods.textContent=[t.modifiers.shift?"Shift":null,t.modifiers.ctrl?"Ctrl":null,t.modifiers.alt?"Alt":null,t.modifiers.meta?"Meta":null].filter(Boolean).join("+")||"none",te.btn.textContent=t.button,!t.picked){te.status.textContent="no hit",te.actor.textContent="–",te.world.textContent="–",te.cell.textContent="–",te.point.textContent="–";return}const e=t.actor,n=t.world;te.status.textContent="hit",te.actor.textContent=e?MO(e):"–",te.world.textContent=n?`${n[0].toFixed(3)}, ${n[1].toFixed(3)}, ${n[2].toFixed(3)}`:"–",te.cell.textContent=typeof t.cellId=="number"&&t.cellId>=0?t.cellId:"–",te.point.textContent=typeof t.pointId=="number"&&t.pointId>=0?t.pointId:"–"}),EO()}Sa();te.pickerType.addEventListener("change",Sa);te.mouseBtn.addEventListener("change",Sa);te.modifier.addEventListener("change",Sa);window.addEventListener("resize",()=>{nl.render()});
